
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>groovy IO | ming15</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ming15">
    

    
    <meta name="description" content="本文是对Groovy部分官方文档进行了翻译

读文件作为第一个例子,让我们看一下,如何输出一个文本文件里的所有行123new File(baseDir, &apos;haiku.txt&apos;).eachLine &amp;#123; line -&amp;gt;    println line&amp;#125;
eachLine方法是Groovy自动添加到File Class的,同时呢,Groovy还添加了很多变量,例如,你如果想">
<meta property="og:type" content="article">
<meta property="og:title" content="groovy IO">
<meta property="og:url" content="http://www.ming15.wang/2014/04/08/groovy/groovyIO/index.html">
<meta property="og:site_name" content="ming15">
<meta property="og:description" content="本文是对Groovy部分官方文档进行了翻译

读文件作为第一个例子,让我们看一下,如何输出一个文本文件里的所有行123new File(baseDir, &apos;haiku.txt&apos;).eachLine &amp;#123; line -&amp;gt;    println line&amp;#125;
eachLine方法是Groovy自动添加到File Class的,同时呢,Groovy还添加了很多变量,例如,你如果想">
<meta property="og:updated_time" content="2016-03-16T00:56:42.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="groovy IO">
<meta name="twitter:description" content="本文是对Groovy部分官方文档进行了翻译

读文件作为第一个例子,让我们看一下,如何输出一个文本文件里的所有行123new File(baseDir, &apos;haiku.txt&apos;).eachLine &amp;#123; line -&amp;gt;    println line&amp;#125;
eachLine方法是Groovy自动添加到File Class的,同时呢,Groovy还添加了很多变量,例如,你如果想">

    
    <link rel="alternative" href="/atom.xml" title="ming15" type="application/atom+xml">
    
    
    
    <link rel="apple-touch-icon" href="/img/author.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/author.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="ming15" title="ming15"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="ming15">ming15</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
						<form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 17728547076946147000 ><input type="text" name="q" size="30" placeholder="搜索"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/04/08/groovy/groovyIO/" title="groovy IO" itemprop="url">groovy IO</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2014-04-07T16:00:00.000Z" itemprop="datePublished"> 发表于 2014-04-08</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#读文件"><span class="toc-number">1.</span> <span class="toc-text">读文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写文件"><span class="toc-number">2.</span> <span class="toc-text">写文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#遍历文件"><span class="toc-number">3.</span> <span class="toc-text">遍历文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#序列化"><span class="toc-number">4.</span> <span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行命令"><span class="toc-number">5.</span> <span class="toc-text">执行命令</span></a></li></ol>
		
		</div>
		
		<blockquote>
<p>本文是对Groovy部分官方文档进行了翻译</p>
</blockquote>
<h3 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h3><p>作为第一个例子,让我们看一下,如何输出一个文本文件里的所有行<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> File(baseDir, <span class="string">'haiku.txt'</span>).eachLine &#123; line -&gt;</span><br><span class="line">    println line</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>eachLine</code>方法是Groovy自动添加到File Class的,同时呢,Groovy还添加了很多变量,例如,你如果想要知道每一行的行号,你可以使用这个变量:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> File(baseDir, <span class="string">'haiku.txt'</span>).eachLine &#123; line, nb -&gt;</span><br><span class="line">    println <span class="string">"Line $nb: $line"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>无论由于什么原因, 当<code>eachLine</code>中抛出了异常,这个方法都会确保,资源已经被正确的关闭掉了. 这对所有Groovy自动添加的关于I/O资源的方法都有效.</p>
<p>例如, 某种情况你使用了<code>Reader</code>, 但是你还想让Groovy自己管理资源. 下面这个例子, 即使抛出了exception, reader仍然会被自动关闭.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> count = <span class="number">0</span>, MAXSIZE = <span class="number">3</span></span><br><span class="line"><span class="keyword">new</span> File(baseDir,<span class="string">"haiku.txt"</span>).withReader &#123; reader -&gt;</span><br><span class="line">    <span class="keyword">while</span> (reader.readLine()) &#123;</span><br><span class="line">        <span class="keyword">if</span> (++count &gt; MAXSIZE) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'Haiku should only have 3 verses'</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果你想要把文本文件中每一行都放进一个list中, 你可以这么做:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> list = <span class="keyword">new</span> File(baseDir, <span class="string">'haiku.txt'</span>).collect &#123;it&#125;</span><br></pre></td></tr></table></figure></p>
<p>或者你想利用操作符将文件中每一行都添加到一个数组中:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> array = <span class="keyword">new</span> File(baseDir, <span class="string">'haiku.txt'</span>) <span class="keyword">as</span> String[]</span><br></pre></td></tr></table></figure></p>
<p>下面这个示例,非常简单的实现了,将一个文件存进一个字节数组里:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span>[] contents = file.bytes</span><br></pre></td></tr></table></figure></p>
<p>如下例,我们轻松地获得了一个输入流.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> is = <span class="keyword">new</span> File(baseDir,<span class="string">'haiku.txt'</span>).newInputStream()</span><br><span class="line"><span class="comment">// do something ...</span></span><br><span class="line">is.close()</span><br></pre></td></tr></table></figure></p>
<p>上个例子中我们获得了一个输入流,但是最后我们不得不手动关闭它, Groovy提供另一个方法<code>withInputStream</code>, 这个方法可以帮我们自动的关闭输入流.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> File(baseDir,<span class="string">'haiku.txt'</span>).withInputStream &#123; stream -&gt;</span><br><span class="line">    <span class="comment">// do something ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h3><p>有时候,你需要的也许只是写文件,下面展示了,如何在Groovy中写文件<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> File(baseDir,<span class="string">'haiku.txt'</span>).withWriter(<span class="string">'utf-8'</span>) &#123; writer -&gt;</span><br><span class="line">    writer.writeLine <span class="string">'Into the ancient pond'</span></span><br><span class="line">    writer.writeLine <span class="string">'A frog jumps'</span></span><br><span class="line">    writer.writeLine <span class="string">'Water’s sound!'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>但对于一个要求很简单的需求来说,我们可以使用<code>&lt;&lt;</code>向文件中写<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> File(baseDir,<span class="string">'haiku.txt'</span>) &lt;&lt; <span class="string">'''Into the ancient pond</span><br><span class="line">A frog jumps</span><br><span class="line">Water’s sound!'''</span></span><br></pre></td></tr></table></figure></p>
<p>当然不是每一次我们都是向文件中输出文本,下面的例子演示了,我们如何向一个文件中写入字节:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file.bytes = [<span class="number">66</span>,<span class="number">22</span>,<span class="number">11</span>]</span><br></pre></td></tr></table></figure></p>
<p>当然,你也可以直接打开一个输出流,下面的例子演示了如何开启一个输出流.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> os = <span class="keyword">new</span> File(baseDir,<span class="string">'data.bin'</span>).newOutputStream()</span><br><span class="line"><span class="comment">// do something ...</span></span><br><span class="line">os.close()</span><br></pre></td></tr></table></figure></p>
<p>同<code>newInputStream</code>一样,<code>newOutputStream</code>同样需要手动关闭, ok,你大概想到了<code>withOutputStream</code>:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> File(baseDir,<span class="string">'data.bin'</span>).withOutputStream &#123; stream -&gt;</span><br><span class="line">    <span class="comment">// do something ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="遍历文件"><a href="#遍历文件" class="headerlink" title="遍历文件"></a>遍历文件</h3><p>在脚本中, 有个很常用的需求就是,遍历一个目录,然后找到一个文件,进行某些操作. Groovy提供了很多方法,来达到这个效果. 下面的例子演示了将一个目录下的所有文件都执行某个操作:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">dir.eachFile &#123; file -&gt;                      (<span class="number">1</span>)</span><br><span class="line">    println file.name</span><br><span class="line">&#125;</span><br><span class="line">dir.eachFileMatch(<span class="regexp">~/.*\.txt/</span>) &#123; file -&gt;     (<span class="number">2</span>)</span><br><span class="line">    println file.name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li>在目录下的每个文件上执行闭包操作.</li>
<li>根据正则表达式在目录下找到符合条件的文件,然后执行闭包操作.</li>
</ol>
<p>也许你想要遍历某个目录和目录里的所有子目录, 那么你可以使用<code>eachFileRecurse</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">dir.eachFileRecurse &#123; file -&gt;                      (<span class="number">1</span>)</span><br><span class="line">    println file.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dir.eachFileRecurse(FileType.FILES) &#123; file -&gt;      (<span class="number">2</span>)</span><br><span class="line">    println file.name</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ol>
<li>对目录里的所有子目录进行递归, 然后对找到的文件和目录进行闭包操作</li>
<li>对目录里进行递归查找,但是只查找文件.</li>
</ol>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">dir.traverse &#123; file -&gt;</span><br><span class="line">    <span class="keyword">if</span> (file.directory &amp;&amp; file.name==<span class="string">'bin'</span>) &#123;</span><br><span class="line">        FileVisitResult.TERMINATE                   (<span class="number">1</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        println file.name</span><br><span class="line">        FileVisitResult.CONTINUE                    (<span class="number">2</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>如果找到的文件是目录,且它的名字是”dir”, 则停止遍历</li>
<li>打印出文件的名字,接着遍历</li>
</ol>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p>在java中会使用<code>java.io.DataOutputStream</code> 序列化数据也不罕见. Groovy对这个需求也做了非常简单的实现, 下面的例子演示了如何序列化和反序列化:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">boolean</span> b = <span class="literal">true</span></span><br><span class="line">String message = <span class="string">'Hello from Groovy'</span></span><br><span class="line"><span class="comment">// Serialize data into a file</span></span><br><span class="line">file.withDataOutputStream &#123; out -&gt;</span><br><span class="line">    out.writeBoolean(b)</span><br><span class="line">    out.writeUTF(message)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// Then read it back</span></span><br><span class="line">file.withDataInputStream &#123; input -&gt;</span><br><span class="line">    <span class="keyword">assert</span> input.readBoolean() == b</span><br><span class="line">    <span class="keyword">assert</span> input.readUTF() == message</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>同样,如果这个数据实例了序列化接口<code>Serializable</code>, 你可以使用 object output stream将整个数据序列化到文件:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Person p = <span class="keyword">new</span> Person(<span class="string">name:</span><span class="string">'Bob'</span>, <span class="string">age:</span><span class="number">76</span>)</span><br><span class="line"><span class="comment">// Serialize data into a file</span></span><br><span class="line">file.withObjectOutputStream &#123; out -&gt;</span><br><span class="line">    out.writeObject(p)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"><span class="comment">// Then read it back</span></span><br><span class="line">file.withObjectInputStream &#123; input -&gt;</span><br><span class="line">    <span class="keyword">def</span> p2 = input.readObject()</span><br><span class="line">    <span class="keyword">assert</span> p2.name == p.name</span><br><span class="line">    <span class="keyword">assert</span> p2.age == p.age</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h3><p>前面的章节介绍了在Groovy中操作files, readers or streams非常简单. 然而, 像系统管理员或者开发者,可能更多的是执行一个系统命令.</p>
<p>Groovy同样提供了非常简单的方式执行命令行命令. 只需要定义一个命令的字符串,然后执行这个字符串的<code>execute()</code>. 在类Unix系统中(如果在windows中也安装了类Unix命令行工具也算),你可以这样执行命令.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> process = <span class="string">"ls -l"</span>.execute()             (<span class="number">1</span>)</span><br><span class="line">println <span class="string">"Found text $&#123;process.text&#125;"</span>        (<span class="number">2</span>)</span><br></pre></td></tr></table></figure></p>
<ol>
<li>在外部过程(external process)执行ls命令</li>
<li>获得命令的输出,并输出</li>
</ol>
<p><code>execute()</code>方法返回一个<code>java.lang.Process</code>实例, 随后选择一种输出流<code>in/out/err</code>, 同时检查<code>exit</code>值,查看是否命令执行完毕.</p>
<p>下面的例子使用了和刚才那个例子一样的命令,但是现在我们每次都会对获得的结果进行行输出.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line">            <span class="keyword">def</span> process = <span class="string">"ls -l"</span>.execute()             (<span class="number">1</span>)</span><br><span class="line">            process.<span class="keyword">in</span>.eachLine &#123; line -&gt;               (<span class="number">2</span>)</span><br><span class="line">                println line                            (<span class="number">3</span>)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">assert</span> process <span class="keyword">instanceof</span> Process</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> testProcessConsumeOutput() &#123;</span><br><span class="line">        <span class="keyword">if</span> (unixlike) &#123;</span><br><span class="line">            doInTmpDir &#123; b -&gt;</span><br><span class="line">                File file = <span class="literal">null</span></span><br><span class="line">                <span class="keyword">def</span> tmpDir = b.tmp &#123;</span><br><span class="line">                    file = <span class="string">'foo.tmp'</span>(<span class="string">'foo'</span>)</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">assert</span> file.exists()</span><br><span class="line">                <span class="keyword">def</span> p = <span class="string">"rm -f foo.tmp"</span>.execute([], tmpDir)</span><br><span class="line">                p.consumeProcessOutput()</span><br><span class="line">                p.waitFor()</span><br><span class="line">                <span class="keyword">assert</span> !file.exists()</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> testProcessPipe() &#123;</span><br><span class="line">        <span class="keyword">if</span> (unixlike) &#123;</span><br><span class="line">            doInTmpDir &#123; b -&gt;</span><br><span class="line">                <span class="keyword">def</span> proc1, proc2, proc3, proc4</span><br><span class="line">                proc1 = <span class="string">'ls'</span>.execute()</span><br><span class="line">                proc2 = <span class="string">'tr -d o'</span>.execute()</span><br><span class="line">                proc3 = <span class="string">'tr -d e'</span>.execute()</span><br><span class="line">                proc4 = <span class="string">'tr -d i'</span>.execute()</span><br><span class="line">                proc1 | proc2 | proc3 | proc4</span><br><span class="line">                proc4.waitFor()</span><br><span class="line">                <span class="keyword">if</span> (proc4.exitValue()) &#123;</span><br><span class="line">                    println proc4.err.text</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    println proc4.text</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">def</span> sout = <span class="keyword">new</span> StringBuilder()</span><br><span class="line">                <span class="keyword">def</span> serr = <span class="keyword">new</span> StringBuilder()</span><br><span class="line">                proc2 = <span class="string">'tr -d o'</span>.execute()</span><br><span class="line">                proc3 = <span class="string">'tr -d e'</span>.execute()</span><br><span class="line">                proc4 = <span class="string">'tr -d i'</span>.execute()</span><br><span class="line">                proc4.consumeProcessOutput(sout, serr)</span><br><span class="line">                proc2 | proc3 | proc4</span><br><span class="line">                [proc2, proc3].each &#123; it.consumeProcessErrorStream(serr) &#125;</span><br><span class="line">                proc2.withWriter &#123; writer -&gt;</span><br><span class="line">                    writer &lt;&lt; <span class="string">'testfile.groovy'</span></span><br><span class="line">                &#125;</span><br><span class="line">                proc4.waitForOrKill(<span class="number">1000</span>)</span><br><span class="line">                println <span class="string">"Standard output: $sout"</span></span><br><span class="line">                println <span class="string">"Standard error: $serr"</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> &#123;</span></span><br><span class="line">        String name</span><br><span class="line">        <span class="keyword">int</span> age</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>1    executes the ls command in an external process<br>2    for each line of the input stream of the process<br>3    print the line</p>
<ol>
<li>在外部进程中执行ls命令<br>2.</li>
</ol>
<p>It is worth noting that in corresponds to an input stream to the standard output of the command. out will refer to a stream where you can send data to the process (its standard input).</p>
<p>Remember that many commands are shell built-ins and need special handling. So if you want a listing of files in a directory on a Windows machine and write:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> process = <span class="string">"dir"</span>.execute()</span><br><span class="line">println <span class="string">"$&#123;process.text&#125;"</span></span><br></pre></td></tr></table></figure>
<p>接着你会收到一个异常<code>IOException</code>,异常信息为<code>Cannot run program &quot;dir&quot;: CreateProcess error=2</code>,系统找不到指定的文件.</p>
<p>这是因为<code>dir</code>是内建于<code>windows shell(cmd.ext)</code>, 想要使用那个命令,你要像下面这个样操作:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> process = <span class="string">"cmd /c dir"</span>.execute()</span><br><span class="line">println <span class="string">"$&#123;process.text&#125;"</span></span><br></pre></td></tr></table></figure></p>
<p>还有,因为上述的功能是在内部使用的<code>java.lang.Process</code>, 这个类的一些不足的地方,我们也要充分考虑. 在javadoc中,是这样描述这个类的:</p>
<blockquote>
<p>Because some native platforms only provide limited buffer size for standard input and output streams, failure to promptly write the input stream or read the output stream of the subprocess may cause the subprocess to block, and even deadlock<br>Because of this, Groovy provides some additional helper methods which make stream handling for processes easier.</p>
</blockquote>
<p>现在演示一下,如何输出进程里所有的输出(包括error stream).<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> p = <span class="string">"rm -f foo.tmp"</span>.execute([], tmpDir)</span><br><span class="line">p.consumeProcessOutput()</span><br><span class="line">p.waitFor()</span><br></pre></td></tr></table></figure></p>
<p><code>consumeProcessOutput</code>仍然有很多对<code>StringBuffer</code>, <code>InputStream</code>, <code>OutputStream</code>等封装的变量, 如果想要获取一个完整的封装列表的,那可以参考 <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Process.html" target="_blank" rel="external">GDK API for java.lang.Process</a></p>
<p>另外, <code>pipeTo</code>命令 可以让一个进程的输出流连接到一个进程的输入流里. 如下例:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">proc1 = <span class="string">'ls'</span>.execute()</span><br><span class="line">proc2 = <span class="string">'tr -d o'</span>.execute()</span><br><span class="line">proc3 = <span class="string">'tr -d e'</span>.execute()</span><br><span class="line">proc4 = <span class="string">'tr -d i'</span>.execute()</span><br><span class="line">proc1 | proc2 | proc3 | proc4</span><br><span class="line">proc4.waitFor()</span><br><span class="line"><span class="keyword">if</span> (proc4.exitValue()) &#123;</span><br><span class="line">    println proc4.err.text</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    println proc4.text</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Consuming errors<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> sout = <span class="keyword">new</span> StringBuilder()</span><br><span class="line"><span class="keyword">def</span> serr = <span class="keyword">new</span> StringBuilder()</span><br><span class="line">proc2 = <span class="string">'tr -d o'</span>.execute()</span><br><span class="line">proc3 = <span class="string">'tr -d e'</span>.execute()</span><br><span class="line">proc4 = <span class="string">'tr -d i'</span>.execute()</span><br><span class="line">proc4.consumeProcessOutput(sout, serr)</span><br><span class="line">proc2 | proc3 | proc4</span><br><span class="line">[proc2, proc3].each &#123; it.consumeProcessErrorStream(serr) &#125;</span><br><span class="line">proc2.withWriter &#123; writer -&gt;</span><br><span class="line">    writer &lt;&lt; <span class="string">'testfile.groovy'</span></span><br><span class="line">&#125;</span><br><span class="line">proc4.waitForOrKill(<span class="number">1000</span>)</span><br><span class="line">println <span class="string">"Standard output: $sout"</span></span><br><span class="line">println <span class="string">"Standard error: $serr"</span></span><br></pre></td></tr></table></figure></p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Groovy/">Groovy</a>
</div>


</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://www.ming15.wang/2014/04/08/groovy/groovyIO/" data-title="groovy IO | ming15" data-tsina="3253370782" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2014/04/08/groovy/groovy/" title="groovy注释和标识符">
  <strong>上一篇：</strong><br/>
  <span>
  groovy注释和标识符</span>
</a>
</div>


<div class="next">
<a href="/2014/04/08/groovy/groovy字符串/"  title="groovy字符串">
 <strong>下一篇：</strong><br/> 
 <span>groovy字符串
</span>
</a>
</div>

</nav>

	
<section id="comments" class="comment">
	<div class="ds-thread" data-thread-key="2014/04/08/groovy/groovyIO/" data-title="groovy IO" data-url="http://www.ming15.wang/2014/04/08/groovy/groovyIO/"></div>
</section>


</div>  
      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#读文件"><span class="toc-number">1.</span> <span class="toc-text">读文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#写文件"><span class="toc-number">2.</span> <span class="toc-text">写文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#遍历文件"><span class="toc-number">3.</span> <span class="toc-text">遍历文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#序列化"><span class="toc-number">4.</span> <span class="toc-text">序列化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#执行命令"><span class="toc-number">5.</span> <span class="toc-text">执行命令</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="ming15" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Groovy/" title="Groovy">Groovy<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Haskell/" title="Haskell">Haskell<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/JMH/" title="JMH">JMH<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/JVM/" title="JVM">JVM<sup>14</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaSE/" title="JavaSE">JavaSE<sup>28</sup></a></li>
		  
		
		  
			<li><a href="/categories/JavaScript/" title="JavaScript">JavaScript<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java工具/" title="Java工具">Java工具<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/MongoDB/" title="MongoDB">MongoDB<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/Netty/" title="Netty">Netty<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/Php/" title="Php">Php<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Reids/" title="Reids">Reids<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/TCP-IP/" title="TCP IP">TCP IP<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/ZooKeeper/" title="ZooKeeper">ZooKeeper<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/asm/" title="asm">asm<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/guice/" title="guice">guice<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/http客户端/" title="http客户端">http客户端<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/http服务器/" title="http服务器">http服务器<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux/" title="linux">linux<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/memcached/" title="memcached">memcached<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/mgits/" title="mgits">mgits<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/mycat/" title="mycat">mycat<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/python2/" title="python2">python2<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/并发编程/" title="并发编程">并发编程<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/序列化工具/" title="序列化工具">序列化工具<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/操作系统/" title="操作系统">操作系统<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库/" title="数据库">数据库<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/日志工具/" title="日志工具">日志工具<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/构建工具/" title="构建工具">构建工具<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法/" title="算法">算法<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  

  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://www1.vertx3.cn" target="_blank" title="vertx3">vertx3</a>
            
          </li>
        
    </ul>
</div>

  

<div class="doubanshow">
<p class="asidetitle">豆瓣秀</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/xxxyy/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">新浪微博</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=3253370782&verifier=e9ca895b&dpc=1"></iframe>
</div>


  

<div class="lofter">
<p class="asidetitle">Lofter</p>

 <iframe width="100%" height="39" class="share_self"  frameborder="0" scrolling="no" src="http://ming15.lofter.com/"></iframe>
</div>




</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 博客,我选择重构 <br/>
			重构使事情变得更美,更加正确</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/3253370782" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/ming15" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		<a href="https://www.douban.com/people/xxxyy" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/ming15" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="ming15">ming15</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>



<script type="text/javascript">
  var duoshuoQuery = {short_name:"wanggnim"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F9e8fca440159a2125668804e46682db4' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
