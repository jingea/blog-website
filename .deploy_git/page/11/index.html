
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>ming15</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ming15">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="ming15">
<meta property="og:url" content="http://www.ming15.wang/page/11/index.html">
<meta property="og:site_name" content="ming15">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ming15">

    
    <link rel="alternative" href="/atom.xml" title="ming15" type="application/atom+xml">
    
    
    
    <link rel="apple-touch-icon" href="/img/author.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/author.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="ming15" title="ming15"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="ming15">ming15</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
						<form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 17728547076946147000 ><input type="text" name="q" size="30" placeholder="Search"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/04/11/编程语言/Groovy 集合/" title="Groovy 集合" itemprop="url">Groovy 集合</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2014-04-11T07:00:00.000Z" itemprop="datePublished"> Published 2014-04-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>本文是对Groovy部分官方文档进行了翻译</p>
</blockquote>
<p>Groovy 语言层面上就支持多种集合类型,包括list, map, range. 大多数类型集合都是基于java的集合框架,而且Groovy development kit对这些集合内置很多快捷方法.</p>
<h3 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h3><p>Groovy使用了一种被<code>[]</code>括起来,值通过<code>,</code>分割的语法 定义list. Groovy list 采用的是 JDK里<code>java.util.List</code>的实现, 因为它自身并没有定义自己的集合类.<br>Groovy list 的默认实现是<code>java.util.ArrayList</code>, 在后面我们可以看到其他形式的list</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> numbers = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]         (<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="keyword">assert</span> numbers <span class="keyword">instanceof</span> List  (<span class="number">2</span>)</div><div class="line"><span class="keyword">assert</span> numbers.size() == <span class="number">3</span>      (<span class="number">3</span>)</div></pre></td></tr></table></figure>
<ol>
<li>我们定义了一个Number类型的List,然后将这个list分配给一个变量</li>
<li>判断list是 Java’s <code>java.util.List</code> interface 的实例</li>
<li>list的大小可以通过size()来进行查询, 例子中也给我们展示了这个list确实包含3个元素</li>
</ol>
<p>在上面的list中,我们使用的是同类元素的list, 但其实Groovy list中的数据类型还可以不一样：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> heterogeneous = [<span class="number">1</span>, <span class="string">"a"</span>, <span class="literal">true</span>]  (<span class="number">1</span>)</div></pre></td></tr></table></figure></p>
<ol>
<li>我们定义了一个包含有number,string,boolean 三个类型的list</li>
</ol>
<p>在上面我们提到过, list实际上是<code>java.util.ArrayList</code>实例, 但其实list还可以是其他不同类型的实例, 下面我们通过操作符或者显式类型声明来强制指定 list使用不同的List实现<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> arrayList = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line"><span class="keyword">assert</span> arrayList <span class="keyword">instanceof</span> java.util.ArrayList</div><div class="line"></div><div class="line"><span class="keyword">def</span> linkedList = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>] <span class="keyword">as</span> LinkedList    (<span class="number">1</span>)</div><div class="line"><span class="keyword">assert</span> linkedList <span class="keyword">instanceof</span> java.util.LinkedList</div><div class="line"></div><div class="line">LinkedList otherLinked = [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]          (<span class="number">2</span>)</div><div class="line"><span class="keyword">assert</span> otherLinked <span class="keyword">instanceof</span> java.util.LinkedList</div></pre></td></tr></table></figure></p>
<ol>
<li>我们使用操作符强制将类型显式地声明为<code>java.util.LinkedList</code></li>
<li>我们使用显式声明方式, 将list声明为<code>java.util.LinkedList</code></li>
</ol>
<p>我们可以通过<code>[]</code>下标操作符来访问list中的元素(读写都可以). 下标既如果是正数的话,那就从左到右访问元素, 如果下标是负数那就从右到左访问元素. 我们好可以使用<code>&lt;&lt;</code>操作符向list里追加元素<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> letters = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</div><div class="line"></div><div class="line"><span class="keyword">assert</span> letters[<span class="number">0</span>] == <span class="string">'a'</span>     (<span class="number">1</span>)</div><div class="line"><span class="keyword">assert</span> letters[<span class="number">1</span>] == <span class="string">'b'</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> letters[<span class="number">-1</span>] == <span class="string">'d'</span>    (<span class="number">2</span>)</div><div class="line"><span class="keyword">assert</span> letters[<span class="number">-2</span>] == <span class="string">'c'</span></div><div class="line"></div><div class="line">letters[<span class="number">2</span>] = <span class="string">'C'</span>             (<span class="number">3</span>)</div><div class="line"><span class="keyword">assert</span> letters[<span class="number">2</span>] == <span class="string">'C'</span></div><div class="line"></div><div class="line">letters &lt;&lt; <span class="string">'e'</span>               (<span class="number">4</span>)</div><div class="line"><span class="keyword">assert</span> letters[ <span class="number">4</span>] == <span class="string">'e'</span></div><div class="line"><span class="keyword">assert</span> letters[<span class="number">-1</span>] == <span class="string">'e'</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> letters[<span class="number">1</span>, <span class="number">3</span>] == [<span class="string">'b'</span>, <span class="string">'d'</span>]         (<span class="number">5</span>)</div><div class="line"><span class="keyword">assert</span> letters[<span class="number">2.</span><span class="number">.4</span>] == [<span class="string">'C'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>]    (<span class="number">6</span>)</div></pre></td></tr></table></figure></p>
<ol>
<li>访问第一个元素(从这可以看出,list的下标是从0开始的)</li>
<li>通过-1 下标访问list中的最后一个元素.</li>
<li>使用下标对list中第三个元素重新赋值</li>
<li>使用<code>&lt;&lt;</code>向list尾部添加一个元素</li>
<li>一次性访问list中俩个元素,这个操作的结果是返回一个包含俩个元素的新的list</li>
<li>使用值域符来访问list中一定范围内的值.</li>
</ol>
<p>由于list支持多种不同类型的元素, 那么list中也可以包含list,这样就可以制造出多维list<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> multi = [[<span class="number">0</span>, <span class="number">1</span>], [<span class="number">2</span>, <span class="number">3</span>]]     (<span class="number">1</span>)</div><div class="line"><span class="keyword">assert</span> multi[<span class="number">1</span>][<span class="number">0</span>] == <span class="number">2</span>          (<span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<ol>
<li>定义了一个包含Number类型list的list</li>
<li>访问外层的第二个元素(第二个list), 然后访问内部list的第一个元素(第二个list的第一个元素)</li>
</ol>
<h4 id="List-literals"><a href="#List-literals" class="headerlink" title="List literals"></a>List literals</h4><p>你可以像下面这样创建集合, 注意<code>[]</code>是空集合表达式.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> list = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</div><div class="line"><span class="keyword">assert</span> list.get(<span class="number">2</span>) == <span class="number">7</span></div><div class="line"><span class="keyword">assert</span> list[<span class="number">2</span>] == <span class="number">7</span></div><div class="line"><span class="keyword">assert</span> list <span class="keyword">instanceof</span> java.util.List</div><div class="line"></div><div class="line"><span class="keyword">def</span> emptyList = []</div><div class="line"><span class="keyword">assert</span> emptyList.size() == <span class="number">0</span></div><div class="line">emptyList.add(<span class="number">5</span>)</div><div class="line"><span class="keyword">assert</span> emptyList.size() == <span class="number">1</span></div></pre></td></tr></table></figure></p>
<p>每一个list表达式都是实现自<code>java.util.List</code></p>
<p>当然list也可以指定其具体的实现类型<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> list1 = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>]</div><div class="line"><span class="comment">//construct a new list, seeded with the same items as in list1</span></div><div class="line"><span class="keyword">def</span> list2 = <span class="keyword">new</span> ArrayList&lt;String&gt;(list1)</div><div class="line"></div><div class="line"><span class="keyword">assert</span> list2 == list1 <span class="comment">// == checks that each corresponding element is the same</span></div><div class="line"></div><div class="line"><span class="comment">// clone() can also be called</span></div><div class="line"><span class="keyword">def</span> list3 = list1.clone()</div><div class="line"><span class="keyword">assert</span> list3 == list1</div></pre></td></tr></table></figure></p>
<p>list本质上是一个有序的对象集合.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> list = [<span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>]</div><div class="line"><span class="keyword">assert</span> list.size() == <span class="number">4</span></div><div class="line"><span class="keyword">assert</span> list.getClass() == ArrayList     <span class="comment">// the specific kind of list being used</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> list[<span class="number">2</span>] == <span class="number">7</span>                     <span class="comment">// indexing starts at 0</span></div><div class="line"><span class="keyword">assert</span> list.getAt(<span class="number">2</span>) == <span class="number">7</span>               <span class="comment">// equivalent method to subscript operator []</span></div><div class="line"><span class="keyword">assert</span> list.get(<span class="number">2</span>) == <span class="number">7</span>                 <span class="comment">// alternative method</span></div><div class="line"></div><div class="line">list[<span class="number">2</span>] = <span class="number">9</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>,]           <span class="comment">// trailing comma OK</span></div><div class="line"></div><div class="line">list.putAt(<span class="number">2</span>, <span class="number">10</span>)                       <span class="comment">// equivalent method to [] when value being changed</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="number">5</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">8</span>]</div><div class="line"><span class="keyword">assert</span> list.set(<span class="number">2</span>, <span class="number">11</span>) == <span class="number">10</span>            <span class="comment">// alternative method that returns old value</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">8</span>]</div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>, <span class="number">1</span>, <span class="string">'a'</span>, <span class="string">'a'</span>, <span class="number">2.5</span>, <span class="number">2.5</span>f, <span class="number">2.5</span>d, <span class="string">'hello'</span>, <span class="number">7</span>g, <span class="literal">null</span>, <span class="number">9</span> <span class="keyword">as</span> <span class="keyword">byte</span>]</div><div class="line"><span class="comment">//objects can be of different types; duplicates allowed</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>][<span class="number">-1</span>] == <span class="number">5</span>             <span class="comment">// use negative indices to count from the end</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>][<span class="number">-2</span>] == <span class="number">4</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].getAt(<span class="number">-2</span>) == <span class="number">4</span>       <span class="comment">// getAt() available with negative index...</span></div><div class="line"><span class="keyword">try</span> &#123;</div><div class="line">    [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>].get(<span class="number">-2</span>)                 <span class="comment">// but negative index not allowed with get()</span></div><div class="line">    <span class="keyword">assert</span> <span class="literal">false</span></div><div class="line">&#125; <span class="keyword">catch</span> (e) &#123;</div><div class="line">    <span class="keyword">assert</span> e <span class="keyword">instanceof</span> ArrayIndexOutOfBoundsException</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="List-as-a-boolean-expression"><a href="#List-as-a-boolean-expression" class="headerlink" title="List as a boolean expression"></a>List as a boolean expression</h4><p>list还可以计算出boolean表达式.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> ![]             <span class="comment">// an empty list evaluates as false</span></div><div class="line"></div><div class="line"><span class="comment">//all other lists, irrespective of contents, evaluate as true</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>] &amp;&amp; [<span class="string">'a'</span>] &amp;&amp; [<span class="number">0</span>] &amp;&amp; [<span class="number">0.0</span>] &amp;&amp; [<span class="literal">false</span>] &amp;&amp; [<span class="literal">null</span>]</div></pre></td></tr></table></figure></p>
<h4 id="Iterating-on-a-list"><a href="#Iterating-on-a-list" class="headerlink" title="Iterating on a list"></a>Iterating on a list</h4><p>可以通过<code>each</code>, <code>eachWithIndex</code>遍历整个集合.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].each &#123;</div><div class="line">    println <span class="string">"Item: $it"</span> <span class="comment">// `it` is an implicit parameter corresponding to the current element</span></div><div class="line">&#125;</div><div class="line">[<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>].eachWithIndex &#123; it, i -&gt; <span class="comment">// `it` is the current element, while `i` is the index</span></div><div class="line">    println <span class="string">"$i: $it"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在遍历的时候,我们经常需要将遍历出来的值经过某些运算,然后再重新放进一个新的list中. 这种操作经常称为映射(mapping), 这种操作通过<code>collect</code>方法实现.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].collect &#123; it * <span class="number">2</span> &#125; == [<span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</div><div class="line"></div><div class="line"><span class="comment">// shortcut syntax instead of collect</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]*.multiply(<span class="number">2</span>) == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].collect &#123; it.multiply(<span class="number">2</span>) &#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> list = [<span class="number">0</span>]</div><div class="line"><span class="comment">// it is possible to give `collect` the list which collects the elements</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].collect(list) &#123; it * <span class="number">2</span> &#125; == [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</div><div class="line"><span class="keyword">assert</span> list == [<span class="number">0</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>]</div></pre></td></tr></table></figure></p>
<h4 id="Manipulating-lists"><a href="#Manipulating-lists" class="headerlink" title="Manipulating lists"></a>Manipulating lists</h4><h5 id="Filtering-and-searching"><a href="#Filtering-and-searching" class="headerlink" title="Filtering and searching"></a>Filtering and searching</h5><p><a href="http://www.groovy-lang.org/gdk.html" target="_blank" rel="external">Groovy development kit</a>提供了许多强大有趣的方法用来强化标准集合:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].find &#123; it &gt; <span class="number">1</span> &#125; == <span class="number">2</span>           <span class="comment">// find 1st element matching criteria</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].findAll &#123; it &gt; <span class="number">1</span> &#125; == [<span class="number">2</span>, <span class="number">3</span>]   <span class="comment">// find all elements matching critieria</span></div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>].findIndexOf &#123;      <span class="comment">// find index of 1st element matching criteria</span></div><div class="line">    it <span class="keyword">in</span> [<span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'g'</span>]</div><div class="line">&#125; == <span class="number">2</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>].indexOf(<span class="string">'c'</span>) == <span class="number">2</span>  <span class="comment">// index returned</span></div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>].indexOf(<span class="string">'z'</span>) == <span class="number">-1</span> <span class="comment">// index -1 means value not in list</span></div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>].lastIndexOf(<span class="string">'c'</span>) == <span class="number">4</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].every &#123; it &lt; <span class="number">5</span> &#125;               <span class="comment">// returns true if all elements match the predicate</span></div><div class="line"><span class="keyword">assert</span> ![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].every &#123; it &lt; <span class="number">3</span> &#125;</div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].any &#123; it &gt; <span class="number">2</span> &#125;                 <span class="comment">// returns true if any element matches the predicate</span></div><div class="line"><span class="keyword">assert</span> ![<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].any &#123; it &gt; <span class="number">3</span> &#125;</div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>].sum() == <span class="number">21</span>                <span class="comment">// sum anything with a plus() method</span></div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>].sum &#123;</div><div class="line">    it == <span class="string">'a'</span> ? 1 : it == <span class="string">'b'</span> ? 2 : it == <span class="string">'c'</span> ? 3 : it == <span class="string">'d'</span> ? 4 : it == <span class="string">'e'</span> ? 5 : <span class="number">0</span></div><div class="line">    <span class="comment">// custom value to use in sum</span></div><div class="line">&#125; == <span class="number">15</span></div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>].sum &#123; ((<span class="keyword">char</span>) it) - ((<span class="keyword">char</span>) <span class="string">'a'</span>) &#125; == <span class="number">10</span></div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>, <span class="string">'e'</span>].sum() == <span class="string">'abcde'</span></div><div class="line"><span class="keyword">assert</span> [[<span class="string">'a'</span>, <span class="string">'b'</span>], [<span class="string">'c'</span>, <span class="string">'d'</span>]].sum() == [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'c'</span>, <span class="string">'d'</span>]</div><div class="line"></div><div class="line"><span class="comment">// an initial value can be provided</span></div><div class="line"><span class="keyword">assert</span> [].sum(<span class="number">1000</span>) == <span class="number">1000</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].sum(<span class="number">1000</span>) == <span class="number">1006</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].join(<span class="string">'-'</span>) == <span class="string">'1-2-3'</span>           <span class="comment">// String joining</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].inject(<span class="string">'counting: '</span>) &#123;</div><div class="line">    str, item -&gt; str + item                     <span class="comment">// reduce operation</span></div><div class="line">&#125; == <span class="string">'counting: 123'</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].inject(<span class="number">0</span>) &#123; count, item -&gt;</div><div class="line">    count + item</div><div class="line">&#125; == <span class="number">6</span></div></pre></td></tr></table></figure>
<p>下面这段代码是由Groovy语言支撑的在集合中找到最大和最小数的例子:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> list = [<span class="number">9</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">10</span>, <span class="number">5</span>]</div><div class="line"><span class="keyword">assert</span> list.max() == <span class="number">10</span></div><div class="line"><span class="keyword">assert</span> list.min() == <span class="number">2</span></div><div class="line"></div><div class="line"><span class="comment">// we can also compare single characters, as anything comparable</span></div><div class="line"><span class="keyword">assert</span> [<span class="string">'x'</span>, <span class="string">'y'</span>, <span class="string">'a'</span>, <span class="string">'z'</span>].min() == <span class="string">'a'</span></div><div class="line"></div><div class="line"><span class="comment">// we can use a closure to specify the sorting behaviour</span></div><div class="line"><span class="keyword">def</span> list2 = [<span class="string">'abc'</span>, <span class="string">'z'</span>, <span class="string">'xyzuvw'</span>, <span class="string">'Hello'</span>, <span class="string">'321'</span>]</div><div class="line"><span class="keyword">assert</span> list2.max &#123; it.size() &#125; == <span class="string">'xyzuvw'</span></div><div class="line"><span class="keyword">assert</span> list2.min &#123; it.size() &#125; == <span class="string">'z'</span></div></pre></td></tr></table></figure></p>
<p>在闭包里,你还可以自定义一个比较规则.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Comparator mc = &#123; a, b -&gt; a == b ? 0 : (a &lt; b ? -1 : <span class="number">1</span>) &#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> list = [<span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">-6</span>, <span class="number">-1</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">-9</span>, <span class="number">5</span>, <span class="number">-13</span>]</div><div class="line"><span class="keyword">assert</span> list.max(mc) == <span class="number">11</span></div><div class="line"><span class="keyword">assert</span> list.min(mc) == <span class="number">-13</span></div><div class="line"></div><div class="line">Comparator mc2 = &#123; a, b -&gt; a == b ? 0 : (Math.abs(a) &lt; Math.abs(b)) ? -1 : <span class="number">1</span> &#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">assert</span> list.max(mc2) == <span class="number">-13</span></div><div class="line"><span class="keyword">assert</span> list.min(mc2) == <span class="number">-1</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> list.max &#123; a, b -&gt; a.equals(b) ? 0 : Math.abs(a) &lt; Math.abs(b) ? -1 : <span class="number">1</span> &#125; == <span class="number">-13</span></div><div class="line"><span class="keyword">assert</span> list.min &#123; a, b -&gt; a.equals(b) ? 0 : Math.abs(a) &lt; Math.abs(b) ? -1 : <span class="number">1</span> &#125; == <span class="number">-1</span></div></pre></td></tr></table></figure></p>
<h5 id="Adding-or-removing-elements"><a href="#Adding-or-removing-elements" class="headerlink" title="Adding or removing elements"></a>Adding or removing elements</h5><p>我们可以使用<code>[]</code>去声明一个新的空list, 然后使用<code>&lt;&lt;</code>向list追加元素<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> list = []</div><div class="line"><span class="keyword">assert</span> list.empty</div><div class="line"></div><div class="line">list &lt;&lt; <span class="number">5</span></div><div class="line"><span class="keyword">assert</span> list.size() == <span class="number">1</span></div><div class="line"></div><div class="line">list &lt;&lt; <span class="number">7</span> &lt;&lt; <span class="string">'i'</span> &lt;&lt; <span class="number">11</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="number">5</span>, <span class="number">7</span>, <span class="string">'i'</span>, <span class="number">11</span>]</div><div class="line"></div><div class="line">list &lt;&lt; [<span class="string">'m'</span>, <span class="string">'o'</span>]</div><div class="line"><span class="keyword">assert</span> list == [<span class="number">5</span>, <span class="number">7</span>, <span class="string">'i'</span>, <span class="number">11</span>, [<span class="string">'m'</span>, <span class="string">'o'</span>]]</div><div class="line"></div><div class="line"><span class="comment">//first item in chain of &lt;&lt; is target list</span></div><div class="line"><span class="keyword">assert</span> ([<span class="number">1</span>, <span class="number">2</span>] &lt;&lt; <span class="number">3</span> &lt;&lt; [<span class="number">4</span>, <span class="number">5</span>] &lt;&lt; <span class="number">6</span>) == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>], <span class="number">6</span>]</div><div class="line"></div><div class="line"><span class="comment">//using leftShift is equivalent to using &lt;&lt;</span></div><div class="line"><span class="keyword">assert</span> ([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] &lt;&lt; <span class="number">4</span>) == ([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].leftShift(<span class="number">4</span>))</div><div class="line">```groovy</div><div class="line">We can add to a list <span class="keyword">in</span> many <span class="string">ways:</span></div><div class="line">```groovy</div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>] + <span class="number">3</span> + [<span class="number">4</span>, <span class="number">5</span>] + <span class="number">6</span> == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</div><div class="line"><span class="comment">// equivalent to calling the `plus` method</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>].plus(<span class="number">3</span>).plus([<span class="number">4</span>, <span class="number">5</span>]).plus(<span class="number">6</span>) == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</div><div class="line"></div><div class="line"><span class="keyword">def</span> a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line">a += <span class="number">4</span>      <span class="comment">// creates a new list and assigns it to `a`</span></div><div class="line">a += [<span class="number">5</span>, <span class="number">6</span>]</div><div class="line"><span class="keyword">assert</span> a == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>]</div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, *[<span class="number">222</span>, <span class="number">333</span>], <span class="number">456</span>] == [<span class="number">1</span>, <span class="number">222</span>, <span class="number">333</span>, <span class="number">456</span>]</div><div class="line"><span class="keyword">assert</span> [*[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]] == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, [<span class="number">2</span>, <span class="number">3</span>, [<span class="number">4</span>, <span class="number">5</span>], <span class="number">6</span>], <span class="number">7</span>, [<span class="number">8</span>, <span class="number">9</span>]].flatten() == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div><div class="line"></div><div class="line"><span class="keyword">def</span> list = [<span class="number">1</span>, <span class="number">2</span>]</div><div class="line">list.add(<span class="number">3</span>)</div><div class="line">list.addAll([<span class="number">5</span>, <span class="number">4</span>])</div><div class="line"><span class="keyword">assert</span> list == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>]</div><div class="line"></div><div class="line">list = [<span class="number">1</span>, <span class="number">2</span>]</div><div class="line">list.add(<span class="number">1</span>, <span class="number">3</span>) <span class="comment">// add 3 just before index 1</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="number">1</span>, <span class="number">3</span>, <span class="number">2</span>]</div><div class="line"></div><div class="line">list.addAll(<span class="number">2</span>, [<span class="number">5</span>, <span class="number">4</span>]) <span class="comment">//add [5,4] just before index 2</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="number">1</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">2</span>]</div><div class="line"></div><div class="line">list = [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'z'</span>, <span class="string">'e'</span>, <span class="string">'u'</span>, <span class="string">'v'</span>, <span class="string">'g'</span>]</div><div class="line">list[<span class="number">8</span>] = <span class="string">'x'</span> <span class="comment">// the [] operator is growing the list as needed</span></div><div class="line"><span class="comment">// nulls inserted if required</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="string">'a'</span>, <span class="string">'b'</span>, <span class="string">'z'</span>, <span class="string">'e'</span>, <span class="string">'u'</span>, <span class="string">'v'</span>, <span class="string">'g'</span>, <span class="literal">null</span>, <span class="string">'x'</span>]</div></pre></td></tr></table></figure></p>
<p>在list中<code>+</code>的语义并没有发生变化,这是何等的重要啊~~~ 与<code>&lt;&lt;</code>相比, <code>+</code>会创建一个新的list,  但是这个创建的list很可能不是你所预期的, 而且这种方式也可能会导致一些性能问题.</p>
<p><code>Groovy development kit</code>同样提供了很多便捷的方式从list里删除元素:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'b'</span>,<span class="string">'b'</span>] - <span class="string">'c'</span> == [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'b'</span>,<span class="string">'b'</span>]</div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'b'</span>,<span class="string">'b'</span>] - <span class="string">'b'</span> == [<span class="string">'a'</span>,<span class="string">'c'</span>]</div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'b'</span>,<span class="string">'b'</span>] - [<span class="string">'b'</span>,<span class="string">'c'</span>] == [<span class="string">'a'</span>]</div><div class="line"></div><div class="line"><span class="keyword">def</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">1</span>]</div><div class="line">list -= <span class="number">3</span>           <span class="comment">// creates a new list by removing `3` from the original one</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">2</span>,<span class="number">1</span>]</div><div class="line"><span class="keyword">assert</span> ( list -= [<span class="number">2</span>,<span class="number">4</span>] ) == [<span class="number">1</span>,<span class="number">1</span>]</div></pre></td></tr></table></figure></p>
<p>同样,你也能通过索引的方式从list里删除元素.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>]</div><div class="line"><span class="keyword">assert</span> list.remove(<span class="number">2</span>) == <span class="number">3</span>          <span class="comment">// remove the third element, and return it</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>]</div></pre></td></tr></table></figure></p>
<p>假设,你如果从list中删除多个相同元素中的第一个, 那你可以调用<code>remove</code>方法.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> list= [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'b'</span>,<span class="string">'b'</span>]</div><div class="line"><span class="keyword">assert</span> list.remove(<span class="string">'c'</span>)             <span class="comment">// remove 'c', and return true because element removed</span></div><div class="line"><span class="keyword">assert</span> list.remove(<span class="string">'b'</span>)             <span class="comment">// remove first 'b', and return true because element removed</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> ! list.remove(<span class="string">'z'</span>)           <span class="comment">// return false because no elements removed</span></div><div class="line"><span class="keyword">assert</span> list == [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'b'</span>]</div></pre></td></tr></table></figure></p>
<p>如果你想要将list清空的话,只需要调用<code>clear</code>方法即可<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> list= [<span class="string">'a'</span>,<span class="number">2</span>,<span class="string">'c'</span>,<span class="number">4</span>]</div><div class="line">list.clear()</div><div class="line"><span class="keyword">assert</span> list == []</div></pre></td></tr></table></figure></p>
<h5 id="Set-operations"><a href="#Set-operations" class="headerlink" title="Set operations"></a>Set operations</h5><p><code>Groovy development kit</code>还包含很多逻辑运算的方法<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> <span class="string">'a'</span> <span class="keyword">in</span> [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>]             <span class="comment">// returns true if an element belongs to the list</span></div><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>].contains(<span class="string">'a'</span>)      <span class="comment">// equivalent to the `contains` method in Java</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>,<span class="number">3</span>,<span class="number">4</span>].containsAll([<span class="number">1</span>,<span class="number">4</span>])       <span class="comment">// `containsAll` will check that all elements are found</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>].count(<span class="number">3</span>) == <span class="number">4</span>  <span class="comment">// count the number of elements which have some value</span></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>].count &#123;</div><div class="line">    it%<span class="number">2</span>==<span class="number">0</span>                             <span class="comment">// count the number of elements which match the predicate</span></div><div class="line">&#125; == <span class="number">2</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">12</span>].intersect([<span class="number">1</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">9</span>,<span class="number">12</span>]) == [<span class="number">1</span>,<span class="number">6</span>,<span class="number">12</span>]</div><div class="line"></div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].disjoint( [<span class="number">4</span>,<span class="number">6</span>,<span class="number">9</span>] )</div><div class="line"><span class="keyword">assert</span> ![<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>].disjoint( [<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>] )</div></pre></td></tr></table></figure></p>
<h5 id="Sorting"><a href="#Sorting" class="headerlink" title="Sorting"></a>Sorting</h5><p>Groovy还提供了很多使用闭包比较器的排序操作<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> [<span class="number">6</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">5</span>].sort() == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">9</span>]</div><div class="line"></div><div class="line"><span class="keyword">def</span> list = [<span class="string">'abc'</span>, <span class="string">'z'</span>, <span class="string">'xyzuvw'</span>, <span class="string">'Hello'</span>, <span class="string">'321'</span>]</div><div class="line"><span class="keyword">assert</span> list.sort &#123;</div><div class="line">    it.size()</div><div class="line">&#125; == [<span class="string">'z'</span>, <span class="string">'abc'</span>, <span class="string">'321'</span>, <span class="string">'Hello'</span>, <span class="string">'xyzuvw'</span>]</div><div class="line"></div><div class="line"><span class="keyword">def</span> list2 = [<span class="number">7</span>, <span class="number">4</span>, <span class="number">-6</span>, <span class="number">-1</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">-9</span>, <span class="number">5</span>, <span class="number">-13</span>]</div><div class="line"><span class="keyword">assert</span> list2.sort &#123; a, b -&gt; a == b ? 0 : Math.abs(a) &lt; Math.abs(b) ? -1 : <span class="number">1</span> &#125; ==</div><div class="line">        [<span class="number">-1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">-6</span>, <span class="number">7</span>, <span class="number">-9</span>, <span class="number">11</span>, <span class="number">-13</span>]</div><div class="line"></div><div class="line">Comparator mc = &#123; a, b -&gt; a == b ? 0 : Math.abs(a) &lt; Math.abs(b) ? -1 : <span class="number">1</span> &#125;</div><div class="line"></div><div class="line"><span class="comment">// JDK 8+ only</span></div><div class="line"><span class="comment">// list2.sort(mc)</span></div><div class="line"><span class="comment">// assert list2 == [-1, 2, 3, 4, 5, -6, 7, -9, 11, -13]</span></div><div class="line"></div><div class="line"><span class="keyword">def</span> list3 = [<span class="number">6</span>, <span class="number">-3</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">-7</span>, <span class="number">1</span>, <span class="number">5</span>]</div><div class="line"></div><div class="line">Collections.sort(list3)</div><div class="line"><span class="keyword">assert</span> list3 == [<span class="number">-7</span>, <span class="number">-3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">9</span>]</div><div class="line"></div><div class="line">Collections.sort(list3, mc)</div><div class="line"><span class="keyword">assert</span> list3 == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">-3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">-7</span>, <span class="number">9</span>]</div></pre></td></tr></table></figure></p>
<h5 id="Duplicating-elements"><a href="#Duplicating-elements" class="headerlink" title="Duplicating elements"></a>Duplicating elements</h5><p><code>roovy development kit</code>还通过重载操作符的方式, 内部提供了一些方法进行list元素复制.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] * <span class="number">3</span> == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line"><span class="keyword">assert</span> [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>].multiply(<span class="number">2</span>) == [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line"><span class="keyword">assert</span> Collections.nCopies(<span class="number">3</span>, <span class="string">'b'</span>) == [<span class="string">'b'</span>, <span class="string">'b'</span>, <span class="string">'b'</span>]</div><div class="line"></div><div class="line"><span class="comment">// nCopies from the JDK has different semantics than multiply for lists</span></div><div class="line"><span class="keyword">assert</span> Collections.nCopies(<span class="number">2</span>, [<span class="number">1</span>, <span class="number">2</span>]) == [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">1</span>, <span class="number">2</span>]] <span class="comment">//not [1,2,1,2]</span></div></pre></td></tr></table></figure></p>
<h3 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h3><p>Groovy 数组重用了list符号, 但是如果想要创建数组, 那么就必须强制地显式定义数组类型<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">String[] arrStr = [<span class="string">'Ananas'</span>, <span class="string">'Banana'</span>, <span class="string">'Kiwi'</span>]  (<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="keyword">assert</span> arrStr <span class="keyword">instanceof</span> String[]    (<span class="number">2</span>)</div><div class="line"><span class="keyword">assert</span> !(arrStr <span class="keyword">instanceof</span> List)</div><div class="line"></div><div class="line"><span class="keyword">def</span> numArr = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="keyword">as</span> <span class="keyword">int</span>[]      (<span class="number">3</span>)</div><div class="line"></div><div class="line"><span class="keyword">assert</span> numArr <span class="keyword">instanceof</span> <span class="keyword">int</span>[]       (<span class="number">4</span>)</div><div class="line"><span class="keyword">assert</span> numArr.size() == <span class="number">3</span></div></pre></td></tr></table></figure></p>
<ol>
<li>使用显式变量类型定义了一个字符串数组</li>
<li>断言刚才创建的数组是否是string类型</li>
<li>使用操作符定义一个int数组</li>
<li>断言刚才创建的数组是否是int类型</li>
</ol>
<p>我们也可以创建出一个多维数组<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> matrix3 = <span class="keyword">new</span> Integer[<span class="number">3</span>][<span class="number">3</span>]         (<span class="number">1</span>)</div><div class="line"><span class="keyword">assert</span> matrix3.size() == <span class="number">3</span></div><div class="line"></div><div class="line">Integer[][] matrix2                     (<span class="number">2</span>)</div><div class="line">matrix2 = [[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]]</div><div class="line"><span class="keyword">assert</span> matrix2 <span class="keyword">instanceof</span> Integer[][]</div></pre></td></tr></table></figure></p>
<ol>
<li>我们指定了新数组的边界</li>
<li>当然我们也可以不指定它的边界</li>
</ol>
<p>访问数组元素和访问list元素的方式相同<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">String[] names = [<span class="string">'Cédric'</span>, <span class="string">'Guillaume'</span>, <span class="string">'Jochen'</span>, <span class="string">'Paul'</span>]</div><div class="line"><span class="keyword">assert</span> names[<span class="number">0</span>] == <span class="string">'Cédric'</span>     (<span class="number">1</span>)</div><div class="line"></div><div class="line">names[<span class="number">2</span>] = <span class="string">'Blackdrag'</span>          (<span class="number">2</span>)</div><div class="line"><span class="keyword">assert</span> names[<span class="number">2</span>] == <span class="string">'Blackdrag'</span></div></pre></td></tr></table></figure></p>
<p>1    Retrieve the first element of the array<br>2    Set the value of the third element of the array to a new value</p>
<ol>
<li>检索数组中第一个元素</li>
<li>对数组中第三个元素重新赋值</li>
</ol>
<p>Groovy不支持Java数组初始化语法, 因为Java数组中的花括号可能被会Groovy无解成闭包</p>
<h3 id="Maps"><a href="#Maps" class="headerlink" title="Maps"></a>Maps</h3><p>有时候我们在其他语言中称map为 字典或者关联数组. Map将key和value关联起来, 在Groovy中map被<code>[]</code>括起来, 通过<code>,</code>分割键值对, 键值通过<code>:</code>分割<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> colors = [<span class="string">red:</span> <span class="string">'#FF0000'</span>, <span class="string">green:</span> <span class="string">'#00FF00'</span>, <span class="string">blue:</span> <span class="string">'#0000FF'</span>]   (<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="keyword">assert</span> colors[<span class="string">'red'</span>] == <span class="string">'#FF0000'</span>    (<span class="number">2</span>)</div><div class="line"><span class="keyword">assert</span> colors.green  == <span class="string">'#00FF00'</span>    (<span class="number">3</span>)</div><div class="line"></div><div class="line">colors[<span class="string">'pink'</span>] = <span class="string">'#FF00FF'</span>           (<span class="number">4</span>)</div><div class="line">colors.yellow  = <span class="string">'#FFFF00'</span>           (<span class="number">5</span>)</div><div class="line"></div><div class="line"><span class="keyword">assert</span> colors.pink == <span class="string">'#FF00FF'</span></div><div class="line"><span class="keyword">assert</span> colors[<span class="string">'yellow'</span>] == <span class="string">'#FFFF00'</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> colors <span class="keyword">instanceof</span> java.util.LinkedHashMap</div></pre></td></tr></table></figure></p>
<ol>
<li>我们定义了一个string类型的代表颜色名字的数组,</li>
<li>然后使用下标来检索map中是否包含red这个key</li>
<li>我们还可以直接使用<code>.</code>来索引到某个key</li>
<li>我们可以使用下标向map中添加一个新的键值对</li>
<li>我们也可以使用<code>.</code>添加一个新的键值对</li>
</ol>
<p>Groovy创建的map类型默认的是<code>java.util.LinkedHashMap</code></p>
<p>当你想要访问一个不存在的key时：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> colors.unknown == <span class="literal">null</span></div></pre></td></tr></table></figure></p>
<p>你将检索出一个null的结果</p>
<p>在上面的例子中我们使用的是以string作为key, 但是你还可以使用其他类型作为map的key：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> numbers = [<span class="number">1</span>: <span class="string">'one'</span>, <span class="number">2</span>: <span class="string">'two'</span>]</div><div class="line"></div><div class="line"><span class="keyword">assert</span> numbers[<span class="number">1</span>] == <span class="string">'one'</span></div></pre></td></tr></table></figure>
<p>我们使用了number作为了map新的key类型, number类型就会直接被解释为number类型, 因此Groovy不会像先前那样创建一个string类型的key. 但是假设你想要传递一个变量作为key,是变量的值作为key：</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> key = <span class="string">'name'</span></div><div class="line"><span class="keyword">def</span> person = [<span class="string">key:</span> <span class="string">'Guillaume'</span>]      (<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="keyword">assert</span> !person.containsKey(<span class="string">'name'</span>)   (<span class="number">2</span>)</div><div class="line"><span class="keyword">assert</span> person.containsKey(<span class="string">'key'</span>)     (<span class="number">3</span>)</div></pre></td></tr></table></figure>
<ol>
<li>与<code>\&#39;Guillaume&#39;</code> 关联的key实际上是<code>&quot;key&quot;</code>这个字符串, 而不是这个key的引用值<code>&#39;name&#39;</code></li>
<li>map中不包含<code>&#39;name&#39;</code>key</li>
<li>取而代之的是map中包含一个<code>&quot;key&quot;</code>的字符串</li>
</ol>
<p>你可以向map中传递一个引号字符串作为key,例如<code>[&quot;name&quot;: &quot;Guillaume&quot;]</code>.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">person = [(key): <span class="string">'Guillaume'</span>]        (<span class="number">1</span>)</div><div class="line"></div><div class="line"><span class="keyword">assert</span> person.containsKey(<span class="string">'name'</span>)    (<span class="number">2</span>)</div><div class="line"><span class="keyword">assert</span> !person.containsKey(<span class="string">'key'</span>)    (<span class="number">3</span>)</div></pre></td></tr></table></figure>
<p>1    This time, we surround the key variable with parentheses, to instruct the parser we are passing a variable rather than defining a string key<br>2    The map does contain the name key<br>3    But the map doesn’t contain the key key as before<br>1.<br>2.<br>3.</p>
<h4 id="Map-literals"><a href="#Map-literals" class="headerlink" title="Map literals"></a>Map literals</h4><p>在Groovy中可以使用<code>[:]</code> 创建一个map.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> map = [<span class="string">name:</span> <span class="string">'Gromit'</span>, <span class="string">likes:</span> <span class="string">'cheese'</span>, <span class="string">id:</span> <span class="number">1234</span>]</div><div class="line"><span class="keyword">assert</span> map.get(<span class="string">'name'</span>) == <span class="string">'Gromit'</span></div><div class="line"><span class="keyword">assert</span> map.get(<span class="string">'id'</span>) == <span class="number">1234</span></div><div class="line"><span class="keyword">assert</span> map[<span class="string">'name'</span>] == <span class="string">'Gromit'</span></div><div class="line"><span class="keyword">assert</span> map[<span class="string">'id'</span>] == <span class="number">1234</span></div><div class="line"><span class="keyword">assert</span> map <span class="keyword">instanceof</span> java.util.Map</div><div class="line"></div><div class="line"><span class="keyword">def</span> emptyMap = [:]</div><div class="line"><span class="keyword">assert</span> emptyMap.size() == <span class="number">0</span></div><div class="line">emptyMap.put(<span class="string">"foo"</span>, <span class="number">5</span>)</div><div class="line"><span class="keyword">assert</span> emptyMap.size() == <span class="number">1</span></div><div class="line"><span class="keyword">assert</span> emptyMap.get(<span class="string">"foo"</span>) == <span class="number">5</span></div></pre></td></tr></table></figure></p>
<p>Map的key默认是<code>string</code>, 例如<code>[a:1]</code>等同于<code>[&#39;a&#39;:1]</code>. 比较荣誉造成疑惑的就是,如果你创建了一个变量a(值为b), 但是你将变量a<code>put</code>进map后, map的key会是a,而不是b. 如果你遇到了这个情况的话,那么你必须对使用<code>()</code>key进行转义了.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> a = <span class="string">'Bob'</span></div><div class="line"><span class="keyword">def</span> ages = [<span class="string">a:</span> <span class="number">43</span>]</div><div class="line"><span class="keyword">assert</span> ages[<span class="string">'Bob'</span>] == <span class="literal">null</span> <span class="comment">// `Bob` is not found</span></div><div class="line"><span class="keyword">assert</span> ages[<span class="string">'a'</span>] == <span class="number">43</span>     <span class="comment">// because `a` is a literal!</span></div><div class="line"></div><div class="line">ages = [(a): <span class="number">43</span>]            <span class="comment">// now we escape `a` by using parenthesis</span></div><div class="line"><span class="keyword">assert</span> ages[<span class="string">'Bob'</span>] == <span class="number">43</span>   <span class="comment">// and the value is found!</span></div></pre></td></tr></table></figure></p>
<p>通过下面的方式你可以轻松克隆一个map<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> map = [</div><div class="line">        <span class="string">simple :</span> <span class="number">123</span>,</div><div class="line"><span class="symbol">        complex:</span> [<span class="string">a:</span> <span class="number">1</span>, <span class="string">b:</span> <span class="number">2</span>]</div><div class="line">]</div><div class="line"><span class="keyword">def</span> map2 = map.clone()</div><div class="line"><span class="keyword">assert</span> map2.get(<span class="string">'simple'</span>) == map.get(<span class="string">'simple'</span>)</div><div class="line"><span class="keyword">assert</span> map2.get(<span class="string">'complex'</span>) == map.get(<span class="string">'complex'</span>)</div><div class="line">map2.get(<span class="string">'complex'</span>).put(<span class="string">'c'</span>, <span class="number">3</span>)</div><div class="line"><span class="keyword">assert</span> map.get(<span class="string">'complex'</span>).get(<span class="string">'c'</span>) == <span class="number">3</span></div></pre></td></tr></table></figure></p>
<h4 id="Map-property-notation"><a href="#Map-property-notation" class="headerlink" title="Map property notation"></a>Map property notation</h4><p>Maps和beans也是非常相像的, 所以你可以对map使用<code>get/set</code>操作元素,当然这也有个前提,那就是map中的key必须是符合Groovy标识符的key.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> map = [<span class="string">name:</span> <span class="string">'Gromit'</span>, <span class="string">likes:</span> <span class="string">'cheese'</span>, <span class="string">id:</span> <span class="number">1234</span>]</div><div class="line"><span class="keyword">assert</span> map.name == <span class="string">'Gromit'</span>     <span class="comment">// can be used instead of map.get('Gromit')</span></div><div class="line"><span class="keyword">assert</span> map.id == <span class="number">1234</span></div><div class="line"></div><div class="line"><span class="keyword">def</span> emptyMap = [:]</div><div class="line"><span class="keyword">assert</span> emptyMap.size() == <span class="number">0</span></div><div class="line">emptyMap.foo = <span class="number">5</span></div><div class="line"><span class="keyword">assert</span> emptyMap.size() == <span class="number">1</span></div><div class="line"><span class="keyword">assert</span> emptyMap.foo == <span class="number">5</span></div></pre></td></tr></table></figure>
<p>注意:<code>map.foo</code>总是会在map中查找key<code>foo</code>. 这意味着,<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> map = [<span class="string">name:</span> <span class="string">'Gromit'</span>, <span class="string">likes:</span> <span class="string">'cheese'</span>, <span class="string">id:</span> <span class="number">1234</span>]</div><div class="line"><span class="keyword">assert</span> map.<span class="keyword">class</span> == <span class="literal">null</span></div><div class="line"><span class="keyword">assert</span> map.get(<span class="string">'class'</span>) == <span class="literal">null</span></div><div class="line"><span class="keyword">assert</span> map.getClass() == LinkedHashMap <span class="comment">// this is probably what you want</span></div><div class="line"></div><div class="line">map = [<span class="number">1</span>      : <span class="string">'a'</span>,</div><div class="line">       (<span class="literal">true</span>) : <span class="string">'p'</span>,</div><div class="line">       (<span class="literal">false</span>): <span class="string">'q'</span>,</div><div class="line">       (<span class="literal">null</span>) : <span class="string">'x'</span>,</div><div class="line">       <span class="string">'null'</span> : <span class="string">'z'</span>]</div><div class="line"><span class="keyword">assert</span> map.containsKey(<span class="number">1</span>) <span class="comment">// 1 is not an identifier so used as is</span></div><div class="line"><span class="keyword">assert</span> map.<span class="literal">true</span> == <span class="literal">null</span></div><div class="line"><span class="keyword">assert</span> map.<span class="literal">false</span> == <span class="literal">null</span></div><div class="line"><span class="keyword">assert</span> map.get(<span class="literal">true</span>) == <span class="string">'p'</span></div><div class="line"><span class="keyword">assert</span> map.get(<span class="literal">false</span>) == <span class="string">'q'</span></div><div class="line"><span class="keyword">assert</span> map.<span class="literal">null</span> == <span class="string">'z'</span></div><div class="line"><span class="keyword">assert</span> map.get(<span class="literal">null</span>) == <span class="string">'x'</span></div></pre></td></tr></table></figure></p>
<h4 id="Iterating-on-maps"><a href="#Iterating-on-maps" class="headerlink" title="Iterating on maps"></a>Iterating on maps</h4><p><code>Groovy development kit</code>还提供了<code>eachWithIndex</code>方法遍历map.值得注意的是,map会保留put元素的顺序,也就是说,当你遍历一个map的时候,无论进行多少次,你获得的元素的顺序是一定的.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> map = [</div><div class="line">        <span class="string">Bob  :</span> <span class="number">42</span>,</div><div class="line"><span class="symbol">        Alice:</span> <span class="number">54</span>,</div><div class="line">        <span class="string">Max  :</span> <span class="number">33</span></div><div class="line">]</div><div class="line"></div><div class="line"><span class="comment">// `entry` is a map entry</span></div><div class="line">map.each &#123; entry -&gt;</div><div class="line">    println <span class="string">"Name: $entry.key Age: $entry.value"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// `entry` is a map entry, `i` the index in the map</span></div><div class="line">map.eachWithIndex &#123; entry, i -&gt;</div><div class="line">    println <span class="string">"$i - Name: $entry.key Age: $entry.value"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Alternatively you can use key and value directly</span></div><div class="line">map.each &#123; key, value -&gt;</div><div class="line">    println <span class="string">"Name: $key Age: $value"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// Key, value and i as the index in the map</span></div><div class="line">map.eachWithIndex &#123; key, value, i -&gt;</div><div class="line">    println <span class="string">"$i - Name: $key Age: $value"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h4 id="Manipulating-maps"><a href="#Manipulating-maps" class="headerlink" title="Manipulating maps"></a>Manipulating maps</h4><h5 id="Adding-or-removing-elements-1"><a href="#Adding-or-removing-elements-1" class="headerlink" title="Adding or removing elements"></a>Adding or removing elements</h5><p>向map中添加元素你可以使用<code>put</code>方法, <code>下标</code>, <code>putAll</code>方法.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> defaults = [<span class="number">1</span>: <span class="string">'a'</span>, <span class="number">2</span>: <span class="string">'b'</span>, <span class="number">3</span>: <span class="string">'c'</span>, <span class="number">4</span>: <span class="string">'d'</span>]</div><div class="line"><span class="keyword">def</span> overrides = [<span class="number">2</span>: <span class="string">'z'</span>, <span class="number">5</span>: <span class="string">'x'</span>, <span class="number">13</span>: <span class="string">'x'</span>]</div><div class="line"></div><div class="line"><span class="keyword">def</span> result = <span class="keyword">new</span> LinkedHashMap(defaults)</div><div class="line">result.put(<span class="number">15</span>, <span class="string">'t'</span>)</div><div class="line">result[<span class="number">17</span>] = <span class="string">'u'</span></div><div class="line">result.putAll(overrides)</div><div class="line"><span class="keyword">assert</span> result == [<span class="number">1</span>: <span class="string">'a'</span>, <span class="number">2</span>: <span class="string">'z'</span>, <span class="number">3</span>: <span class="string">'c'</span>, <span class="number">4</span>: <span class="string">'d'</span>, <span class="number">5</span>: <span class="string">'x'</span>, <span class="number">13</span>: <span class="string">'x'</span>, <span class="number">15</span>: <span class="string">'t'</span>, <span class="number">17</span>: <span class="string">'u'</span>]</div></pre></td></tr></table></figure></p>
<p>如果想要删除map中全部的元素,可以使用<code>clear</code>方法.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> m = [<span class="number">1</span>:<span class="string">'a'</span>, <span class="number">2</span>:<span class="string">'b'</span>]</div><div class="line"><span class="keyword">assert</span> m.get(<span class="number">1</span>) == <span class="string">'a'</span></div><div class="line">m.clear()</div><div class="line"><span class="keyword">assert</span> m == [:]</div></pre></td></tr></table></figure></p>
<p>通过map字面量标记创建的map会使用<code>object</code>的<code>equals</code>方法和<code>hashcode</code>方法.</p>
<p>还要注意的是,不要使用GString作为map的key, 因为GString的hashcode方法和String的hashcode方法不一样.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> key = <span class="string">'some key'</span></div><div class="line"><span class="keyword">def</span> map = [:]</div><div class="line"><span class="keyword">def</span> gstringKey = <span class="string">"$&#123;key.toUpperCase()&#125;"</span></div><div class="line">map.put(gstringKey,<span class="string">'value'</span>)</div><div class="line"><span class="keyword">assert</span> map.get(<span class="string">'SOME KEY'</span>) == <span class="literal">null</span></div></pre></td></tr></table></figure></p>
<h5 id="Keys-values-and-entries"><a href="#Keys-values-and-entries" class="headerlink" title="Keys, values and entries"></a>Keys, values and entries</h5><p>我们可以在视图中inspect<code>keys, values, and entries</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> map = [<span class="number">1</span>:<span class="string">'a'</span>, <span class="number">2</span>:<span class="string">'b'</span>, <span class="number">3</span>:<span class="string">'c'</span>]</div><div class="line"></div><div class="line"><span class="keyword">def</span> entries = map.entrySet()</div><div class="line">entries.each &#123; entry -&gt;</div><div class="line">  <span class="keyword">assert</span> entry.key <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</div><div class="line">  <span class="keyword">assert</span> entry.value <span class="keyword">in</span> [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>]</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">def</span> keys = map.keySet()</div><div class="line"><span class="keyword">assert</span> keys == [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>] <span class="keyword">as</span> Set</div></pre></td></tr></table></figure></p>
<p>Mutating values returned by the view (be it a map entry, a key or a value) is highly discouraged because success of the operation directly depends on the type of the map being manipulated. In particular, Groovy relies on collections from the JDK that in general make no guarantee that a collection can safely be manipulated through keySet, entrySet, or values.</p>
<h5 id="Filtering-and-searching-1"><a href="#Filtering-and-searching-1" class="headerlink" title="Filtering and searching"></a>Filtering and searching</h5><p>The Groovy development kit contains filtering, searching and collecting methods similar to those found for lists:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> people = [</div><div class="line"><span class="symbol">    1:</span> [<span class="string">name:</span><span class="string">'Bob'</span>, <span class="string">age:</span> <span class="number">32</span>, <span class="string">gender:</span> <span class="string">'M'</span>],</div><div class="line"><span class="symbol">    2:</span> [<span class="string">name:</span><span class="string">'Johnny'</span>, <span class="string">age:</span> <span class="number">36</span>, <span class="string">gender:</span> <span class="string">'M'</span>],</div><div class="line"><span class="symbol">    3:</span> [<span class="string">name:</span><span class="string">'Claire'</span>, <span class="string">age:</span> <span class="number">21</span>, <span class="string">gender:</span> <span class="string">'F'</span>],</div><div class="line"><span class="symbol">    4:</span> [<span class="string">name:</span><span class="string">'Amy'</span>, <span class="string">age:</span> <span class="number">54</span>, <span class="string">gender:</span><span class="string">'F'</span>]</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">def</span> bob = people.find &#123; it.value.name == <span class="string">'Bob'</span> &#125; <span class="comment">// find a single entry</span></div><div class="line"><span class="keyword">def</span> females = people.findAll &#123; it.value.gender == <span class="string">'F'</span> &#125;</div><div class="line"></div><div class="line"><span class="comment">// both return entries, but you can use collect to retrieve the ages for example</span></div><div class="line"><span class="keyword">def</span> ageOfBob = bob.value.age</div><div class="line"><span class="keyword">def</span> agesOfFemales = females.collect &#123;</div><div class="line">    it.value.age</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">assert</span> ageOfBob == <span class="number">32</span></div><div class="line"><span class="keyword">assert</span> agesOfFemales == [<span class="number">21</span>,<span class="number">54</span>]</div><div class="line"></div><div class="line"><span class="comment">// but you could also use a key/pair value as the parameters of the closures</span></div><div class="line"><span class="keyword">def</span> agesOfMales = people.findAll &#123; id, person -&gt;</div><div class="line">    person.gender == <span class="string">'M'</span></div><div class="line">&#125;.collect &#123; id, person -&gt;</div><div class="line">    person.age</div><div class="line">&#125;</div><div class="line"><span class="keyword">assert</span> agesOfMales == [<span class="number">32</span>, <span class="number">36</span>]</div><div class="line"></div><div class="line"><span class="comment">// `every` returns true if all entries match the predicate</span></div><div class="line"><span class="keyword">assert</span> people.every &#123; id, person -&gt;</div><div class="line">    person.age &gt; <span class="number">18</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// `any` returns true if any entry matches the predicate</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> people.any &#123; id, person -&gt;</div><div class="line">    person.age == <span class="number">54</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="Grouping"><a href="#Grouping" class="headerlink" title="Grouping"></a>Grouping</h5><p>We can group a list into a map using some criteria:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">assert</span> [<span class="string">'a'</span>, <span class="number">7</span>, <span class="string">'b'</span>, [<span class="number">2</span>, <span class="number">3</span>]].groupBy &#123;</div><div class="line">    it.<span class="keyword">class</span></div><div class="line">&#125; == [(String)   : [<span class="string">'a'</span>, <span class="string">'b'</span>],</div><div class="line">      (Integer)  : [<span class="number">7</span>],</div><div class="line">      (ArrayList): [[<span class="number">2</span>, <span class="number">3</span>]]</div><div class="line">]</div><div class="line"></div><div class="line"><span class="keyword">assert</span> [</div><div class="line">        [<span class="string">name:</span> <span class="string">'Clark'</span>, <span class="string">city:</span> <span class="string">'London'</span>], [<span class="string">name:</span> <span class="string">'Sharma'</span>, <span class="string">city:</span> <span class="string">'London'</span>],</div><div class="line">        [<span class="string">name:</span> <span class="string">'Maradona'</span>, <span class="string">city:</span> <span class="string">'LA'</span>], [<span class="string">name:</span> <span class="string">'Zhang'</span>, <span class="string">city:</span> <span class="string">'HK'</span>],</div><div class="line">        [<span class="string">name:</span> <span class="string">'Ali'</span>, <span class="string">city:</span> <span class="string">'HK'</span>], [<span class="string">name:</span> <span class="string">'Liu'</span>, <span class="string">city:</span> <span class="string">'HK'</span>],</div><div class="line">].groupBy &#123; it.city &#125; == [</div><div class="line"><span class="symbol">        London:</span> [[<span class="string">name:</span> <span class="string">'Clark'</span>, <span class="string">city:</span> <span class="string">'London'</span>],</div><div class="line">                 [<span class="string">name:</span> <span class="string">'Sharma'</span>, <span class="string">city:</span> <span class="string">'London'</span>]],</div><div class="line">        <span class="string">LA    :</span> [[<span class="string">name:</span> <span class="string">'Maradona'</span>, <span class="string">city:</span> <span class="string">'LA'</span>]],</div><div class="line">        <span class="string">HK    :</span> [[<span class="string">name:</span> <span class="string">'Zhang'</span>, <span class="string">city:</span> <span class="string">'HK'</span>],</div><div class="line">                 [<span class="string">name:</span> <span class="string">'Ali'</span>, <span class="string">city:</span> <span class="string">'HK'</span>],</div><div class="line">                 [<span class="string">name:</span> <span class="string">'Liu'</span>, <span class="string">city:</span> <span class="string">'HK'</span>]],</div><div class="line">]</div></pre></td></tr></table></figure>
<h3 id="Ranges"><a href="#Ranges" class="headerlink" title="Ranges"></a>Ranges</h3><p>Ranges allow you to create a list of sequential values. These can be used as List since Range extends java.util.List.</p>
<p>Ranges defined with the .. notation are inclusive (that is the list contains the from and to value).</p>
<p>Ranges defined with the ..&lt; notation are half-open, they include the first value but not the last value.</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// an inclusive range</span></div><div class="line"><span class="keyword">def</span> range = <span class="number">5.</span><span class="number">.8</span></div><div class="line"><span class="keyword">assert</span> range.size() == <span class="number">4</span></div><div class="line"><span class="keyword">assert</span> range.get(<span class="number">2</span>) == <span class="number">7</span></div><div class="line"><span class="keyword">assert</span> range[<span class="number">2</span>] == <span class="number">7</span></div><div class="line"><span class="keyword">assert</span> range <span class="keyword">instanceof</span> java.util.List</div><div class="line"><span class="keyword">assert</span> range.contains(<span class="number">5</span>)</div><div class="line"><span class="keyword">assert</span> range.contains(<span class="number">8</span>)</div><div class="line"></div><div class="line"><span class="comment">// lets use a half-open range</span></div><div class="line">range = <span class="number">5.</span>.&lt;<span class="number">8</span></div><div class="line"><span class="keyword">assert</span> range.size() == <span class="number">3</span></div><div class="line"><span class="keyword">assert</span> range.get(<span class="number">2</span>) == <span class="number">7</span></div><div class="line"><span class="keyword">assert</span> range[<span class="number">2</span>] == <span class="number">7</span></div><div class="line"><span class="keyword">assert</span> range <span class="keyword">instanceof</span> java.util.List</div><div class="line"><span class="keyword">assert</span> range.contains(<span class="number">5</span>)</div><div class="line"><span class="keyword">assert</span> !range.contains(<span class="number">8</span>)</div><div class="line"></div><div class="line"><span class="comment">//get the end points of the range without using indexes</span></div><div class="line">range = <span class="number">1.</span><span class="number">.10</span></div><div class="line"><span class="keyword">assert</span> range.from == <span class="number">1</span></div><div class="line"><span class="keyword">assert</span> range.to == <span class="number">10</span></div></pre></td></tr></table></figure>
<p>Note that int ranges are implemented efficiently, creating a lightweight Java object containing a from and to value.</p>
<p>Ranges can be used for any Java object which implements java.lang.Comparable for comparison and also have methods next() and previous() to return the next / previous item in the range. For example, you can create a range of String elements:</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程语言/">编程语言</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/04/11/编程语言/Groovy 集合/#comments" class="ds-thread-count comments-count-link" data-thread-key="2014/04/11/编程语言/Groovy 集合/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/04/09/编程语言/Groovy IO/" title="Groovy IO" itemprop="url">Groovy IO</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2014-04-09T07:00:00.000Z" itemprop="datePublished"> Published 2014-04-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>本文是对Groovy部分官方文档进行了翻译</p>
</blockquote>
<h3 id="读文件"><a href="#读文件" class="headerlink" title="读文件"></a>读文件</h3><p>作为第一个例子,让我们看一下,如何输出一个文本文件里的所有行<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> File(baseDir, <span class="string">'haiku.txt'</span>).eachLine &#123; line -&gt;</div><div class="line">    println line</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>eachLine</code>方法是Groovy自动添加到File Class的,同时呢,Groovy还添加了很多变量,例如,你如果想要知道每一行的行号,你可以使用这个变量:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> File(baseDir, <span class="string">'haiku.txt'</span>).eachLine &#123; line, nb -&gt;</div><div class="line">    println <span class="string">"Line $nb: $line"</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>无论由于什么原因, 当<code>eachLine</code>中抛出了异常,这个方法都会确保,资源已经被正确的关闭掉了. 这对所有Groovy自动添加的关于I/O资源的方法都有效.</p>
<p>例如, 某种情况你使用了<code>Reader</code>, 但是你还想让Groovy自己管理资源. 下面这个例子, 即使抛出了exception, reader仍然会被自动关闭.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> count = <span class="number">0</span>, MAXSIZE = <span class="number">3</span></div><div class="line"><span class="keyword">new</span> File(baseDir,<span class="string">"haiku.txt"</span>).withReader &#123; reader -&gt;</div><div class="line">    <span class="keyword">while</span> (reader.readLine()) &#123;</div><div class="line">        <span class="keyword">if</span> (++count &gt; MAXSIZE) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">'Haiku should only have 3 verses'</span>)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>如果你想要把文本文件中每一行都放进一个list中, 你可以这么做:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> list = <span class="keyword">new</span> File(baseDir, <span class="string">'haiku.txt'</span>).collect &#123;it&#125;</div></pre></td></tr></table></figure></p>
<p>或者你想利用操作符将文件中每一行都添加到一个数组中:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> array = <span class="keyword">new</span> File(baseDir, <span class="string">'haiku.txt'</span>) <span class="keyword">as</span> String[]</div></pre></td></tr></table></figure></p>
<p>下面这个示例,非常简单的实现了,将一个文件存进一个字节数组里:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">byte</span>[] contents = file.bytes</div></pre></td></tr></table></figure></p>
<p>如下例,我们轻松地获得了一个输入流.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> is = <span class="keyword">new</span> File(baseDir,<span class="string">'haiku.txt'</span>).newInputStream()</div><div class="line"><span class="comment">// do something ...</span></div><div class="line">is.close()</div></pre></td></tr></table></figure></p>
<p>上个例子中我们获得了一个输入流,但是最后我们不得不手动关闭它, Groovy提供另一个方法<code>withInputStream</code>, 这个方法可以帮我们自动的关闭输入流.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> File(baseDir,<span class="string">'haiku.txt'</span>).withInputStream &#123; stream -&gt;</div><div class="line">    <span class="comment">// do something ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="写文件"><a href="#写文件" class="headerlink" title="写文件"></a>写文件</h3><p>有时候,你需要的也许只是写文件,下面展示了,如何在Groovy中写文件<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> File(baseDir,<span class="string">'haiku.txt'</span>).withWriter(<span class="string">'utf-8'</span>) &#123; writer -&gt;</div><div class="line">    writer.writeLine <span class="string">'Into the ancient pond'</span></div><div class="line">    writer.writeLine <span class="string">'A frog jumps'</span></div><div class="line">    writer.writeLine <span class="string">'Water’s sound!'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>但对于一个要求很简单的需求来说,我们可以使用<code>&lt;&lt;</code>向文件中写<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> File(baseDir,<span class="string">'haiku.txt'</span>) &lt;&lt; <span class="string">'''Into the ancient pond</span></div><div class="line">A frog jumps</div><div class="line">Water’s sound!'''</div></pre></td></tr></table></figure></p>
<p>当然不是每一次我们都是向文件中输出文本,下面的例子演示了,我们如何向一个文件中写入字节:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">file.bytes = [<span class="number">66</span>,<span class="number">22</span>,<span class="number">11</span>]</div></pre></td></tr></table></figure></p>
<p>当然,你也可以直接打开一个输出流,下面的例子演示了如何开启一个输出流.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> os = <span class="keyword">new</span> File(baseDir,<span class="string">'data.bin'</span>).newOutputStream()</div><div class="line"><span class="comment">// do something ...</span></div><div class="line">os.close()</div></pre></td></tr></table></figure></p>
<p>同<code>newInputStream</code>一样,<code>newOutputStream</code>同样需要手动关闭, ok,你大概想到了<code>withOutputStream</code>:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">new</span> File(baseDir,<span class="string">'data.bin'</span>).withOutputStream &#123; stream -&gt;</div><div class="line">    <span class="comment">// do something ...</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="遍历文件"><a href="#遍历文件" class="headerlink" title="遍历文件"></a>遍历文件</h3><p>在脚本中, 有个很常用的需求就是,遍历一个目录,然后找到一个文件,进行某些操作. Groovy提供了很多方法,来达到这个效果. 下面的例子演示了将一个目录下的所有文件都执行某个操作:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">dir.eachFile &#123; file -&gt;                      (<span class="number">1</span>)</div><div class="line">    println file.name</div><div class="line">&#125;</div><div class="line">dir.eachFileMatch(<span class="regexp">~/.*\.txt/</span>) &#123; file -&gt;     (<span class="number">2</span>)</div><div class="line">    println file.name</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>在目录下的每个文件上执行闭包操作.</li>
<li>根据正则表达式在目录下找到符合条件的文件,然后执行闭包操作.</li>
</ol>
<p>也许你想要遍历某个目录和目录里的所有子目录, 那么你可以使用<code>eachFileRecurse</code><br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">dir.eachFileRecurse &#123; file -&gt;                      (<span class="number">1</span>)</div><div class="line">    println file.name</div><div class="line">&#125;</div><div class="line"></div><div class="line">dir.eachFileRecurse(FileType.FILES) &#123; file -&gt;      (<span class="number">2</span>)</div><div class="line">    println file.name</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<ol>
<li>对目录里的所有子目录进行递归, 然后对找到的文件和目录进行闭包操作</li>
<li>对目录里进行递归查找,但是只查找文件.</li>
</ol>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">dir.traverse &#123; file -&gt;</div><div class="line">    <span class="keyword">if</span> (file.directory &amp;&amp; file.name==<span class="string">'bin'</span>) &#123;</div><div class="line">        FileVisitResult.TERMINATE                   (<span class="number">1</span>)</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        println file.name</div><div class="line">        FileVisitResult.CONTINUE                    (<span class="number">2</span>)</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>如果找到的文件是目录,且它的名字是”dir”, 则停止遍历</li>
<li>打印出文件的名字,接着遍历</li>
</ol>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p>在java中会使用<code>java.io.DataOutputStream</code> 序列化数据也不罕见. Groovy对这个需求也做了非常简单的实现, 下面的例子演示了如何序列化和反序列化:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">boolean</span> b = <span class="literal">true</span></div><div class="line">String message = <span class="string">'Hello from Groovy'</span></div><div class="line"><span class="comment">// Serialize data into a file</span></div><div class="line">file.withDataOutputStream &#123; out -&gt;</div><div class="line">    out.writeBoolean(b)</div><div class="line">    out.writeUTF(message)</div><div class="line">&#125;</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="comment">// Then read it back</span></div><div class="line">file.withDataInputStream &#123; input -&gt;</div><div class="line">    <span class="keyword">assert</span> input.readBoolean() == b</div><div class="line">    <span class="keyword">assert</span> input.readUTF() == message</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>同样,如果这个数据实例了序列化接口<code>Serializable</code>, 你可以使用 object output stream将整个数据序列化到文件:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">Person p = <span class="keyword">new</span> Person(<span class="string">name:</span><span class="string">'Bob'</span>, <span class="string">age:</span><span class="number">76</span>)</div><div class="line"><span class="comment">// Serialize data into a file</span></div><div class="line">file.withObjectOutputStream &#123; out -&gt;</div><div class="line">    out.writeObject(p)</div><div class="line">&#125;</div><div class="line"><span class="comment">// ...</span></div><div class="line"><span class="comment">// Then read it back</span></div><div class="line">file.withObjectInputStream &#123; input -&gt;</div><div class="line">    <span class="keyword">def</span> p2 = input.readObject()</div><div class="line">    <span class="keyword">assert</span> p2.name == p.name</div><div class="line">    <span class="keyword">assert</span> p2.age == p.age</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="执行命令"><a href="#执行命令" class="headerlink" title="执行命令"></a>执行命令</h3><p>前面的章节介绍了在Groovy中操作files, readers or streams非常简单. 然而, 像系统管理员或者开发者,可能更多的是执行一个系统命令.</p>
<p>Groovy同样提供了非常简单的方式执行命令行命令. 只需要定义一个命令的字符串,然后执行这个字符串的<code>execute()</code>. 在类Unix系统中(如果在windows中也安装了类Unix命令行工具也算),你可以这样执行命令.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> process = <span class="string">"ls -l"</span>.execute()             (<span class="number">1</span>)</div><div class="line">println <span class="string">"Found text $&#123;process.text&#125;"</span>        (<span class="number">2</span>)</div></pre></td></tr></table></figure></p>
<ol>
<li>在外部过程(external process)执行ls命令</li>
<li>获得命令的输出,并输出</li>
</ol>
<p><code>execute()</code>方法返回一个<code>java.lang.Process</code>实例, 随后选择一种输出流<code>in/out/err</code>, 同时检查<code>exit</code>值,查看是否命令执行完毕.</p>
<p>下面的例子使用了和刚才那个例子一样的命令,但是现在我们每次都会对获得的结果进行行输出.<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">            <span class="keyword">def</span> process = <span class="string">"ls -l"</span>.execute()             (<span class="number">1</span>)</div><div class="line">            process.<span class="keyword">in</span>.eachLine &#123; line -&gt;               (<span class="number">2</span>)</div><div class="line">                println line                            (<span class="number">3</span>)</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">assert</span> process <span class="keyword">instanceof</span> Process</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">void</span> testProcessConsumeOutput() &#123;</div><div class="line">        <span class="keyword">if</span> (unixlike) &#123;</div><div class="line">            doInTmpDir &#123; b -&gt;</div><div class="line">                File file = <span class="literal">null</span></div><div class="line">                <span class="keyword">def</span> tmpDir = b.tmp &#123;</div><div class="line">                    file = <span class="string">'foo.tmp'</span>(<span class="string">'foo'</span>)</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">assert</span> file.exists()</div><div class="line">                <span class="keyword">def</span> p = <span class="string">"rm -f foo.tmp"</span>.execute([], tmpDir)</div><div class="line">                p.consumeProcessOutput()</div><div class="line">                p.waitFor()</div><div class="line">                <span class="keyword">assert</span> !file.exists()</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">void</span> testProcessPipe() &#123;</div><div class="line">        <span class="keyword">if</span> (unixlike) &#123;</div><div class="line">            doInTmpDir &#123; b -&gt;</div><div class="line">                <span class="keyword">def</span> proc1, proc2, proc3, proc4</div><div class="line">                proc1 = <span class="string">'ls'</span>.execute()</div><div class="line">                proc2 = <span class="string">'tr -d o'</span>.execute()</div><div class="line">                proc3 = <span class="string">'tr -d e'</span>.execute()</div><div class="line">                proc4 = <span class="string">'tr -d i'</span>.execute()</div><div class="line">                proc1 | proc2 | proc3 | proc4</div><div class="line">                proc4.waitFor()</div><div class="line">                <span class="keyword">if</span> (proc4.exitValue()) &#123;</div><div class="line">                    println proc4.err.text</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    println proc4.text</div><div class="line">                &#125;</div><div class="line"></div><div class="line">                <span class="keyword">def</span> sout = <span class="keyword">new</span> StringBuilder()</div><div class="line">                <span class="keyword">def</span> serr = <span class="keyword">new</span> StringBuilder()</div><div class="line">                proc2 = <span class="string">'tr -d o'</span>.execute()</div><div class="line">                proc3 = <span class="string">'tr -d e'</span>.execute()</div><div class="line">                proc4 = <span class="string">'tr -d i'</span>.execute()</div><div class="line">                proc4.consumeProcessOutput(sout, serr)</div><div class="line">                proc2 | proc3 | proc4</div><div class="line">                [proc2, proc3].each &#123; it.consumeProcessErrorStream(serr) &#125;</div><div class="line">                proc2.withWriter &#123; writer -&gt;</div><div class="line">                    writer &lt;&lt; <span class="string">'testfile.groovy'</span></div><div class="line">                &#125;</div><div class="line">                proc4.waitForOrKill(<span class="number">1000</span>)</div><div class="line">                println <span class="string">"Standard output: $sout"</span></div><div class="line">                println <span class="string">"Standard error: $serr"</span></div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span> &#123;</span></div><div class="line">        String name</div><div class="line">        <span class="keyword">int</span> age</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>1    executes the ls command in an external process<br>2    for each line of the input stream of the process<br>3    print the line</p>
<ol>
<li>在外部进程中执行ls命令<br>2.</li>
</ol>
<p>It is worth noting that in corresponds to an input stream to the standard output of the command. out will refer to a stream where you can send data to the process (its standard input).</p>
<p>Remember that many commands are shell built-ins and need special handling. So if you want a listing of files in a directory on a Windows machine and write:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> process = <span class="string">"dir"</span>.execute()</div><div class="line">println <span class="string">"$&#123;process.text&#125;"</span></div></pre></td></tr></table></figure>
<p>接着你会收到一个异常<code>IOException</code>,异常信息为<code>Cannot run program &quot;dir&quot;: CreateProcess error=2</code>,系统找不到指定的文件.</p>
<p>这是因为<code>dir</code>是内建于<code>windows shell(cmd.ext)</code>, 想要使用那个命令,你要像下面这个样操作:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> process = <span class="string">"cmd /c dir"</span>.execute()</div><div class="line">println <span class="string">"$&#123;process.text&#125;"</span></div></pre></td></tr></table></figure></p>
<p>还有,因为上述的功能是在内部使用的<code>java.lang.Process</code>, 这个类的一些不足的地方,我们也要充分考虑. 在javadoc中,是这样描述这个类的:</p>
<blockquote>
<p>Because some native platforms only provide limited buffer size for standard input and output streams, failure to promptly write the input stream or read the output stream of the subprocess may cause the subprocess to block, and even deadlock<br>Because of this, Groovy provides some additional helper methods which make stream handling for processes easier.</p>
</blockquote>
<p>现在演示一下,如何输出进程里所有的输出(包括error stream).<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> p = <span class="string">"rm -f foo.tmp"</span>.execute([], tmpDir)</div><div class="line">p.consumeProcessOutput()</div><div class="line">p.waitFor()</div></pre></td></tr></table></figure></p>
<p><code>consumeProcessOutput</code>仍然有很多对<code>StringBuffer</code>, <code>InputStream</code>, <code>OutputStream</code>等封装的变量, 如果想要获取一个完整的封装列表的,那可以参考 <a href="http://docs.groovy-lang.org/latest/html/groovy-jdk/java/lang/Process.html" target="_blank" rel="external">GDK API for java.lang.Process</a></p>
<p>另外, <code>pipeTo</code>命令 可以让一个进程的输出流连接到一个进程的输入流里. 如下例:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">proc1 = <span class="string">'ls'</span>.execute()</div><div class="line">proc2 = <span class="string">'tr -d o'</span>.execute()</div><div class="line">proc3 = <span class="string">'tr -d e'</span>.execute()</div><div class="line">proc4 = <span class="string">'tr -d i'</span>.execute()</div><div class="line">proc1 | proc2 | proc3 | proc4</div><div class="line">proc4.waitFor()</div><div class="line"><span class="keyword">if</span> (proc4.exitValue()) &#123;</div><div class="line">    println proc4.err.text</div><div class="line">&#125; <span class="keyword">else</span> &#123;</div><div class="line">    println proc4.text</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Consuming errors<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> sout = <span class="keyword">new</span> StringBuilder()</div><div class="line"><span class="keyword">def</span> serr = <span class="keyword">new</span> StringBuilder()</div><div class="line">proc2 = <span class="string">'tr -d o'</span>.execute()</div><div class="line">proc3 = <span class="string">'tr -d e'</span>.execute()</div><div class="line">proc4 = <span class="string">'tr -d i'</span>.execute()</div><div class="line">proc4.consumeProcessOutput(sout, serr)</div><div class="line">proc2 | proc3 | proc4</div><div class="line">[proc2, proc3].each &#123; it.consumeProcessErrorStream(serr) &#125;</div><div class="line">proc2.withWriter &#123; writer -&gt;</div><div class="line">    writer &lt;&lt; <span class="string">'testfile.groovy'</span></div><div class="line">&#125;</div><div class="line">proc4.waitForOrKill(<span class="number">1000</span>)</div><div class="line">println <span class="string">"Standard output: $sout"</span></div><div class="line">println <span class="string">"Standard error: $serr"</span></div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程语言/">编程语言</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/04/09/编程语言/Groovy IO/#comments" class="ds-thread-count comments-count-link" data-thread-key="2014/04/09/编程语言/Groovy IO/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2014/04/08/编程语言/Groovy/" title="Groovy 注释和标识符" itemprop="url">Groovy 注释和标识符</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2014-04-08T07:00:00.000Z" itemprop="datePublished"> Published 2014-04-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <blockquote>
<p>本文是对Groovy部分官方文档进行了翻译</p>
</blockquote>
<h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><h3 id="单行注释"><a href="#单行注释" class="headerlink" title="单行注释"></a>单行注释</h3><p>想要使用单行注释, 使用<code>//</code>就可以了.  本行中<code>//</code>后续的内容都会被认为是注释的一部分<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// a standalone single line comment</span></div><div class="line">println <span class="string">"hello"</span> <span class="comment">// a comment till the end of the line</span></div></pre></td></tr></table></figure></p>
<h3 id="多行注释"><a href="#多行注释" class="headerlink" title="多行注释"></a>多行注释</h3><p>多行注释从<code>/*</code>开始, 直到<code>*/</code>结束(跨行也包含在内)<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/* a standalone multiline comment</span></div><div class="line">spanning two lines */</div><div class="line">println <span class="string">"hello"</span> <span class="comment">/* a multiline comment starting</span></div><div class="line">at the end of a statement */</div><div class="line">println <span class="number">1</span> <span class="comment">/* one */</span> + <span class="number">2</span> <span class="comment">/* two */</span></div></pre></td></tr></table></figure></p>
<h4 id="GroovyDoc-注释"><a href="#GroovyDoc-注释" class="headerlink" title="GroovyDoc 注释"></a>GroovyDoc 注释</h4><p><code>GroovyDoc</code> 注释也是多行的, 但是它是以<code>/**</code>开始, <code>*/</code>结束定义的.<br>这种注释一般用于以下情况：</p>
<ul>
<li>类型定义(包含 classes, interfaces, enums, annotations)</li>
<li>字段和属性定义</li>
<li>方法定义</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">  * A Class description</div><div class="line">  */</div><div class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> &#123;</span></div><div class="line">     <span class="comment">/** the name of the person */</span></div><div class="line">     String name</div><div class="line"></div><div class="line">     <span class="comment">/**</span></div><div class="line">      * Creates a greeting method for a certain person.</div><div class="line">      *</div><div class="line">      * <span class="doctag">@param</span> otherPerson the person to greet</div><div class="line">      * <span class="doctag">@return</span> ag reeting message</div><div class="line">      */</div><div class="line">     String greet(String otherPerson) &#123;</div><div class="line">        <span class="string">"Hello $&#123;otherPerson&#125;"</span></div><div class="line">     &#125;</div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<h3 id="Shebang-line"><a href="#Shebang-line" class="headerlink" title="Shebang line"></a>Shebang line</h3><p>除了上面提到的单行注释外, 还有一种特殊的单行注释.这种注释在UNIX系统下通常称为shebang线, 这种注释允许脚本直接在命令行里执行( 但是前提是你已经在系统是安装了<code>groovy</code>,并且在<code>PATH</code>里进行了配置)</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/usr/bin/env groovy</span></div><div class="line">println <span class="string">"Hello from the shebang line"</span></div></pre></td></tr></table></figure>
<p><code>#</code>字符必须是这个文件里的第一个字符,否则编译器将会抛出一个编译错误.</p>
<h2 id="标识符"><a href="#标识符" class="headerlink" title="标识符"></a>标识符</h2><h3 id="普通标识符"><a href="#普通标识符" class="headerlink" title="普通标识符"></a>普通标识符</h3><p>标识符以一个<code>字母</code>或者<code>$</code>或者<code>_</code>开始, 不能以数字打头.<br>如果以字母打头,他们在下列范围内</p>
<ul>
<li>‘a’ to ‘z’ (lowercase ascii letter)</li>
<li>‘A’ to ‘Z’ (uppercase ascii letter)</li>
<li>‘\u00C0’ to ‘\u00D6’</li>
<li>‘\u00D8’ to ‘\u00F6’</li>
<li>‘\u00F8’ to ‘\u00FF’</li>
<li>‘\u0100’ to ‘\uFFFE’</li>
</ul>
<p>剩下的字符就可以包含字母或者数字了.  下面列举了一些合法的标识符：<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> name</div><div class="line"><span class="keyword">def</span> item3</div><div class="line"><span class="keyword">def</span> with_underscore</div><div class="line"><span class="keyword">def</span> $dollarStart</div></pre></td></tr></table></figure></p>
<p>下面是一些非法的标识符<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">def 3tier</div><div class="line">def a+b</div><div class="line">def a#b</div></pre></td></tr></table></figure></p>
<p><code>.</code>后面的关键字也是合法的标识符<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">foo.<span class="keyword">as</span></div><div class="line">foo.<span class="keyword">assert</span></div><div class="line">foo.<span class="keyword">break</span></div><div class="line">foo.<span class="keyword">case</span></div><div class="line">foo.<span class="keyword">catch</span></div></pre></td></tr></table></figure></p>
<h3 id="带引号的标识符"><a href="#带引号的标识符" class="headerlink" title="带引号的标识符"></a>带引号的标识符</h3><p>带引号的标识符出现在<code>.\</code>. 例如<code>person.name</code>表达式中的<code>name</code>部分能通过这俩种方式引起来<code>person.&quot;name&quot;</code>或者<code>person.\&#39;name&#39;</code>. 当特定标识符中包含非法字符(java语言禁止的字符),但是通过引号的方式可以达到在Groovy的合法. 例如,一个破折号,一个空格,一个感叹号,<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> map = [:]</div><div class="line"></div><div class="line">map.<span class="string">"an identifier with a space and double quotes"</span> = <span class="string">"ALLOWED"</span></div><div class="line">map.<span class="string">'with-dash-signs-and-single-quotes'</span> = <span class="string">"ALLOWED"</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> map.<span class="string">"an identifier with a space and double quotes"</span> == <span class="string">"ALLOWED"</span></div><div class="line"><span class="keyword">assert</span> map.<span class="string">'with-dash-signs-and-single-quotes'</span> == <span class="string">"ALLOWED"</span></div></pre></td></tr></table></figure></p>
<p>正像一会我们在strings模块看到的一样, Groovy提供了不同的string字面量. 以下所列举的都是合法的<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">map.<span class="string">'single quote'</span></div><div class="line">map.<span class="string">"double quote"</span></div><div class="line">map.<span class="string">'''triple single quote'''</span></div><div class="line">map.<span class="string">"""triple double quote"""</span></div><div class="line">map.<span class="regexp">/slashy string/</span></div><div class="line">map.<span class="string">$/dollar slashy string/$</span></div></pre></td></tr></table></figure></p>
<p>strings 和 Groovy’s GStrings 在纯字符上面是有一点不同的,as in that the latter case, the interpolated values are inserted in the final string for evaluating the whole identifier:<br><figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">def</span> firstname = <span class="string">"Homer"</span></div><div class="line">map.<span class="string">"Simson-$&#123;firstname&#125;"</span> = <span class="string">"Homer Simson"</span></div><div class="line"></div><div class="line"><span class="keyword">assert</span> map.<span class="string">'Simson-Homer'</span> == <span class="string">"Homer Simson"</span></div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程语言/">编程语言</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2014/04/08/编程语言/Groovy/#comments" class="ds-thread-count comments-count-link" data-thread-key="2014/04/08/编程语言/Groovy/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/11/20/zookeeper/ZooKeeper 命令行客户端/" title="ZooKeeper 命令行客户端" itemprop="url">ZooKeeper 命令行客户端</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2013-11-20T08:00:00.000Z" itemprop="datePublished"> Published 2013-11-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>我们执行<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">bin/zkCli.cmd -server 127.0.0.1:2181</div></pre></td></tr></table></figure></p>
<p>就连接上了刚才启动的服务器,进入shell<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">E:\zookeeper-3.4.6\bin&gt;.\zkCli.cmd -server 127.0.0.1:2181</div><div class="line">Connecting to 127.0.0.1:2181</div><div class="line">2015-11-09 16:04:51,367 [myid:] - INFO  [main:Environment@100] - Client environment:zookeeper.version=3.4.6-1569965, built on 02/20/2014 09:09 GMT</div><div class="line">...</div><div class="line">2015-11-09 16:04:51,374 [myid:] - INFO  [main:Environment@100] - Client environment:user.home=C:\Users\Administrator</div><div class="line">2015-11-09 16:04:51,374 [myid:] - INFO  [main:Environment@100] - Client environment:user.dir=E:\zookeeper-3.4.6\bin</div><div class="line">2015-11-09 16:04:51,375 [myid:] - INFO  [main:ZooKeeper@438] - Initiating client connection, connectString=127.0.0.1:2181 sessionTimeout=30000 watcher=org.apache.zookeeper.ZooKeeperMain$MyWatcher@277050dc</div><div class="line">Welcome to ZooKeeper!</div><div class="line">2015-11-09 16:04:51,514 [myid:] - INFO  [main-SendThread(127.0.0.1:2181):ClientCnxn$SendThread@975] - Opening socket connection to server 127.0.0.1/127.0.0.1:2181. Will not attempt to authenticate using SASL (unknown error)</div><div class="line">2015-11-09 16:04:51,516 [myid:] - INFO  [main-SendThread(127.0.0.1:2181):ClientCnxn$SendThread@852] - Socket connection established to 127.0.0.1/127.0.0.1:2181, initiating session</div><div class="line">2015-11-09 16:04:51,684 [myid:] - INFO  [main-SendThread(127.0.0.1:2181):ClientCnxn$SendThread@1235] - Session establishment complete on server 127.0.0.1/127.0.0.1:2181, sessionid = 0x150eb438ceb0000, negotiated timeout = 30000</div><div class="line"></div><div class="line">WATCHER::</div><div class="line"></div><div class="line">WatchedEvent state:SyncConnected type:None path:null</div><div class="line">JLine support is enabled</div><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 0]</div></pre></td></tr></table></figure></p>
<p>进入到shell之后,我们可以敲人<code>help</code>命令，查看我们都能使用哪些命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] help</div><div class="line">ZooKeeper -server host:port cmd args</div><div class="line">	stat path [watch]</div><div class="line">	set path data [version]</div><div class="line">	ls path [watch]</div><div class="line">	delquota [-n|-b] path</div><div class="line">	ls2 path [watch]</div><div class="line">	setAcl path acl</div><div class="line">	setquota -n|-b val path</div><div class="line">	history</div><div class="line">	redo cmdno</div><div class="line">	printwatches on|off</div><div class="line">	delete path [version]</div><div class="line">	sync path</div><div class="line">	listquota path</div><div class="line">	rmr path</div><div class="line">	get path [watch]</div><div class="line">	create [-s] [-e] path data acl</div><div class="line">	addauth scheme auth</div><div class="line">	quit</div><div class="line">	getAcl path</div><div class="line">	close</div><div class="line">	connect host:port</div><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 2]</div></pre></td></tr></table></figure></p>
<p>看到了,我们能使用这么多命令，下来我们简单的接受几个命令.</p>
<p>我们使用<code>create</code>命令创建一个<code>znode</code>(这个node里和字符串”my_data”关联起来了).<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 1] create /zk_test my_data</div><div class="line">Created /zk_test</div><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 3] ls /</div><div class="line">[zookeeper, zk_test]</div><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 4]</div></pre></td></tr></table></figure></p>
<p>但是实际上，这个node还没有被创建出来.</p>
<p>下来我们使用<code>get</code>命令验证一下<code>zk_test</code>是不是真的和”my_data”关联起来了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 4] get /zk_test</div><div class="line">my_data</div><div class="line">cZxid = 0x3</div><div class="line">ctime = Mon Nov 09 16:29:12 CST 2015</div><div class="line">mZxid = 0x3</div><div class="line">mtime = Mon Nov 09 16:29:12 CST 2015</div><div class="line">pZxid = 0x3</div><div class="line">cversion = 0</div><div class="line">dataVersion = 0</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 7</div><div class="line">numChildren = 0</div><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 5]</div></pre></td></tr></table></figure></p>
<p>我们还可以使用<code>set</code>命令将刚才那个node重新关联<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 5] set /zk_test new_data</div><div class="line">cZxid = 0x3</div><div class="line">ctime = Mon Nov 09 16:29:12 CST 2015</div><div class="line">mZxid = 0x4</div><div class="line">mtime = Mon Nov 09 16:35:11 CST 2015</div><div class="line">pZxid = 0x3</div><div class="line">cversion = 0</div><div class="line">dataVersion = 1</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 8</div><div class="line">numChildren = 0</div><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 7] get /zk_test</div><div class="line">new_data</div><div class="line">cZxid = 0x3</div><div class="line">ctime = Mon Nov 09 16:29:12 CST 2015</div><div class="line">mZxid = 0x4</div><div class="line">mtime = Mon Nov 09 16:35:11 CST 2015</div><div class="line">pZxid = 0x3</div><div class="line">cversion = 0</div><div class="line">dataVersion = 1</div><div class="line">aclVersion = 0</div><div class="line">ephemeralOwner = 0x0</div><div class="line">dataLength = 8</div><div class="line">numChildren = 0</div><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 8]</div></pre></td></tr></table></figure></p>
<p>最后，我们将这个node删掉<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 9] delete /zk_test</div><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 10] ls /</div><div class="line">[zookeeper]</div><div class="line">[zk: 127.0.0.1:2181(CONNECTED) 11]</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ZooKeeper/">ZooKeeper</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2013/11/20/zookeeper/ZooKeeper 命令行客户端/#comments" class="ds-thread-count comments-count-link" data-thread-key="2013/11/20/zookeeper/ZooKeeper 命令行客户端/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/11/20/zookeeper/ZooKeeper Java客户端/" title="ZooKeeper Java客户端" itemprop="url">ZooKeeper Java客户端</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2013-11-20T08:00:00.000Z" itemprop="datePublished"> Published 2013-11-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>我们使用ZooKeeper官方java客户端进行测试,另外可以使用curator.</p>
<p>我们使用Maven添加相关依赖<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.zookeeper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>zookeeper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="创建节点"><a href="#创建节点" class="headerlink" title="创建节点"></a>创建节点</h2><p>然后我们向zk服务器上添加俩个节点<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.zookeeper.CreateMode;</div><div class="line"><span class="keyword">import</span> org.apache.zookeeper.KeeperException;</div><div class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooDefs;</div><div class="line"><span class="keyword">import</span> org.apache.zookeeper.ZooKeeper;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateNode</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ROOT_PATH = <span class="string">"/Servers"</span>;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ZooKeeper zooKeeper;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, KeeperException, InterruptedException </span>&#123;</div><div class="line">		<span class="comment">// 连接ZooKeeper服务器</span></div><div class="line">		zooKeeper = <span class="keyword">new</span> ZooKeeper(<span class="string">"localhost:2181"</span>, <span class="number">15000</span>, event -&gt; &#123;</div><div class="line">			<span class="comment">// TODO</span></div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		<span class="comment">// 创建根节点, 子节点依赖于父节点, 我们不能直接创建出/Servers/server1</span></div><div class="line">		zooKeeper.create(ROOT_PATH, <span class="comment">// 节点路径</span></div><div class="line">				<span class="string">"create"</span>.getBytes(), <span class="comment">// 节点数据</span></div><div class="line">				ZooDefs.Ids.OPEN_ACL_UNSAFE, <span class="comment">// 权限控制(不使用节点权限控制)</span></div><div class="line">				CreateMode.PERSISTENT, <span class="comment">// 节点类型(临时节点不允许创建子节点,所以我们选择了持久节点)</span></div><div class="line">				(rc, path, ctx, name) -&gt; &#123; <span class="comment">// 节点创建成功之后的回调函数</span></div><div class="line">					<span class="comment">// TODO</span></div><div class="line">				&#125;, ROOT_PATH);</div><div class="line"></div><div class="line">		<span class="comment">// 创建子节点</span></div><div class="line">		zooKeeper.create(ROOT_PATH + <span class="string">"/server1"</span>, <span class="comment">// 节点路径</span></div><div class="line">				<span class="string">"create"</span>.getBytes(), <span class="comment">// 节点数据</span></div><div class="line">				ZooDefs.Ids.OPEN_ACL_UNSAFE, <span class="comment">// 权限控制</span></div><div class="line">				CreateMode.PERSISTENT, <span class="comment">// 节点类型</span></div><div class="line">				(rc, path, ctx, name) -&gt; &#123; <span class="comment">// 节点创建成功之后的回调函数</span></div><div class="line">					<span class="comment">// TODO</span></div><div class="line">				&#125;, ROOT_PATH);</div><div class="line"></div><div class="line">		<span class="comment">// 获取节点下的所有子节点</span></div><div class="line">		List&lt;String&gt; children = zooKeeper.getChildren(ROOT_PATH, event -&gt; &#123;</div><div class="line">			<span class="comment">// TODO</span></div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		children.forEach(child -&gt; System.out.println(child));</div><div class="line"></div><div class="line">		TimeUnit.SECONDS.sleep(<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.zookeeper.*;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.util.Random;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CreateNode</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String ROOT_PATH = <span class="string">"/Servers"</span> + <span class="keyword">new</span> Random().nextInt(<span class="number">100000</span>);</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ZooKeeper zooKeeper;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException, KeeperException, InterruptedException </span>&#123;</div><div class="line">		<span class="comment">// 连接ZooKeeper服务器</span></div><div class="line">		zooKeeper = <span class="keyword">new</span> ZooKeeper(<span class="string">"localhost:2181"</span>, <span class="number">15000</span>, event -&gt; &#123;</div><div class="line">			System.out.println(<span class="string">"事件变化 : "</span> + event.getPath() + <span class="string">" -&gt; "</span> + event.getType());</div><div class="line">		&#125;);</div><div class="line"></div><div class="line">		<span class="comment">// 创建根节点, 子节点依赖于父节点, 我们不能直接创建出/Servers/server1</span></div><div class="line">		zooKeeper.create(ROOT_PATH, <span class="comment">// 节点路径</span></div><div class="line">				<span class="string">"create"</span>.getBytes(), <span class="comment">// 节点数据</span></div><div class="line">				ZooDefs.Ids.OPEN_ACL_UNSAFE, <span class="comment">// 权限控制(不使用节点权限控制)</span></div><div class="line">				CreateMode.PERSISTENT, <span class="comment">// 节点类型(临时节点不允许创建子节点,所以我们选择了持久节点)</span></div><div class="line">				(rc, path, ctx, name) -&gt; &#123; <span class="comment">// 节点创建成功之后的回调函数</span></div><div class="line">					<span class="keyword">try</span> &#123;</div><div class="line">						System.out.println(<span class="string">"Create Node OK!"</span>);</div><div class="line">						zooKeeper.getChildren(ROOT_PATH, event -&gt; &#123;</div><div class="line">							System.out.println(<span class="string">"Watch : "</span> + event.getPath() + <span class="string">" -&gt; "</span> + event.getType());</div><div class="line">						&#125;);</div><div class="line">					&#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</div><div class="line">						e.printStackTrace();</div><div class="line">					&#125;</div><div class="line">				&#125;, ROOT_PATH);</div><div class="line"></div><div class="line">		<span class="comment">// 在创建上个node的时候, 由于注册watch是异步执行的, 因此需要在这里等待一下</span></div><div class="line">		TimeUnit.SECONDS.sleep(<span class="number">3</span>);</div><div class="line"></div><div class="line">		zooKeeper.create(ROOT_PATH + <span class="string">"/server1"</span>, <span class="comment">// 节点路径</span></div><div class="line">				<span class="string">"create"</span>.getBytes(), <span class="comment">// 节点数据</span></div><div class="line">				ZooDefs.Ids.OPEN_ACL_UNSAFE, <span class="comment">// 权限控制(不使用节点权限控制)</span></div><div class="line">				CreateMode.PERSISTENT, <span class="comment">// 节点类型(临时节点不允许创建子节点,所以我们选择了持久节点)</span></div><div class="line">				(rc, path, ctx, name) -&gt; &#123; <span class="comment">// 节点创建成功之后的回调函数</span></div><div class="line">					<span class="keyword">try</span> &#123;</div><div class="line">						System.out.println(<span class="string">"Create Node OK!"</span>);</div><div class="line">						zooKeeper.getChildren(ROOT_PATH, event -&gt; &#123;</div><div class="line">							System.out.println(<span class="string">"Watch : "</span> + event.getPath() + <span class="string">" -&gt; "</span> + event.getType());</div><div class="line">						&#125;);</div><div class="line">					&#125; <span class="keyword">catch</span> (<span class="keyword">final</span> Exception e) &#123;</div><div class="line">						e.printStackTrace();</div><div class="line">					&#125;</div><div class="line">				&#125;, ROOT_PATH);</div><div class="line"></div><div class="line">		TimeUnit.SECONDS.sleep(<span class="number">3</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>输出结果为<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">事件变化 : null -&gt; None</div><div class="line">Create Node OK!</div><div class="line">Watch : /Servers53734 -&gt; NodeChildrenChanged</div><div class="line">Create Node OK!</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ZooKeeper/">ZooKeeper</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2013/11/20/zookeeper/ZooKeeper Java客户端/#comments" class="ds-thread-count comments-count-link" data-thread-key="2013/11/20/zookeeper/ZooKeeper Java客户端/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/09/13/zookeeper/ZooKeeper 服务器/" title="ZooKeeper 服务器" itemprop="url">ZooKeeper 服务器</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2013-09-13T07:00:00.000Z" itemprop="datePublished"> Published 2013-09-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>演示windows系统下快速使用<code>Zookeeper3.4.6</code>版本</p>
<h2 id="单机模式"><a href="#单机模式" class="headerlink" title="单机模式"></a>单机模式</h2><p>我们从Zookeeper官网下载下其最新的压缩包之后,然后解压得到下面的目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">├───bin</div><div class="line">├───conf</div><div class="line">├───contrib</div><div class="line">├───datadir</div><div class="line">├───dist-maven</div><div class="line">├───docs</div><div class="line">├───lib</div><div class="line">├───recipes</div><div class="line">└───src</div></pre></td></tr></table></figure></p>
<blockquote>
<p><code>datadir</code>是我自己创建的,用于存放内存数据的快照文件。</p>
</blockquote>
<ol>
<li>进入到<code>conf</code>目录，将<code>zoo_sample.cfg</code>修改为<code>zoo.cfg</code>文件</li>
<li>修改<code>zoo.cfg</code>文件内容,<code>dataDir=E:/zookeeper-3.4.6/datadir</code>这个是我修改过的路径</li>
<li>进入到<code>bin</code>目录, 执行<code>.\zkServer.cmd start</code> .最后见到<code>Established session 0x150eb438ceb0000 with negotiated timeout 30000 for client /127.0.0.1:54408</code>就启动成功了</li>
</ol>
<blockquote>
<p>如果遇到<code>java.lang.NumberFormatException: For input string: &quot;E:\zookeeper-3.4.6\bin\..\conf\zoo.cfg&quot;</code>这个提示,那就要去修改<code>bin/zkServer.cmd</code>文件, 将<code>%*</code>这个去掉就好了</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">call %JAVA% "-Dzookeeper.log.dir=%ZOO_LOG_DIR%" "-Dzookeeper.root.logger=%ZOO_LOG4J_PROP%" -cp "%CLASSPATH%" %ZOOMAIN% "%ZOOCFG%" %*</div></pre></td></tr></table></figure>
<p>修改成<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">call %JAVA% "-Dzookeeper.log.dir=%ZOO_LOG_DIR%" "-Dzookeeper.root.logger=%ZOO_LOG4J_PROP%" -cp "%CLASSPATH%" %ZOOMAIN% "%ZOOCFG%"</div></pre></td></tr></table></figure></p>
<h2 id="集群模式"><a href="#集群模式" class="headerlink" title="集群模式"></a>集群模式</h2>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/ZooKeeper/">ZooKeeper</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2013/09/13/zookeeper/ZooKeeper 服务器/#comments" class="ds-thread-count comments-count-link" data-thread-key="2013/09/13/zookeeper/ZooKeeper 服务器/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2013/09/13/Java/Guava CachesExplained/" title="Guava Cache" itemprop="url">Guava Cache</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2013-09-13T07:00:00.000Z" itemprop="datePublished"> Published 2013-09-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">LoadingCache&lt;Key, Graph&gt; graphs = CacheBuilder.newBuilder()  </div><div class="line">       .maximumSize(<span class="number">1000</span>)  </div><div class="line">       .expireAfterWrite(<span class="number">10</span>, TimeUnit.MINUTES)  </div><div class="line">       .removalListener(MY_LISTENER)  </div><div class="line">       .build(  </div><div class="line">           <span class="keyword">new</span> CacheLoader&lt;Key, Graph&gt;() &#123;  </div><div class="line">             <span class="function"><span class="keyword">public</span> Graph <span class="title">load</span><span class="params">(Key key)</span> <span class="keyword">throws</span> AnyException </span>&#123;  </div><div class="line">               <span class="keyword">return</span> createExpensiveGraph(key);  </div><div class="line">             &#125;  </div><div class="line">           &#125;);</div></pre></td></tr></table></figure>
<h2 id="适用范围"><a href="#适用范围" class="headerlink" title="适用范围"></a>适用范围</h2><p>缓存的使用范围是十分广泛的。每当计算或者通过一些方式生成一个值的时候，会造成资源严重浪费的时候我们可以考虑用缓存技术来存储该值。</p>
<p>缓存和<code>CurrentMap</code>十分相似(键值对形式),但是他们之间还是仍有诸多不同.他们之间最大的不同之处是<code>ConcurrentMap</code>里的元素在被明确地删除之前会一直被存储在<code>Map</code>里，但是对于cache来说，为了维护cache的内存占用，cache被设计成会自动删除其中的数据。在一些应用场合中，使用<code>LoadingCache也</code>是非常有用的，即使它不被允许自动删除其entries(由于它的自动内存加载机制，他不允许这么做)。</p>
<p>一般来说，Guava的缓存技术一般适用于以下场合</p>
<ol>
<li>想要消耗掉一些内存来换取速度的提升</li>
<li>key(map中也有key)会在一段时间内被频繁的访问。</li>
<li>在cache存储的数据容量不会大于其RAM中存储的。</li>
</ol>
<p>你可以按照上文中的例子(CacheBuilder的builder pattern)来创建一个Cache，但是定制属于自己应用程序的Cache才是最激动人心的事。</p>
<blockquote>
<p>注：如果你的应用程序中不会用到上文提到的Cache的特性，那么你可以考虑ConcurrentHashMap，它在内存方面也许更有优势。但是ConcurrentHashMap是非常困难，甚至不可能的来模拟出Cache那样的强大功能。<br>至于如何选择，就要看你的应用程序需求了,仔细看看下面提到的特性—-例如元素的存活期，元素的大小等等，这些特点都是在ConcurrentMap里所不存在的。</p>
</blockquote>
<h2 id="总体"><a href="#总体" class="headerlink" title="总体"></a>总体</h2><p>你应该先问自己第一个问题：你是否有特定的明确的通过某些keys的作参数生成Value的方法？如果你的回答是肯定的话，那么<code>CacheLoader</code>是适合你的。如果你不需要通过某些key来生成value或者你想要重载默认的方法或者想要使用<code>get-if-absent-compute</code>方式,你可以参考<a href="">From A Callable</a>。一般我们可以通过<code>Cache.put</code>直接将元素插入cache中，但是我们应该首先考虑它的自动缓存加载，因为它会考虑到所有缓存内容的一致性。</p>
<blockquote>
<p>From A CacheLoader : LoadingCache通过一个附着的CacheLoader来创建。创建一个CacheLoader也是非常简单的，只要实现一个V load(K key) throws exception的方法就可以了.下面的例子展示出如何创建一个LoadingCache<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">LoadingCache&lt;Key, Graph&gt; graphs = CacheBuilder.newBuilder()  </div><div class="line">       .maximumSize(<span class="number">1000</span>)  </div><div class="line">       .build(  </div><div class="line">           <span class="keyword">new</span> CacheLoader&lt;Key, Graph&gt;() &#123;  </div><div class="line">             <span class="function"><span class="keyword">public</span> Graph <span class="title">load</span><span class="params">(Key key)</span> <span class="keyword">throws</span> AnyException </span>&#123;  </div><div class="line">               <span class="keyword">return</span> createExpensiveGraph(key);  </div><div class="line">             &#125;  </div><div class="line">           &#125;);  </div><div class="line"></div><div class="line">...  </div><div class="line"><span class="keyword">try</span> &#123;  </div><div class="line">  <span class="keyword">return</span> graphs.get(key);  </div><div class="line">&#125; <span class="keyword">catch</span> (ExecutionException e) &#123;  </div><div class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> OtherException(e.getCause());  </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<p>上面的例子也展示除了我们可以通过<code>get(K)</code>的方式对<code>LoadingCache</code>进行查询获取值。我们如果可以从cache中查找到该key，那么将会直接返回该key对应的value，否则会通过cache的<code>CacheLoader</code>自动加载一个新的键值对，然后返回该值。因为<code>CacheLoader</code>可能会抛出异常，所以get(K)可能会抛出<code>Execution</code>。如果在<code>CacheLoader</code>中定义了一个非异常检查的<code>load</code>方法，那么在查询取值时可以使用<code>getUnchecked(Key)</code>;但是如果你声明了throws，则一定不要调用<code>getUnchecked(Key)</code>. 下面是一个例子：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">LoadingCache&lt;Key, Graph&gt; graphs = CacheBuilder.newBuilder()  </div><div class="line">       .expireAfterAccess(<span class="number">10</span>, TimeUnit.MINUTES)  </div><div class="line">       .build(  </div><div class="line">           <span class="keyword">new</span> CacheLoader&lt;Key, Graph&gt;() &#123;  </div><div class="line">             <span class="function"><span class="keyword">public</span> Graph <span class="title">load</span><span class="params">(Key key)</span> </span>&#123; <span class="comment">// no checked exception  </span></div><div class="line">               <span class="keyword">return</span> createExpensiveGraph(key);  </div><div class="line">             &#125;  </div><div class="line">           &#125;);  </div><div class="line"></div><div class="line">...  </div><div class="line"><span class="keyword">return</span> graphs.getUnchecked(key);</div></pre></td></tr></table></figure></p>
<p>当我们想要获取N多值的时候，在查询时可以使用方法<code>getAll(Iterable&lt;? extends K&gt;)</code>.在getAll中，对每一个不存在于cache里的key都会执行一个单独的对<code>CacheLoader.load</code>的方法调用来加载该值。看，guava提供了如此优秀的方法当进行一次getAll比多次get更有优势时，我们就应该重载<code>CacheLoader.loadAll</code>来实现这个功能。</p>
<p>可以通过实现<code>CacheLoader.loadAll</code>这个方法来加载那些不被包含的显示请求的值。</p>
<p>如果想要设定cache有一定的大小可以通过<code>CacheBuilder.maximumSize(long)</code>来设定。如此设定会使得cache在达到限定值时删除那些没有被使用过或者不经常使用的entries.</p>
<blockquote>
<p>From a Callable: 所有的Guava caches，不管是否是loading模式的，都支持get(K, Callable<v>)方法。这个方法会从cache中返回与该key相关联的value，或者从Callable中计算该值并把它放进cache中。这个方法使用了一个非常简单的模式”if cached, return; otherwise create, cache and return”</v></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">Cache&lt;Key, Value&gt; cache = CacheBuilder.newBuilder()  </div><div class="line">    .maximumSize(<span class="number">1000</span>)  </div><div class="line">    .build(); <span class="comment">// look Ma, no CacheLoader  </span></div><div class="line">...  </div><div class="line"><span class="keyword">try</span> &#123;  </div><div class="line">  <span class="comment">// If the key wasn't in the "easy to compute" group, we need to  </span></div><div class="line">  <span class="comment">// do things the hard way.  </span></div><div class="line">  cache.get(key, <span class="keyword">new</span> Callable&lt;Value&gt;() &#123;  </div><div class="line">    <span class="meta">@Override</span>  </div><div class="line">    <span class="function"><span class="keyword">public</span> Value <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> AnyException </span>&#123;  </div><div class="line">      <span class="keyword">return</span> doThingsTheHardWay(key);  </div><div class="line">    &#125;  </div><div class="line">  &#125;);  </div><div class="line">&#125; <span class="keyword">catch</span> (ExecutionException e) &#123;  </div><div class="line">  <span class="keyword">throw</span> <span class="keyword">new</span> OtherException(e.getCause());  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Inserted Directly : Values也可以通过cache.put(key,value)直接将值插入cache中。该方法将重写先前与key匹配的entry。</p>
<h2 id="Eviction"><a href="#Eviction" class="headerlink" title="Eviction"></a>Eviction</h2><p>一个不能避免的问题：由于内存原因，我们不能将所有的东西都加载进cache中。那么你必须下决定：一个cache entry应该何时被抛弃。Guava提供了三种entry释放策略：size-basd evicton，time-based eviction 和reference-based eviction</p>
<h3 id="Size-based-Eviction"><a href="#Size-based-Eviction" class="headerlink" title="Size-based Eviction"></a>Size-based Eviction</h3><p>如果你的cache不允许扩容,即不允许超过设定的最大值，那么使用CacheBuilder.maxmuSize(long)即可。在这种条件下，cache会自己释放掉那些最近没有或者不经常使用的entries内存。注意：cache并不是在超过限定时才会删除掉那些entries，而是在即将达到这个限定值时，那么你就要小心考虑这种情况了，因为很明显即使没有达到这个限定值，cache仍然会进行删除操作。</p>
<p>还有一种情况：cache里不同的entries可能会有不同的weight。例如：如果你的cache values有着截然不同的内存占用—-你可以使用CacheBuilder.weigher(Weigher)设定weigh和使用CacheBuilder.maximumWeight(long)设定一个最大值。<br>下面代码展示了对weight的使用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">LoadingCache&lt;Key, Graph&gt; graphs = CacheBuilder.newBuilder()  </div><div class="line">       .maximumWeight(<span class="number">100000</span>)  </div><div class="line">       .weigher(<span class="keyword">new</span> Weigher&lt;Key, Graph&gt;() &#123;  </div><div class="line">          <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">weigh</span><span class="params">(Key k, Graph g)</span> </span>&#123;  </div><div class="line">            <span class="keyword">return</span> g.vertices().size();  </div><div class="line">          &#125;  </div><div class="line">        &#125;)  </div><div class="line">       .build(  </div><div class="line">           <span class="keyword">new</span> CacheLoader&lt;Key, Graph&gt;() &#123;  </div><div class="line">             <span class="function"><span class="keyword">public</span> Graph <span class="title">load</span><span class="params">(Key key)</span> </span>&#123; <span class="comment">// no checked exception  </span></div><div class="line">               <span class="keyword">return</span> createExpensiveGraph(key);  </div><div class="line">             &#125;  </div><div class="line">           &#125;);</div></pre></td></tr></table></figure></p>
<h3 id="Timed-Eviction"><a href="#Timed-Eviction" class="headerlink" title="Timed Eviction"></a>Timed Eviction</h3><p>CacheBuilder 提供了俩种方式来实现这一模式<br>expireAfterAccess(long, TimeUnit)<br>从最后一次访问(读或者写)开始计时，过了这段指定的时间就会释放掉该entries。注意：那些被删掉的entries的顺序时和size-based eviction是十分相似的。<br>expireAfterWrite(long,TimeUnit)<br>它是从entries被创建或者最后一次被修改值的点来计时的，如果从这个点开始超过了那段指定的时间，entries就会被删除掉。这点设计的很精明，因为数据会随着时间变得越来越陈旧。<br>如果想要测试Timed Eviction，使用Ticker interface和CacheBuilder.ticker(Ticker)方法对你的cache设定一个时间即可，那么你就不需要去等待系统时间了。</p>
<h3 id="Reference-based-Eviction"><a href="#Reference-based-Eviction" class="headerlink" title="Reference-based Eviction"></a>Reference-based Eviction</h3><p>Guava为你准备了entries的垃圾回收器，对于keys或者values可以使用<code>weak reference</code> ，对于values可以使用 <code>soft reference</code>.</p>
<p><code>CacheBuilder.weakKeys()</code>通过weak reference存储keys。在这种情况下，如果keys没有被strong或者soft引用，那么entries会被垃圾回收。这种条件下的垃圾回收器是建立在标识符(引用)之上的，那么这会造成整个cache是使用==来比较俩个key的，而不是equals();</p>
<p><code>CacheBuilder.weakValues()</code>  通过weak referene 存储values.在这种情况下，如果valves没有被strong或者soft引用，那么entries会被垃圾回收。这种条件下的垃圾回收器是建立在标识符(引用)之上的，那么这会造成整个cache是使用==来比较俩个values的，而不是equals();<br>CacheBuilder.softValues()</p>
<h3 id="Explicit-Removals"><a href="#Explicit-Removals" class="headerlink" title="Explicit Removals"></a>Explicit Removals</h3><p>也许在某年某月某天你不想再等cache释放entries，而是自己能手动的去释放掉这些entries，下面三个方法会帮助你</p>
<ul>
<li>单个释放：Cache.invalidate(key)</li>
<li>多个释放：Cache.invalidateAll(keys)</li>
<li>全部释放：Cache.invalidateAll()</li>
</ul>
<h3 id="Removal-Listeners"><a href="#Removal-Listeners" class="headerlink" title="Removal Listeners"></a>Removal Listeners</h3><p>cache允许你指定一个removal listener监听entry的移除操作(例如<code>CacheBuilder.removalListener(RemovalListener)</code>).通过R<code>emovaNotification</code>获得的<code>RemovalListener</code>制定了RemovalCause,key和value`。</p>
<blockquote>
<p>注意RemovalListener抛出的任何异常都会被Logger记录然后被丢弃</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">CacheLoader&lt;Key, DatabaseConnection&gt; loader = <span class="keyword">new</span> CacheLoader&lt;Key, DatabaseConnection&gt; () &#123;  </div><div class="line">  <span class="function"><span class="keyword">public</span> DatabaseConnection <span class="title">load</span><span class="params">(Key key)</span> <span class="keyword">throws</span> Exception </span>&#123;  </div><div class="line">    <span class="keyword">return</span> openConnection(key);  </div><div class="line">  &#125;  </div><div class="line">&#125;;  </div><div class="line">RemovalListener&lt;Key, DatabaseConnection&gt; removalListener = <span class="keyword">new</span> RemovalListener&lt;Key, DatabaseConnection&gt;() &#123;  </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRemoval</span><span class="params">(RemovalNotification&lt;Key, DatabaseConnection&gt; removal)</span> </span>&#123;  </div><div class="line">    DatabaseConnection conn = removal.getValue();  </div><div class="line">    conn.close(); <span class="comment">// tear down properly  </span></div><div class="line">  &#125;  </div><div class="line">&#125;;  </div><div class="line"></div><div class="line"><span class="keyword">return</span> CacheBuilder.newBuilder()  </div><div class="line">  .expireAfterWrite(<span class="number">2</span>, TimeUnit.MINUTES)  </div><div class="line">  .removalListener(removalListener)  </div><div class="line">  .build(loader);</div></pre></td></tr></table></figure>
<p>警告：removal listeners是被默认同步执行的，而且cache的维护是在其普通操作中维护的，那么“昂贵的”removal listener会降低cache操作(某些方法)的效率。如果你在使用一个”昂贵的”removal listener，你可以使用RemovalListener.asynchronous(RemovalListener,Executor),将其布置成异步操作.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java/">Java</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2013/09/13/Java/Guava CachesExplained/#comments" class="ds-thread-count comments-count-link" data-thread-key="2013/09/13/Java/Guava CachesExplained/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2012/08/20/mgits/SVN 总结/" title="SVN 总结" itemprop="url">SVN 总结</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ming15" target="_blank" itemprop="author">ming15</a>
		
  <p class="article-time">
    <time datetime="2012-08-20T07:00:00.000Z" itemprop="datePublished"> Published 2012-08-20</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="服务器搭建"><a href="#服务器搭建" class="headerlink" title="服务器搭建"></a>服务器搭建</h2><p>下载svn服务器<a href="http://sourceforge.net/projects/win32svn/" target="_blank" rel="external">subversion</a>和svn客户端TortoiseSVN(下载页面有安装程序和汉化程序)，还有<a href="">apache</a>(apache主要是为了解析成网络，要不然安装好的svn只能在局域网里使用)</p>
<p>在e盘下创建svn仓库<code>svnresp</code> <img src="https://raw.githubusercontent.com/ming15/blog-website/images/svn/0.jpg" alt=""></p>
<p>创建好版本库后需要将版本库里的配置文件<code>E:\svnresp\conf\svnserve.conf</code>文件进行修改<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># password-db = passwd</div><div class="line">将其修改成</div><div class="line">password-db = passwd</div></pre></td></tr></table></figure></p>
<p>如果不修改这个配置在提交文件是会产生：svn认证失败的错误。 修改如图,前面一定不能有空格：<br><a href="https://raw.githubusercontent.com/ming15/blog-website/images/svn/1.jpg" target="_blank" rel="external"></a><a href="https://raw.githubusercontent.com/ming15/blog-website/images/svn/2.jpg" target="_blank" rel="external"></a><br>然后修改同一目录下的<code>E:\svnresp\conf\passwd.conf</code>文件<br><a href="https://raw.githubusercontent.com/ming15/blog-website/images/svn/3.jpg" target="_blank" rel="external"></a></p>
<blockquote>
<p>注意xiaoli是合法用户，而sally则是非法用户。=前面的为用户名，后面的为密码，同样的前面不能有空格</p>
</blockquote>
<p>都配置好成功之后，接下来我到一个测试项目下进行导入。</p>
<p>首先是开启我们的svn服务器：<br><a href="https://raw.githubusercontent.com/ming15/blog-website/images/svn/4.jpg" target="_blank" rel="external"></a></p>
<p>回车后只要不显示其他内容那么就说明该svn服务器已经启动了。<code>svnserve -d -r</code>是固定写法，而其后面的内容是版本库地址。</p>
<p>然后我们找到测试项目，在空白处右击<br><a href="https://raw.githubusercontent.com/ming15/blog-website/images/svn/5.jpg" target="_blank" rel="external"></a></p>
<p>选择版本浏览器或者导入都可以，我选择的是导入。<br><a href="https://raw.githubusercontent.com/ming15/blog-website/images/svn/6.jpg" target="_blank" rel="external"></a></p>
<p><code>localhost</code>是你要把文件提交到的svn版本库的ip，我在本机做的所以就填写的localhost。而newdemo是我为提交的文件所存放的文件夹。导入信息就是这个版本的信息，可以在版本浏览器中看到。<br><a href="https://raw.githubusercontent.com/ming15/blog-website/images/svn/7.jpg" target="_blank" rel="external"></a><br>填写好在passwd文件里配置好的用户名和密码就可以提交文件了。<br><a href="https://raw.githubusercontent.com/ming15/blog-website/images/svn/8.jpg" target="_blank" rel="external"></a></p>
<h2 id="修改服务器地址"><a href="#修改服务器地址" class="headerlink" title="修改服务器地址"></a>修改服务器地址</h2><p>当svn服务器地址变化之后我们使用如下命令进行修改<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">svn <span class="keyword">switch</span> --relocate http:<span class="comment">//10.234.10.11/svn/server/ http://10.230.8.116/svn/server/</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>在修改前后我们可以使用<code>svn info</code>命令进行查看, 当前svn信息.</p>
</blockquote>
<h2 id="无法clean-up"><a href="#无法clean-up" class="headerlink" title="无法clean up"></a>无法clean up</h2><p>在TortoiseSVN执行clean up时报错“Previous operation has not finished; run ‘cleanup’ if it was interrupted”, 遇到这种情况只要在命令行里执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">svn cleanup</div></pre></td></tr></table></figure></p>
<p>就好了</p>
<blockquote>
<p>需要在安装TortoiseSVN时, 勾选上命令行工具</p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/mgits/">mgits</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2012/08/20/mgits/SVN 总结/#comments" class="ds-thread-count comments-count-link" data-thread-key="2012/08/20/mgits/SVN 总结/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/10/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="ming15" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
		
		  
			<li><a href="/categories/JVM/" title="JVM">JVM<sup>38</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>61</sup></a></li>
		  
		
		  
		
		  
		
		  
			<li><a href="/categories/Netty/" title="Netty">Netty<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/NoSql/" title="NoSql">NoSql<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/Spring-Guice/" title="Spring Guice">Spring Guice<sup>12</sup></a></li>
		  
		
		  
			<li><a href="/categories/ZooKeeper/" title="ZooKeeper">ZooKeeper<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/asm/" title="asm">asm<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/linux/" title="linux">linux<sup>8</sup></a></li>
		  
		
		  
			<li><a href="/categories/mgits/" title="mgits">mgits<sup>16</sup></a></li>
		  
		
		  
		
		  
		
		  
			<li><a href="/categories/数据库/" title="数据库">数据库<sup>13</sup></a></li>
		  
		
		  
		
		  
			<li><a href="/categories/算法/" title="算法">算法<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程语言/" title="编程语言">编程语言<sup>18</sup></a></li>
		  
		
		  
		
		</ul>
</div>


  

  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="http://www1.vertx3.cn" target="_blank" title="vertx3">vertx3</a>
            
          </li>
        
    </ul>
</div>

  

<div class="doubanshow">
<p class="asidetitle">Douban Show</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/xxxyy/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=3253370782&verifier=e9ca895b&dpc=1"></iframe>
</div>


  

<div class="lofter">
<p class="asidetitle">Lofter</p>

 <iframe width="100%" height="39" class="share_self"  frameborder="0" scrolling="no" src="http://ming15.lofter.com/"></iframe>
</div>




</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 博客,我选择重构 <br/>
			重构使事情变得更美,更加正确</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/3253370782" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/ming15" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		<a href="https://www.douban.com/people/xxxyy" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/ming15" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="ming15">ming15</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"wanggnim"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F9e8fca440159a2125668804e46682db4' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
