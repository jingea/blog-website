category: 
- threadManager
title: threadManager\µÈ´ıÏß³ÌµÄÖÕÖ¹
---
1. wait()æ–¹æ³•æ˜¯Objectç±»é‡Œçš„æ–¹æ³•;å½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œåˆ°wait()æ–¹æ³•æ—¶,å®ƒå°±è¿›å…¥åˆ°ä¸€ä¸ªå’Œè¯¥å¯¹è±¡ç›¸å…³çš„ç­‰å¾…æ± ä¸­,
åŒæ—¶å¤±å»(é‡Šæ”¾)äº†å¯¹è±¡çš„æœºé”(æš‚æ—¶å¤±å»æœºé”,wait(long timeout)è¶…æ—¶æ—¶é—´åˆ°åè¿˜éœ€è¦è¿”è¿˜å¯¹è±¡é”);å…¶ä»–çº¿ç¨‹å¯ä»¥è®¿é—®;
2. wait()ä½¿ç”¨notifyæˆ–è€…notifyAlllæˆ–è€…æŒ‡å®šç¡çœ æ—¶é—´æ¥å”¤é†’å½“å‰ç­‰å¾…æ± ä¸­çš„çº¿ç¨‹ã€‚
3. wiat()å¿…é¡»æ”¾åœ¨synchronized(this) {}ä¸­,å¦åˆ™ä¼šåœ¨program runtimeæ—¶æ‰”å‡ºâ€java.lang.IllegalMonitorStateExceptionâ€œå¼‚å¸¸ã€‚

1. sleep()ä½¿å½“å‰çº¿ç¨‹è¿›å…¥åœæ»çŠ¶æ€(é˜»å¡å½“å‰çº¿ç¨‹),è®©å‡ºCUPçš„ä½¿ç”¨ã€ç›®çš„æ˜¯ä¸è®©å½“å‰çº¿ç¨‹ç‹¬è‡ªéœ¸å è¯¥è¿›ç¨‹æ‰€è·çš„CPUèµ„æº,
ä»¥ç•™ä¸€å®šæ—¶é—´ç»™å…¶ä»–çº¿ç¨‹æ‰§è¡Œçš„æœºä¼š;
2. sleep()æ˜¯Threadç±»çš„Static(é™æ€)çš„æ–¹æ³•ï¼›å› æ­¤ä»–ä¸èƒ½æ”¹å˜å¯¹è±¡çš„æœºé”,æ‰€ä»¥å½“åœ¨ä¸€ä¸ªSynchronizedå—ä¸­è°ƒç”¨Sleep()æ–¹æ³•æ˜¯,
çº¿ç¨‹è™½ç„¶ä¼‘çœ äº†,ä½†æ˜¯å¯¹è±¡çš„æœºé”å¹¶æœ¨æœ‰è¢«é‡Šæ”¾,å…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®è¿™ä¸ªå¯¹è±¡(å³ä½¿ç¡ç€ä¹ŸæŒæœ‰å¯¹è±¡é”)ã€‚
3. åœ¨sleep()ä¼‘çœ æ—¶é—´æœŸæ»¡å,è¯¥çº¿ç¨‹ä¸ä¸€å®šä¼šç«‹å³æ‰§è¡Œ,è¿™æ˜¯å› ä¸ºå…¶å®ƒçº¿ç¨‹å¯èƒ½æ­£åœ¨è¿è¡Œè€Œä¸”æ²¡æœ‰è¢«è°ƒåº¦ä¸ºæ”¾å¼ƒæ‰§è¡Œ,
é™¤éæ­¤çº¿ç¨‹å…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ã€‚

```java
public class TestWait {

	public static void main(String[] args) {

		WaitThread wt = new WaitThread();

		wt.start();

		try {
			TimeUnit.SECONDS.sleep(2);
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		long now = System.currentTimeMillis();
		while((System.currentTimeMillis() - now) % 1000 == 0) {
			wt.print();
		}
	}
}

class WaitThread extends Thread {

	@Override
	public void run() {
		long old = System.currentTimeMillis();
		System.out.println("SleepThread run and start sleep 10s -- ");
		try {
			synchronized (this) {
				wait(10000);
			}
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		System.out.println("SleepThread wake up ---" + (System.currentTimeMillis() - old));
	}


	public void print() {
		synchronized (this) {
			System.out.println(System.currentTimeMillis());
		}
	}
}



```

* ç”¨notify() å”¤é†’ wait()å µå¡çš„çº¿ç¨‹
```java
public class TestNotify {

	public static void main(String[] args) {
		NotifyThread nt = new NotifyThread();
		nt.start();

		try {
			TimeUnit.SECONDS.sleep(3);
		} catch (InterruptedException e) {
			e.printStackTrace();
		}

		System.out.println("notify start");
		nt.callNotify();
		System.out.println("notify over");
	}
}

class NotifyThread extends Thread {

	@Override
	public void run() {
		long old = System.currentTimeMillis();
		System.out.println("NotifyThread run");
		try {
			synchronized (this) {
				wait(10000);
			}
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		System.out.println("SleepThread wake up ---" + (System.currentTimeMillis() - old));
	}

	public void callNotify() {
		synchronized (this) {
			notify();
		}
	}
}
```

```java
public class TestSleepWithLock {

	public static void main(String[] args) {
		Object lock = new Object();

		SleepThreadWithLock sleep = new SleepThreadWithLock(lock);
		SimpleThreadWithLock simple = new SimpleThreadWithLock(lock);

		sleep.start();
		simple.start();
	}

}

class SleepThreadWithLock extends Thread {

	private Object lock;

	public SleepThreadWithLock(Object lock) {
		this.lock = lock;
	}

	@Override
	public void run() {
		long old = System.currentTimeMillis();
		System.out.println("SleepThread run and start sleep 10s -- ");
		try {
			synchronized (lock) {
				sleep(10000);
			}
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		System.out.println("SleepThread wake up ---"
				+ (System.currentTimeMillis() - old));
	}

}

class SimpleThreadWithLock extends Thread {

	private Object lock;

	public SimpleThreadWithLock(Object lock) {
		this.lock = lock;
	}

	@Override
	public void run() {
		try {
			/**
			 * SimpleThread sleep2sç¡®ä¿SleepThread è·å¾—Objectå¯¹è±¡é”ä¹‹å
			 */
			sleep(2000);
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		synchronized (lock) {
			System.out.println("SimpleThread");
		}
	}

}

```


```java
public class TestSleepNonLock {

	public static void main(String[] args) {
		SleepThread sleep = new SleepThread();
		SimpleThread simple1  = new SimpleThread(1);
		SimpleThread simple2  = new SimpleThread(2);
		SimpleThread simple3  = new SimpleThread(3);
		System.out.println("A : " + getState(sleep, simple1, simple2, simple3));
		sleep.start();
		System.out.println("B : " + getState(sleep, simple1, simple2, simple3));
		simple1.start();
		System.out.println("C : " + getState(sleep, simple1, simple2, simple3));
		simple2.start();
		System.out.println("D : " + getState(sleep, simple1, simple2, simple3));
		simple3.start();
		System.out.println("E : " + getState(sleep, simple1, simple2, simple3));
	}

	private static String getState(Thread... t) {
		StringBuffer buffer = new StringBuffer();
		for (Thread thread : t) {
			buffer.append(thread.getState().name() + "...");
		}
		return buffer.toString();
	}
}

class SleepThread extends Thread {

	@Override
	public void run() {
		long old = System.currentTimeMillis();
		System.out.println("SleepThread run and start sleep 10s -- ");
		try {
				sleep(10000);
		} catch (InterruptedException e) {
			e.printStackTrace();
		}
		System.out.println("SleepThread wake up ---" + (System.currentTimeMillis() - old));
	}

}

class SimpleThread extends Thread {

	private int id;
	SimpleThread(int id) {
		this.id = id;
	}
	@Override
	public void run() {
		System.out.println("SimpleThread" + id);
	}
}
```
