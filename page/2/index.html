
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>王玉</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="王玉">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="王玉">
<meta property="og:url" content="http://www.yu66.wang/page/2/index.html">
<meta property="og:site_name" content="王玉">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="王玉">

    
    <link rel="alternative" href="/atom.xml" title="王玉" type="application/atom+xml">
    
    
    
    <link rel="apple-touch-icon" href="/img/author.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/author.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="王玉" title="王玉"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="王玉">王玉</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
						<form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 17728547076946147000 ><input type="text" name="q" size="30" placeholder="Search"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/07/12/JavaSE/Java8 排序/" title="java8 排序" itemprop="url">java8 排序</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-07-12T07:00:00.000Z" itemprop="datePublished"> Published 2016-07-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>在这里我们主要看一下Java8提供的<code>Comparator</code>实现的快捷排序.</p>
<p>首先写一个工具类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CompareObject</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> tall;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> age;</div><div class="line">	<span class="keyword">public</span> String name;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="title">CompareObject</span><span class="params">(<span class="keyword">int</span> tall, <span class="keyword">int</span> age, String name)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.tall = tall;</div><div class="line">		<span class="keyword">this</span>.age = age;</div><div class="line">		<span class="keyword">this</span>.name = name;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getTall</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> tall;&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getAge</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> age;&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> name;&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;CompareObject&gt; <span class="title">getList</span><span class="params">()</span> </span>&#123;</div><div class="line">		CompareObject co1 = <span class="keyword">new</span> CompareObject(<span class="number">160</span>, <span class="number">15</span>, <span class="string">"张华"</span>);</div><div class="line">		CompareObject co2 = <span class="keyword">new</span> CompareObject(<span class="number">160</span>, <span class="number">19</span>, <span class="string">"徐来"</span>);</div><div class="line">		CompareObject co3 = <span class="keyword">new</span> CompareObject(<span class="number">160</span>, <span class="number">16</span>, <span class="string">"张德建"</span>);</div><div class="line">		CompareObject co4 = <span class="keyword">new</span> CompareObject(<span class="number">170</span>, <span class="number">18</span>, <span class="string">"李子栋"</span>);</div><div class="line">		CompareObject co5 = <span class="keyword">new</span> CompareObject(<span class="number">170</span>, <span class="number">18</span>, <span class="string">"玛丽凯乐"</span>);</div><div class="line">		CompareObject co6 = <span class="keyword">new</span> CompareObject(<span class="number">180</span>, <span class="number">18</span>, <span class="string">"王义海"</span>);</div><div class="line">		CompareObject co7 = <span class="keyword">new</span> CompareObject(<span class="number">180</span>, <span class="number">19</span>, <span class="string">"赵同利"</span>);</div><div class="line">		CompareObject co8 = <span class="keyword">new</span> CompareObject(<span class="number">180</span>, <span class="number">19</span>, <span class="string">"刘丽"</span>);</div><div class="line">		List&lt;CompareObject&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">		list.add(co1);</div><div class="line">		list.add(co2);</div><div class="line">		list.add(co3);</div><div class="line">		list.add(co4);</div><div class="line">		list.add(co5);</div><div class="line">		list.add(co6);</div><div class="line">		list.add(co7);</div><div class="line">		list.add(co8);</div><div class="line">		<span class="keyword">return</span> list;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们首先看一个最普通的排序<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSort</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		List&lt;CompareObject&gt; list = CompareObject.getList();</div><div class="line">		list.stream().sorted(Comparator.comparing(CompareObject::getTall)</div><div class="line">						.thenComparing(CompareObject::getAge)</div><div class="line">						.thenComparing(CompareObject::getName))</div><div class="line">				.forEach(co -&gt; System.out.println(co.getTall() + <span class="string">" "</span> + co.getAge() + <span class="string">" "</span> + co.getName()));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">160 15 张华</div><div class="line">160 16 张德建</div><div class="line">160 19 徐来</div><div class="line">170 18 李子栋</div><div class="line">170 18 玛丽凯乐</div><div class="line">180 18 王义海</div><div class="line">180 19 刘丽</div><div class="line">180 19 赵同利</div></pre></td></tr></table></figure></p>
<p>下面我们看一下它的倒序<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSort</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		List&lt;CompareObject&gt; list = CompareObject.getList();</div><div class="line">		list.stream().sorted(Comparator.comparing(CompareObject::getTall).reversed()</div><div class="line">						.thenComparing(CompareObject::getAge)</div><div class="line">						.thenComparing(CompareObject::getName))</div><div class="line">				.forEach(co -&gt; System.out.println(co.getTall() + <span class="string">" "</span> + co.getAge() + <span class="string">" "</span> + co.getName()));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">180 18 王义海</div><div class="line">180 19 刘丽</div><div class="line">180 19 赵同利</div><div class="line">170 18 李子栋</div><div class="line">170 18 玛丽凯乐</div><div class="line">160 15 张华</div><div class="line">160 16 张德建</div><div class="line">160 19 徐来</div></pre></td></tr></table></figure></p>
<p>然们将其作用在第二个comparing上<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSort</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		List&lt;CompareObject&gt; list = CompareObject.getList();</div><div class="line">		list.stream().sorted(Comparator.comparing(CompareObject::getTall)</div><div class="line">						.thenComparing(CompareObject::getAge).reversed()</div><div class="line">						.thenComparing(CompareObject::getName))</div><div class="line">				.forEach(co -&gt; System.out.println(co.getTall() + <span class="string">" "</span> + co.getAge() + <span class="string">" "</span> + co.getName()));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">180 19 刘丽</div><div class="line">180 19 赵同利</div><div class="line">180 18 王义海</div><div class="line">170 18 李子栋</div><div class="line">170 18 玛丽凯乐</div><div class="line">160 19 徐来</div><div class="line">160 16 张德建</div><div class="line">160 15 张华</div></pre></td></tr></table></figure></p>
<p>然们将其作用在第三个comparing上<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSort</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		List&lt;CompareObject&gt; list = CompareObject.getList();</div><div class="line">		list.stream().sorted(Comparator.comparing(CompareObject::getTall)</div><div class="line">						.thenComparing(CompareObject::getAge)</div><div class="line">						.thenComparing(CompareObject::getName).reversed())</div><div class="line">				.forEach(co -&gt; System.out.println(co.getTall() + <span class="string">" "</span> + co.getAge() + <span class="string">" "</span> + co.getName()));</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">180 19 赵同利</div><div class="line">180 19 刘丽</div><div class="line">180 18 王义海</div><div class="line">170 18 玛丽凯乐</div><div class="line">170 18 李子栋</div><div class="line">160 19 徐来</div><div class="line">160 16 张德建</div><div class="line">160 15 张华</div></pre></td></tr></table></figure></p>
<p>通关上面的现象我们可以得出, 放在后面的<code>reversed()</code>会将前面的都执行倒序操作.</p>
<p>那么如果只想对某个键进行倒序, 其他都正序要如何操作呢？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClassForName</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ClassNotFoundException </span>&#123;</div><div class="line">        List&lt;CompareObject&gt; list = CompareObject.getList();</div><div class="line">        list.stream().sorted(Comparator.comparing(CompareObject::getTall)</div><div class="line">                .thenComparing(CompareObject::getAge, Comparator.reverseOrder())</div><div class="line">                .thenComparing(CompareObject::getName))</div><div class="line">                .forEach(co -&gt; System.out.println(co.getTall() + <span class="string">" "</span> + co.getAge() + <span class="string">" "</span> + co.getName()));</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">160 19 徐来</div><div class="line">160 16 张德建</div><div class="line">160 15 张华</div><div class="line">170 18 李子栋</div><div class="line">170 18 玛丽凯乐</div><div class="line">180 19 刘丽</div><div class="line">180 19 赵同利</div><div class="line">180 18 王义海</div></pre></td></tr></table></figure></p>
<p>我们看到年龄已经降序排序了</p>
<h2 id="TimSort异常"><a href="#TimSort异常" class="headerlink" title="TimSort异常"></a>TimSort异常</h2><p>今天项目中跑出了一段排序的异常代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">java.lang.IllegalArgumentException: Comparison method violates its general contract!</div><div class="line">	at java.util.TimSort.mergeLo(TimSort.java:<span class="number">777</span>)</div><div class="line">	at java.util.TimSort.mergeAt(TimSort.java:<span class="number">514</span>)</div><div class="line">	at java.util.TimSort.mergeCollapse(TimSort.java:<span class="number">441</span>)</div><div class="line">	at java.util.TimSort.sort(TimSort.java:<span class="number">245</span>)</div><div class="line">	at java.util.Arrays.sort(Arrays.java:<span class="number">1512</span>)</div><div class="line">	at java.util.ArrayList.sort(ArrayList.java:<span class="number">1454</span>)</div><div class="line">	at java.util.stream.SortedOps$RefSortingSink.end(SortedOps.java:<span class="number">387</span>)</div><div class="line">	at java.util.stream.Sink$ChainedReference.end(Sink.java:<span class="number">258</span>)</div><div class="line">	at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:<span class="number">482</span>)</div><div class="line">	at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:<span class="number">471</span>)</div><div class="line">	at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:<span class="number">708</span>)</div><div class="line">	at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:<span class="number">234</span>)</div><div class="line">	at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:<span class="number">499</span>)</div></pre></td></tr></table></figure></p>
<p>通过百度得知, 这是因为JDK升级到7的时候内置的排序算法由归并排序替换成了TimeSort算法. 然后打开JDK API看一下它现在的描述<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">int compare(T o1,</div><div class="line">          T o2)</div><div class="line">Compares its two arguments <span class="keyword">for</span> order. Returns a negative <span class="built_in">integer</span>, zero, or a positive <span class="built_in">integer</span> as the first argument is less than, equal to, or greater than the second.</div><div class="line">In the foregoing description, the notation sgn(expression) designates the mathematical signum <span class="keyword">function</span>, <span class="built_in">which</span> is defined to <span class="built_in">return</span> one of -1, 0, or 1 according to whether the value of expression is negative, zero or positive.</div><div class="line"></div><div class="line">The implementor must ensure that sgn(compare(x, y)) == -sgn(compare(y, x)) <span class="keyword">for</span> all x and y. (This implies that compare(x, y) must throw an exception <span class="keyword">if</span> and only <span class="keyword">if</span> compare(y, x) throws an exception.)</div><div class="line"></div><div class="line">The implementor must also ensure that the relation is transitive: ((compare(x, y)&gt;0) &amp;&amp; (compare(y, z)&gt;0)) implies compare(x, z)&gt;0.</div><div class="line"></div><div class="line">Finally, the implementor must ensure that compare(x, y)==0 implies that sgn(compare(x, z))==sgn(compare(y, z)) <span class="keyword">for</span> all z.</div><div class="line"></div><div class="line">It is generally the <span class="keyword">case</span>, but not strictly required that (compare(x, y)==0) == (x.equals(y)). Generally speaking, any comparator that violates this condition should clearly indicate this fact. The recommended language is <span class="string">"Note: this comparator imposes orderings that are inconsistent with equals."</span></div><div class="line"></div><div class="line">Parameters:</div><div class="line">o1 - the first object to be compared.</div><div class="line">o2 - the second object to be compared.</div><div class="line">Returns:</div><div class="line">a negative <span class="built_in">integer</span>, zero, or a positive <span class="built_in">integer</span> as the first argument is less than, equal to, or greater than the second.</div><div class="line">Throws:</div><div class="line">NullPointerException - <span class="keyword">if</span> an argument is null and this comparator does not permit null arguments</div><div class="line">ClassCastException - <span class="keyword">if</span> the arguments<span class="string">' types prevent them from being compared by this comparator.</span></div></pre></td></tr></table></figure></p>
<p>通过这个描述我们可以看出compare函数是对o1和o2进行对比，如果<code>o1&lt;o2</code>则返回负数, <code>o1==o2</code>返回0, <code>o1&gt;o2</code>返回正数.</p>
<p>在第二段中又描述到，<code>sgn(expression)</code>函数（数学上的符号函数, 取出一个数字的符号）定义了在上文中的正数要返回1，负数要返回-1，0则返回0.</p>
<p>接着说到，如果要实现这个函数则必须保证三点</p>
<ol>
<li>在所有的x和y下，<code>sgn(compare(x, y)) == -sgn(compare(y, x))</code>. 这意味着当且仅当<code>compare(y, x)</code>抛出异常的话,则<code>compare(x, y)</code>也必须抛出一个异常. </li>
<li>还必须要保证传递性, <code>((compare(x, y)&gt;0) &amp;&amp; (compare(y, z)&gt;0))</code>则必须<code>compare(x, z)&gt;0</code>.<br>3.最后还需要保证当<code>compare(x, y)==0</code>时则对于所有的z要<code>sgn(compare(x, z))==sgn(compare(y, z))</code>.</li>
</ol>
<p>最后阐述的是对<code>equals()</code>函数, compare函数并不严格要求要确保<code>(compare(x, y)==0) == (x.equals(y))</code>. </p>
<p>看了这么多, 那么那个bug是怎么发生的呢？</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java/">Java</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/07/12/JavaSE/Java8 排序/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/07/12/JavaSE/Java8 排序/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/07/06/jvm/jclasslib class文件分析/" title="jclasslib bytecode viewer 对 class文件分析" itemprop="url">jclasslib bytecode viewer 对 class文件分析</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-07-06T07:00:00.000Z" itemprop="datePublished"> Published 2016-07-06</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>jclasslib bytecode viewer 是一个java编译后字节码查看的一个工具.</p>
<p>我写了一段源码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JClassLibObject</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String name;</div><div class="line">    <span class="keyword">private</span> String singleName;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">        i ++;</div><div class="line">        <span class="keyword">return</span> i;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">print</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> i = init();</div><div class="line">        System.out.println(i);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>看一下在jclasslib bytecode viewer中的样子<br><img src="https://raw.githubusercontent.com/ming15/blog-website/images/jvm/jclasslib_constant_pool.jpg" alt=""><br><img src="https://raw.githubusercontent.com/ming15/blog-website/images/jvm/jclasslib_fields_methods.jpg" alt=""></p>
<p><a href="https://github.com/ingokegel/jclasslib" target="_blank" rel="external">github地址</a><br><a href="https://sourceforge.net/projects/jclasslib/" target="_blank" rel="external">下载地址</a></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JVM/">JVM</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/07/06/jvm/jclasslib class文件分析/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/07/06/jvm/jclasslib class文件分析/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/21/jvm/ClassForName加载类/" title="ClassForName加载类" itemprop="url">ClassForName加载类</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-21T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-21</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>我在<a href="http://www.ming15.wang/2016/01/29/jvm/使用Classloader加载类/">使用Classloader加载类</a>这篇文章中介绍了, 使用ClassLoader加载类. 但是我们还可以使用一个更简单的方式<br><code>Class.forName()</code>让系统来加载一个类. 其实我们看它的源码实现的话, 会发现, 它自己也是通过ClassLoader实现的加载<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@CallerSensitive</span></div><div class="line"><span class="keyword">public</span> <span class="keyword">static</span> Class&lt;?&gt; forName(String className)</div><div class="line">            <span class="keyword">throws</span> ClassNotFoundException &#123;</div><div class="line">    <span class="keyword">return</span> forName0(className, <span class="keyword">true</span>, ClassLoader.getClassLoader(Reflection.getCallerClass()));</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">native</span> Class&lt;?&gt; forName0(String name, <span class="keyword">boolean</span> initialize, ClassLoader loader)</div><div class="line">        <span class="keyword">throws</span> ClassNotFoundException;</div></pre></td></tr></table></figure></p>
<p>我们看到了, 它内部也是找到了一个系统的ClassLoader开始对Class进行加载的.</p>
<p>我们写个测试代码测试一下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestClassForName</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ClassNotFoundException </span>&#123;</div><div class="line">        Class&lt;?&gt; simpleClass = Class.forName(<span class="string">"SimpleClass"</span>);</div><div class="line">        <span class="keyword">for</span> (Method method: simpleClass.getMethods()) &#123;</div><div class="line">            System.out.println(method.getName());</div><div class="line">        &#125;</div><div class="line">        Class&lt;?&gt; simpleClass1 = Class.forName(<span class="string">"SimpleClass"</span>);</div><div class="line">        System.out.println(simpleClass.equals(simpleClass1));</div><div class="line">        System.out.println(simpleClass == simpleClass1);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后我在同一级包下定义一个类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SimpleClass</span> </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">empotyMethod</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们运行一下看一下结果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">empotyMethod</div><div class="line"><span class="built_in">wait</span></div><div class="line"><span class="built_in">wait</span></div><div class="line"><span class="built_in">wait</span></div><div class="line">equals</div><div class="line">toString</div><div class="line"><span class="built_in">hash</span>Code</div><div class="line">getClass</div><div class="line">notify</div><div class="line">notifyAll</div><div class="line"><span class="literal">true</span></div><div class="line"><span class="literal">true</span></div></pre></td></tr></table></figure></p>
<p>ok, 类已经被成功加载并且找到了.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JVM/">JVM</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/21/jvm/ClassForName加载类/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/21/jvm/ClassForName加载类/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/18/算法/基于递归实现的二叉树/" title="基于递归实现的二叉树" itemprop="url">基于递归实现的二叉树</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-18T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-18</time>
    
  </p>
</header>
    <div class="article-content">
        
        <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-*- coding=utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></div><div class="line">    key = <span class="number">0</span></div><div class="line">    value = <span class="number">0</span></div><div class="line">    left = <span class="number">0</span></div><div class="line">    right = <span class="number">0</span></div><div class="line">    size = <span class="number">0</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">BST</span>:</span></div><div class="line">    root = Node</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">size</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.size(self.root)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">size</span><span class="params">(self, node)</span>:</span></div><div class="line">        <span class="keyword">return</span> node.size</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, key)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.get(self.root, key)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get</span><span class="params">(self, node, key)</span>:</span></div><div class="line">        <span class="keyword">if</span> node == <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">return</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> key &lt; node.key:</div><div class="line">            <span class="keyword">return</span> self.get(node.left, key)</div><div class="line">        <span class="keyword">elif</span> key &gt; node.key:</div><div class="line">            <span class="keyword">return</span> self.get(node.right, key)</div><div class="line">        <span class="keyword">return</span> node.value</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, key, value)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.put(self.root, key, value)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">put</span><span class="params">(self, node, key, value)</span>:</span></div><div class="line">        <span class="keyword">if</span> key &lt; node.key:</div><div class="line">            self.put(node.left, key, value)</div><div class="line">        <span class="keyword">elif</span> key &gt; node.key:</div><div class="line">            self.put(node.right, key, value)</div><div class="line">        node.value = value</div><div class="line">        node.size = self.size(node.left) + self.size(node.right) + <span class="number">1</span></div><div class="line">        <span class="keyword">return</span> node</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">max</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.max(self.root)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">max</span><span class="params">(self, node)</span>:</span></div><div class="line">        <span class="keyword">if</span> node.right == <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">return</span> node</div><div class="line">        <span class="keyword">return</span> self.max(node.right)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">min</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.min(self.root)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">min</span><span class="params">(self, node)</span>:</span></div><div class="line">        <span class="keyword">if</span> node.left == <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">return</span> node</div><div class="line">        <span class="keyword">return</span> self.min(node.left)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">floor</span><span class="params">(self, key)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.floor(self.root, key)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">floor</span><span class="params">(self, node, key)</span>:</span></div><div class="line">        <span class="keyword">if</span> key == node.key:</div><div class="line">            <span class="keyword">return</span> node</div><div class="line"></div><div class="line">        <span class="keyword">if</span> key &lt; node.key:</div><div class="line">            <span class="keyword">return</span> self.floor(node.left, key)</div><div class="line"></div><div class="line">        <span class="keyword">if</span> node.right == <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">return</span> node</div><div class="line"></div><div class="line">        nextNode = self.floor(node.right, key)</div><div class="line">        <span class="keyword">if</span> nextNode == <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">return</span> node</div><div class="line"></div><div class="line">        <span class="keyword">return</span> nextNode</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ceiling</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">pass</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">(self, rank)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.select(self.root, rank)</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">select</span><span class="params">(self, node, rank)</span>:</span></div><div class="line">        size = self.size(node.left)</div><div class="line">        <span class="keyword">if</span> size &gt; rank:</div><div class="line">            <span class="keyword">return</span> self.select(node.left, rank)</div><div class="line">        <span class="keyword">elif</span> size &lt; rank:</div><div class="line">            <span class="keyword">return</span> self.select(node.right, rank - size <span class="number">-1</span>)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> rank</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rank</span><span class="params">(self, key)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.rank(self.root, key)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">rank</span><span class="params">(self, node, key)</span>:</span></div><div class="line">        <span class="keyword">if</span> node.key &lt; key:</div><div class="line">            <span class="keyword">return</span> self.rank(node.left, key)</div><div class="line">        <span class="keyword">elif</span> node.key &gt; key:</div><div class="line">            <span class="keyword">return</span> <span class="number">1</span> + self.size(node.left) + self.rank(node.right, key)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">return</span> self.size(node.left)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deleteMin</span><span class="params">(self)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.deleteMin(self.root)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">deleteMin</span><span class="params">(self, node)</span>:</span></div><div class="line">        <span class="keyword">if</span> node.left == <span class="keyword">None</span>:</div><div class="line">            <span class="keyword">return</span> node.right</div><div class="line">        node.left = self.deleteMin(node.left)</div><div class="line">        node.size = self.size(node.left) + self.size(node.right) + <span class="number">1</span></div><div class="line">        <span class="keyword">return</span> node</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, key)</span>:</span></div><div class="line">        <span class="keyword">return</span> self.delete(self.root, key)</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, node, key)</span>:</span></div><div class="line">        <span class="keyword">if</span> key &lt; node.key:</div><div class="line">            node.left = self.delete(node.left, key)</div><div class="line">        <span class="keyword">elif</span> key &gt; node.key:</div><div class="line">            node.right = self.delete(node.right, key)</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">if</span> node.right == <span class="keyword">None</span>:</div><div class="line">                <span class="keyword">return</span> node.left</div><div class="line">            <span class="keyword">if</span> node.left == <span class="keyword">None</span>:</div><div class="line">                <span class="keyword">return</span> node.right</div><div class="line"></div><div class="line">            tmpNode = node</div><div class="line">            node = self.min(tmpNode.right)</div><div class="line">            node.right = self.deleteMin(tmpNode.right)</div><div class="line">            node.left = tmpNode.left</div><div class="line">        node.size = self.size(node.left) + self.size(node.right) + <span class="number">1</span></div><div class="line"></div><div class="line">        <span class="keyword">return</span> node</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keys</span><span class="params">(self)</span>:</span></div><div class="line">        queue = []</div><div class="line">        self.keys(self.root, queue, self.min(), self.max())</div><div class="line">        <span class="keyword">return</span> queue</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">keys</span><span class="params">(self, node, queue, lo, hi)</span>:</span></div><div class="line">        <span class="keyword">if</span> lo &lt; node.key:</div><div class="line">            self.keys(node.left, queue, lo, hi)</div><div class="line">        <span class="keyword">if</span> lo &lt;= node.key &amp; lo &gt;= node.key:</div><div class="line">            queue.append(node.key)</div><div class="line">        <span class="keyword">if</span> lo &gt; node.right:</div><div class="line">            self.keys(node.right, queue, lo, hi)</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/18/算法/基于递归实现的二叉树/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/18/算法/基于递归实现的二叉树/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/15/JavaLibrary/Spring Cache/" title="Spring Cache" itemprop="url">Spring Cache</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-15T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="https://spring.io/guides/" target="_blank" rel="external">官方文档</a>学习</p>
<p>我们先看一段基准测试代码, 我们不开启缓存功能<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> testSpringCache;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="meta">@SpringBootApplication</span>(scanBasePackages = <span class="string">"testSpringCache"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheApp</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		ConfigurableApplicationContext app = SpringApplication.run(CacheApp.class, args);</div><div class="line">		PrintService printService = app.getBean(<span class="string">"printService"</span>, PrintService.class);</div><div class="line">		printService.printTime(<span class="number">1</span>);</div><div class="line">		printService.printTime(<span class="number">1</span>);</div><div class="line">		printService.printTime(<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintService</span> </span>&#123;</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	TimeRepository timeRepository;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTime</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">		System.out.println(timeRepository.currentTimeMillis(type));</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeRepository</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">currentTimeMillis</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			TimeUnit.SECONDS.sleep(<span class="number">1</span>);</div><div class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</div><div class="line">		<span class="keyword">return</span> type + <span class="string">" : "</span> + System.currentTimeMillis();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>最后的时间输出为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1 : 1465959306110</div><div class="line">1 : 1465959307110</div><div class="line">1 : 1465959308110</div></pre></td></tr></table></figure></p>
<p>我们看到是每隔一秒输出的，然后我们加上Cache功能<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> testSpringCache;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</div><div class="line"><span class="keyword">import</span> org.springframework.cache.annotation.EnableCaching;</div><div class="line"><span class="keyword">import</span> org.springframework.context.ConfigurableApplicationContext;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="meta">@SpringBootApplication</span>(scanBasePackages = <span class="string">"testSpringCache"</span>)</div><div class="line"><span class="meta">@EnableCaching</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheApp</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		ConfigurableApplicationContext app = SpringApplication.run(CacheApp.class, args);</div><div class="line">		PrintService printService = app.getBean(<span class="string">"printService"</span>, PrintService.class);</div><div class="line">		printService.printTime(<span class="number">1</span>);</div><div class="line">		printService.printTime(<span class="number">1</span>);</div><div class="line">		printService.printTime(<span class="number">1</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PrintService</span> </span>&#123;</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	TimeRepository timeRepository;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">printTime</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">		System.out.println(timeRepository.currentTimeMillis(type));</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimeRepository</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Cacheable</span>(<span class="string">"currentTimeMillis"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">currentTimeMillis</span><span class="params">(<span class="keyword">int</span> type)</span> </span>&#123;</div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			TimeUnit.SECONDS.sleep(<span class="number">1</span>);</div><div class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</div><div class="line">		<span class="keyword">return</span> type + <span class="string">" : "</span> + System.currentTimeMillis();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后再看一下时间输出<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1 : 1465959376657</div><div class="line">1 : 1465959376657</div><div class="line">1 : 1465959376657</div></pre></td></tr></table></figure></p>
<p>我们看到时间立马就输出了,也就是说下面俩次的请求其实是请求的是第一次的缓存结果，</p>
<p>也许你注意到了，我在代码里添加了一个变量称为type, 那么我为什么要添加它呢？其实这是为了测试是否取缓存的前提是请求的参数是否相同，也就是咱们的方法参数是否相同, 刚才我使用的都是1,1,1. 下面我修改为1,2,2看一下结果<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">1 : 1465959531983</div><div class="line">2 : 1465959532983</div><div class="line">2 : 1465959532983</div></pre></td></tr></table></figure></p>
<p>好了结果很显而易见了， 当我们修改了参数之后，spring就不会再取缓存结果而是又重新获取了一遍</p>
<p>最后添加所需要的Maven依赖<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>gs-scheduling-tasks<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">parent</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.3.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java-Library/">Java Library</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/Spring/">Spring</a>
  </div>

</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/15/JavaLibrary/Spring Cache/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/15/JavaLibrary/Spring Cache/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/14/JavaLibrary/ReflectASM 性能测试/" title="ReflectASM 性能测试" itemprop="url">ReflectASM 性能测试</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-14T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>我们采用JMH测试ReflectASM 官网给出的几个示例的吞吐量.</p>
<p>我们的测试代码为<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> testASM;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.esotericsoftware.reflectasm.ConstructorAccess;</div><div class="line"><span class="keyword">import</span> com.esotericsoftware.reflectasm.FieldAccess;</div><div class="line"><span class="keyword">import</span> com.esotericsoftware.reflectasm.MethodAccess;</div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.annotations.*;</div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.Runner;</div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.RunnerException;</div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.options.Options;</div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.options.OptionsBuilder;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="meta">@State</span>(Scope.Thread)</div><div class="line"><span class="meta">@BenchmarkMode</span>(Mode.AverageTime)</div><div class="line"><span class="meta">@OutputTimeUnit</span>(TimeUnit.NANOSECONDS)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestRelectASM</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RunnerException </span>&#123;</div><div class="line">        Options opt = <span class="keyword">new</span> OptionsBuilder()</div><div class="line">                .include(TestRelectASM.class.getSimpleName())</div><div class="line">                .warmupIterations(<span class="number">5</span>)</div><div class="line">                .measurementIterations(<span class="number">5</span>)</div><div class="line">                .forks(<span class="number">1</span>)</div><div class="line">                .build();</div><div class="line"></div><div class="line">        <span class="keyword">new</span> Runner(opt).run();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@BenchmarkMode</span>(Mode.Throughput)</div><div class="line">    <span class="meta">@OutputTimeUnit</span>(TimeUnit.SECONDS)</div><div class="line">    <span class="meta">@Benchmark</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measureMethodAccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        SomeClass someObject = <span class="keyword">new</span> SomeClass();</div><div class="line">        MethodAccess access = MethodAccess.get(SomeClass.class);</div><div class="line">        access.invoke(someObject, <span class="string">"setName"</span>, <span class="string">"Awesome McLovin"</span>);</div><div class="line">        String name = (String)access.invoke(someObject, <span class="string">"getName"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@BenchmarkMode</span>(Mode.Throughput)</div><div class="line">    <span class="meta">@OutputTimeUnit</span>(TimeUnit.SECONDS)</div><div class="line">    <span class="meta">@Benchmark</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measureFieldAccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        SomeClass someObject = <span class="keyword">new</span> SomeClass();</div><div class="line">        FieldAccess access = FieldAccess.get(SomeClass.class);</div><div class="line">        access.set(someObject, <span class="string">"age"</span>, <span class="number">18</span>);</div><div class="line">        Integer age = (Integer)access.get(someObject, <span class="string">"age"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@BenchmarkMode</span>(Mode.Throughput)</div><div class="line">    <span class="meta">@OutputTimeUnit</span>(TimeUnit.SECONDS)</div><div class="line">    <span class="meta">@Benchmark</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measureConstructorAccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        ConstructorAccess&lt;SomeClass&gt; access = ConstructorAccess.get(SomeClass.class);</div><div class="line">        SomeClass someObject = access.newInstance();</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">SomeClass</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</div><div class="line">    <span class="keyword">private</span> String name;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> name;</div><div class="line">    &#125;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName</span><span class="params">(String name)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.name = name;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Warmup: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Measurement: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Timeout: 10 min per iteration</span></div><div class="line"><span class="comment"># Threads: 1 thread, will synchronize iterations</span></div><div class="line"><span class="comment"># Benchmark mode: Throughput, ops/time</span></div><div class="line"><span class="comment"># Benchmark: testASM.TestRelectASM.measureConstructorAccess</span></div><div class="line"></div><div class="line"><span class="comment"># Run progress: 0.00% complete, ETA 00:00:30</span></div><div class="line"><span class="comment"># Fork: 1 of 1</span></div><div class="line"><span class="comment"># Warmup Iteration   1: 146112.555 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   2: 399173.011 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   3: 452136.048 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   4: 450102.353 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   5: 446112.781 ops/s</span></div><div class="line">Iteration   1: 454817.511 ops/s</div><div class="line">Iteration   2: 444272.121 ops/s</div><div class="line">Iteration   3: 454354.750 ops/s</div><div class="line">Iteration   4: 449983.056 ops/s</div><div class="line">Iteration   5: 446149.202 ops/s</div><div class="line"></div><div class="line"></div><div class="line">Result <span class="string">"measureConstructorAccess"</span>:</div><div class="line">  449915.328 ±(99.9%) 18242.255 ops/s [Average]</div><div class="line">  (min, avg, max) = (444272.121, 449915.328, 454817.511), stdev = 4737.456</div><div class="line">  CI (99.9%): [431673.074, 468157.583] (assumes normal distribution)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Warmup: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Measurement: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Timeout: 10 min per iteration</span></div><div class="line"><span class="comment"># Threads: 1 thread, will synchronize iterations</span></div><div class="line"><span class="comment"># Benchmark mode: Throughput, ops/time</span></div><div class="line"><span class="comment"># Benchmark: testASM.TestRelectASM.measureFieldAccess</span></div><div class="line"></div><div class="line"><span class="comment"># Run progress: 33.33% complete, ETA 00:00:21</span></div><div class="line"><span class="comment"># Fork: 1 of 1</span></div><div class="line"><span class="comment"># Warmup Iteration   1: 483272.367 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   2: 638769.340 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   3: 643087.589 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   4: 654921.986 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   5: 646076.594 ops/s</span></div><div class="line">Iteration   1: 657034.718 ops/s</div><div class="line">Iteration   2: 651774.971 ops/s</div><div class="line">Iteration   3: 648118.383 ops/s</div><div class="line">Iteration   4: 647813.662 ops/s</div><div class="line">Iteration   5: 654691.279 ops/s</div><div class="line"></div><div class="line"></div><div class="line">Result <span class="string">"measureFieldAccess"</span>:</div><div class="line">  651886.603 ±(99.9%) 15542.738 ops/s [Average]</div><div class="line">  (min, avg, max) = (647813.662, 651886.603, 657034.718), stdev = 4036.400</div><div class="line">  CI (99.9%): [636343.865, 667429.341] (assumes normal distribution)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Warmup: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Measurement: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Timeout: 10 min per iteration</span></div><div class="line"><span class="comment"># Threads: 1 thread, will synchronize iterations</span></div><div class="line"><span class="comment"># Benchmark mode: Throughput, ops/time</span></div><div class="line"><span class="comment"># Benchmark: testASM.TestRelectASM.measureMethodAccess</span></div><div class="line"></div><div class="line"><span class="comment"># Run progress: 66.67% complete, ETA 00:00:10</span></div><div class="line"><span class="comment"># Fork: 1 of 1</span></div><div class="line"><span class="comment"># Warmup Iteration   1: 432894.585 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   2: 621680.095 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   3: 618783.228 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   4: 624738.576 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   5: 611762.568 ops/s</span></div><div class="line">Iteration   1: 625825.844 ops/s</div><div class="line">Iteration   2: 621933.920 ops/s</div><div class="line">Iteration   3: 644088.779 ops/s</div><div class="line">Iteration   4: 644729.889 ops/s</div><div class="line">Iteration   5: 615383.465 ops/s</div><div class="line"></div><div class="line"></div><div class="line">Result <span class="string">"measureMethodAccess"</span>:</div><div class="line">  630392.379 ±(99.9%) 51331.476 ops/s [Average]</div><div class="line">  (min, avg, max) = (615383.465, 630392.379, 644729.889), stdev = 13330.621</div><div class="line">  CI (99.9%): [579060.904, 681723.855] (assumes normal distribution)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Run complete. Total time: 00:00:31</span></div><div class="line"></div><div class="line">Benchmark                                        Mode  Cnt       Score       Error  Units</div><div class="line"><span class="built_in">test</span>ASM.TestRelectASM.measureConstructorAccess  thrpt    5  449915.328 ± 18242.255  ops/s</div><div class="line"><span class="built_in">test</span>ASM.TestRelectASM.measureFieldAccess        thrpt    5  651886.603 ± 15542.738  ops/s</div><div class="line"><span class="built_in">test</span>ASM.TestRelectASM.measureMethodAccess       thrpt    5  630392.379 ± 51331.476  ops/s</div></pre></td></tr></table></figure></p>
<p>接下来我们看一下JDK原生反射的性能<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> testASM;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.annotations.*;</div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.Runner;</div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.RunnerException;</div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.options.Options;</div><div class="line"><span class="keyword">import</span> org.openjdk.jmh.runner.options.OptionsBuilder;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.lang.reflect.Constructor;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Field;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.InvocationTargetException;</div><div class="line"><span class="keyword">import</span> java.lang.reflect.Method;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="meta">@State</span>(Scope.Thread)</div><div class="line"><span class="meta">@BenchmarkMode</span>(Mode.AverageTime)</div><div class="line"><span class="meta">@OutputTimeUnit</span>(TimeUnit.NANOSECONDS)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestJDKReflect</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> RunnerException </span>&#123;</div><div class="line">        Options opt = <span class="keyword">new</span> OptionsBuilder()</div><div class="line">                .include(TestRelectASM.class.getSimpleName())</div><div class="line">                .warmupIterations(<span class="number">5</span>)</div><div class="line">                .measurementIterations(<span class="number">5</span>)</div><div class="line">                .forks(<span class="number">1</span>)</div><div class="line">                .build();</div><div class="line"></div><div class="line">        <span class="keyword">new</span> Runner(opt).run();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@BenchmarkMode</span>(Mode.Throughput)</div><div class="line">    <span class="meta">@OutputTimeUnit</span>(TimeUnit.SECONDS)</div><div class="line">    <span class="meta">@Benchmark</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measureMethodAccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        SomeClass someObject = <span class="keyword">new</span> SomeClass();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Method setNameMethod = SomeClass.class.getMethod(<span class="string">"setName"</span>);</div><div class="line">            setNameMethod.invoke(someObject, <span class="string">"Awesome McLovin"</span>);</div><div class="line">            Method getNameMethod = SomeClass.class.getMethod(<span class="string">"getName"</span>);</div><div class="line">            String name = (String)getNameMethod.invoke(someObject);</div><div class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@BenchmarkMode</span>(Mode.Throughput)</div><div class="line">    <span class="meta">@OutputTimeUnit</span>(TimeUnit.SECONDS)</div><div class="line">    <span class="meta">@Benchmark</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measureFieldAccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        SomeClass someObject = <span class="keyword">new</span> SomeClass();</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Field ageField = SomeClass.class.getField(<span class="string">"age"</span>);</div><div class="line">            ageField.set(someObject, <span class="number">18</span>);</div><div class="line">            Integer age = (Integer)ageField.get(someObject);</div><div class="line">        &#125; <span class="keyword">catch</span> (NoSuchFieldException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@BenchmarkMode</span>(Mode.Throughput)</div><div class="line">    <span class="meta">@OutputTimeUnit</span>(TimeUnit.SECONDS)</div><div class="line">    <span class="meta">@Benchmark</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">measureConstructorAccess</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Constructor&lt;SomeClass&gt; con = SomeClass.class.getConstructor();</div><div class="line">            SomeClass newInstance = con.newInstance();</div><div class="line">        &#125; <span class="keyword">catch</span> (NoSuchMethodException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125; <span class="keyword">catch</span> (InvocationTargetException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Warmup: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Measurement: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Timeout: 10 min per iteration</span></div><div class="line"><span class="comment"># Threads: 1 thread, will synchronize iterations</span></div><div class="line"><span class="comment"># Benchmark mode: Throughput, ops/time</span></div><div class="line"><span class="comment"># Benchmark: testASM.TestRelectASM.measureConstructorAccess</span></div><div class="line"></div><div class="line"><span class="comment"># Run progress: 0.00% complete, ETA 00:00:30</span></div><div class="line"><span class="comment"># Fork: 1 of 1</span></div><div class="line"><span class="comment"># Warmup Iteration   1: 272071.065 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   2: 589448.060 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   3: 583306.327 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   4: 559099.151 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   5: 546514.262 ops/s</span></div><div class="line">Iteration   1: 603711.245 ops/s</div><div class="line">Iteration   2: 582218.187 ops/s</div><div class="line">Iteration   3: 561487.624 ops/s</div><div class="line">Iteration   4: 582646.831 ops/s</div><div class="line">Iteration   5: 612259.454 ops/s</div><div class="line"></div><div class="line"></div><div class="line">Result <span class="string">"measureConstructorAccess"</span>:</div><div class="line">  588464.668 ±(99.9%) 76995.468 ops/s [Average]</div><div class="line">  (min, avg, max) = (561487.624, 588464.668, 612259.454), stdev = 19995.478</div><div class="line">  CI (99.9%): [511469.200, 665460.136] (assumes normal distribution)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Warmup: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Measurement: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Timeout: 10 min per iteration</span></div><div class="line"><span class="comment"># Threads: 1 thread, will synchronize iterations</span></div><div class="line"><span class="comment"># Benchmark mode: Throughput, ops/time</span></div><div class="line"><span class="comment"># Benchmark: testASM.TestRelectASM.measureFieldAccess</span></div><div class="line"></div><div class="line"><span class="comment"># Run progress: 33.33% complete, ETA 00:00:21</span></div><div class="line"><span class="comment"># Fork: 1 of 1</span></div><div class="line"><span class="comment"># Warmup Iteration   1: 407799.239 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   2: 599419.421 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   3: 624838.592 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   4: 636293.822 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   5: 623880.225 ops/s</span></div><div class="line">Iteration   1: 600361.584 ops/s</div><div class="line">Iteration   2: 642029.016 ops/s</div><div class="line">Iteration   3: 613483.428 ops/s</div><div class="line">Iteration   4: 645823.284 ops/s</div><div class="line">Iteration   5: 632346.098 ops/s</div><div class="line"></div><div class="line"></div><div class="line">Result <span class="string">"measureFieldAccess"</span>:</div><div class="line">  626808.682 ±(99.9%) 74589.468 ops/s [Average]</div><div class="line">  (min, avg, max) = (600361.584, 626808.682, 645823.284), stdev = 19370.648</div><div class="line">  CI (99.9%): [552219.214, 701398.150] (assumes normal distribution)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Warmup: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Measurement: 5 iterations, 1 s each</span></div><div class="line"><span class="comment"># Timeout: 10 min per iteration</span></div><div class="line"><span class="comment"># Threads: 1 thread, will synchronize iterations</span></div><div class="line"><span class="comment"># Benchmark mode: Throughput, ops/time</span></div><div class="line"><span class="comment"># Benchmark: testASM.TestRelectASM.measureMethodAccess</span></div><div class="line"></div><div class="line"><span class="comment"># Run progress: 66.67% complete, ETA 00:00:10</span></div><div class="line"><span class="comment"># Fork: 1 of 1</span></div><div class="line"><span class="comment"># Warmup Iteration   1: 397028.204 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   2: 602683.986 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   3: 576226.708 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   4: 602674.109 ops/s</span></div><div class="line"><span class="comment"># Warmup Iteration   5: 591631.635 ops/s</span></div><div class="line">Iteration   1: 607990.169 ops/s</div><div class="line">Iteration   2: 586306.494 ops/s</div><div class="line">Iteration   3: 606049.775 ops/s</div><div class="line">Iteration   4: 583441.620 ops/s</div><div class="line">Iteration   5: 577363.527 ops/s</div><div class="line"></div><div class="line"></div><div class="line">Result <span class="string">"measureMethodAccess"</span>:</div><div class="line">  592230.317 ±(99.9%) 53519.265 ops/s [Average]</div><div class="line">  (min, avg, max) = (577363.527, 592230.317, 607990.169), stdev = 13898.783</div><div class="line">  CI (99.9%): [538711.052, 645749.582] (assumes normal distribution)</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment"># Run complete. Total time: 00:00:31</span></div><div class="line"></div><div class="line">Benchmark                                        Mode  Cnt       Score       Error  Units</div><div class="line"><span class="built_in">test</span>ASM.TestRelectASM.measureConstructorAccess  thrpt    5  588464.668 ± 76995.468  ops/s</div><div class="line"><span class="built_in">test</span>ASM.TestRelectASM.measureFieldAccess        thrpt    5  626808.682 ± 74589.468  ops/s</div><div class="line"><span class="built_in">test</span>ASM.TestRelectASM.measureMethodAccess       thrpt    5  592230.317 ± 53519.265  ops/s</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java-Library/">Java Library</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/14/JavaLibrary/ReflectASM 性能测试/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/14/JavaLibrary/ReflectASM 性能测试/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/14/JavaSE/ClassFinder/" title="ClassFinder" itemprop="url">ClassFinder</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-14T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-14</time>
    
  </p>
</header>
    <div class="article-content">
        
        <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.io.File;</div><div class="line"><span class="keyword">import</span> java.io.IOException;</div><div class="line"><span class="keyword">import</span> java.net.JarURLConnection;</div><div class="line"><span class="keyword">import</span> java.net.MalformedURLException;</div><div class="line"><span class="keyword">import</span> java.net.URL;</div><div class="line"><span class="keyword">import</span> java.net.URLDecoder;</div><div class="line"><span class="keyword">import</span> java.util.*;</div><div class="line"><span class="keyword">import</span> java.util.jar.JarEntry;</div><div class="line"><span class="keyword">import</span> java.util.jar.JarFile;</div><div class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClassFinder</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Logger logger = Logger.getLogger(ClassFinder.class);</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Class&gt; <span class="title">findClasses</span><span class="params">(String packageName, String suffix)</span> </span>&#123;</div><div class="line">        Collection&lt;String&gt; packageSet = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">        packageSet.add(packageName);</div><div class="line"></div><div class="line">        Collection&lt;String&gt; suffixSet = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">        suffixSet.add(suffix);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> findClasses(packageSet, suffixSet);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;Class&gt; <span class="title">findClasses</span><span class="params">(Collection&lt;String&gt; packageNameColl, Collection&lt;String&gt; suffixColl)</span> </span>&#123;</div><div class="line">        logger.trace(<span class="string">"find classes from:"</span> + packageNameColl + <span class="string">" suffixes:"</span> + suffixColl);</div><div class="line">        List&lt;String&gt; classNameList = getAllClasseNames();</div><div class="line">        classNameList = filter(classNameList, packageNameColl, suffixColl);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> loadClasses(classNameList);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;Class&gt; <span class="title">loadClasses</span><span class="params">(List&lt;String&gt; classNames)</span> </span>&#123;</div><div class="line">        List&lt;Class&gt; retList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (String className : classNames) &#123;</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                Class clazz = Thread.currentThread().getContextClassLoader().loadClass(className);</div><div class="line">                retList.add(clazz);</div><div class="line">            &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</div><div class="line">                logger.error(<span class="string">"[can't load class:"</span> + className + <span class="string">"]"</span>, e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> retList;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">filter</span><span class="params">(List&lt;String&gt; classNameList, Collection&lt;String&gt; packageNameColl, Collection&lt;String&gt; suffixColl)</span> </span>&#123;</div><div class="line">        List&lt;String&gt; retList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (String className : classNameList) &#123;</div><div class="line">            <span class="keyword">if</span> (isFit(className, packageNameColl, suffixColl))</div><div class="line">                retList.add(className);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> retList;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> Collection&lt;URL&gt; <span class="title">getClassPathUrls</span><span class="params">()</span> </span>&#123;</div><div class="line">        String pathSeparator = System.getProperty(<span class="string">"path.separator"</span>, <span class="string">":"</span>);</div><div class="line">        String classpath = System.getProperty(<span class="string">"java.class.path"</span>, <span class="string">"."</span>);</div><div class="line">        String[] pathArray = classpath.split(pathSeparator);</div><div class="line">        Collection&lt;URL&gt; urls = <span class="keyword">new</span> HashSet&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (String path : pathArray) &#123;</div><div class="line">            <span class="keyword">if</span> (path.endsWith(<span class="string">".jar"</span>)) &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    URL jarUrl = <span class="keyword">new</span> URL(<span class="string">"jar:file:"</span> + path + <span class="string">"!/"</span>);</div><div class="line">                    urls.add(jarUrl);</div><div class="line">                &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</div><div class="line">                    logger.error(<span class="string">"[jarPath:"</span> + path + <span class="string">"]"</span>, e);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">try</span> &#123;</div><div class="line">                    URL fileUrl = <span class="keyword">new</span> URL(<span class="string">"file://"</span> + path);</div><div class="line">                    urls.add(fileUrl);</div><div class="line">                &#125; <span class="keyword">catch</span> (MalformedURLException e) &#123;</div><div class="line">                    logger.error(<span class="string">"[path:"</span> + path + <span class="string">"]"</span>, e);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> urls;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">getAllClasseNames</span><span class="params">()</span> </span>&#123;</div><div class="line">        Collection&lt;URL&gt; urls = getClassPathUrls();</div><div class="line">        List&lt;String&gt; classNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">for</span> (URL location : urls) &#123;</div><div class="line">            logger.trace(<span class="string">"find classes from:"</span> + location);</div><div class="line">            <span class="keyword">try</span> &#123;</div><div class="line">                <span class="keyword">if</span> (<span class="string">"jar"</span>.equals(location.getProtocol())) &#123;</div><div class="line">                    classNames.addAll(jar(location));</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">"file"</span>.equals(location.getProtocol())) &#123;</div><div class="line">                    classNames.addAll(file(location));</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">                logger.error(e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> classNames;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">boolean</span> <span class="title">isFit</span><span class="params">(String className, Collection&lt;String&gt; packageNameColl, Collection&lt;String&gt; suffixColl)</span> </span>&#123;</div><div class="line">        <span class="keyword">boolean</span> packageFlag = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (String packageName : packageNameColl) &#123;</div><div class="line">            <span class="keyword">if</span> (className.startsWith(packageName)) &#123;</div><div class="line">                packageFlag = <span class="keyword">true</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!packageFlag)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line"></div><div class="line">        <span class="keyword">boolean</span> suffixFlag = <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">for</span> (String suffix : suffixColl) &#123;</div><div class="line">            <span class="keyword">if</span> (className.endsWith(suffix)) &#123;</div><div class="line">                suffixFlag = <span class="keyword">true</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> suffixFlag;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">jar</span><span class="params">(URL location)</span> <span class="keyword">throws</span> IOException </span>&#123;</div><div class="line">        List&lt;String&gt; classNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        JarURLConnection conn = (JarURLConnection) location.openConnection();</div><div class="line">        JarFile jarfile = conn.getJarFile();</div><div class="line"></div><div class="line">        Enumeration&lt;JarEntry&gt; jarEntrys = jarfile.entries();</div><div class="line">        <span class="keyword">while</span> (jarEntrys.hasMoreElements()) &#123;</div><div class="line">            JarEntry jarEntry = jarEntrys.nextElement();</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (jarEntry.isDirectory() || !jarEntry.getName().endsWith(<span class="string">".class"</span>)) &#123;</div><div class="line">                <span class="keyword">continue</span>;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            String className = jarEntry.getName();</div><div class="line">            className = className.replaceFirst(<span class="string">".class$"</span>, <span class="string">""</span>);</div><div class="line">            className = className.replace(<span class="string">'/'</span>, <span class="string">'.'</span>);</div><div class="line">            classNames.add(className);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> classNames;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">file</span><span class="params">(URL location)</span> </span>&#123;</div><div class="line">        List&lt;String&gt; classNames = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        File dir = <span class="keyword">new</span> File(URLDecoder.decode(location.getPath()));</div><div class="line">        <span class="keyword">if</span> (<span class="string">"META-INF"</span>.equals(dir.getName())) &#123;</div><div class="line">            dir = dir.getParentFile(); <span class="comment">// Scrape "META-INF" off</span></div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (dir.isDirectory()) &#123;</div><div class="line">            scanDir(dir, classNames, <span class="string">""</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> classNames;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">scanDir</span><span class="params">(File dir, List&lt;String&gt; classNames, String packageName)</span> </span>&#123;</div><div class="line">        logger.trace(<span class="string">"scan dir: "</span> + dir);</div><div class="line">        File[] files = dir.listFiles();</div><div class="line">        <span class="keyword">for</span> (File file : files) &#123;</div><div class="line">            <span class="keyword">if</span> (file.isDirectory()) &#123;</div><div class="line">                scanDir(file, classNames, packageName + file.getName() + <span class="string">"."</span>);</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (file.getName().endsWith(<span class="string">".class"</span>)) &#123;</div><div class="line">                String name = file.getName();</div><div class="line">                name = name.replaceFirst(<span class="string">".class$"</span>, <span class="string">""</span>);</div><div class="line">                classNames.add(packageName + name);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java/">Java</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/14/JavaSE/ClassFinder/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/14/JavaSE/ClassFinder/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/13/JavaSE/Java Integer Parse String/" title="Integer Parse ValueOf" itemprop="url">Integer Parse ValueOf</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-13T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-13</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>今天使用FindBugs检查项目时，发现有这样一个提示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Boxing/unboxing to parse a primitive</div><div class="line">A boxed primitive is created from a String, just to extract the unboxed primitive value. It is more efficient to just call the static parseXXX method.</div></pre></td></tr></table></figure></p>
<p>这句话的意思是说，我们正在讲一个String解析成一个boxed的原生类型，也就是Integer，Long这些等等，但是我们只需要将String解析成unboxed原生类型即可，也就是int，long这种。最后它推荐使用<code>parseXXX()</code>这样的静态方法.</p>
<p>于是很好奇<code>parseXXX()</code>和<code>valueOf()</code>有啥不同呢？打开源码看一看<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(String s)</span> <span class="keyword">throws</span> NumberFormatException </span>&#123;</div><div class="line">      <span class="keyword">return</span> Integer.valueOf(parseInt(s, <span class="number">10</span>));</div><div class="line">  &#125;</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title">valueOf</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (i &gt;= IntegerCache.low &amp;&amp; i &lt;= IntegerCache.high)</div><div class="line">        <span class="keyword">return</span> IntegerCache.cache[i + (-IntegerCache.low)];</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Integer(i);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们看到<code>valueOf()</code>内部也是调用了<code>parseInt()</code>方法. 从下面的<code>valueOf()</code>方法可以看出, <code>parseInt()</code>返回的是一个unboxed的原生类型数据. 因此在上面的场景中会有那样的提示.</p>
<p>但是看到这里还不算完, 看到这让我想起了一个以前碰到的面试题<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestIntegerValueOf</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		Integer i1 = <span class="number">1</span>;</div><div class="line">		Integer i2 = <span class="number">1</span>;</div><div class="line">		System.out.println(i1 == i2);</div><div class="line"></div><div class="line">		Integer i3 = <span class="number">200</span>;</div><div class="line">		Integer i4 = <span class="number">200</span>;</div><div class="line">		System.out.println(i3 == i4);</div><div class="line"></div><div class="line">		Integer i5 = Integer.valueOf(<span class="number">100</span>);</div><div class="line">		Integer i6 = Integer.valueOf(<span class="number">100</span>);</div><div class="line">		System.out.println(i5 == i6);</div><div class="line"></div><div class="line">		Integer i7 = Integer.valueOf(<span class="number">200</span>);</div><div class="line">		Integer i8 = Integer.valueOf(<span class="number">200</span>);</div><div class="line">		System.out.println(i7 == i8);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="literal">true</span></div><div class="line"><span class="literal">false</span></div><div class="line"><span class="literal">true</span></div><div class="line"><span class="literal">false</span></div></pre></td></tr></table></figure></p>
<p>我们看到在讲int强转为Interger的时候, 也是<code>valueOf()</code>的逻辑</p>
<p>除了Integer之外, 还有哪些基本原生类型是这样子的呢？先看看long<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Long <span class="title">valueOf</span><span class="params">(<span class="keyword">long</span> l)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> offset = <span class="number">128</span>;</div><div class="line">    <span class="keyword">if</span> (l &gt;= -<span class="number">128</span> &amp;&amp; l &lt;= <span class="number">127</span>) &#123; <span class="comment">// will cache</span></div><div class="line">        <span class="keyword">return</span> LongCache.cache[(<span class="keyword">int</span>)l + offset];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Long(l);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来是Short<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Short <span class="title">valueOf</span><span class="params">(<span class="keyword">short</span> s)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> offset = <span class="number">128</span>;</div><div class="line">    <span class="keyword">int</span> sAsInt = s;</div><div class="line">    <span class="keyword">if</span> (sAsInt &gt;= -<span class="number">128</span> &amp;&amp; sAsInt &lt;= <span class="number">127</span>) &#123; <span class="comment">// must cache</span></div><div class="line">        <span class="keyword">return</span> ShortCache.cache[sAsInt + offset];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Short(s);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来是Byte<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Byte <span class="title">valueOf</span><span class="params">(<span class="keyword">byte</span> b)</span> </span>&#123;</div><div class="line">    <span class="keyword">final</span> <span class="keyword">int</span> offset = <span class="number">128</span>;</div><div class="line">    <span class="keyword">return</span> ByteCache.cache[(<span class="keyword">int</span>)b + offset];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来是Char<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Character <span class="title">valueOf</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</div><div class="line">    <span class="keyword">if</span> (c &lt;= <span class="number">127</span>) &#123; <span class="comment">// must cache</span></div><div class="line">        <span class="keyword">return</span> CharacterCache.cache[(<span class="keyword">int</span>)c];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Character(c);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来是Float<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Float <span class="title">valueOf</span><span class="params">(<span class="keyword">float</span> f)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Float(f);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来是Double<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Double <span class="title">valueOf</span><span class="params">(<span class="keyword">double</span> d)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Double(d);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们看到除了浮点型之外，都采用了缓存的原理。虽然我们从源码中看到了结果，可是求个心安，我们还是要写代码测试一下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		Short s_1 = <span class="number">100</span>;</div><div class="line">		Short s_2 = <span class="number">100</span>;</div><div class="line">		System.out.println(s_1 == s_2);</div><div class="line"></div><div class="line">		Long l_1 = <span class="number">100l</span>;</div><div class="line">		Long l_2 = <span class="number">100l</span>;</div><div class="line">		System.out.println(l_1 == l_2);</div><div class="line"></div><div class="line">		Character c_1 = <span class="number">100</span>;</div><div class="line">		Character c_2 = <span class="number">100</span>;</div><div class="line">		System.out.println(c_1 == c_2);</div><div class="line"></div><div class="line">		Short s1 = <span class="number">200</span>;</div><div class="line">		Short s2 = <span class="number">200</span>;</div><div class="line">		System.out.println(s1 == s2);</div><div class="line"></div><div class="line">		Long l1 = <span class="number">200l</span>;</div><div class="line">		Long l2 = <span class="number">200l</span>;</div><div class="line">		System.out.println(l1 == l2);</div><div class="line"></div><div class="line">		Character c1 = <span class="number">200</span>;</div><div class="line">		Character c2 = <span class="number">200</span>;</div><div class="line">		System.out.println(c1 == c2);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="literal">true</span></div><div class="line"><span class="literal">true</span></div><div class="line"><span class="literal">true</span></div><div class="line"><span class="literal">false</span></div><div class="line"><span class="literal">false</span></div><div class="line"><span class="literal">false</span></div></pre></td></tr></table></figure></p>
<p>好了，这下世界安静了</p>
<hr>
<p>后来在项目中发现有使用Gson转换中也会发生这种情况, 写个代码测试一下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestIntegerValueOf</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		Obj obj = <span class="keyword">new</span> Obj();</div><div class="line">		obj.integer = <span class="number">200</span>;</div><div class="line">		Gson gson = <span class="keyword">new</span> Gson();</div><div class="line">		String str = gson.toJson(obj);</div><div class="line">		System.out.println(str);</div><div class="line">		Obj newObj1 = gson.fromJson(str, Obj.class);</div><div class="line">		Obj newObj2 = gson.fromJson(str, Obj.class);</div><div class="line">		System.out.println(newObj1.integer == newObj2.integer);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Obj</span> </span>&#123;</div><div class="line">		<span class="keyword">public</span> Integer integer;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>输出结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="string">"integer"</span>:200&#125;</div><div class="line"><span class="literal">false</span></div></pre></td></tr></table></figure></p>
<p>看来在Gson中不是使用强转就是使用的<code>valueOf()</code></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java/">Java</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/13/JavaSE/Java Integer Parse String/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/13/JavaSE/Java Integer Parse String/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/10/算法/选择排序/" title="选择排序" itemprop="url">选择排序</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-10T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>假设我们有这样的一个数组 [10, 2, 5, 3, 6, 4]. 在选择排序算法时, 会进行如下操作</p>
<ol>
<li>10 与 2, 5, 3, 6, 4进行比较, 找到最小的值放到左边. 因此第一轮排序之后结果为 [2, 10, 5, 3, 6, 4]</li>
<li>10 与 5, 3, 6, 4进行比较, 找到最小的值放到左边. 因此第二轮排序之后结果为 [2, 3, 5, 10, 6, 4]</li>
<li>5 与 10, 6, 4进行比较, 找到最小的值放到左边. 因此第二轮排序之后结果为 [2, 3, 4, 10, 6, 5]</li>
<li>…以此类推</li>
</ol>
<p>我们看一下选择排序的实现<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-*- coding=utf-8 -*-</span></div><div class="line"></div><div class="line">data = [<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</div><div class="line"><span class="keyword">print</span> data</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(data)):</div><div class="line">        min  = i</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i, len(data)):</div><div class="line">            <span class="keyword">if</span> data[j] &lt; data[min]:</div><div class="line">                min = j</div><div class="line"></div><div class="line">        tmp = data[i]</div><div class="line">        data[i] = data[min]</div><div class="line">        data[min] = tmp</div><div class="line">        <span class="keyword">print</span> str(data[i]) + <span class="string">" compore "</span> + str(data[j]) + <span class="string">" -&gt; "</span> + str(data)</div><div class="line"></div><div class="line">sort()</div></pre></td></tr></table></figure></p>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[5, 4, 3, 2, 1]</div><div class="line">1 compore 5 -&gt; [1, 4, 3, 2, 5]</div><div class="line">2 compore 5 -&gt; [1, 2, 3, 4, 5]</div><div class="line">3 compore 5 -&gt; [1, 2, 3, 4, 5]</div><div class="line">4 compore 5 -&gt; [1, 2, 3, 4, 5]</div><div class="line">5 compore 5 -&gt; [1, 2, 3, 4, 5]</div></pre></td></tr></table></figure></p>
<p>选择排序的运行时间和输入没有关系. 因为在排序的过程中, 每一个位置的数字都会跟后边的数字比较一遍.所以哪怕数组是排序好的, 仍然会进行比较.</p>
<p>那么选择排序会比较多少次呢? 答案是<code>(N + (N - 1) + (N - 2) ... 1) = N^2/2</code>.</p>
<p>相关网站</p>
<ul>
<li><a href="http://visualgo.net" target="_blank" rel="external">visualgo</a></li>
<li><a href="http://www.sorting-algorithms.com/" target="_blank" rel="external">Sorting Algorithm</a></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/10/算法/选择排序/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/10/算法/选择排序/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/10/算法/希尔排序/" title="希尔排序" itemprop="url">希尔排序</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-10T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>希尔排序是一种基于插入排序的算法.</p>
<p>插入排序的递增序列是1, 每次向前插入的时候都是和相邻的数组元素比较. 而希尔排序的递增是不固定的, 一般我们是选择一个算法, 算出递增. 希尔排序的思想是在间隔任意值h之间的数字是有序的, 这样的数组称为h有序数组. h有序数组是由h个互相独立的有序数组组成的一个大数组.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-*- coding=utf-8 -*-</span></div><div class="line"></div><div class="line">data = [<span class="number">8</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</div><div class="line"><span class="keyword">print</span> data</div><div class="line"></div><div class="line">h = <span class="number">1</span></div><div class="line"><span class="keyword">while</span> h &lt; len(data)/<span class="number">3</span>:</div><div class="line">    h = <span class="number">3</span>*h + <span class="number">1</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">global</span> h</div><div class="line">    <span class="keyword">while</span> h &gt; <span class="number">0</span>:</div><div class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(data)):</div><div class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(i, <span class="number">0</span>, -h):</div><div class="line">                pre = j - h</div><div class="line">                <span class="keyword">if</span> data[j] &lt; data[pre]:</div><div class="line">                    tmp = data[pre]</div><div class="line">                    data[pre] = data[j]</div><div class="line">                    data[j] = tmp</div><div class="line"></div><div class="line">                <span class="keyword">print</span> str(h) + <span class="string">":   "</span> + str(data[j - h]) + <span class="string">" compore "</span> + str(data[j]) + <span class="string">" -&gt; "</span> + str(data)</div><div class="line">        h = h / <span class="number">3</span></div><div class="line">sort()</div></pre></td></tr></table></figure>
<p>运算结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">[8, 7, 6, 5, 4, 3, 2, 1]</div><div class="line">4:   3 compore 7 -&gt; [8, 7, 6, 5, 4, 3, 2, 1]</div><div class="line">4:   2 compore 6 -&gt; [8, 7, 6, 5, 4, 3, 2, 1]</div><div class="line">4:   1 compore 5 -&gt; [8, 7, 6, 5, 4, 3, 2, 1]</div><div class="line">4:   4 compore 8 -&gt; [4, 7, 6, 5, 8, 3, 2, 1]</div><div class="line">4:   3 compore 7 -&gt; [4, 3, 6, 5, 8, 7, 2, 1]</div><div class="line">4:   3 compore 7 -&gt; [4, 7, 6, 5, 8, 3, 2, 1]</div><div class="line">4:   2 compore 6 -&gt; [4, 7, 2, 5, 8, 3, 6, 1]</div><div class="line">4:   2 compore 6 -&gt; [4, 7, 6, 5, 8, 3, 2, 1]</div><div class="line">4:   1 compore 5 -&gt; [4, 7, 6, 1, 8, 3, 2, 5]</div><div class="line">4:   1 compore 5 -&gt; [4, 7, 6, 5, 8, 3, 2, 1]</div><div class="line">1:   4 compore 7 -&gt; [4, 7, 6, 5, 8, 3, 2, 1]</div><div class="line">1:   6 compore 7 -&gt; [4, 6, 7, 5, 8, 3, 2, 1]</div><div class="line">1:   4 compore 6 -&gt; [4, 6, 7, 5, 8, 3, 2, 1]</div><div class="line">1:   5 compore 7 -&gt; [4, 6, 5, 7, 8, 3, 2, 1]</div><div class="line">1:   5 compore 6 -&gt; [4, 5, 6, 7, 8, 3, 2, 1]</div><div class="line">1:   4 compore 5 -&gt; [4, 5, 6, 7, 8, 3, 2, 1]</div><div class="line">1:   7 compore 8 -&gt; [4, 5, 6, 7, 8, 3, 2, 1]</div><div class="line">1:   6 compore 7 -&gt; [4, 5, 6, 7, 8, 3, 2, 1]</div><div class="line">1:   5 compore 6 -&gt; [4, 5, 6, 7, 8, 3, 2, 1]</div><div class="line">1:   4 compore 5 -&gt; [4, 5, 6, 7, 8, 3, 2, 1]</div><div class="line">1:   3 compore 8 -&gt; [4, 5, 6, 7, 3, 8, 2, 1]</div><div class="line">1:   3 compore 7 -&gt; [4, 5, 6, 3, 7, 8, 2, 1]</div><div class="line">1:   3 compore 6 -&gt; [4, 5, 3, 6, 7, 8, 2, 1]</div><div class="line">1:   3 compore 5 -&gt; [4, 3, 5, 6, 7, 8, 2, 1]</div><div class="line">1:   3 compore 4 -&gt; [3, 4, 5, 6, 7, 8, 2, 1]</div><div class="line">1:   2 compore 8 -&gt; [3, 4, 5, 6, 7, 2, 8, 1]</div><div class="line">1:   2 compore 7 -&gt; [3, 4, 5, 6, 2, 7, 8, 1]</div><div class="line">1:   2 compore 6 -&gt; [3, 4, 5, 2, 6, 7, 8, 1]</div><div class="line">1:   2 compore 5 -&gt; [3, 4, 2, 5, 6, 7, 8, 1]</div><div class="line">1:   2 compore 4 -&gt; [3, 2, 4, 5, 6, 7, 8, 1]</div><div class="line">1:   2 compore 3 -&gt; [2, 3, 4, 5, 6, 7, 8, 1]</div><div class="line">1:   1 compore 8 -&gt; [2, 3, 4, 5, 6, 7, 1, 8]</div><div class="line">1:   1 compore 7 -&gt; [2, 3, 4, 5, 6, 1, 7, 8]</div><div class="line">1:   1 compore 6 -&gt; [2, 3, 4, 5, 1, 6, 7, 8]</div><div class="line">1:   1 compore 5 -&gt; [2, 3, 4, 1, 5, 6, 7, 8]</div><div class="line">1:   1 compore 4 -&gt; [2, 3, 1, 4, 5, 6, 7, 8]</div><div class="line">1:   1 compore 3 -&gt; [2, 1, 3, 4, 5, 6, 7, 8]</div><div class="line">1:   1 compore 2 -&gt; [1, 2, 3, 4, 5, 6, 7, 8]</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/10/算法/希尔排序/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/10/算法/希尔排序/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/09/算法/插入排序/" title="插入排序" itemprop="url">插入排序</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-09T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>插入排序和选择排序类似, 也是在每个数组元素左边的数据都是有序的, 但是不确定他们的最终位置在哪里. 都是排序完的结果都是升序, 但是选择排序是将每个数据向后比较, 上次的比较和交换结果对下次的比较交换并没有什么影响. 而插入排序就不一样了, 插入排序是向前比较, 而它前面的数据是已经排序好了的. 因此插入排序的结果是受数据输入的影响的.如果输入的数据是一个已经排序好的数组, 那么插入排序的时间复杂度仅仅是<code>O(N)</code>. 更多关于性能方面的介绍我会在最后给出, 下面我们看一个实现, 以及对一组简单数据排序后的结果:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-*- coding=utf-8 -*-</span></div><div class="line"></div><div class="line">data = [<span class="number">10</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>]</div><div class="line"><span class="keyword">print</span> data</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(data)):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i, <span class="number">0</span>, <span class="number">-1</span>):</div><div class="line">            <span class="keyword">if</span> data[j] &lt; data[j - <span class="number">1</span>]:</div><div class="line">                tmp = data[j - <span class="number">1</span>]</div><div class="line">                data[j - <span class="number">1</span>] = data[j]</div><div class="line">                data[j] = tmp</div><div class="line">                </div><div class="line">            </div><div class="line"></div><div class="line">sort()</div></pre></td></tr></table></figure>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">[10, 2, 5, 3, 6, 4]</div><div class="line">2 compore 10 -&gt; [2, 10, 5, 3, 6, 4]</div><div class="line">5 compore 10 -&gt; [2, 5, 10, 3, 6, 4]</div><div class="line">2 compore 5 -&gt; [2, 5, 10, 3, 6, 4]</div><div class="line">3 compore 10 -&gt; [2, 5, 3, 10, 6, 4]</div><div class="line">3 compore 5 -&gt; [2, 3, 5, 10, 6, 4]</div><div class="line">2 compore 3 -&gt; [2, 3, 5, 10, 6, 4]</div><div class="line">6 compore 10 -&gt; [2, 3, 5, 6, 10, 4]</div><div class="line">5 compore 6 -&gt; [2, 3, 5, 6, 10, 4]</div><div class="line">3 compore 5 -&gt; [2, 3, 5, 6, 10, 4]</div><div class="line">2 compore 3 -&gt; [2, 3, 5, 6, 10, 4]</div><div class="line">4 compore 10 -&gt; [2, 3, 5, 6, 4, 10]</div><div class="line">4 compore 6 -&gt; [2, 3, 5, 4, 6, 10]</div><div class="line">4 compore 5 -&gt; [2, 3, 4, 5, 6, 10]</div><div class="line">3 compore 4 -&gt; [2, 3, 4, 5, 6, 10]</div><div class="line">2 compore 3 -&gt; [2, 3, 4, 5, 6, 10]</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/09/算法/插入排序/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/09/算法/插入排序/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/09/算法/冒泡排序/" title="冒泡排序" itemprop="url">冒泡排序</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-09T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-09</time>
    
  </p>
</header>
    <div class="article-content">
        
        <figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-*- coding=utf-8 -*-</span></div><div class="line"></div><div class="line">data = [<span class="number">5</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>]</div><div class="line"><span class="keyword">print</span> data</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">sort</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, len(data)):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(i, <span class="number">0</span>, <span class="number">-1</span>):</div><div class="line">            pre = j - <span class="number">1</span></div><div class="line">            <span class="keyword">if</span> data[j] &lt; data[pre]:</div><div class="line">                tmp = data[pre]</div><div class="line">                data[pre] = data[j]</div><div class="line">                data[j] = tmp</div><div class="line">                <span class="keyword">print</span> str(data[pre]) + <span class="string">" compore "</span> + str(data[j]) + <span class="string">" -&gt; "</span> + str(data)</div><div class="line"></div><div class="line">sort()</div></pre></td></tr></table></figure>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">[5, 4, 3, 2, 1]</div><div class="line">4 compore 5 -&gt; [4, 5, 3, 2, 1]</div><div class="line">3 compore 5 -&gt; [4, 3, 5, 2, 1]</div><div class="line">3 compore 4 -&gt; [3, 4, 5, 2, 1]</div><div class="line">2 compore 5 -&gt; [3, 4, 2, 5, 1]</div><div class="line">2 compore 4 -&gt; [3, 2, 4, 5, 1]</div><div class="line">2 compore 3 -&gt; [2, 3, 4, 5, 1]</div><div class="line">1 compore 5 -&gt; [2, 3, 4, 1, 5]</div><div class="line">1 compore 4 -&gt; [2, 3, 1, 4, 5]</div><div class="line">1 compore 3 -&gt; [2, 1, 3, 4, 5]</div><div class="line">1 compore 2 -&gt; [1, 2, 3, 4, 5]</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/09/算法/冒泡排序/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/09/算法/冒泡排序/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/06/07/JavaSE/Java  ThreadLocal/" title="ThreadLocal 实战" itemprop="url">ThreadLocal 实战</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-06-07T07:00:00.000Z" itemprop="datePublished"> Published 2016-06-07</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>项目中使用了<code>java.text.SimpleDateFormat</code>, 但是却将其声明为<code>static</code>. 在Oracle的Java API文档中是这样说明的<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Synchronization</div><div class="line"></div><div class="line">Date formats are not synchronized. It is recommended to create separate format instances <span class="keyword">for</span> each thread. If multiple threads access a format concurrently, it must be synchronized externally.</div></pre></td></tr></table></figure></p>
<p><code>Date</code>对象的format操作并不是同步进行的. 我们应该为每个线程都创建一个<code>SimpleDateFormat</code>对象, 或者为format操作进行加锁处理.</p>
<p>那么<code>ThreadLocal</code>就可以成为这种场景下的替代方案. 我们看一下替换后的代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> ThreadLocal&lt;<span class="keyword">byte</span>[]&gt; simpleDateFormatThreadLocal = <span class="keyword">new</span> ThreadLocal&lt;&gt;();</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> AtomicInteger count = <span class="keyword">new</span> AtomicInteger();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="number">5</span>; j++) &#123;</div><div class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</div><div class="line">				Thread thread = <span class="keyword">new</span> Thread(() -&gt; &#123;</div><div class="line">					<span class="keyword">byte</span>[] bytes = simpleDateFormatThreadLocal.get();</div><div class="line">					<span class="keyword">if</span> (bytes == <span class="keyword">null</span>) &#123;</div><div class="line">						bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">3</span>];</div><div class="line">						simpleDateFormatThreadLocal.set(bytes);</div><div class="line">						count.incrementAndGet();</div><div class="line">					&#125;</div><div class="line">				&#125;);</div><div class="line">				thread.start();</div><div class="line">				thread.join();</div><div class="line">			&#125;</div><div class="line">			System.out.println(<span class="string">"Active Thread Count : "</span> + Thread.activeCount());</div><div class="line">	        TimeUnit.MILLISECONDS.sleep(<span class="number">50</span>);</div><div class="line">		&#125;</div><div class="line">		System.out.println(<span class="string">"set count ; "</span> + count);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们看到了ThreadLocal的使用很简单, 首先是分配一个ThreadLocal对象, 然后接下来就通关get, set进行操作就ok了</p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h2><p><code>ThreadLocal</code>的实现是这样子的, 每个<code>Thread</code>对象内部有一个<code>ThreadLocal.ThreadLocalMap</code>实例<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</div><div class="line">	ThreadLocal.ThreadLocalMap threadLocals = <span class="keyword">null</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>而<code>ThreadLocal.ThreadLocalMap</code>里有一个Entry数组用于实际存储数据, 也就是说<code>ThreadLocal</code>本身是不存储数据的<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocalMap</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</div><div class="line">        Object value;</div><div class="line"></div><div class="line">        Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</div><div class="line">            <span class="keyword">super</span>(k);</div><div class="line">            value = v;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> Entry[] table;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>通过下面<code>ThreadLocal</code>方法实现我们可以看到每个和线程相关的数据最终都是保存到了各自的线程对象<code>ThreadLocal.ThreadLocalMap</code>实例里, 然后使用<code>ThreadLocal</code>作为key存储.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadLocal</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> T <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">		Thread t = Thread.currentThread();</div><div class="line">		ThreadLocalMap map = getMap(t);</div><div class="line">		<span class="keyword">if</span> (map != <span class="keyword">null</span>) &#123;</div><div class="line">			ThreadLocalMap.Entry e = map.getEntry(<span class="keyword">this</span>);</div><div class="line">			<span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</div><div class="line">				<span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</div><div class="line">				T result = (T)e.value;</div><div class="line">				<span class="keyword">return</span> result;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> setInitialValue();</div><div class="line">	&#125;</div><div class="line">		</div><div class="line">	<span class="function">ThreadLocalMap <span class="title">getMap</span><span class="params">(Thread t)</span> </span>&#123;</div><div class="line">			<span class="keyword">return</span> t.threadLocals;</div><div class="line">		&#125;</div><div class="line">		</div><div class="line">	<span class="function"><span class="keyword">private</span> Entry <span class="title">getEntry</span><span class="params">(ThreadLocal&lt;?&gt; key)</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> i = key.threadLocalHashCode &amp; (table.length - <span class="number">1</span>);</div><div class="line">		Entry e = table[i];</div><div class="line">		<span class="keyword">if</span> (e != <span class="keyword">null</span> &amp;&amp; e.get() == key)</div><div class="line">			<span class="keyword">return</span> e;</div><div class="line">		<span class="keyword">else</span></div><div class="line">			<span class="keyword">return</span> getEntryAfterMiss(key, i, e);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="内存溢出"><a href="#内存溢出" class="headerlink" title="内存溢出"></a>内存溢出</h2><p>上面我们说了一下应用和原理, 但是见<a href="http://www.codeceo.com/article/about-threadlocal-memory-leak.html" target="_blank" rel="external">网上有人说内存泄漏的问题</a>, 关键在于<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span> <span class="keyword">extends</span> <span class="title">WeakReference</span>&lt;<span class="title">ThreadLocal</span>&lt;?&gt;&gt; </span>&#123;</div><div class="line">    Object value;</div><div class="line"></div><div class="line">    Entry(ThreadLocal&lt;?&gt; k, Object v) &#123;</div><div class="line">        <span class="keyword">super</span>(k);</div><div class="line">        value = v;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><code>Entry</code>是一个弱引用类型(<a href="http://www.ming15.wang/2016/05/05/jvm/Java%20%E5%BC%95%E7%94%A8%E7%B1%BB%E5%9E%8B/" target="_blank" rel="external">Java 引用类型</a>). 当GC的时候, 如果weakReference的引用没有被强依赖的话, 则势必会被回收掉, 但是在ThreadLocal的时候则不然, 因为我们会一直保留ThreadLocal作为强引用依赖, 那么ThreadLocal则会一直被引用着, GC也不会回收它, Entry里面的value也就一直是可用的. 并不会发生ThreadLocal实例被回收, 而Entry里面value一直保存下来, 发生内存泄漏的情况.</p>
<p>第一个应用中就是我实际代码中使用的示例, 下面我使用<code>-Xmx10M -Xms10M -XX:+PrintGC</code>这几个JVM参数测试一下上面程序的内存泄漏问题, 结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div></pre></td><td class="code"><pre><div class="line">[GC (Allocation Failure)  2048K-&gt;905K(9728K), 0.0061875 secs]</div><div class="line">[GC (Allocation Failure)  7854K-&gt;7113K(9728K), 0.0011924 secs]</div><div class="line">[GC (Allocation Failure)  7113K-&gt;7129K(9728K), 0.0031599 secs]</div><div class="line">[Full GC (Allocation Failure)  7129K-&gt;873K(9728K), 0.0409086 secs]</div><div class="line">[GC (Allocation Failure)  7140K-&gt;7081K(9728K), 0.0311850 secs]</div><div class="line">[Full GC (Ergonomics)  7081K-&gt;1024K(9728K), 0.0355878 secs]</div><div class="line">[GC (Allocation Failure)  4150K-&gt;4128K(9728K), 0.0130218 secs]</div><div class="line">[GC (Allocation Failure)  4128K-&gt;4128K(8704K), 0.0009429 secs]</div><div class="line">[Full GC (Allocation Failure)  4128K-&gt;872K(8704K), 0.0158858 secs]</div><div class="line">[GC (Allocation Failure)  7057K-&gt;7112K(9216K), 0.0064885 secs]</div><div class="line">[Full GC (Ergonomics)  7112K-&gt;872K(9216K), 0.0088626 secs]</div><div class="line">[GC (Allocation Failure)  7057K-&gt;7112K(9216K), 0.0037829 secs]</div><div class="line">[Full GC (Ergonomics)  7112K-&gt;872K(9216K), 0.0174345 secs]</div><div class="line">[GC (Allocation Failure)  7057K-&gt;7048K(9216K), 0.0180387 secs]</div><div class="line">[Full GC (Ergonomics)  7048K-&gt;872K(9216K), 0.0508169 secs]</div><div class="line">[GC (Allocation Failure)  7057K-&gt;7080K(9216K), 0.0088642 secs]</div><div class="line">[Full GC (Ergonomics)  7080K-&gt;872K(9216K), 0.0328227 secs]</div><div class="line">Active Thread Count : 2</div><div class="line"></div><div class="line">......</div><div class="line"></div><div class="line">[Full GC (Ergonomics)  7050K-&gt;874K(9728K), 0.0055843 secs]</div><div class="line">[GC (Allocation Failure)  7100K-&gt;7050K(9728K), 0.0002894 secs]</div><div class="line">[Full GC (Ergonomics)  7050K-&gt;874K(9728K), 0.0209747 secs]</div><div class="line">[GC (Allocation Failure)  7100K-&gt;7114K(9728K), 0.0002878 secs]</div><div class="line">[Full GC (Ergonomics)  7114K-&gt;874K(9728K), 0.0034925 secs]</div><div class="line">[GC (Allocation Failure)  7100K-&gt;7082K(9728K), 0.0003256 secs]</div><div class="line">[Full GC (Ergonomics)  7082K-&gt;874K(9728K), 0.0057511 secs]</div><div class="line">[GC (Allocation Failure)  7100K-&gt;7082K(9728K), 0.0003378 secs]</div><div class="line">[Full GC (Ergonomics)  7082K-&gt;874K(9728K), 0.0037080 secs]</div><div class="line">[GC (Allocation Failure)  7100K-&gt;7050K(9728K), 0.0001761 secs]</div><div class="line">[Full GC (Ergonomics)  7050K-&gt;874K(9728K), 0.0040176 secs]</div><div class="line">[GC (Allocation Failure)  7120K-&gt;7050K(9728K), 0.0005024 secs]</div><div class="line">[Full GC (Ergonomics)  7050K-&gt;874K(9728K), 0.0051379 secs]</div><div class="line">[GC (Allocation Failure)  7100K-&gt;7082K(9728K), 0.0021276 secs]</div><div class="line">[Full GC (Ergonomics)  7082K-&gt;874K(9728K), 0.0060047 secs]</div><div class="line">Active Thread Count : 2</div><div class="line"><span class="built_in">set</span> count ; 250</div></pre></td></tr></table></figure></p>
<p>由于篇幅的原因, 我并没有将全部的日志输出, 但是通过上面的日志我们还是可以看出, 程序一共分配了250次内存, 每次分配给ThreadLocal里面的数据都被回收掉了, 因此对<code>ThreadLocal</code>的一个简单应用, 只要我们写的线程代码没有问题, 我们并不需要对内存泄漏担心太多.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java/">Java</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/06/07/JavaSE/Java  ThreadLocal/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/06/07/JavaSE/Java  ThreadLocal/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/30/杂记/ttystudio/" title="终端生成GIF文件" itemprop="url">终端生成GIF文件</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-05-30T07:00:00.000Z" itemprop="datePublished"> Published 2016-05-30</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="ttystudio"><a href="#ttystudio" class="headerlink" title="ttystudio"></a>ttystudio</h2><p><a href="https://github.com/chjj/ttystudio" target="_blank" rel="external">ttystudio</a>可以将命令行操作制作成gif文件.</p>
<p>安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install ttystudio</div></pre></td></tr></table></figure></p>
<p>全局安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">npm install ttystudio -g</div></pre></td></tr></table></figure></p>
<p>使用<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ttystudio output.gif --log</div></pre></td></tr></table></figure></p>
<p>上面这个命令最终生成一个output.gif文件, 同时将生成的过程输出</p>
<p>除了上面简单的介绍外, 它还可以为我们添加边框, 录制部分帧</p>
<blockquote>
<p>还有其他的录制软件 <a href="https://asciinema.org" target="_blank" rel="external">asciinema</a></p>
</blockquote>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/30/杂记/ttystudio/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/30/杂记/ttystudio/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/28/杂记/mac/" title="mac" itemprop="url">mac</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-05-28T07:00:00.000Z" itemprop="datePublished"> Published 2016-05-28</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="修改root密码"><a href="#修改root密码" class="headerlink" title="修改root密码"></a>修改root密码</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo passwd root</div></pre></td></tr></table></figure>
<p>直接输入新密码即可</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/28/杂记/mac/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/28/杂记/mac/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/17/数据库/Mysql JSON Data Type/" title="Mysql JSON 支持" itemprop="url">Mysql JSON 支持</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-05-17T07:00:00.000Z" itemprop="datePublished"> Published 2016-05-17</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="http://dev.mysql.com/doc/refman/5.7/en/json.html" target="_blank" rel="external">官方文档</a>学习</p>
<p>在MySQL5.7版本中增加了对JSON的支持. 在SQL中进行JSON字段操作时都是通过使用函数完成的</p>
<h2 id="创建JSON字段"><a href="#创建JSON字段" class="headerlink" title="创建JSON字段"></a>创建JSON字段</h2><p>在Mysql中, JSON是通过字符串进行存储的.</p>
<p>下面的例子演示了创建JSON类型字段的表, 以及插入一个JSON串和插入一个非法的JSON串<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">mysql&gt; CREATE TABLE t1 (jdoc JSON);</div><div class="line">Query OK, 0 rows affected (0.20 sec)</div><div class="line"></div><div class="line">mysql&gt; INSERT INTO t1 VALUES('&#123;"key1": "value1", "key2": "value2"&#125;');</div><div class="line">Query OK, 1 row affected (0.01 sec)</div><div class="line"></div><div class="line">mysql&gt; INSERT INTO t1 VALUES('[1, 2,');</div><div class="line">ERROR 3140 (22032) at line 2: Invalid JSON text: "Invalid value." at position 6 in value (or column) '[1, 2,'.</div></pre></td></tr></table></figure></p>
<blockquote>
<p><code>at position N</code>是从0 开始计算的</p>
</blockquote>
<h2 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a>搜索</h2><p>我们可以在JSON文档中通过<code>JSON_EXTRACT()</code>函数指定path来搜索出一个值.</p>
<p>在相关方法中使用表达式可以提取数据,或者修改JSON文档 以及进行其他的操作. 例如下面的操作就是从JSON文档中提取key为name的值.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_EXTRACT('&#123;"id": 14, "name": "Aztalan"&#125;', '$.name');</div><div class="line">+---------------------------------------------------------+</div><div class="line">| JSON_EXTRACT('&#123;"id": 14, "name": "Aztalan"&#125;', '$.name') |</div><div class="line">+---------------------------------------------------------+</div><div class="line">| "Aztalan"                                               |</div><div class="line">+---------------------------------------------------------+</div></pre></td></tr></table></figure></p>
<p>在Mysql中, 可以使用<code>$</code>加后缀的方式表示一个JSON文档. <code>$</code>后可以跟一个选择符来索引到JSON文档中任意的位置元素:</p>
<ul>
<li><code>$&quot;key&quot;</code> 表示在JSON文档中, key所对应的值. 注意key必须使用<code>&quot;&quot;</code>括起来.</li>
<li><code>[N]</code> 表示JSON数组文档中第N个位置的值(从0开始).</li>
<li>Paths 可以包含 <code>*</code>或者<code>**</code> 通配符.</li>
<li><code>.[*]</code> 找到JSON对象中所有的成员值</li>
<li><code>[*]</code> 找到JSON数组中所有的成员值</li>
<li><code>prefix**suffix</code> 匹配所有的以prefix开头, 以suffix结尾的path.</li>
</ul>
<p>下面我们创建出三个元素的数组, 然后假设 <code>$</code> 指向这个数组:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="number">3</span>, &#123;<span class="attr">"a"</span>: [<span class="number">5</span>, <span class="number">6</span>], <span class="attr">"b"</span>: <span class="number">10</span>&#125;, [<span class="number">99</span>, <span class="number">100</span>]]</div></pre></td></tr></table></figure></p>
<p>那么:</p>
<ul>
<li><code>$[0]</code> 求值为 3.</li>
<li><code>$[1]</code> 求值为 {“a”: [5, 6], “b”: 10}.</li>
<li><code>$[2]</code> 求值为[99, 100].</li>
<li><code>$[3]</code> 求值为 NULL (指向一个不存在的元素).</li>
</ul>
<p>因为 $[1] 和 $[2] 是非标量的值, 因此我们可以进一步的使用path表达式求出它内嵌的值. 例如:</p>
<ul>
<li><code>$[1].a</code> 求值为 [5, 6].</li>
<li><code>$[1].a[1]</code> 求值为 6.</li>
<li><code>$[1].b</code> 求值为 10.</li>
<li><code>$[2][0]</code> 求值为 99.</li>
</ul>
<p>刚才我们也提到了, path表达式的key必须被<code>&quot;&quot;</code>包含起来, 未被<code>&quot;&quot;</code>包含起来的key会被视为非法的.<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&#123;<span class="attr">"a fish"</span>: <span class="string">"shark"</span>, <span class="attr">"a bird"</span>: <span class="string">"sparrow"</span>&#125;</div></pre></td></tr></table></figure></p>
<p>这俩个key都包含了一个空格, 因此在path表达式中, 必须使用<code>&quot;&quot;</code>将key包含:</p>
<ul>
<li><code>$.&quot;a fish&quot;</code> 求值为 shark.</li>
<li><code>$.&quot;a bird&quot;</code> 求值为 to sparrow.</li>
</ul>
<p>如果在对数组求值时, path中的通配符会求值出多个结果.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_EXTRACT('&#123;"a": 1, "b": 2, "c": [3, 4, 5]&#125;', '$.*');</div><div class="line">+---------------------------------------------------------+</div><div class="line">| JSON_EXTRACT('&#123;"a": 1, "b": 2, "c": [3, 4, 5]&#125;', '$.*') |</div><div class="line">+---------------------------------------------------------+</div><div class="line">| [1, 2, [3, 4, 5]]                                       |</div><div class="line">+---------------------------------------------------------+</div><div class="line">mysql&gt; SELECT JSON_EXTRACT('&#123;"a": 1, "b": 2, "c": [3, 4, 5]&#125;', '$.c[*]');</div><div class="line">+------------------------------------------------------------+</div><div class="line">| JSON_EXTRACT('&#123;"a": 1, "b": 2, "c": [3, 4, 5]&#125;', '$.c[*]') |</div><div class="line">+------------------------------------------------------------+</div><div class="line">| [3, 4, 5]                                                  |</div><div class="line">+------------------------------------------------------------+</div></pre></td></tr></table></figure></p>
<p>在下面的例子中, <code>$**.b</code>会在多个path($.a.b 和 $.c.b)中进行求值, 然后将求值结果放到一个数组中:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_EXTRACT('&#123;"a": &#123;"b": 1&#125;, "c": &#123;"b": 2&#125;&#125;', '$**.b');</div><div class="line">+---------------------------------------------------------+</div><div class="line">| JSON_EXTRACT('&#123;"a": &#123;"b": 1&#125;, "c": &#123;"b": 2&#125;&#125;', '$**.b') |</div><div class="line">+---------------------------------------------------------+</div><div class="line">| [1, 2]                                                  |</div><div class="line">+---------------------------------------------------------+</div></pre></td></tr></table></figure></p>
<p>在MySQL 5.7.9 和以后的版本中, 你可以使用<code>column-&gt;path</code>代替方法<code>JSON_EXTRACT(column, path)</code>.</p>
<blockquote>
<p>更多参考See Section 13.16.3, “Functions That Search JSON Values” 以及 Section 14.1.18.6, “Secondary Indexes and Generated Virtual Columns”.</p>
</blockquote>
<p>在一些方法中, 会接受一个JSON文档, 然后对该JSON文档进行一些处理. 例如</p>
<ul>
<li><code>JSON_SET()</code></li>
<li><code>JSON_INSERT()</code></li>
<li><code>JSON_REPLACE()</code></li>
</ul>
<h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><p>我们生成一个JSON文档, 然后在下面的操作中使用这个文档:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SET @j = '["a", &#123;"b": [true, false]&#125;, [10, 20]]';</div></pre></td></tr></table></figure></p>
<p><code>JSON_SET()</code>会对已经存在的path替换, 不存在的进行添加:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_SET(@j, '$[1].b[0]', 1, '$[2][2]', 2);</div><div class="line">+--------------------------------------------+</div><div class="line">| JSON_SET(@j, '$[1].b[0]', 1, '$[2][2]', 2) |</div><div class="line">+--------------------------------------------+</div><div class="line">| ["a", &#123;"b": [1, false]&#125;, [10, 20, 2]]      |</div><div class="line">+--------------------------------------------+</div></pre></td></tr></table></figure></p>
<p>在上例中<code>$[1].b[0]</code>选择了一个已经存在的value，然后它被替换成了1. 但是<code>$[2][2]</code> 并不存在, 所以就在<code>$[2][2]</code>插入了值2.</p>
<p><code>JSON_INSERT()</code>向JSON文档中插入新的值, 但是如果path已经存在, 则会归一化处理, 不会覆盖原有的值:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_INSERT(@j, '$[1].b[0]', 1, '$[2][2]', 2);</div><div class="line">+-----------------------------------------------+</div><div class="line">| JSON_INSERT(@j, '$[1].b[0]', 1, '$[2][2]', 2) |</div><div class="line">+-----------------------------------------------+</div><div class="line">| ["a", &#123;"b": [true, false]&#125;, [10, 20, 2]]      |</div><div class="line">+-----------------------------------------------+</div></pre></td></tr></table></figure></p>
<h2 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h2><p><code>JSON_REPLACE()</code>执行替换操作, 但是如果path不存在的话, 不会进行插入操作:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_REPLACE(@j, '$[1].b[0]', 1, '$[2][2]', 2);</div><div class="line">+------------------------------------------------+</div><div class="line">| JSON_REPLACE(@j, '$[1].b[0]', 1, '$[2][2]', 2) |</div><div class="line">+------------------------------------------------+</div><div class="line">| ["a", &#123;"b": [1, false]&#125;, [10, 20]]             |</div><div class="line">+------------------------------------------------+</div></pre></td></tr></table></figure></p>
<blockquote>
<p><code>JSON_SET()</code>也会完成修改值的功能</p>
</blockquote>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><p><code>JSON_REMOVE()</code> 接受一个 JSON 文档以及一个或者多个要删除的path.  The return value is the original document minus the values selected by paths that exist within the document:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_REMOVE(@j, '$[2]', '$[1].b[1]', '$[1].b[1]');</div><div class="line">+---------------------------------------------------+</div><div class="line">| JSON_REMOVE(@j, '$[2]', '$[1].b[1]', '$[1].b[1]') |</div><div class="line">+---------------------------------------------------+</div><div class="line">| ["a", &#123;"b": [true]&#125;]                              |</div><div class="line">+---------------------------------------------------+</div></pre></td></tr></table></figure></p>
<p>这三个path产生了如下的效果</p>
<ul>
<li><code>$[2]</code>找到匹配[10, 20]值, 然后将其删除掉.</li>
<li>第一个<code>$[1].b[1]</code>匹配到了false值, 然后将其删除掉.</li>
<li>第二个<code>$[1].b[1]</code>没有匹配到任何值, 因此该操作不会有任何结果.</li>
</ul>
<h2 id="归一化处理"><a href="#归一化处理" class="headerlink" title="归一化处理"></a>归一化处理</h2><p>当一个字符串可以解析成一个有效的JSON文档, 它同时也会进行归一化处理. 当JSON中出现重复的Key时, 只会保留最开始的那个Key/Value, 接下来重复出现的都会抛弃掉.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_OBJECT('key1', 1, 'key2', 'abc', 'key1', 'def');</div><div class="line">+------------------------------------------------------+</div><div class="line">| JSON_OBJECT('key1', 1, 'key2', 'abc', 'key1', 'def') |</div><div class="line">+------------------------------------------------------+</div><div class="line">| &#123;"key1": 1, "key2": "abc"&#125;                           |</div><div class="line">+------------------------------------------------------+</div></pre></td></tr></table></figure></p>
<p>Mysql的归一化处理还会对JSON对象的key进行排序处理(以便查找时提供更好的性能). The result of this ordering is subject to change and not guaranteed to be consistent across releases. 另外, key或者value之间的空格会自动的被忽略掉.</p>
<p>同样的, Mysql中创建JSON的方法同样也都做了归一化处理.</p>
<p>当多个数组合并成一个数组时, 数组元素会依次存储进新的数组中, 如下面的<code>JSON_MERGE()</code>:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_MERGE('[1, 2]', '["a", "b"]', '[true, false]');</div><div class="line">+-----------------------------------------------------+</div><div class="line">| JSON_MERGE('[1, 2]', '["a", "b"]', '[true, false]') |</div><div class="line">+-----------------------------------------------------+</div><div class="line">| [1, 2, "a", "b", true, false]                       |</div><div class="line">+-----------------------------------------------------+</div></pre></td></tr></table></figure></p>
<h2 id="合并"><a href="#合并" class="headerlink" title="合并"></a>合并</h2><p>多个对象合并到一个对象中的时候, 如果多个对象中都出现了相同的key, 那么相同的key对应的value值会被放到该key对应的数组中.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_MERGE('&#123;"a": 1, "b": 2&#125;', '&#123;"c": 3, "a": 4&#125;');</div><div class="line">+----------------------------------------------------+</div><div class="line">| JSON_MERGE('&#123;"a": 1, "b": 2&#125;', '&#123;"c": 3, "a": 4&#125;') |</div><div class="line">+----------------------------------------------------+</div><div class="line">| &#123;"a": [1, 4], "b": 2, "c": 3&#125;                      |</div><div class="line">+----------------------------------------------------+</div></pre></td></tr></table></figure></p>
<p>当非数组类型的数据出现在要求数组为参数的上下文中时, 非数组类型的数据会自动被包装成数组类型(会自动在数据俩侧添加<code>[]</code>将其括起来). 在下面的例子中, 每一个参数都会被自动包装成([1], [2]), 然后产生一个新的数组.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_MERGE('1', '2');</div><div class="line">+----------------------+</div><div class="line">| JSON_MERGE('1', '2') |</div><div class="line">+----------------------+</div><div class="line">| [1, 2]               |</div><div class="line">+----------------------+</div></pre></td></tr></table></figure></p>
<p>当对象和数组进行合并时, 对象会自动的包装成一个数组, 然后将这俩个数组进行合并<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_MERGE('[10, 20]', '&#123;"a": "x", "b": "y"&#125;');</div><div class="line">+------------------------------------------------+</div><div class="line">| JSON_MERGE('[10, 20]', '&#123;"a": "x", "b": "y"&#125;') |</div><div class="line">+------------------------------------------------+</div><div class="line">| [10, 20, &#123;"a": "x", "b": "y"&#125;]                 |</div><div class="line">+------------------------------------------------+</div></pre></td></tr></table></figure></p>
<h2 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h2><p>在下面我们看一下除了增删改查之外的其他常用函数</p>
<h3 id="JSON-TYPE"><a href="#JSON-TYPE" class="headerlink" title="JSON_TYPE()"></a>JSON_TYPE()</h3><p><code>JSON_TYPE()</code>方法接受一个JSON串, 然后尝试解析它, 最后返回该JSON的数据类型<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_TYPE('["a", "b", 1]');</div><div class="line">+----------------------------+</div><div class="line">| JSON_TYPE('["a", "b", 1]') |</div><div class="line">+----------------------------+</div><div class="line">| ARRAY                      |</div><div class="line">+----------------------------+</div><div class="line"></div><div class="line">mysql&gt; SELECT JSON_TYPE('"hello"');</div><div class="line">+----------------------+</div><div class="line">| JSON_TYPE('"hello"') |</div><div class="line">+----------------------+</div><div class="line">| STRING               |</div><div class="line">+----------------------+</div><div class="line"></div><div class="line">mysql&gt; SELECT JSON_TYPE('hello');</div><div class="line">ERROR 3146 (22032): Invalid data type for JSON data in argument 1</div><div class="line">to function json_type; a JSON string or JSON type is required.</div></pre></td></tr></table></figure></p>
<p>MySQL 使用<code>utf8mb4</code>编码和<code>utf8mb4_bin</code>集合处理JSON 字符串内容. 其他的编码会被转换成utf8mb4编码. (ascii 和 utf8 编码并不会进行转换, 因为这俩个字符集是utf8mb4的子集.)</p>
<h3 id="创建JSON数组"><a href="#创建JSON数组" class="headerlink" title="创建JSON数组"></a>创建JSON数组</h3><p>除了使用字面量JSON串之外, Mysql还提供了很多创建JSON串的方法. 例如JSON_ARRAY()`函数接受一个参数列表(个数大于等于0), 然后返回一个JSON字符串数组.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_ARRAY('a', 1, NOW());</div><div class="line">+----------------------------------------+</div><div class="line">| JSON_ARRAY('a', 1, NOW())              |</div><div class="line">+----------------------------------------+</div><div class="line">| ["a", 1, "2015-07-27 09:43:47.000000"] |</div><div class="line">+----------------------------------------+</div></pre></td></tr></table></figure></p>
<h3 id="创建JSON对象"><a href="#创建JSON对象" class="headerlink" title="创建JSON对象"></a>创建JSON对象</h3><p><code>JSON_OBJECT()</code>接受一个key/value形式的参数列表, 返回一个包含那些元素的JSON对象:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_OBJECT('key1', 1, 'key2', 'abc');</div><div class="line">+---------------------------------------+</div><div class="line">| JSON_OBJECT('key1', 1, 'key2', 'abc') |</div><div class="line">+---------------------------------------+</div><div class="line">| &#123;"key1": 1, "key2": "abc"&#125;            |</div><div class="line">+---------------------------------------+</div></pre></td></tr></table></figure></p>
<h3 id="变量赋值"><a href="#变量赋值" class="headerlink" title="变量赋值"></a>变量赋值</h3><p>也可以将JSON赋给一个用户自定义的变量<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SET @j = JSON_OBJECT('key', 'value');</div><div class="line">mysql&gt; SELECT @j;</div><div class="line">+------------------+</div><div class="line">| @j               |</div><div class="line">+------------------+</div><div class="line">| &#123;"key": "value"&#125; |</div><div class="line">+------------------+</div></pre></td></tr></table></figure></p>
<p>在上例中, 尽管<code>JSON_OBJECT()</code>方法会返回一个JSON类型对象, 但是当将其赋给一个变量(<code>@j</code>)时, 它就被自动转换成了一个字符串类型.</p>
<p>JSON转换成的字符串, 它的编码是<code>utf8mb4</code>, 字符序为<code>utf8mb4_bin</code>:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT CHARSET(@j), COLLATION(@j);</div><div class="line">+-------------+---------------+</div><div class="line">| CHARSET(@j) | COLLATION(@j) |</div><div class="line">+-------------+---------------+</div><div class="line">| utf8mb4     | utf8mb4_bin   |</div><div class="line">+-------------+---------------+</div></pre></td></tr></table></figure></p>
<p>因为<code>utf8mb4_bin</code>是一种二进制的字符序, 因此在对比俩个JSON值是区分大小写的.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_ARRAY('x') = JSON_ARRAY('X');</div><div class="line">+-----------------------------------+</div><div class="line">| JSON_ARRAY('x') = JSON_ARRAY('X') |</div><div class="line">+-----------------------------------+</div><div class="line">|                                 0 |</div><div class="line">+-----------------------------------+</div></pre></td></tr></table></figure></p>
<h3 id="字面量"><a href="#字面量" class="headerlink" title="字面量"></a>字面量</h3><p>区分大小写同样支持JSON的<code>null</code>, <code>true</code>, <code>false</code>等字面量. 因此在引用他们的时候一定要小写.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT JSON_VALID('null'), JSON_VALID('Null'), JSON_VALID('NULL');</div><div class="line">+--------------------+--------------------+--------------------+</div><div class="line">| JSON_VALID('null') | JSON_VALID('Null') | JSON_VALID('NULL') |</div><div class="line">+--------------------+--------------------+--------------------+</div><div class="line">|                  1 |                  0 |                  0 |</div><div class="line">+--------------------+--------------------+--------------------+</div><div class="line"></div><div class="line">mysql&gt; SELECT CAST('null' AS JSON);</div><div class="line">+----------------------+</div><div class="line">| CAST('null' AS JSON) |</div><div class="line">+----------------------+</div><div class="line">| null                 |</div><div class="line">+----------------------+</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<h3 id="转换"><a href="#转换" class="headerlink" title="转换"></a>转换</h3><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT CAST('NULL' AS JSON);</div><div class="line">ERROR 3141 (22032): Invalid JSON text in argument 1 to function cast_as_json:</div><div class="line">"Invalid value." at position 0 in 'NULL'.</div></pre></td></tr></table></figure>
<p>JSON字面量区分大小写与SQL中的不同. 在SQL中<code>NULL, TRUE, FALSE</code>等字面量可以写成由任意大小写组成:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">mysql&gt; SELECT ISNULL(null), ISNULL(Null), ISNULL(NULL);</div><div class="line">+--------------+--------------+--------------+</div><div class="line">| ISNULL(null) | ISNULL(Null) | ISNULL(NULL) |</div><div class="line">+--------------+--------------+--------------+</div><div class="line">|            1 |            1 |            1 |</div><div class="line">+--------------+--------------+--------------+</div></pre></td></tr></table></figure></p>
<h2 id="比较和排序"><a href="#比较和排序" class="headerlink" title="比较和排序"></a>比较和排序</h2><p>JSON文档里面的value可以通过如下操作符进行比较操作</p>
<ul>
<li>=</li>
<li>&lt;</li>
<li>&lt;=</li>
<li>&gt;</li>
<li><blockquote>
<p>=</p>
</blockquote>
</li>
<li>&lt;&gt;</li>
<li>!=</li>
<li>&lt;=&gt;</li>
</ul>
<p>下面的比较操作符和方法并不支持JSON值</p>
<ul>
<li>BETWEEN</li>
<li>IN()</li>
<li>GREATEST()</li>
<li>LEAST()</li>
</ul>
<p>刚才列出的比较操作符和方法会将JSON值转换成MySQL原生的numeric或者string类型, 因此他们有一个consistent non-JSON扩展类型.</p>
<p>JSON值进行比较时会先根据JSON类型进行比较, 如果类型不同的话, 比较结果就决定于更高优先级的类型. 如果类型一样的话, 则会根据指定类型原则进行比较.</p>
<p>下面列出了JSON类型的优先级, 从高到低进行排序. 我们可以通过<code>JSON_TYPE()</code>来获取某个值得类型.</p>
<ul>
<li>BLOB</li>
<li>BIT</li>
<li>OPAQUE</li>
<li>DATETIME</li>
<li>TIME</li>
<li>DATE</li>
<li>BOOLEAN</li>
<li>ARRAY</li>
<li>OBJECT</li>
<li>STRING</li>
<li>INTEGER, DOUBLE</li>
<li>NULL<br>如果JSON值拥有相同的优先级的话, 那么不同的类型或根据下面介绍的规则进行比较:</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/数据库/">数据库</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/17/数据库/Mysql JSON Data Type/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/17/数据库/Mysql JSON Data Type/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/15/jvm/CRaSH 命令行/" title="CRaSH 安装启动" itemprop="url">CRaSH 安装启动</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-05-15T07:00:00.000Z" itemprop="datePublished"> Published 2016-05-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>CRaSH 的全名是 Common Reusable SHell . 网上对其介绍是: 基于 Java 发布提供与 JVM 进行交互的 SHELL 环境. 作为入门, 这篇文章介绍一下, 作为单独程序的使用.</p>
<p>我在mac上使用brew安装上里CRaSH, 大家可以根据自己的环境自行安装.</p>
<p>我启动了一个SpringBoot HTTP服务, 然后使用CRaSH连接到这个服务上.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</div><div class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.EnableAutoConfiguration;</div><div class="line"><span class="keyword">import</span> org.springframework.stereotype.Controller;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</div><div class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.ResponseBody;</div><div class="line"></div><div class="line"><span class="meta">@Controller</span></div><div class="line"><span class="meta">@EnableAutoConfiguration</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HTTPServer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@RequestMapping</span>(<span class="string">"/"</span>)</div><div class="line">    <span class="meta">@ResponseBody</span></div><div class="line">    <span class="function">String <span class="title">home</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"Hello World!"</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">        SpringApplication.run(HTTPServer.class, args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后在命令行找到这个进程id<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">➜  ~ jps <span class="_">-l</span></div><div class="line">467</div><div class="line">488 org.jetbrains.idea.maven.server.RemoteMavenServer</div><div class="line">696 com.intellij.rt.execution.application.AppMain</div><div class="line">697 org.jetbrains.jps.cmdline.Launcher</div><div class="line">845 sun.tools.jps.Jps</div><div class="line">➜  ~ crash.sh 696</div><div class="line"></div><div class="line">   _____     ________                 _______    ____ ____</div><div class="line"> .<span class="string">'     `.  |        `.             .'</span>       `. |    |    | 1.3.0</div><div class="line">|    |    | |    |    |  .-------.  |    |    | |    |    |</div><div class="line">|    |____| |    `   .<span class="string">' |   _|    |  .    '</span>~_ ` |         |</div><div class="line">|    |    | |    .   `.  .~<span class="string">'      | | `~_    `| |         |</span></div><div class="line">|    |    | |    |    | |    |    | |    |    | |    |    |</div><div class="line"> `._____.'  |____|____| `.________|  `._____.<span class="string">'  |____|____|</span></div><div class="line"></div><div class="line">Follow and support the project on http://www.crashub.org</div><div class="line">Welcome to localhost + !</div><div class="line">It is Sun May 15 10:44:03 CST 2016 now</div><div class="line">%</div></pre></td></tr></table></figure></p>
<p>最后出现<code>%</code>说明我们已经连接到SpringBoot服务所在的虚拟机里了. 同样的在SpringBoot服务的日志里也有输出<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">2016-05-15 10:44:00.005  INFO 696 --- [Attach Listener] org.crsh.standalone.Agent                : CRaSH agent loaded</div><div class="line">2016-05-15 10:44:00.007  INFO 696 --- [Attach Listener] org.crsh.standalone.Agent                : Spawned CRaSH thread 23 <span class="keyword">for</span> further processing</div><div class="line">2016-05-15 10:44:00.097  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property vfs.refresh_period=1 from properties</div><div class="line">2016-05-15 10:44:00.203  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property ssh.port=2000 from properties</div><div class="line">2016-05-15 10:44:00.203  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property ssh.auth_timeout=600000 from properties</div><div class="line">2016-05-15 10:44:00.204  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property ssh.idle_timeout=600000 from properties</div><div class="line">2016-05-15 10:44:00.204  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property ssh.default_encoding=UTF-8 from properties</div><div class="line">2016-05-15 10:44:00.204  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property auth=simple from properties</div><div class="line">2016-05-15 10:44:00.204  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property telnet.port=5000 from properties</div><div class="line">2016-05-15 10:44:00.204  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property mail.debug=<span class="literal">false</span> from properties</div><div class="line">2016-05-15 10:44:00.205  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property auth.simple.username=admin from properties</div><div class="line">2016-05-15 10:44:00.205  INFO 696 --- [       Thread-3] org.crsh.standalone.Bootstrap            : Configuring property auth.simple.password=admin from properties</div><div class="line">2016-05-15 10:44:02.111  INFO 696 --- [       Thread-6] net.wimpi.telnetd.net.PortListener       : Listening to Port 5,000 with a connectivity queue size of 5.</div><div class="line">2016-05-15 10:44:02.700  INFO 696 --- [       Thread-3] org.crsh.standalone.Agent                : Callback back remote on port 50656</div></pre></td></tr></table></figure></p>
<p>当我们在启动时, 还可以指定一些参数设置</p>
<ul>
<li><code>--cmd</code> : 这个选项用于指定, 我们要执行的命令所在的目录. 如果不指定的话, 会默认地从当前classpath下的<code>/crash/commands/</code>进行查找</li>
<li><code>--conf</code> : 用于指定配置文件所在的目录, 可以指定多个目录</li>
<li><code>--property</code> : <code>--cmd</code>可选参数, 可以覆盖配置文件中的配置, 示例<code>crash.sh --property crash.telnet.port=3000</code></li>
</ul>
<p>下面我们看一下在CRaSH中都可以使用哪些命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">% <span class="built_in">help</span></div><div class="line">Try one of these commands with the -h or --help switch:</div><div class="line"></div><div class="line">NAME      DESCRIPTION</div><div class="line">clock</div><div class="line">cron      manages the cron plugin</div><div class="line">dashboard a monitoring dashboard</div><div class="line">date      show the current time</div><div class="line">egrep     search file(s) <span class="keyword">for</span> lines that match a pattern</div><div class="line">env       display the term env</div><div class="line">filter    a filter <span class="keyword">for</span> a stream of map</div><div class="line">hello</div><div class="line">java      various java language commands</div><div class="line">jdbc      JDBC connection</div><div class="line">jmx       Java Management Extensions</div><div class="line">jndi      Java Naming and Directory Interface</div><div class="line">jpa       Java persistance API</div><div class="line">jul       java.util.logging commands</div><div class="line">jvm       JVM informations</div><div class="line">less      opposite of more</div><div class="line">mail      interact with emails</div><div class="line">man       format and display the on-line manual pages</div><div class="line">shell     shell related <span class="built_in">command</span></div><div class="line">sleep     sleep <span class="keyword">for</span> some time</div><div class="line">sort      sort a map</div><div class="line">system    vm system properties commands</div><div class="line">thread    JVM thread commands</div><div class="line"><span class="built_in">help</span>      provides basic <span class="built_in">help</span></div><div class="line">repl      list the repl or change the current repl</div></pre></td></tr></table></figure></p>
<p>CRaSH为我们提供了非常多的命令, 对于命令的具体用法, 大家可以使用<code>jvm --help</code>这样的用法具体看一下. CRaSH还提供了pipline, 我们可以使用<code>|</code>管道符使用多个命令.</p>
<p>具体的命令这篇文章就不再多介绍了, 下面我们看一下如何将CRaSH内嵌到Spring里. 为了简单, 我并没有直接使用CRaSH官网里介绍的那样, 使用xml配置Spring<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.crsh.spring.SpringBootstrap;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.Properties;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.TimeUnit;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">        SpringBootstrap springBootstrap = <span class="keyword">new</span> SpringBootstrap();</div><div class="line">        Properties properties = <span class="keyword">new</span> Properties();</div><div class="line">        properties.setProperty(<span class="string">"crash.vfs.refresh_period"</span>, <span class="string">"1"</span>);</div><div class="line">        properties.setProperty(<span class="string">"crash.ssh.port"</span>, <span class="string">"2000"</span>);</div><div class="line">        properties.setProperty(<span class="string">"crash.ssh.idle_timeout"</span>, <span class="string">"3000000"</span>);</div><div class="line">        properties.setProperty(<span class="string">"crash.telnet.port"</span>, <span class="string">"5000"</span>);</div><div class="line">        properties.setProperty(<span class="string">"crash.ssh.auth_timeout"</span>, <span class="string">"300000"</span>);</div><div class="line">        properties.setProperty(<span class="string">"crash.auth"</span>, <span class="string">"simple"</span>);</div><div class="line">        properties.setProperty(<span class="string">"crash.auth.simple.username"</span>, <span class="string">"admin"</span>);</div><div class="line">        properties.setProperty(<span class="string">"crash.auth.simple.password"</span>, <span class="string">"admin"</span>);</div><div class="line">        springBootstrap.setConfig(properties);</div><div class="line"></div><div class="line">        TimeUnit.DAYS.sleep(<span class="number">1</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>然后启动一个客户端<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">➜  ~ telnet localhost 5000</div><div class="line">Trying ::1...</div><div class="line">Connected to localhost.</div><div class="line">Escape character is <span class="string">'^]'</span>.</div><div class="line"></div><div class="line">   _____     ________                 _______    ____ ____</div><div class="line"> .<span class="string">'     `.  |        `.             .'</span>       `. |    |    | 1.3.0</div><div class="line">|    |    | |    |    |  .-------.  |    |    | |    |    |</div><div class="line">|    |____| |    `   .<span class="string">' |   _|    |  .    '</span>~_ ` |         |</div><div class="line">|    |    | |    .   `.  .~<span class="string">'      | | `~_    `| |         |</span></div><div class="line">|    |    | |    |    | |    |    | |    |    | |    |    |</div><div class="line"> `._____.'  |____|____| `.________|  `._____.<span class="string">'  |____|____|</span></div><div class="line"></div><div class="line">Follow and support the project on http://www.crashub.org</div><div class="line">Welcome to localhost + !</div><div class="line">It is Sun May 15 11:29:56 CST 2016 now</div><div class="line"></div><div class="line">%</div></pre></td></tr></table></figure></p>
<p>通过telnet, 我们也成功连接进来了.</p>
<p>这个需要添加的CRaSH的maven依赖有<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- http://mvnrepository.com/artifact/org.crashub/crash.shell --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.crashub<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>crash.shell<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- http://mvnrepository.com/artifact/org.crashub/crash.cli --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.crashub<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>crash.cli<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- http://mvnrepository.com/artifact/org.crashub/crash.packaging --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.crashub<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>crash.packaging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- http://mvnrepository.com/artifact/org.crashub/crash.embed.spring --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.crashub<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>crash.embed.spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/JVM/">JVM</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/15/jvm/CRaSH 命令行/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/15/jvm/CRaSH 命令行/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/12/JavaLibrary/log4j2/" title="Log4J2 初探" itemprop="url">Log4J2 初探</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-05-12T07:00:00.000Z" itemprop="datePublished"> Published 2016-05-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>Log4J2会使用<code>ConfigurationFactory</code>从classpath上依次尝试加载下面的配置文件, 一旦找到就停止查找过程</p>
<ol>
<li>log4j.configurationFil</li>
<li>log4j2-test.properties</li>
<li>log4j2-test.yaml or log4j2-test.yml</li>
<li>log4j2-test.json or log4j2-test.jsn</li>
<li>log4j2-test.xml</li>
<li>log4j2.properties</li>
<li>log4j2.yaml or log4j2.yml</li>
<li>log4j2.json or log4j2.jsn</li>
<li>log4j2.xml<br>从上面的配置文件,我们可以看到Log4J2支持, JSON, YAML, properties, XML 等四种格式的配置文件.</li>
</ol>
<p>如果找不到配置文件的话, 就会使用默认的配置</p>
<ul>
<li>想root logger 关联一个ConsoleAppender (root logger的默认等级是Level.ERROR)</li>
<li>ConsoleAppender指定一个PatternLayout, 其格式内容为<code>%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg%n</code></li>
</ul>
<p>官网给出了一个简单的示例<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> com.foo.Bar;</div><div class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</div><div class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyApp</span> </span>&#123;</div><div class="line"> </div><div class="line">    <span class="comment">// Define a static logger variable so that it references the</span></div><div class="line">    <span class="comment">// Logger instance named "MyApp".</span></div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LogManager.getLogger(MyApp.class);</div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(<span class="keyword">final</span> String... args)</span> </span>&#123;</div><div class="line"> </div><div class="line">        <span class="comment">// Set up a simple configuration that logs on the console.</span></div><div class="line"> </div><div class="line">        logger.trace(<span class="string">"Entering application."</span>);</div><div class="line">        Bar bar = <span class="keyword">new</span> Bar();</div><div class="line">        <span class="keyword">if</span> (!bar.doIt()) &#123;</div><div class="line">            logger.error(<span class="string">"Didn't do it."</span>);</div><div class="line">        &#125;</div><div class="line">        logger.trace(<span class="string">"Exiting application."</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">package</span> com.foo;</div><div class="line"><span class="keyword">import</span> org.apache.logging.log4j.Logger;</div><div class="line"><span class="keyword">import</span> org.apache.logging.log4j.LogManager;</div><div class="line"> </div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Bar</span> </span>&#123;</div><div class="line">  <span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LogManager.getLogger(Bar.class.getName());</div><div class="line"> </div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">doIt</span><span class="params">()</span> </span>&#123;</div><div class="line">    logger.entry();</div><div class="line">    logger.error(<span class="string">"Did it again!"</span>);</div><div class="line">    <span class="keyword">return</span> logger.exit(<span class="keyword">false</span>);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>配置文件为<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span> <span class="attr">monitorInterval</span>=<span class="string">"30"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d&#123;HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"error"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>输出结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">17:13:01.540 [main] TRACE MyApp - Entering application.</div><div class="line">17:13:01.540 [main] TRACE com.foo.Bar - entry</div><div class="line">17:13:01.540 [main] ERROR com.foo.Bar - Did it again!</div><div class="line">17:13:01.540 [main] TRACE com.foo.Bar - <span class="built_in">exit</span> with (<span class="literal">false</span>)</div><div class="line">17:13:01.540 [main] ERROR MyApp - Didn<span class="string">'t do it.</span></div><div class="line">17:13:01.540 [main] TRACE MyApp - Exiting application.</div></pre></td></tr></table></figure></p>
<p>我们在配置里使用了一个<code>monitorInterval</code>属性, 这个属性是用来监控日志文件的, 每隔多少秒刷新一次.</p>
<p>下面我们展示一个只有<code>com.foo.Bar</code>才会trace全部日志, 而其他的日志则只会输出ERROR级别的.<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">"%d&#123;HH:mm:ss.SSS&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Logger</span> <span class="attr">name</span>=<span class="string">"com.foo.Bar"</span> <span class="attr">level</span>=<span class="string">"trace"</span> <span class="attr">additivity</span>=<span class="string">"false"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Logger</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"error"</span>&gt;</span></div><div class="line">      <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">17:13:01.540 [main] TRACE com.foo.Bar - entry</div><div class="line">17:13:01.540 [main] ERROR com.foo.Bar - Did it again!</div><div class="line">17:13:01.540 [main] TRACE com.foo.Bar - <span class="built_in">exit</span> (<span class="literal">false</span>)</div><div class="line">17:13:01.540 [main] ERROR MyApp - Didn<span class="string">'t do it.</span></div></pre></td></tr></table></figure></p>
<p>需要注意的是,我们在com.foo.Bar这个Logger后面添加了一个<code>additivity=&quot;false&quot;</code>的属性.</p>
<p>关于日志级别我们来测试一下, 我们写一个Java程序<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLevel</span> </span>&#123;</div><div class="line">	<span class="keyword">static</span> <span class="keyword">final</span> Logger logger = LogManager.getLogger(TestLookups.class.getName());</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line"></div><div class="line">		logger.trace(<span class="string">"test"</span>);</div><div class="line">		logger.debug(<span class="string">"test"</span>);</div><div class="line">		logger.info(<span class="string">"test"</span>);</div><div class="line">		logger.warn(<span class="string">"test"</span>);</div><div class="line">		logger.error(<span class="string">"test"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>log4j2的配置文件为<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span> <span class="attr">monitorInterval</span>=<span class="string">"30"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d %p %c&#123;1.&#125; [%t] $$&#123;ctx:loginId&#125; %m%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"trace"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2016-05-12 18:29:55,570 TRACE t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:29:55,571 DEBUG t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:29:55,572 INFO t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:29:55,572 WARN t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:29:55,572 ERROR t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div></pre></td></tr></table></figure></p>
<p>级别改为debug后结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">2016-05-12 18:30:13,574 DEBUG t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:30:13,575 INFO t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:30:13,575 WARN t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:30:13,575 ERROR t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div></pre></td></tr></table></figure></p>
<p>级别改为info后结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">2016-05-12 18:30:43,042 INFO t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:30:43,043 WARN t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:30:43,044 ERROR t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div></pre></td></tr></table></figure></p>
<p>级别改为warn后结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-05-12 18:31:18,095 WARN t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div><div class="line">2016-05-12 18:31:18,096 ERROR t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div></pre></td></tr></table></figure></p>
<p>级别改为error后结果为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2016-05-12 18:31:43,894 ERROR t.TestLookups [main] <span class="variable">$&#123;ctx:loginId&#125;</span> <span class="built_in">test</span></div></pre></td></tr></table></figure></p>
<p>如果出现重复日志输出, 多半原因因为, root收集到了子logger反馈的日志, 只需要将子logger设置为<code>additivity=&quot;false&quot;</code>就可以了,例如<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">"WARN"</span> <span class="attr">monitorInterval</span>=<span class="string">"30"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">"Console"</span> <span class="attr">target</span>=<span class="string">"SYSTEM_OUT"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span>&gt;</span></div><div class="line">                <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d %p %c&#123;1.&#125; [%t] $$&#123;ctx:loginId&#125; %m%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></div><div class="line">            <span class="tag">&lt;/<span class="name">PatternLayout</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">Logger</span> <span class="attr">name</span>=<span class="string">"stdout"</span> <span class="attr">level</span>=<span class="string">"info"</span> <span class="attr">additivity</span>=<span class="string">"false"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">Logger</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">Root</span> <span class="attr">level</span>=<span class="string">"trace"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">AppenderRef</span> <span class="attr">ref</span>=<span class="string">"Console"</span>/&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">Root</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>动态修改日志级别<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> LoggerContext ctx = (LoggerContext) LogManager.getContext(<span class="keyword">false</span>);</div><div class="line"><span class="keyword">final</span> Configuration config = ctx.getConfiguration();</div><div class="line"></div><div class="line">LoggerConfig loggerConfig = config.getLoggerConfig(logger.getName());</div><div class="line">LoggerConfig specificConfig = loggerConfig;</div><div class="line"></div><div class="line"><span class="keyword">if</span> (!loggerConfig.getName().equals(logger.getName())) &#123;</div><div class="line">	specificConfig = <span class="keyword">new</span> LoggerConfig(logger.getName(), level, <span class="keyword">true</span>);</div><div class="line">	specificConfig.setParent(loggerConfig);</div><div class="line">	config.addLogger(logger.getName(), specificConfig);</div><div class="line">&#125;</div><div class="line">specificConfig.setLevel(level);</div><div class="line">ctx.updateLoggers();</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java-Library/">Java Library</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/12/JavaLibrary/log4j2/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/12/JavaLibrary/log4j2/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/11/JavaLibrary/Oracle Solaris Studio/" title="Oracle® Solaris Studio" itemprop="url">Oracle® Solaris Studio</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-05-11T07:00:00.000Z" itemprop="datePublished"> Published 2016-05-11</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>在Centos上安装Oracle® Solaris Studio.  <a href="http://docs.oracle.com/cd/E27071_01/html/E26451/gemyt.html#scrolltoc" target="_blank" rel="external">中文教程</a></p>
<p>首先执行下列命令<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">yum install glibc</div><div class="line">yum install elfutils-libelf-devel</div><div class="line">yum install zlib</div><div class="line">yum install libstdc++</div><div class="line">yum install libgcc</div></pre></td></tr></table></figure></p>
<p>执行完之后, 会将下列依赖包安装完成<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">glibc</div><div class="line">glibc.i686</div><div class="line">glibc-devel</div><div class="line">glibc-devel.i686</div><div class="line">elfutils-libelf-devel </div><div class="line">elfutils-libelf-devel.i686</div><div class="line">zlib</div><div class="line">zlib.i686</div><div class="line">libstdc++</div><div class="line">libstdc++.i686</div><div class="line">libgcc</div><div class="line">libgcc.i686</div></pre></td></tr></table></figure></p>
<ol>
<li>在<a href="http://www.oracle.com/technetwork/server-storage/solarisstudio/downloads/index.html" target="_blank" rel="external">下载界面</a>下载Oracle Linux/ Red Hat Linux - RPM installer on x86 </li>
<li>运行命令解压<code>bzcat download_directory/SolarisStudio12.4-linux-x86-rpm.tar.bz2 | /bin/tar -xf -</code></li>
<li>进行安装<code>./solarisstudio.sh --non-interactive</code>(包含GUI, 也就是我们可以在Linux的桌面上打开Solaris Studio IDE)</li>
<li>验证是否安装成功<code>/opt/oracle/solarisstudio12.4/bin/analyzer -v</code></li>
</ol>
<p>安装完成后会显示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Configuring the installer...</div><div class="line">Searching <span class="keyword">for</span> JVM on the system...</div><div class="line">Extracting installation data (can take a <span class="keyword">while</span>, please <span class="built_in">wait</span>)...</div><div class="line">Running the installer wizard...</div><div class="line">/tmp/ossi-c2x_<span class="built_in">test</span>-20160509142618.silent.log:</div><div class="line">[2016-05-09 14:26:18.764]: WARNING - Your OS distribution is not supported. The list of supported systems can be found <span class="keyword">in</span> the Oracle Solaris Studio documentation. While it might be possible to install Oracle Solaris Studio on your system, it might not <span class="keyword">function</span> properly.</div></pre></td></tr></table></figure></p>
<p>运行<code>analyzer -v</code>显示<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">analyzer: Oracle Solaris Studio 12.4 Performance Analyzer 12.4 Linux_x64 2014/10/21</div><div class="line">Java at /usr/java/jdk1.8.0_25/bin/java selected by PATH</div><div class="line">java version <span class="string">"1.8.0_25"</span></div><div class="line">Java(TM) SE Runtime Environment (build 1.8.0_25-b17)</div><div class="line">Java HotSpot(TM) 64-Bit Server VM (build 25.25-b02, mixed mode)</div><div class="line">WARNING: Linux CentOS_6.7 system <span class="string">"c2x_test"</span> is not supported by the Performance tools.</div><div class="line">Running /usr/java/jdk1.8.0_25/bin/java -version</div><div class="line">/opt/oracle/solarisstudio12.4/bin/analyzer: ERROR: environment variable DISPLAY is not <span class="built_in">set</span></div></pre></td></tr></table></figure></p>
<p>额外事项</p>
<ol>
<li>卸载程序 <code>/opt/oracle/solarisstudio12.4/uninstall.sh --non-interactive</code></li>
<li>如果安装时不想要GUI, 只需要在后面加上<code>--libraries-only</code>就好了</li>
<li>设置环境变量 <code>vi /ect/profile</code> 修改<code>PATH=$PATH:/opt/oracle/solarisstudio12.4/bin/</code></li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java-Library/">Java Library</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/11/JavaLibrary/Oracle Solaris Studio/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/11/JavaLibrary/Oracle Solaris Studio/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2016/05/10/数据库/Mysql Secondary Indexes and Generated Virtual Columns/" title="Mysql 第二索引和虚拟列" itemprop="url">Mysql 第二索引和虚拟列</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2016-05-10T07:00:00.000Z" itemprop="datePublished"> Published 2016-05-10</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p><a href="http://dev.mysql.com/doc/refman/5.7/en/create-table-secondary-indexes-virtual-columns.html" target="_blank" rel="external">官方文档</a></p>
<h2 id="Generated-Columns"><a href="#Generated-Columns" class="headerlink" title="Generated Columns"></a>Generated Columns</h2><p>generated column是由普通column生成的列.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">CREATE TABLE sum (</div><div class="line">  num1 int,</div><div class="line">  num2 int,</div><div class="line">  sum int AS (num1 + num2)</div><div class="line">);</div><div class="line"></div><div class="line">INSERT INTO sum (num1, num2) VALUES(1,1),(3,4);</div><div class="line">mysql&gt; SELECT * FROM sum;</div><div class="line">+-------+-------+--------------------+</div><div class="line">| num1  | num2  | sum                |</div><div class="line">+-------+-------+--------------------+</div><div class="line">|     1 |     1 |                  2 |</div><div class="line">|     3 |     4 |                  7 |</div><div class="line">+-------+-------+--------------------+</div></pre></td></tr></table></figure></p>
<p>在上面的实例中我们首先创建了一个sum表，然后插入俩条数据数据 我们发现sum这一列上自动生成一个值</p>
<p>这种自动生成列的语法为为<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">col_name data_type [GENERATED ALWAYS] AS (expression)</div><div class="line">  [VIRTUAL | STORED] [UNIQUE [KEY]] [COMMENT comment]</div><div class="line">  [[NOT] NULL] [[PRIMARY] KEY]</div></pre></td></tr></table></figure></p>
<ul>
<li>VIRTUAL: 不存储值到磁盘上</li>
<li>STORED : 将值存储到磁盘上</li>
</ul>
<h2 id="Secondary-Indexes"><a href="#Secondary-Indexes" class="headerlink" title="Secondary Indexes"></a>Secondary Indexes</h2><p>从MySQL5.7.8开始, InnoDB引擎基于自生成(generated virtual columns)的虚拟列支持辅助索引索引(secondary indexes, 并不支持其他索引, 例如簇索引等).</p>
<p>secondary indexe可以基于一个, 多个, 组合virtual columns或者非generated virtual columns生成。当基于virtual column的secondary index可以由<code>UNIQUE</code>进行定义.</p>
<p>当基于generated virtual column创建的secondary index, generated column的值就体现在了这个secondary index的记录上. 如果这个索引是一个covering index, generated column值是从索引中已经生成的值进行索引, 而不是再自己计算一遍.</p>
<blockquote>
<p>covering index 查询时检索所有的column.</p>
</blockquote>
<p>在执行<code>INSERT</code>和<code>UPDATE</code>这样的写操作时, 如果用到了基于virtual column的辅助索引时, 那么生成virtual column时会产生额外的性能消耗. 甚至当使用STORED generated columns时, 写操作会带来更多的性能消耗, 还有更多的内存和磁盘消耗. 如果secondary index不是基于virtual column, 当产生读操作时会带来更多的性能消耗, 这是因为virtual column的值每当该column的列被检查时都会计算一次.</p>
<p>当发生回滚或者清除操作时, 被索引过的virtual column已经经过里MVCC-logged, 如此一来就可以以避免再计算一次. logged值的长度是由索引长度限制的, <code>COMPACT</code>和<code>REDUNDANT</code>是767字节, <code>DYNAMIC</code>和<code>COMPRESSED</code>是3072个字节.</p>
<p>在virtual column 上增加或者删除secondary index是一个内置的操作.</p>
<p>virtual column 上的secondary index不能成为外键的索引. 同样secondary index的virtual column也不能指向外键, 而且也不能使用如下的语句定义</p>
<ul>
<li>ON DELETE CASCADE</li>
<li>ON DELETE SET NULL</li>
<li>ON UPDATE CASCADE</li>
<li>ON UPDATE SET NULL.</li>
</ul>
<h2 id="Generated-Virtual-Column索引JSON-Column上"><a href="#Generated-Virtual-Column索引JSON-Column上" class="headerlink" title="Generated Virtual Column索引JSON Column上"></a>Generated Virtual Column索引JSON Column上</h2><p>JSON columns是不能被直接索引的. 但是我们可以通过创建一个generated column来间接为JSON columns生成一个索引, 如下例:<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line">mysql&gt; CREATE TABLE jemp (</div><div class="line">    -&gt;     c JSON,</div><div class="line">    -&gt;     g INT GENERATED ALWAYS AS (JSON_EXTRACT(c, '$.id')),</div><div class="line">    -&gt;     INDEX i (g)</div><div class="line">    -&gt; );</div><div class="line">Query OK, 0 rows affected (0.28 sec)</div><div class="line"></div><div class="line">mysql&gt; INSERT INTO jemp (c) VALUES</div><div class="line">     &gt;   ('&#123;"id": "1", "name": "Fred"&#125;'), ('&#123;"id": "2", "name": "Wilma"&#125;'),</div><div class="line">     &gt;   ('&#123;"id": "3", "name": "Barney"&#125;'), ('&#123;"id": "4", "name": "Betty"&#125;');</div><div class="line">Query OK, 4 rows affected (0.04 sec)</div><div class="line">Records: 4  Duplicates: 0  Warnings: 0</div><div class="line"></div><div class="line">mysql&gt; SELECT JSON_UNQUOTE(JSON_EXTRACT(c, '$.name')) AS name</div><div class="line">     &gt;     FROM jemp WHERE g &gt; 2;</div><div class="line">+--------+</div><div class="line">| name   |</div><div class="line">+--------+</div><div class="line">| Barney |</div><div class="line">| Betty  |</div><div class="line">+--------+</div><div class="line">2 rows in set (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; EXPLAIN SELECT JSON_UNQUOTE(JSON_EXTRACT(c, '$.name')) AS name</div><div class="line">     &gt;    FROM jemp WHERE g &gt; 2\G</div><div class="line">*************************** 1. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: SIMPLE</div><div class="line">        table: jemp</div><div class="line">   partitions: NULL</div><div class="line">         type: range</div><div class="line">possible_keys: i</div><div class="line">          key: i</div><div class="line">      key_len: 5</div><div class="line">          ref: NULL</div><div class="line">         rows: 2</div><div class="line">     filtered: 100.00</div><div class="line">        Extra: Using where</div><div class="line">1 row in set, 1 warning (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; SHOW WARNINGS\G</div><div class="line">*************************** 1. row ***************************</div><div class="line">  Level: Note</div><div class="line">   Code: 1003</div><div class="line">Message: /* select#1 */ select json_unquote(json_extract(`test`.`jemp`.`c`,'$.name'))</div><div class="line">AS `name` from `test`.`jemp` where (`test`.`jemp`.`g` &gt; 2)</div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>
<blockquote>
<p>关于上例中创建表的更多信息参考 <a href="">Section 9.3.9, “Optimizer Use of Generated Column Indexes”</a></p>
</blockquote>
<p>在Mysql 5.7.9以后, 你可以使用<code>-&gt;</code>替代<code>JSON_EXTRACT()</code>作为path访问JSON列.</p>
<p>当你使用<code>EXPLAIN</code>的语句中包含了一个或者多个<code>-&gt;</code>操作符时, 它们会被<code>JSON_EXTRACT()</code>进行替换.<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">mysql&gt; EXPLAIN SELECT c-&gt;"$.name"</div><div class="line">     &gt; FROM jemp WHERE g &gt; 2\G ORDER BY c-&gt;"$.name"</div><div class="line">*************************** 1. row ***************************</div><div class="line">           id: 1</div><div class="line">  select_type: SIMPLE</div><div class="line">        table: jemp</div><div class="line">   partitions: NULL</div><div class="line">         type: range</div><div class="line">possible_keys: i</div><div class="line">          key: i</div><div class="line">      key_len: 5</div><div class="line">          ref: NULL</div><div class="line">         rows: 2</div><div class="line">     filtered: 100.00</div><div class="line">        Extra: Using where; Using filesort</div><div class="line">1 row in set, 1 warning (0.00 sec)</div><div class="line"></div><div class="line">mysql&gt; SHOW WARNINGS\G</div><div class="line">*************************** 1. row ***************************</div><div class="line">  Level: Note</div><div class="line">   Code: 1003</div><div class="line">Message: /* select#1 */ select json_extract(`test`.`jemp`.`c`,'$.name') AS</div><div class="line">`c-&gt;"$.name"` from `test`.`jemp` where (`test`.`jemp`.`g` &gt; 2) order by</div><div class="line">json_extract(`test`.`jemp`.`c`,'$.name')  </div><div class="line">1 row in set (0.00 sec)</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/数据库/">数据库</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2016/05/10/数据库/Mysql Secondary Indexes and Generated Virtual Columns/#comments" class="ds-thread-count comments-count-link" data-thread-key="2016/05/10/数据库/Mysql Secondary Indexes and Generated Virtual Columns/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><a class="extend next" rel="next" href="/page/3/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="yu66" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
		
		  
			<li><a href="/categories/JVM/" title="JVM">JVM<sup>38</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>42</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java-Library/" title="Java Library">Java Library<sup>42</sup></a></li>
		  
		
		  
		
		  
		
		  
		
		  
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/NoSql/" title="NoSql">NoSql<sup>9</sup></a></li>
		  
		
		  
		
		  
			<li><a href="/categories/ZooKeeper/" title="ZooKeeper">ZooKeeper<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/asm/" title="asm">asm<sup>4</sup></a></li>
		  
		
		  
		
		  
		
		  
		
		  
		
		  
			<li><a href="/categories/数据库/" title="数据库">数据库<sup>10</sup></a></li>
		  
		
		  
		
		  
			<li><a href="/categories/杂记/" title="杂记">杂记<sup>23</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法/" title="算法">算法<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程语言/" title="编程语言">编程语言<sup>20</sup></a></li>
		  
		
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Netty/" title="Netty">Netty<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/Guice/" title="Guice">Guice<sup>7</sup></a></li>
			
		
			
				<li><a href="/tags/Spring/" title="Spring">Spring<sup>5</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="http://vertx.yu66.wang/" target="_blank" title="vertx3">vertx3</a>
            
          </li>
        
    </ul>
</div>

  

<div class="doubanshow">
<p class="asidetitle">Douban Show</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/xxxyy/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=3253370782&verifier=e9ca895b&dpc=1"></iframe>
</div>


  

<div class="lofter">
<p class="asidetitle">Lofter</p>

 <iframe width="100%" height="39" class="share_self"  frameborder="0" scrolling="no" src="http://ming15.lofter.com/"></iframe>
</div>




</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 博客,我选择重构 <br/>
			重构使事情变得更美,更加正确</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/3253370782" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/yu66" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		<a href="https://www.douban.com/people/xxxyy" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/ming15" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="王玉">王玉</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"wanggnim"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F9e8fca440159a2125668804e46682db4' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
