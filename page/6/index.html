
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>·</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="王玉">
    

    
    <meta property="og:type" content="website">
<meta property="og:title" content="·">
<meta property="og:url" content="http://www.yu66.wang/page/6/index.html">
<meta property="og:site_name" content="·">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="·">

    
    <link rel="alternative" href="/atom.xml" title="·" type="application/atom+xml">
    
    
    
    <link rel="apple-touch-icon" href="/img/author.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/author.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="·">·</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="Menu">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">主页</a></li>
					
						<li><a href="/about">关于</a></li>
					
					<li>
 					
						<form class="search" action="http://zhannei.baidu.com/cse/search" target="_blank">
							<label>Search</label>
						<input name="s" type="hidden" value= 17728547076946147000 ><input type="text" name="q" size="30" placeholder="Search"><br>
						</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main">

   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/26/杂记/NUMA/" title="NUMA和RDMA" itemprop="url">NUMA和RDMA</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-26T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-26</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="支持NUMA的CPU"><a href="#支持NUMA的CPU" class="headerlink" title="支持NUMA的CPU"></a>支持NUMA的CPU</h2><p>英特尔系列的</p>
<ul>
<li>Nehalem和Tukwila系列之后的处理器</li>
<li>Xeon</li>
<li>至强处理器 E5-2690</li>
<li>i3、i5、i7</li>
</ul>
<p>HP系列的</p>
<ul>
<li>Superdome</li>
<li>SGI的Altix 3000</li>
</ul>
<p>IBM的</p>
<ul>
<li>p690</li>
<li>x440</li>
</ul>
<p>NEC</p>
<ul>
<li>TX7</li>
</ul>
<p>AMD</p>
<ul>
<li>Opteron</li>
</ul>
<h2 id="Linux中关于NUMA的命令"><a href="#Linux中关于NUMA的命令" class="headerlink" title="Linux中关于NUMA的命令"></a>Linux中关于NUMA的命令</h2><ul>
<li>NUMACTL ：设定进程NUMA策略的命令行工具。</li>
<li>NUMASTAT ：获取NUMA内存访问统计信息的命令行工具</li>
</ul>
<p>开启NUMA<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">numactl --cpunodebind=<span class="number">0</span> --membind=<span class="number">0</span> myapp</div></pre></td></tr></table></figure></p>
<h1 id="JAVA中的NUMA"><a href="#JAVA中的NUMA" class="headerlink" title="JAVA中的NUMA"></a>JAVA中的NUMA</h1><p><code>-XX:+UseNUMA</code>启用Numa, 默认情况下,JVM所占内存会随机的分配到不同的NUMA节点上,当cpu运算时可能会到不同的NUMA节点的告诉缓存上进行数据查找,降低系统速度,可使用numactl工具将JVM进程绑定到特定的NUMA节点上,只让其访问自己所在节点的内存.</p>
<h1 id="NUMA用于MySQL"><a href="#NUMA用于MySQL" class="headerlink" title="NUMA用于MySQL"></a>NUMA用于MySQL</h1><p>调优的时候，有哪些关键配置项，需要注意什么</p>
<ul>
<li><code>numactl --interleave=all</code></li>
<li>在MySQL进程启动前，使用<code>sysctl -q -w vm.drop_caches=3</code>清空文件缓存所占用的空间</li>
<li>Innodb在启动时，就完成整个<code>Innodb_buffer_pool_size</code>的内存分配</li>
</ul>
<h1 id="RDMA"><a href="#RDMA" class="headerlink" title="RDMA"></a>RDMA</h1><p>RDMA 技术需要怎样的硬件，寻找一篇RDMA用于数据库或者Java的文章，对其性能和用法做简单的阐述。</p>
<p>RDMA是一种网卡技术,采用该技术可以使一台计算机直接将信息放入另一台计算机的内存中。RDMA通过在网卡上将可靠传输协议固化于硬件,以及支持绕过内核的零拷贝网络这两种途径来达到这一目标。绕过内核使应用程序不必执行内核调用就可以向网卡发出命令。当一个应用程序执行RDMA读/写请求时,系统并不执行数据拷贝动作。这就减少了处理 网络通信时在内核空间和用户空间上下文切换的次数。RDMA请求的完成,或者完全在用户空间中进行,或者在应用程序希望进入睡眠直到完成信号出现的情况下 通过内核进行。</p>
<p>RDMA实现：</p>
<ul>
<li>利用传统的网络硬件,以TCP/IP及以太网络标准来建立因特网</li>
<li>InfiniBand网络和实现虚拟接口架构的网络支持RDMA.</li>
</ul>
<p>采用RDMA来获取高性能的协议包括</p>
<ul>
<li>Sockets Direct Protocol</li>
<li>SCSI RDMA Protocol（SRP）</li>
<li>Direct Access File System（DAFS）</li>
</ul>
<h2 id="Java-7-SDP"><a href="#Java-7-SDP" class="headerlink" title="Java 7 SDP"></a>Java 7 SDP</h2><p>在Solaris系统上只要有物理InfiniBand网卡，Java 7 SDP就可以立即工作。</p>
<p>Linux则通过Open Fabrics Enterprise Distribution（OFED）包支持SDP。</p>
<blockquote>
<p>确认Linux版本有没有配置OFED设备驱动器，<code>egrep &quot;^[ \t]+ib&quot; /proc/net/dev</code>可以使用该命令测试.</p>
</blockquote>
<p>Java只通过<code>java.net.Socket、java.net.ServerSocket、java.net.Datagram</code>对传输层进行抽象,通过<code>Java.net.InetAddress</code>对网络层进行抽象.只需要将JVM和InfiniBand操作系统设备和库进行设定,java就可以通过传输层抽象直接与物理层进行访问,从而绕过了网络层和数据链路层.</p>
<p>SDP也能让Java具备非常强大的“零拷贝”,这个零拷贝并不是指的是<code>java.nio.channels.FileChannel</code>的<code>transferTo()</code>实现的零拷贝.而是直接使用原生的InfiniBand零拷贝协议实现。现在CPU不用将一个内存区域的数据拷贝到另一个内存区域。CPU可以继续处理其他任务，数据拷贝则由机器的另一部分并行处理，这样就提升了性能。此外，零拷贝操作减少了在用户空间和内核空间之间切换所消耗的时间。</p>
<p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/net/javasdp.jpg" alt=""></p>
<h3 id="配置JVM7支持SDP"><a href="#配置JVM7支持SDP" class="headerlink" title="配置JVM7支持SDP"></a>配置JVM7支持SDP</h3><p>SDP配置文件是个文本文件，JVM启动时会从本地文件系统读取该文件。我们有俩种规则来定义：</p>
<ol>
<li>bind规则：只要TCP套接字绑定到与规则匹配的地址和端口，就会使用SDP协议进行传输。</li>
<li>connect规则：没有绑定的TCP套接字尝试连接匹配规则的地址和端口时，就会使用SDP协议进行传输。<br>第一个关键字用来表明规则是bind还是connect。第二部分指定主机名或IP地址。当指定为IP地址时，你也可以指定表示IP地址范围的前缀。第三部分即最后一个部分是端口号或端口号范围。<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"># 绑定到192.168.1.196主机所有端口使用SDP</div><div class="line">bind 192.168.1.196 *</div><div class="line"></div><div class="line"># 连接到192.168.2.*上的所有应用服务时都使用SDP</div><div class="line">connect 192.168.2.0/24 1024-*</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="使用SDP的JVM7"><a href="#使用SDP的JVM7" class="headerlink" title="使用SDP的JVM7"></a>使用SDP的JVM7</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">java \</div><div class="line">-Dcom.sun.sdp.conf=sdp.conf \</div><div class="line">-Djava.net.preferIPv4Stack=<span class="keyword">true</span> \</div><div class="line">Application.class</div></pre></td></tr></table></figure>
<blockquote>
<p>注意要指定网络格式为<code>IPv4Stack</code>。尽管Java 7和InfiniBand都支持IPv6网络格式，但Solaris和Linux都不支持两者之间的映射。所以启动支持SDP的Java 7 VM时，还是要使用基础、可靠的IPv4网络格式。</p>
</blockquote>
<h2 id="IO性能度量"><a href="#IO性能度量" class="headerlink" title="IO性能度量"></a>IO性能度量</h2><h3 id="全SSD硬盘的IO阀值"><a href="#全SSD硬盘的IO阀值" class="headerlink" title="全SSD硬盘的IO阀值"></a>全SSD硬盘的IO阀值</h3><p>SSD 硬盘传输速率取 500M/S<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="number">0.1</span>ms + <span class="number">0</span> + <span class="number">4</span>K/<span class="number">500</span>MB = <span class="number">0.1</span> + <span class="number">0</span> + <span class="number">0.008</span> = <span class="number">0.108</span></div><div class="line"></div><div class="line">IOPS = <span class="number">1</span>/<span class="number">0.108</span> ms = <span class="number">9259</span> IOPS</div></pre></td></tr></table></figure></p>
<p>吞吐率 = <code>9259 * 4K = 37M / 500M = 7.4%</code></p>
<h3 id="1万转机械磁盘的IO阀值"><a href="#1万转机械磁盘的IO阀值" class="headerlink" title="1万转机械磁盘的IO阀值"></a>1万转机械磁盘的IO阀值</h3><p>1 万转机械磁盘传输速率取 200M/S<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="number">5</span>ms + (<span class="number">60</span>sec/<span class="number">10000</span>RPM/<span class="number">2</span>) + <span class="number">4</span>K/<span class="number">200</span>MB = <span class="number">5</span> + <span class="number">3</span> + <span class="number">0.02</span> = <span class="number">8.02</span> IOPS = <span class="number">1</span>/<span class="number">8.02</span>s ms = <span class="number">125</span> IOPS</div></pre></td></tr></table></figure></p>
<p>吞吐率 = <code>125 * 4K = 500K / 200M = 0.25%</code></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/26/杂记/NUMA/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/26/杂记/NUMA/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/杂记/grep/" title="grep" itemprop="url">grep</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-15T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>grep一种强大的文本搜索工具,它能使用正则表达式搜索文本,并把匹 配的行打印出来</p>
<p>用法: <code>grep [选项]... PATTERN [FILE]...</code>. 在每个 FILE 或是标准输入中查找 PATTERN.默认的 PATTERN 是一个基本正则表达式(缩写为 BRE).<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep -i &apos;hello world&apos; menu.h main.c</div></pre></td></tr></table></figure></p>
<p>主要参数：</p>
<ul>
<li><code>-c</code>：只输出匹配行的计数.</li>
<li><code>-I</code>：不区分大小写(只适用于单字符).</li>
<li><code>-h</code>：查询多文件时不显示文件名.</li>
<li><code>-l</code>：查询多文件时只输出包含匹配字符的文件名.</li>
<li><code>-n</code>：显示匹配行及行号.</li>
<li><code>-s</code>：不显示不存在或无匹配文本的错误信息.</li>
<li><code>-v</code>：排除包含某字符串的行.</li>
</ul>
<p>pattern正则表达式主要参数：</p>
<ul>
<li><code>\</code>： 忽略正则表达式中特殊字符的原有含义.</li>
<li><code>^</code>：匹配正则表达式的开始行.</li>
<li><code>$</code>: 匹配正则表达式的结束行.</li>
<li><code>\&lt;</code>：从匹配正则表达 式的行开始.</li>
<li><code>\&gt;</code>：到匹配正则表达式的行结束.</li>
<li><code>[ ]</code>：单个字符,如[A]即A符合要求 .</li>
<li><code>[ - ]</code>：范围,如[A-Z],即A,B,C一直到Z都符合要求 .</li>
<li><code>.</code>：所有的单个字符.</li>
<li><code>*</code> ：有字符,长度可以为0.</li>
</ul>
<p>正则表达式选择与解释:</p>
<ul>
<li><code>-E</code>     PATTERN 是一个可扩展的正则表达式(缩写为 ERE)</li>
<li><code>-F</code>     PATTERN 是一组由断行符分隔的定长字符串.</li>
<li><code>-G</code>     PATTERN 是一个基本正则表达式(缩写为 BRE)</li>
<li><code>-e</code>     用 PATTERN 来进行匹配操作</li>
<li><code>-f</code>     从 FILE 中取得 PATTERN</li>
<li><code>-i</code>     忽略大小写</li>
<li><code>-w</code>     强制 PATTERN 仅完全匹配字词</li>
<li><code>-x</code>     强制 PATTERN 仅完全匹配一行</li>
<li><code>-z</code>     一个 0 字节的数据行,但不是空行</li>
</ul>
<p>输出控制:</p>
<ul>
<li><code>-m</code> : 只获得前m个匹配结果</li>
<li><code>-b</code> : 在输出的内容中打印byte offset</li>
<li><code>-n</code> : 输出行号</li>
<li><code>-H</code> : 输出文件名</li>
<li><code>-h</code> : 不输出文件名</li>
<li><code>-o</code> : 仅仅输出一行中符合 PATTERN模式 匹配要求的部分</li>
<li><code>-a</code> : 等同于 –binary-files=text</li>
<li><code>-I</code> : 等同于 –binary-files=without-match</li>
<li><code>-d</code> : 处理目录方式; <code>read&#39;,</code>recurse’, or `skip’</li>
<li><code>-D</code> : 处理 devices, FIFOs and sockets的方式: <code>read&#39; or</code>skip’</li>
<li><code>-R</code> : equivalent to –directories=recurse<blockquote>
<p>   –include=FILE_PATTERN  仅对符合FILE_PATTERN模式的文件进行搜索</p>
<pre><code>--exclude=FILE_PATTERN  跳过符合FILE_PATTERN的文件和目录
--exclude-from=FILE   跳过符合FILE中file pattern所有的文件
--exclude-dir=PATTERN  符合PATTERN模式的目录将被跳过.
</code></pre></blockquote>
</li>
<li><code>-L</code> :  只输出匹配失败的文件名</li>
<li><code>-l</code> : 只输出匹配成功的文件名</li>
<li><code>-c</code> : 只输出每个文件匹配成功的行数</li>
<li><code>-Z</code> : 在文件名后输出0 byte</li>
</ul>
<p>输出行数</p>
<ul>
<li><code>-B, --before-context=NUM</code>  输出匹配的前n行数据</li>
<li><code>-A, --after-context=NUM</code>   输出匹配的后n行数据</li>
<li><code>-C, --context=NUM</code>         输出匹配的前后n行数据</li>
<li><code>-NUM</code>                      和 –context=NUM 一样</li>
</ul>
<p>当前目录下有多个文件我们想要同时对所有文件进行搜索的话, 我们可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep &quot;刷新&quot; *</div></pre></td></tr></table></figure></p>
<p>如果我们只想对今天的文件进行搜索的话, 可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep &quot;刷新&quot; *2016-02-02*</div></pre></td></tr></table></figure></p>
<p>如果我们的目录下有多个目录, 要搜索的文件都在当前的子目录里的话, 可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep --directories=recurse &quot;刷新&quot; *</div></pre></td></tr></table></figure></p>
<p>递归grep所有目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep -r &quot;some_text&quot; /path/to/dir</div></pre></td></tr></table></figure></p>
<p>排除包含字符的行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep -v <span class="string">"22"</span> ./as.txt</div></pre></td></tr></table></figure></p>
<p>包含多个条件中的任意一个(或的关系)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep -E <span class="string">"22222|11111"</span> ./as.txt</div></pre></td></tr></table></figure></p>
<p>输出匹配行的前后俩行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">grep -C 2 <span class="string">'linux'</span></div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/杂记/grep/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/杂记/grep/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/杂记/CheckList/" title="CheckList" itemprop="url">CheckList</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-15T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="FastJSON"><a href="#FastJSON" class="headerlink" title="FastJSON"></a>FastJSON</h2><h3 id="序列化bug"><a href="#序列化bug" class="headerlink" title="序列化bug"></a>序列化bug</h3><p>在项目中运营团队给出了下面这样的一个公告<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">================================================</div><div class="line">官方QQ群： <span class="number">467027422</span></div><div class="line">官方微信号：gm-xyxmp</div><div class="line">微信订阅号：xyxmpsy</div><div class="line"></div><div class="line">亲爱的小伙伴：</div><div class="line"></div><div class="line">大家好，老猪给各位请安了！</div><div class="line"></div><div class="line">首款能交易的<span class="number">3</span>D卡牌游戏，星爷独家正版授权《西游降魔篇<span class="number">3</span>D》</div><div class="line">自<span class="number">2015</span>年<span class="number">7</span>月<span class="number">21</span>日正式登陆iOS平台后，大量玩家热情涌入游戏</div><div class="line">，老猪我面对此景喜极而泣，为了让更多小伙伴加入到咱们的</div><div class="line">大团队中，老猪我决定[FFFF00]<span class="number">10</span>月<span class="number">16</span>日<span class="number">11</span>：<span class="number">00</span>开启新服N23-物华天宝 [-]，</div><div class="line">诚邀各位新老玩家的加入！</div><div class="line"></div><div class="line"></div><div class="line">新服开启，精彩纷呈的活动期待各位的参与，丰厚的大礼拿到手</div><div class="line">抽筋，在《西游降魔篇<span class="number">3</span>D》西行的途中，让我们一同感受友情，</div><div class="line">感受激情，感受无限快乐！</div><div class="line"></div><div class="line">服务器名称：[FFFF00]N23-物华天宝 [-]</div><div class="line">开服时间：[FFFF00]<span class="number">2015</span>年<span class="number">10</span>月<span class="number">16</span>日<span class="number">11</span>：<span class="number">00</span>（周五）[-]</div><div class="line"></div><div class="line"></div><div class="line">伴随开服的同时，多个活动前来助阵！</div><div class="line">[FFFF00]活动一：连续登陆送豪礼[-]</div><div class="line">[FFFF00]活动二：冲级领元宝[-]</div><div class="line">[FFFF00]活动三：战力大比拼[-]</div><div class="line">[FFFF00]活动四：五星神将双倍抽[-]</div><div class="line">[FFFF00]活动五：天天有礼送段小姐[-]</div><div class="line">[FFFF00]活动六：累积充值送玉帝[-]</div><div class="line">[FFFF00]活动七：每日礼包大回馈[-]</div><div class="line">[FFFF00]活动八：首充翻倍送豪礼[-]</div><div class="line">[FFFF00]活动九：签到送好礼[-]</div><div class="line"></div><div class="line"></div><div class="line">活动详情请查看游戏内公告！</div><div class="line">================================================</div><div class="line">                                                            《西游降魔篇<span class="number">3</span>D》运营团队</div></pre></td></tr></table></figure></p>
<p>当我将其赋值到一个对象<code>obj#value</code>时,然后使用<code>JSON.toJSONString(obj)</code>的时候遇到了下面的异常:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Exception in thread <span class="string">"main"</span> java.lang.ArrayIndexOutOfBoundsException: <span class="number">160</span></div><div class="line">	at com.alibaba.fastjson.serializer.SerializeWriter.writeStringWithDoubleQuote(SerializeWriter.java:<span class="number">868</span>)</div><div class="line">	at com.alibaba.fastjson.serializer.SerializeWriter.writeStringWithDoubleQuote(SerializeWriter.java:<span class="number">602</span>)</div><div class="line">	at com.alibaba.fastjson.serializer.SerializeWriter.writeString(SerializeWriter.java:<span class="number">1366</span>)</div><div class="line">	at com.alibaba.fastjson.serializer.StringCodec.write(StringCodec.java:<span class="number">49</span>)</div><div class="line">	at com.alibaba.fastjson.serializer.StringCodec.write(StringCodec.java:<span class="number">34</span>)</div><div class="line">	at com.alibaba.fastjson.serializer.JSONSerializer.write(JSONSerializer.java:<span class="number">369</span>)</div><div class="line">	at com.alibaba.fastjson.JSON.toJSONString(JSON.java:<span class="number">430</span>)</div><div class="line">	at com.alibaba.fastjson.JSON.toJSONString(JSON.java:<span class="number">418</span>)</div><div class="line">	at Print1.main(Print1.java:<span class="number">52</span>)</div></pre></td></tr></table></figure></p>
<p>出现的原因是:<code>服务器名称：[FFFF00]N23-物华天宝 [-]</code>物华天宝后面跟的空格，不是我们常用的ascii码为32的空格，而是一个ascii码为160特殊的空格符,导致JSON序列化时失败.</p>
<h2 id="用户名字符集"><a href="#用户名字符集" class="headerlink" title="用户名字符集"></a>用户名字符集</h2><p>用户可能输入emoji表情符号,这种符号普遍存在iOS与android系统中,这种表情不处理直接存储到MySQL5.5以下的版本会报错</p>
<blockquote>
<p>这种符号采用Unicode 6标准4个bytes作为存储单元,MySQL存储这种字符需要修改数据库字符集为utf8mb4,但数据回传给网页或者移动客户端时则需要做兼容处理</p>
</blockquote>
<h2 id="日志问题"><a href="#日志问题" class="headerlink" title="日志问题"></a>日志问题</h2><p>在项目的开发过程中不允许使用debug模式, 一定要使用日志分析问题, 因为在线上时候, 没办法使用debug的方式, 因此在记录的日志的时候, 一定要记录的全(每个数据变化都要记录下来), 简(剩下来的就是钱)</p>
<h2 id="数据接口都尽量做成数组形式"><a href="#数据接口都尽量做成数组形式" class="headerlink" title="数据接口都尽量做成数组形式"></a>数据接口都尽量做成数组形式</h2><p>这是为了提高拓展性,以防策划将模块提出批处理</p>
<h2 id="代码中不要出现中文"><a href="#代码中不要出现中文" class="headerlink" title="代码中不要出现中文"></a>代码中不要出现中文</h2><p>当要出现中文的时候,可以根据个英文索引到表里查国际化文字.</p>
<p>服务器向客户端提示的时候发送错误号,由客户端进行国际化</p>
<h2 id="客户端打包"><a href="#客户端打包" class="headerlink" title="客户端打包"></a>客户端打包</h2><p>在打包的时候，加上时间和svn版本号，方便渠道确定客户端的版本是一致的</p>
<h2 id="交易类模块"><a href="#交易类模块" class="headerlink" title="交易类模块"></a>交易类模块</h2><p>交易类模块要慎重考虑,玩家可能刷元宝</p>
<h2 id="玩家使用模拟器登录"><a href="#玩家使用模拟器登录" class="headerlink" title="玩家使用模拟器登录"></a>玩家使用模拟器登录</h2><p>这个要做技术处理</p>
<h2 id="id"><a href="#id" class="headerlink" title="id"></a>id</h2><p>项目里边每个模块的ID要是全区唯一的,保证合服顺利</p>
<h2 id="GWF的问题"><a href="#GWF的问题" class="headerlink" title="GWF的问题"></a>GWF的问题</h2><p>参考<a href="http://blog.zhukunqian.com/?p=1377" target="_blank" rel="external">记今天域名和GWF的问题</a></p>
<h2 id="模块次数"><a href="#模块次数" class="headerlink" title="模块次数"></a>模块次数</h2><p>每个模块活动都加一个每日次数限制。例如扫荡类的功能，加一个每日最大扫荡次数，避免出现角色刷货币的情况.</p>
<h2 id="道具"><a href="#道具" class="headerlink" title="道具"></a>道具</h2><ul>
<li>道具信息里添加上获得来源途径信息. 将途径分类, 以区别特殊道具 </li>
</ul>
<h2 id="数据备份"><a href="#数据备份" class="headerlink" title="数据备份"></a>数据备份</h2><p>每天备份玩家数据, 以便后期查bug和回档使用</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/杂记/CheckList/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/杂记/CheckList/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/杂记/Linux cpu信息/" title="Linux io相关" itemprop="url">Linux io相关</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-15T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="pidstat"><a href="#pidstat" class="headerlink" title="pidstat"></a>pidstat</h3><p>监控锁竞争<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[root@cvs /]# pidstat</div><div class="line">Linux 2.6.32-279.el6.x86_64 (cvs)       2015年10月15日  _x86_64_        (8 CPU)</div><div class="line"></div><div class="line">PID    %usr %system  %guest    %CPU   CPU  Command</div></pre></td></tr></table></figure></p>
<p>显式参数</p>
<ul>
<li>PID : 被监控的任务的进程号</li>
<li>%usr :  当在用户层执行(应用程序)时这个任务的cpu使用率，和 nice 优先级无关。注意这个字段计算的cpu时间不包括在虚拟处理器中花去的时间。</li>
<li>%system :  这个任务在系统层使用时的cpu使用率。</li>
<li>%guest ：  任务花费在虚拟机上的cpu使用率（运行在虚拟处理器）。</li>
<li>%CPU ：  任务总的cpu使用率。在SMP环境(多处理器)中，如果在命令行中输入-I参数的话，cpu使用率会除以你的cpu数量。</li>
<li>CPU ： 正在运行这个任务的处理器编号。</li>
<li>Command ： 这个任务的命令名称。</li>
</ul>
<p>参数</p>
<ul>
<li>-u: pidstat将显示各活动进程的cpu使用统计</li>
<li>-p: 我们可以查看特定进程的系统资源使用情况：</li>
<li>-r: pidstat将显示各活动进程的内存使用统计：</li>
<li>-d: 我们可以查看进程IO的统计信息</li>
</ul>
<p>-d:</p>
<ul>
<li>kB_rd/s: 每秒进程从磁盘读取的数据量(以kB为单位)</li>
<li>kB_wr/s: 每秒进程向磁盘写的数据量(以kB为单位)</li>
<li>Command: 拉起进程对应的命令</li>
</ul>
<p>-r:</p>
<ul>
<li>minflt/s: 每秒次缺页错误次数(minor page faults)，次缺页错误次数意即虚拟内存地址映射成物理内存地址产生的page fault次数</li>
<li>majflt/s: 每秒主缺页错误次数(major page faults)，当虚拟内存地址映射成物理内存地址时，相应的page在swap中，这样的page fault为major page fault，一般在内存使用紧张时产生</li>
<li>VSZ:      该进程使用的虚拟内存(以kB为单位)</li>
<li>RSS:      该进程使用的物理内存(以kB为单位)</li>
<li>%MEM:     该进程使用内存的百分比</li>
<li>Command:  拉起进程对应的命令</li>
</ul>
<h2 id="proc-cpuinfo"><a href="#proc-cpuinfo" class="headerlink" title="/proc/cpuinfo"></a>/proc/cpuinfo</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">[root@cvs /]# cat /proc/cpuinfo</div><div class="line">processor       : 0</div><div class="line">vendor_id       : GenuineIntel</div><div class="line">cpu family      : 6</div><div class="line">model           : 45</div><div class="line">model name      : Intel(R) Xeon(R) CPU E5-2603 0 @ 1.80GHz</div><div class="line">stepping        : 7</div><div class="line">cpu MHz         : 1800.009</div><div class="line">cache size      : 10240 KB</div><div class="line">physical id     : 0</div><div class="line">siblings        : 4</div><div class="line">core id         : 0</div><div class="line">cpu cores       : 4</div><div class="line">apicid          : 0</div><div class="line">initial apicid  : 0</div><div class="line">fpu             : yes</div><div class="line">fpu_exception   : yes</div><div class="line">cpuid level     : 13</div><div class="line">wp              : yes</div><div class="line">flags           : fpu vme de pse tsc msr pae mce ...</div><div class="line">bogomips        : 3600.01</div><div class="line">clflush size    : 64</div><div class="line">cache_alignment : 64</div><div class="line">address sizes   : 46 bits physical, 48 bits virtual</div><div class="line">power management:</div></pre></td></tr></table></figure>
<ul>
<li><code>processor</code>       : CPU号</li>
<li><code>vendor_id</code>       : CPU制造商   </li>
<li><code>cpu family</code>      : CPU产品系列代号</li>
<li><code>model</code>           : CPU属于其系列中的哪一代的代号</li>
<li><code>model name</code>      : CPU属于的名字及其编号、标称主频</li>
<li><code>stepping</code>        : CPU属于制作更新版本</li>
<li><code>cpu MHz</code>         : CPU的实际使用主频</li>
<li><code>cache size</code>      : CPU二级缓存大小</li>
<li><code>physical id</code>     : 单个CPU的标号</li>
<li><code>siblings</code>        : 单个CPU逻辑物理核数</li>
<li><code>core id</code>         : 当前物理核在其所处CPU中的编号，这个编号不一定连续</li>
<li><code>cpu cores</code>       : 该逻辑核所处CPU的物理核数</li>
<li><code>apicid</code>          : 用来区分不同逻辑核的编号，系统中每个逻辑核的此编号必然不同，此编号不一定连续</li>
<li><code>initial apicid</code>  :</li>
<li><code>fpu</code>             : 是否具有浮点运算单元（Floating Point Unit）</li>
<li><code>fpu_exception</code>   : 是否支持浮点计算异常</li>
<li><code>cpuid level</code>     : 执行cpuid指令前，eax寄存器中的值，根据不同的值cpuid指令会返回不同的内容</li>
<li><code>wp</code>              : 表明当前CPU是否在内核态支持对用户空间的写保护（Write Protection）</li>
<li><code>flags</code>           : 当前CPU支持的功能</li>
<li><code>bogomips</code>        : 在系统内核启动时粗略测算的CPU速度（Million Instructions Per Second）</li>
<li><code>clflush size</code>    : 每次刷新缓存的大小单位</li>
<li><code>cache_alignment</code> : 缓存地址对齐单位</li>
<li><code>address sizes</code>   : 可访问地址空间位数</li>
<li><code>power management</code>: 对能源管理的支持，有以下几个可选支持功能</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/杂记/Linux cpu信息/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/杂记/Linux cpu信息/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/杂记/Linux常用命令/" title="Linux常用命令" itemprop="url">Linux常用命令</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-15T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="gzip"><a href="#gzip" class="headerlink" title="gzip"></a>gzip</h2><p>将文件或者文件夹压缩成后缀为<code>.gz</code>的文件</p>
<ul>
<li><code>-a</code> 　使用ASCII文字模式.</li>
<li><code>-c</code> 　把压缩后的文件输出到标准输出设备,不去更动原始文件.</li>
<li><code>-d</code> 　解开压缩文件.</li>
<li><code>-f</code> 　强行压缩文件.不理会文件名称或硬连接是否存在以及该文件是否为符号连接.</li>
<li><code>-l</code> 　列出压缩文件的相关信息.</li>
<li><code>-L</code> 　显示版本与版权信息.</li>
<li><code>-n</code> 　压缩文件时,不保存原来的文件名称及时间戳记.</li>
<li><code>-N</code> 　压缩文件时,保存原来的文件名称及时间戳记.</li>
<li><code>-q</code> 　不显示警告信息.</li>
<li><code>-r</code> 　递归处理,将指定目录下的所有文件及子目录一并处理.</li>
<li><code>-S</code> 　更改压缩字尾字符串.</li>
<li><code>-t</code> 　测试压缩文件是否正确无误.</li>
<li><code>-v</code> 　显示指令执行过程.</li>
<li><code>-num</code> 用指定的数字num调整压缩的速度,-1或–fast表示最快压缩方法（低压缩比）,-9或–best表示最慢压缩方法（高压缩比）.系统缺省值为6.</li>
</ul>
<p>常用命令</p>
<ul>
<li><code>gzip *</code>  把test6目录下的每个文件压缩成.gz文件</li>
<li><code>gzip -dv *</code> 把例1中每个压缩的文件解压,并列出详细的信息</li>
<li><code>gzip -l *</code> 详细显示例1中每个压缩的文件的信息,并不解压</li>
<li><code>gzip -r log.tar</code> 压缩一个tar备份文件,此时压缩文件的扩展名为.tar.gz</li>
<li><code>gzip -rv test6</code> 递归的压缩目录</li>
<li><code>gzip -dr test6</code> 递归地解压目录</li>
</ul>
<h2 id="tar"><a href="#tar" class="headerlink" title="tar"></a>tar</h2><p>tar可用于建立,还原,查看,管理文件,也可方 便的追加新文件到备份文件中,或仅更新部分的备份文件,以及解压,删除指定的文件</p>
<p>将tar.gz提取到新目录里：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar zxvf package.tar.gz -C new_dir</div></pre></td></tr></table></figure></p>
<p>将small目录压缩到small.tar.gz里<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -czf small.tar.gz small</div></pre></td></tr></table></figure></p>
<p>压缩为zip, 且忽略指定目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">tar -zcvf  web.zip --exclude=&quot;restful&quot; web/</div></pre></td></tr></table></figure></p>
<blockquote>
<p>–exclude=”restful”  一定要放在压缩文件和被压缩文件夹之间</p>
</blockquote>
<h2 id="sort"><a href="#sort" class="headerlink" title="sort"></a>sort</h2><p>sort将文件的每一行作为一个单位,相互比较,比较原则是从首字符向后,依次按ASCII码值进行比较,最后将他们按升序输出.</p>
<p>命令参数</p>
<ul>
<li><code>-u</code> 在输出行中去除重复行.</li>
<li><code>-r</code> sort默认的排序方式是升序,加-r改成降序</li>
<li><code>-o</code> 将排序结果输出到原文件,而使用重定向是不可以的.</li>
<li><code>-n</code> sort命令默认是按照字符排序的,如果遇到数字的字符, 可能会出现1大于10的情况, 所以我们可以设定<code>-n</code>选项, 将其按照数字排序</li>
<li><code>-t</code> 设定间隔符. 设置间隔符,就会将每一行分割成一个数组,我们可以使用-k参数指定按照某列排序</li>
<li><code>-k</code> -t指定了间隔符之后,可以用-k指定基于某列排序.</li>
<li><code>-f</code> 会将小写字母都转换为大写字母来进行比较,亦即忽略大小写</li>
<li><code>-c</code> 会检查文件是否已排好序,如果乱序,则输出第一个乱序的行的相关信息,最后返回1</li>
<li><code>-C</code> 会检查文件是否已排好序,如果乱序,不输出内容,仅返回1</li>
<li><code>-M</code> 会以月份来排序,比如JAN小于FEB等等</li>
<li><code>-b</code> 会忽略每一行前面的所有空白部分,从第一个可见字符开始比较.</li>
</ul>
<h2 id="wc"><a href="#wc" class="headerlink" title="wc"></a>wc</h2><p>统计指定文件中的字节数,字数,行数,并将统计结果显示输出.该命令统计指定文件中的字节数,字数,行数.如果没有给出文件名,则从标准输入读取.wc同时也给出所指定文件的总统计数.</p>
<ul>
<li><code>-c</code> 统计字节数.</li>
<li><code>-l</code> 统计行数.</li>
<li><code>-m</code> 统计字符数.这个标志不能与 -c 标志一起使用.</li>
<li><code>-w</code> 统计字数.一个字被定义为由空白,跳格或换行字符分隔的字符串.</li>
<li><code>-L</code> 打印最长行的长度.</li>
</ul>
<h2 id="find"><a href="#find" class="headerlink" title="find"></a>find</h2><p><code>find pathname -options [-print -exec -ok ...]</code></p>
<p>命令参数；<br><code>pathname</code>: 要查找的路径.<br><code>-print</code>： find命令将匹配的文件输出到标准输出.<br><code>-exec</code>： 匹配到合适文件后执行的shell命令.相应命令的形式为<code>&#39;command&#39; { } ;</code>(注意{ }和；之间的空格).<br><code>-ok</code>： 和-exec的作用相同,但是在执行命令之前,都会给出提示确认是否真的执行.</p>
<p>options选项</p>
<ul>
<li><code>-name</code> 要查找的文件名(可以使用正则).</li>
<li><code>-perm</code> 按照文件权限查找文件.</li>
<li><code>-prune</code> 使用这一选项可以使find命令不在当前指定的目录中查找,如果同时使用-depth选项,那么-prune将被find命令忽略.</li>
<li><code>-user</code> 按照文件属主来查找文件.</li>
<li><code>-group</code> 按照文件所属的组来查找文件.</li>
<li><code>-mtime -n +n</code> 按照文件的更改时间来查找文件, - n表示文件更改时间距现在n天以内,+ n表示文件更改时间距现在n天以前.</li>
<li><code>-nogroup</code> 查找无有效所属组的文件,即该文件所属的组在/etc/groups中不存在.</li>
<li><code>-nouser</code> 查找无有效属主的文件,即该文件的属主在/etc/passwd中不存在.</li>
<li><code>-newer file1 ! file2</code> 查找更改时间比文件file1新但比文件file2旧的文件.</li>
<li><code>-type</code> 查找某一类型的文件(例如: <code>-b</code>块设备文件. <code>-d</code>目录. <code>-c</code>字符设备文件. <code>-p</code>管道文件. <code>-l</code>符号链接文件. <code>-f</code>普通文件.)</li>
<li><code>-size n [c]</code>：查找文件长度为n块的文件,带有c时表示文件长度以字节计.</li>
<li><code>-depth</code>：在查找文件时,首先查找当前目录中的文件,然后再在其子目录中查找.</li>
<li><code>-mount</code>：在查找文件时不跨越文件系统mount点.</li>
<li><code>-follow</code>：如果find命令遇到符号链接文件,就跟踪至链接所指向的文件.</li>
</ul>
<p>另外,下面三个的区别:</p>
<ul>
<li><code>-amin n</code>  查找系统中最后N分钟访问的文件</li>
<li><code>-atime n</code> 查找系统中最后n*24小时访问的文件</li>
<li><code>-cmin n</code>  查找系统中最后N分钟被改变文件状态的文件</li>
<li><code>-ctime n</code> 查找系统中最后n*24小时被改变文件状态的文件</li>
<li><code>-mmin n</code>  查找系统中最后N分钟被改变文件数据的文件</li>
<li><code>-mtime n</code> 查找系统中最后n*24小时被改变文件数据的文件<br>找出/home/user下所有空子目录：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find /home/user -maxdepth 1 -type d -empty</div></pre></td></tr></table></figure>
</li>
</ul>
<p>获取test.txt文件中第50-60行内容：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">&lt; test.txt sed -n &apos;50,60p&apos;</div></pre></td></tr></table></figure></p>
<p>将所有文件名中含有”txt”的文件移入/home/user目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">find -iname &quot;*txt*&quot; -exec mv -v &#123;&#125; /home/user \;</div></pre></td></tr></table></figure></p>
<h2 id="cat-more-less"><a href="#cat-more-less" class="headerlink" title="cat,more,less"></a>cat,more,less</h2><ul>
<li>cat是一次性显示整个文件的内容,还可以将多个文件连接起来显示,它常与重定向符号配合使用,适用于文件内容少的情况；</li>
<li>more比cat强大,提供分页显示的功能</li>
<li>less比more更强大,提供翻页,跳转,查找等命令.</li>
</ul>
<h2 id="source"><a href="#source" class="headerlink" title="source"></a>source</h2><ol>
<li>当shell脚本具有可执行权限时,用sh filename与./filename执行脚本是没有区别得../filename是因为当前目录没有在PATH中,所有”.”是用来表示当前目录的.</li>
<li>sh filename 重新建立一个子shell,在子shell中执行脚本里面的语句,该子shell继承父shell的环境变量,但子shell新建的,改变的变量不会被带回父shell,除非使用export.</li>
<li>source filename：这个命令其实只是简单地读取脚本里面的语句依次在当前shell里面执行,没有建立新的子shell.那么脚本里面所有新建,改变变量的语句都会保存在当前shell里面.</li>
</ol>
<h2 id="wget"><a href="#wget" class="headerlink" title="wget"></a>wget</h2><p>用wget抓取完整的网站目录结构,存放到本地目录中：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">wget -r --no-parent --reject &quot;index.html*&quot; http://hostname/ -P /home/user/dirs</div></pre></td></tr></table></figure></p>
<p>用wget命令执行ftp下载：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">wget -m ftp:</div><div class="line">//username:password@hostname</div></pre></td></tr></table></figure></p>
<h2 id="mkdir"><a href="#mkdir" class="headerlink" title="mkdir"></a>mkdir</h2><p>一次创建多个目录：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mkdir -p /home/user/&#123;test,test1,test2&#125;</div></pre></td></tr></table></figure></p>
<h2 id="ps"><a href="#ps" class="headerlink" title="ps"></a>ps</h2><p>列出包括子进程的进程树：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ps axwef</div></pre></td></tr></table></figure></p>
<h2 id="dd"><a href="#dd" class="headerlink" title="dd"></a>dd</h2><p>测试硬盘写入速度：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">dd if=/dev/zero of=/tmp/output.img bs=8k count=256k; rm -rf /tmp/output.img</div></pre></td></tr></table></figure></p>
<p>测试硬盘读取速度：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hdparm -Tt /dev/sda</div></pre></td></tr></table></figure></p>
<h2 id="xmllint"><a href="#xmllint" class="headerlink" title="xmllint"></a>xmllint</h2><p>检查xml格式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xmllint --noout file.xml</div></pre></td></tr></table></figure></p>
<h2 id="curl"><a href="#curl" class="headerlink" title="curl"></a>curl</h2><p>使用curl获取HTTP头信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -I http://www.example.com</div></pre></td></tr></table></figure></p>
<p>指定header<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl --header &quot;Auth: none&quot; http://www.example.com</div></pre></td></tr></table></figure></p>
<p>POST请求<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -d &quot;user=test&amp;time=now&quot; http://www.example.com</div></pre></td></tr></table></figure></p>
<h2 id="touch"><a href="#touch" class="headerlink" title="touch"></a>touch</h2><p>修改文件或目录的时间戳(YYMMDDhhmm)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">touch -t 0712250000 file</div></pre></td></tr></table></figure></p>
<h2 id="cp"><a href="#cp" class="headerlink" title="cp"></a>cp</h2><p>快速备份一个文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cp some_file_name&#123;,.bkp&#125;</div></pre></td></tr></table></figure></p>
<h2 id="watch"><a href="#watch" class="headerlink" title="watch"></a>watch</h2><p>重复运行文件,显示其输出（缺省是2秒一次）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">watch ps -ef</div></pre></td></tr></table></figure></p>
<h2 id="lsof"><a href="#lsof" class="headerlink" title="lsof"></a>lsof</h2><p>列出前10个最大的文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">lsof / | awk &apos;&#123; if($7 &gt; 1048576) print $7/1048576 &quot;MB &quot;$9 &#125;&apos; | sort -n -u | tail</div></pre></td></tr></table></figure></p>
<h2 id="free"><a href="#free" class="headerlink" title="free"></a>free</h2><p>显示剩余内存(MB)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">free -m | grep cache | awk &apos;/[0-9]/&#123; print $4&quot; MB&quot; &#125;&apos;</div></pre></td></tr></table></figure></p>
<h2 id="paste"><a href="#paste" class="headerlink" title="paste"></a>paste</h2><p>将文件按行并列显示：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">paste test.txt test1.txt</div></pre></td></tr></table></figure></p>
<h2 id="pv"><a href="#pv" class="headerlink" title="pv"></a>pv</h2><p>shell里的进度条：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pv data.log</div></pre></td></tr></table></figure></p>
<h2 id="scp"><a href="#scp" class="headerlink" title="scp"></a>scp</h2><p>文件复制：本机-&gt;远程服务器：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp /home/shaoxiaohu/test1.txt shaoxiaohu@172.16.18.1:/home/test2.txt</div></pre></td></tr></table></figure></p>
<blockquote>
<p>其中，test1为源文件，test2为目标文件，shaoxiaohu@172.16.18.1为远程服务器的用户名和ip地址。</p>
</blockquote>
<p>文件复制：远程服务器-&gt;本机<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">scp shaoxiaohu@172.16.18.2:/home/test2.txt /home/shaoxiaohu/test1.txt</div></pre></td></tr></table></figure></p>
<blockquote>
<p>其中，haoxiaohu@172.16.18.2为远程服务器的用户名和ip地址， test2为源文件，test1为目标路径</p>
</blockquote>
<p>文件夹复制, 在scp命令后加<code>-r</code>参数即可。</p>
<p>端口号, 如果端口号有更改，需在scp 后输入：<code>-P</code> 端口号 （注意是大写，ssh的命令中 <code>-p</code>是小写）。</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/杂记/Linux常用命令/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/杂记/Linux常用命令/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/杂记/linux系统文件/" title="Linux CPU信息" itemprop="url">Linux CPU信息</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-15T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h3 id="iostat"><a href="#iostat" class="headerlink" title="iostat"></a>iostat</h3><p>iostat用于输出CPU和磁盘I/O相关的统计信息.</p>
<ul>
<li><code>-c</code> 仅显示CPU统计信息.与-d选项互斥.</li>
<li><code>-d</code> 仅显示磁盘统计信息.与-c选项互斥.</li>
<li><code>-k</code> 以K为单位显示每秒的磁盘请求数,默认单位块.</li>
<li><code>-p device | ALL</code>  与-x选项互斥,用于显示块设备及系统分区的统计信息.也可以在-p后指定一个设备名,如:<code>iostat -p hda</code> 或显示所有设备<code>iostat -p ALL</code></li>
<li><code>-t</code>    在输出数据时,打印搜集数据的时间.</li>
<li><code>-V</code>    打印版本号和帮助信息.</li>
<li><code>-x</code>    输出扩展信息.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[root@cvs /]# iostat</div><div class="line">Linux 2.6.32-279.el6.x86_64 (cvs)       2015年10月16日  _x86_64_        (8 CPU)</div><div class="line"></div><div class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</div><div class="line">           1.67    0.00    0.21    0.38    0.00   97.74</div><div class="line"></div><div class="line">Device:            tps   Blk_read/s   Blk_wrtn/s   Blk_read   Blk_wrtn</div><div class="line">sda              18.64        72.79       512.65  951732770 6702726216</div></pre></td></tr></table></figure>
<p>avg-cpu:  </p>
<ul>
<li><code>%user</code>: 在用户级别运行所使用的CPU的百分比.</li>
<li><code>%nice</code>: nice操作所使用的CPU的百分比.</li>
<li><code>%system</code>: 在系统级别(kernel)运行所使用CPU的百分比.</li>
<li><code>%iowait</code>: CPU等待硬件I/O时,所占用CPU百分比.</li>
<li><code>%steal</code>:</li>
<li><code>%idle</code>: CPU空闲时间的百分比.</li>
</ul>
<p>Device:            </p>
<ul>
<li><code>tps</code>: 每秒钟发送到的I/O请求数.</li>
<li><code>Blk_read/s</code>: 每秒读取的block数.</li>
<li><code>Blk_wrtn/s</code>: 每秒写入的block数.</li>
<li><code>Blk_read</code>: 读入的block总数.</li>
<li><code>Blk_wrtn</code>: 写入的block总数.</li>
</ul>
<ul>
<li><code>Blk_read</code> 读入块的当总数.</li>
<li><code>Blk_wrtn</code> 写入块的总数.</li>
<li><code>kB_read/s</code> 每秒从驱动器读入的数据量,单位为K.</li>
<li><code>kB_wrtn/s</code> 每秒向驱动器写入的数据量,单位为K.</li>
<li><code>kB_read</code> 读入的数据总量,单位为K.</li>
<li><code>kB_wrtn</code> 写入的数据总量,单位为K.</li>
<li><code>rrqm/s</code>  将读入请求合并后,每秒发送到设备的读入请求数.</li>
<li><code>wrqm/s</code>  将写入请求合并后,每秒发送到设备的写入请求数.</li>
<li><code>r/s</code>     每秒发送到设备的读入请求数.</li>
<li><code>w/s</code>     每秒发送到设备的写入请求数.</li>
<li><code>rsec/s</code>  每秒从设备读入的扇区数.</li>
<li><code>wsec/s</code>  每秒向设备写入的扇区数.</li>
<li><code>rkB/s</code>  每秒从设备读入的数据量,单位为K.</li>
<li><code>wkB/s</code>  每秒向设备写入的数据量,单位为K.</li>
<li><code>avgrq-sz</code>  发送到设备的请求的平均大小,单位是扇区.</li>
<li><code>avgqu-sz</code> 发送到设备的请求的平均队列长度.</li>
<li><code>await</code>  I/O请求平均执行时间.包括发送请求和执行的时间.单位是毫秒.</li>
<li><code>svctm</code> 发送到设备的I/O请求的平均执行时间.单位是毫秒.</li>
<li><code>%util</code>  在I/O请求发送到设备期间,占用CPU时间的百分比.用于显示设备的带宽利用率.当这个值接近100%时,表示设备带宽已经占满.</li>
</ul>
<h3 id="uname"><a href="#uname" class="headerlink" title="uname"></a>uname</h3><ul>
<li><code>-a</code> 　显示全部的信息。</li>
<li><code>-m</code>　显示电脑类型。</li>
<li><code>-n</code>　显示在网络上的主机名称。</li>
<li><code>-r</code>　显示操作系统的发行编号。</li>
<li><code>-s</code>　显示操作系统名称。</li>
<li><code>-v</code> 　显示操作系统的版本。<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@test game]# uname -a</div><div class="line">Linux test 2.6.32-431.el6.x86_64 #1 SMP Fri Nov 22 03:15:09 UTC 2013 x86_64 x86_64 x86_64 GNU/Linux</div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>查看发行版本 <code>cat /etc/issue</code></p>
</blockquote>
<h3 id="df"><a href="#df" class="headerlink" title="df"></a>df</h3><p>检查文件系统的磁盘空间占用情况</p>
<ul>
<li><code>-a</code> 显示所有文件系统的磁盘使用情况，包括0块（block）的文件系统，如/proc文件系统。</li>
<li><code>-k</code> 以k字节为单位显示。</li>
<li><code>-i</code> 显示i节点信息，而不是磁盘块。</li>
<li><code>-t</code> 显示各指定类型的文件系统的磁盘空间使用情况。</li>
<li><code>-x</code> 列出不是某一指定类型文件系统的磁盘空间使用情况（与t选项相反）。</li>
<li><code>-T</code> 显示文件系统类型。<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">文件系统                 1K-块      已用      可用 已用% 挂载点</div><div class="line">/dev/sda2             10079084   6660892   2906192  70% /</div><div class="line">tmpfs                  8141376         0   8141376   0% /dev/shm</div><div class="line">/dev/sda1             10079084    173308   9393776   2% /boot</div><div class="line">/dev/sda5            257592732 241557292   2950464  99% /opt</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="du"><a href="#du" class="headerlink" title="du"></a>du</h3><p>显示每个文件和目录的磁盘使用空间。</p>
<ul>
<li><code>-a或-all</code>  显示目录中个别文件的大小。   </li>
<li><code>-b或-bytes</code>  显示目录或文件大小时，以byte为单位。   </li>
<li><code>-c或--total</code>  除了显示个别目录或文件的大小外，同时也显示所有目录或文件的总和。</li>
<li><code>-k或--kilobytes</code>  以KB(1024bytes)为单位输出。</li>
<li><code>-m或--megabytes</code>  以MB为单位输出。   </li>
<li><code>-s或--summarize</code>  仅显示总计，只列出最后加总的值。</li>
<li><code>-h或--human-readable</code>  以K，M，G为单位，提高信息的可读性。</li>
<li><code>-x或--one-file-xystem</code>  以一开始处理时的文件系统为准，若遇上其它不同的文件系统目录则略过。</li>
<li><code>-L&lt;符号链接&gt;或--dereference&lt;符号链接&gt;</code> 显示选项中所指定符号链接的源文件大小。   </li>
<li><code>-S或--separate-dirs</code>   显示个别目录的大小时，并不含其子目录的大小。</li>
<li><code>-X&lt;文件&gt;或--exclude-from=&lt;文件&gt;</code>  在&lt;文件&gt;指定目录或文件。   </li>
<li><code>--exclude=&lt;目录或文件&gt;</code>         略过指定的目录或文件。    </li>
<li><code>-D或--dereference-args</code>   显示指定符号链接的源文件大小。   </li>
<li><code>-H或--si</code>  与-h参数相同，但是K，M，G是以1000为换算单位。   </li>
<li><code>-l或--count-links</code>   重复计算硬件链接的文件。  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 对当前目前下所有文件按文件大小倒排序，大小相同按文件名字母倒排序</div><div class="line">du -ak | sort -t$&apos;\t&apos; -l1 -nr -k2 -r</div></pre></td></tr></table></figure>
</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/杂记/linux系统文件/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/杂记/linux系统文件/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/15/算法/自旋锁/" title="自旋锁" itemprop="url">自旋锁</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-15T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-15</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="自旋锁spinlock"><a href="#自旋锁spinlock" class="headerlink" title="自旋锁spinlock"></a>自旋锁spinlock</h1><p>自旋锁是指当一个线程尝试获取某个锁时，如果该锁已被其他线程占用，就一直循环检测锁是否被释放，而不是进入线程挂起或睡眠状态。<br>自旋锁适用于锁保护的临界区很小的情况，临界区很小的话，锁占用的时间就很短。<br>SimpleSpinLock里有一个owner属性持有锁当前拥有者的线程的引用，如果该引用为null，则表示锁未被占用，不为null则被占用。<br>这里用AtomicReference是为了使用它的原子性的compareAndSet方法（CAS操作），<br>解决了多线程并发操作导致数据不一致的问题，确保其他线程可以看到锁的真实状态。<br>缺点<br>CAS操作需要硬件的配合；<br>保证各个CPU的缓存（L1、L2、L3、跨CPU Socket、主存）的数据一致性，通讯开销很大，在多处理器系统上更严重；<br>没法保证公平性，不保证等待进程/线程按照FIFO顺序获得锁。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Spinlock</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> AtomicReference&lt;Thread&gt; owner = <span class="keyword">new</span> AtomicReference&lt;Thread&gt;();</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</div><div class="line">		Thread currentThread = Thread.currentThread();</div><div class="line"></div><div class="line">		<span class="comment">// 如果锁未被占用，则设置当前线程为锁的拥有者</span></div><div class="line">		<span class="keyword">while</span> (owner.compareAndSet(<span class="keyword">null</span>, currentThread)) &#123;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</div><div class="line">		Thread currentThread = Thread.currentThread();</div><div class="line"></div><div class="line">		<span class="comment">// 只有锁的拥有者才能释放锁</span></div><div class="line">		owner.compareAndSet(currentThread, <span class="keyword">null</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="TicketSpinLock"><a href="#TicketSpinLock" class="headerlink" title="TicketSpinLock"></a>TicketSpinLock</h1><p>Ticket Lock 是为了解决上面的公平性问题，类似于现实中银行柜台的排队叫号：<br>锁拥有一个服务号，表示正在服务的线程，还有一个排队号；每个线程尝试获取锁之前先拿一个排队号，<br>然后不断轮询锁的当前服务号是否是自己的排队号，如果是，则表示自己拥有了锁，不是则继续轮询。</p>
<p>当线程释放锁时，将服务号加1，这样下一个线程看到这个变化，就退出自旋。<br>Ticket Lock 虽然解决了公平性的问题，但是多处理器系统上，每个进程/线程占用的处理器都在读写同一个变量serviceNum ，<br>每次读写操作都必须在多个处理器缓存之间进行缓存同步，这会导致繁重的系统总线和内存的流量，大大降低系统整体的性能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketSpinLock</span> </span>&#123;</div><div class="line">   <span class="keyword">private</span> AtomicInteger serviceNum = <span class="keyword">new</span> AtomicInteger(); <span class="comment">// 服务号</span></div><div class="line">   <span class="keyword">private</span> AtomicInteger ticketNum = <span class="keyword">new</span> AtomicInteger(); <span class="comment">// 排队号</span></div><div class="line"></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</div><div class="line">         <span class="comment">// 首先原子性地获得一个排队号</span></div><div class="line">         <span class="keyword">int</span> myTicketNum = ticketNum.getAndIncrement();</div><div class="line"></div><div class="line">              <span class="comment">// 只要当前服务号不是自己的就不断轮询</span></div><div class="line">       <span class="keyword">while</span> (serviceNum.get() != myTicketNum) &#123;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">return</span> myTicketNum;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">(<span class="keyword">int</span> myTicket)</span> </span>&#123;</div><div class="line">        <span class="comment">// 只有当前线程拥有者才能释放锁</span></div><div class="line">        <span class="keyword">int</span> next = myTicket + <span class="number">1</span>;</div><div class="line">        serviceNum.compareAndSet(myTicket, next);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="CLHSpinLock"><a href="#CLHSpinLock" class="headerlink" title="CLHSpinLock"></a>CLHSpinLock</h1><p>CLH锁也是一种基于链表的可扩展、高性能、公平的自旋锁，申请线程只在本地变量上自旋，<br>它不断轮询前驱的状态，如果发现前驱释放了锁就结束自旋。<br> <em><br>差异：
 </em><br> 从代码实现来看，CLH比MCS要简单得多。<br> 从自旋的条件来看，CLH是在本地变量上自旋，MCS是自旋在其他对象的属性。<br> 从链表队列来看，CLH的队列是隐式的，CLHNode并不实际持有下一个节点；MCS的队列是物理存在的。<br> CLH锁释放时只需要改变自己的属性，MCS锁释放则需要改变后继节点的属性。<br> 注意：这里实现的锁都是独占的，且不能重入的。</p>
 <figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CLHSpinLock</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">CLHNode</span> </span>&#123;</div><div class="line">		<span class="keyword">private</span> <span class="keyword">boolean</span> isLocked = <span class="keyword">true</span>; <span class="comment">// 默认是在等待锁</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@SuppressWarnings</span>(<span class="string">"unused"</span>)</div><div class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> CLHNode tail;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicReferenceFieldUpdater&lt;CLHSpinLock, CLHNode&gt; UPDATER = AtomicReferenceFieldUpdater</div><div class="line">			.newUpdater(CLHSpinLock.class, CLHNode.class, <span class="string">"tail"</span>);</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">(CLHNode currentThread)</span> </span>&#123;</div><div class="line">		CLHNode preNode = UPDATER.getAndSet(<span class="keyword">this</span>, currentThread);</div><div class="line">		<span class="keyword">if</span> (preNode != <span class="keyword">null</span>) &#123;<span class="comment">// 已有线程占用了锁，进入自旋</span></div><div class="line">			<span class="keyword">while</span> (preNode.isLocked) &#123;</div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">(CLHNode currentThread)</span> </span>&#123;</div><div class="line">		<span class="comment">// 如果队列里只有当前线程，则释放对当前线程的引用（for GC）。</span></div><div class="line">		<span class="keyword">if</span> (!UPDATER.compareAndSet(<span class="keyword">this</span>, currentThread, <span class="keyword">null</span>)) &#123;</div><div class="line">			<span class="comment">// 还有后续线程</span></div><div class="line">			currentThread.isLocked = <span class="keyword">false</span>;<span class="comment">// 改变状态，让后续线程结束自旋</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="MCSSpinLock"><a href="#MCSSpinLock" class="headerlink" title="MCSSpinLock"></a>MCSSpinLock</h1><p>MCS Spinlock 是一种基于链表的可扩展、高性能、公平的自旋锁，申请线程只在本地变量上自旋，直接前驱负责通知其结束自旋，从而极大地减少了不必要的处理器缓存同步的次数，降低了总线和内存的开销。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MCSSpinLock</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MCSNode</span> </span>&#123;</div><div class="line">		<span class="keyword">volatile</span> MCSNode next;</div><div class="line">		<span class="keyword">volatile</span> <span class="keyword">boolean</span> isLocked = <span class="keyword">true</span>; <span class="comment">// 默认是在等待锁</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">volatile</span> MCSNode queue;<span class="comment">// 指向最后一个申请锁的MCSNode</span></div><div class="line">	<span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> AtomicReferenceFieldUpdater&lt;MCSSpinLock, MCSNode&gt; UPDATER = AtomicReferenceFieldUpdater</div><div class="line">			.newUpdater(MCSSpinLock.class, MCSNode.class, <span class="string">"queue"</span>);</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">(MCSNode currentThread)</span> </span>&#123;</div><div class="line">		MCSNode predecessor = UPDATER.getAndSet(<span class="keyword">this</span>, currentThread);<span class="comment">// step 1</span></div><div class="line">		<span class="keyword">if</span> (predecessor != <span class="keyword">null</span>) &#123;</div><div class="line">			predecessor.next = currentThread;<span class="comment">// step 2</span></div><div class="line"></div><div class="line">			<span class="keyword">while</span> (currentThread.isLocked) &#123;<span class="comment">// step 3</span></div><div class="line">			&#125;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">(MCSNode currentThread)</span> </span>&#123;</div><div class="line">		<span class="keyword">if</span> (UPDATER.get(<span class="keyword">this</span>) == currentThread) &#123;<span class="comment">// 锁拥有者进行释放锁才有意义</span></div><div class="line">			<span class="keyword">if</span> (currentThread.next == <span class="keyword">null</span>) &#123;<span class="comment">// 检查是否有人排在自己后面</span></div><div class="line">				<span class="keyword">if</span> (UPDATER.compareAndSet(<span class="keyword">this</span>, currentThread, <span class="keyword">null</span>)) &#123;<span class="comment">// step 4</span></div><div class="line">					<span class="comment">// compareAndSet返回true表示确实没有人排在自己后面</span></div><div class="line">					<span class="keyword">return</span>;</div><div class="line">				&#125; <span class="keyword">else</span> &#123;</div><div class="line">					<span class="comment">// 突然有人排在自己后面了，可能还不知道是谁，下面是等待后续者</span></div><div class="line">					<span class="comment">// 这里之所以要忙等是因为：step 1执行完后，step 2可能还没执行完</span></div><div class="line">					<span class="keyword">while</span> (currentThread.next == <span class="keyword">null</span>) &#123; <span class="comment">// step 5</span></div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line"></div><div class="line">			currentThread.next.isLocked = <span class="keyword">false</span>;</div><div class="line">			currentThread.next = <span class="keyword">null</span>;<span class="comment">// for GC</span></div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/15/算法/自旋锁/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/15/算法/自旋锁/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/12/算法/1_1_双线程锁/" title="双线程锁" itemprop="url">双线程锁</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-12T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-12</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>所谓的双线程锁指的是这种锁适用于俩个线程运行的前提下. 下面我们依次给出了三种双线程锁解决方案：</p>
<p>双线程算法遵循以下俩点约定:</p>
<ol>
<li>线程标志为<code>0</code>或者<code>1</code>. 若当前线程调用者的标志为i,则另一方的调用者为1 - i</li>
<li>通过ThreadId.get()获取自己的标志</li>
</ol>
<ul>
<li>互斥: 俩个线程的临界区是没有重叠的,那么我们撑这俩个临界区是互斥的.</li>
<li>无死锁: 如果一个线程尝试获得一个锁,那么总会成功获得这个锁.</li>
<li>无饥饿：每一个尝试获得锁的线程都能成功. 当线程调用一个锁方法的时候,这个方法立即返回,我们便称这个锁是无饥饿的.</li>
</ul>
<h2 id="LockOne"><a href="#LockOne" class="headerlink" title="LockOne"></a>LockOne</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LockOne</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span>[] flags = <span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">2</span>];</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> i = ThreadID.get();</div><div class="line">		<span class="keyword">int</span> j = <span class="number">1</span>- i;</div><div class="line">		flag[i] = <span class="keyword">true</span>;</div><div class="line">		<span class="keyword">while</span>(flag[j]) &#123;&#125;		</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> i = ThreadID.get();</div><div class="line">		flag[i] = <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>假设线程A对应flag[0]标志,线程B对应flag[1]标志,那么我们得出下面这一个流程:</p>
<ol>
<li><code>write_A(flag[0] = true) -&gt; read_A(flag[1] == false) -&gt; CS_A</code>这段话的意思是线程A将<code>flag[0]</code>的值置为true然后读取<code>flag[1]</code>的值,这个过程称为<code>CS_A</code>事件</li>
<li><code>write_B(flag[1] = true) -&gt; read_B(flag[0] == false) -&gt; CS_B</code>这段话的意思是线程B将<code>flag[1]</code>的值置为true然后读取<code>flag[0]</code>的值,这个过程称为<code>CS_B</code>事件</li>
</ol>
<blockquote>
<p>我们验证一下LockOne算法是否满足互斥<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">假设这个算法不是互斥的，也就是无法得到`CS_A -&gt; CS_B`且`CS_B -&gt; CS_A`.</div><div class="line">假设CS_A事件先于CS_B事件,那么有：</div><div class="line">write_A(flag[<span class="number">0</span>] = <span class="keyword">true</span>) -&gt; read_A(flag[<span class="number">1</span>] == <span class="keyword">false</span>) -&gt; write_B(flag[<span class="number">1</span>] = <span class="keyword">true</span>)</div><div class="line">=&gt;</div><div class="line">read_A(flag[<span class="number">1</span>] == <span class="keyword">false</span>) -&gt; write_B(flag[<span class="number">1</span>] = <span class="keyword">true</span>)</div><div class="line">可以看到这俩个事件是互斥的(它们的临界区是没有重叠的).</div></pre></td></tr></table></figure></p>
</blockquote>
<p>LockOne算法满足了互斥,但是如果俩个线程并发执行的话，就会进入死锁,同样我们来证明一下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">假设</div><div class="line">write_A(flag[<span class="number">0</span>] = <span class="keyword">true</span>) -&gt; write_B(flag[<span class="number">1</span>] = <span class="keyword">true</span>) -&gt; read_A(flag[<span class="number">1</span>] == <span class="keyword">false</span>) -&gt; read_B(flag[<span class="number">0</span>] == <span class="keyword">false</span>)</div><div class="line">那么`flag[<span class="number">0</span>]`和`flag[<span class="number">1</span>]`就都成为<span class="keyword">true</span>,也就是线程A和线程B进入了死锁.</div></pre></td></tr></table></figure></p>
<p>至于说为什么要使用<code>volatile</code>关键字,这是为了保证<code>flags</code>变量的内存可见性,因为Java会将这段代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span>(flag[j]) &#123;&#125;</div><div class="line">=&gt;</div><div class="line"><span class="keyword">if</span>(flag[j]) &#123;</div><div class="line">	<span class="keyword">while</span>(<span class="keyword">true</span>) &#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>编译后的代码进行了提升优化,加上<code>volatile</code>关键字,就是告诉编译器,不要提升优化我的代码.</p>
<h2 id="LockTwo"><a href="#LockTwo" class="headerlink" title="LockTwo"></a>LockTwo</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">LockTwo</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> lock;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> tid = ThreadID.get();</div><div class="line">		lock = tid;</div><div class="line">		<span class="keyword">while</span>(lock == tid)&#123;&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> tid = ThreadID.get();</div><div class="line">		lock = tid;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>同样我们假设有俩个事件发生</p>
<ol>
<li><code>write_A(lock = 1) -&gt; read_A(lock == 1) -&gt; CS_A</code></li>
<li><code>write_B(lock = 2) -&gt; read_B(lock == 2) -&gt; CS_B</code><br>很明显任何线程调用加锁操作都会造成死循环. 但是,如果锁调用交叉调用的话<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">write_A(lock = <span class="number">1</span>) -&gt; write_B(lock = <span class="number">2</span>) -&gt; read_A(lock == <span class="number">2</span>) -&gt; read_B(lock == <span class="number">2</span>)</div></pre></td></tr></table></figure>
</li>
</ol>
<p>直到A线程释放锁,B线程就一直在阻塞着. 因此只要这俩个事件并发执行就能完成互斥要求.</p>
<h2 id="Peterson"><a href="#Peterson" class="headerlink" title="Peterson"></a>Peterson</h2><p>算法实现<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Peterson</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> voliate <span class="keyword">boolean</span>[] flag = <span class="keyword">new</span> <span class="keyword">boolean</span>[<span class="number">2</span>];</div><div class="line">	<span class="keyword">private</span> <span class="keyword">int</span> lock;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lock</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> tid = ThreadID.get();</div><div class="line">		<span class="keyword">int</span> oid = <span class="number">1</span> - tid;</div><div class="line">		flag[oid] = <span class="keyword">true</span>;</div><div class="line">		lock = tid;</div><div class="line"></div><div class="line">		<span class="keyword">while</span>(flag[tid] &amp;&amp; lock == tid) &#123;&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">unlock</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">int</span> tid = ThreadID.get();</div><div class="line">		flag[tid] = <span class="keyword">false</span>;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>同样的我们看看俩个线程依次调用锁过程(假设线程A对应flag[0]标志,线程B对应flag[1]标志)：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">write_A(flag[<span class="number">1</span>] = <span class="keyword">true</span>) -&gt; write_A(lock = <span class="number">0</span>) -&gt; read_A(flag[<span class="number">0</span>] == <span class="keyword">false</span>) -&gt; read_A(lock == <span class="number">0</span>) -&gt; <span class="function">CS_A</span></div><div class="line"><span class="title">write_B</span><span class="params">(flag[<span class="number">0</span>] = <span class="keyword">true</span>)</span> -&gt; <span class="title">write_B</span><span class="params">(lock = <span class="number">1</span>)</span> -&gt; <span class="title">read_B</span><span class="params">(flag[<span class="number">1</span>] == <span class="keyword">true</span>)</span> -&gt; <span class="title">read_B</span><span class="params">(lock == <span class="number">1</span>)</span> -&gt; CS_B</div></pre></td></tr></table></figure></p>
<p>好，首先我们看一下</p>
<ul>
<li><code>CS_A</code>先于<code>CS_B</code>事件执行的话,那么B线程会进入锁等待.</li>
</ul>
<p><code>CS_A</code>和<code>CS_B</code>事件并发执行我们分俩种情况分析：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">write_A(flag[<span class="number">1</span>] = <span class="keyword">true</span>) -&gt; write_A(lock = <span class="number">0</span>) -&gt; write_B(flag[<span class="number">0</span>] = <span class="keyword">true</span>) -&gt; write_B(lock = <span class="number">1</span>) -&gt; read_A(flag[<span class="number">1</span>] == <span class="keyword">true</span>) -&gt; read_A(lock == <span class="number">0</span>) -&gt; read_B(flag[<span class="number">1</span>] == <span class="keyword">true</span>) -&gt; read_B(lock == <span class="number">1</span>)</div></pre></td></tr></table></figure></p>
<p>同样的A线程事件先于B线程事件,我们看到A线程并没有进入锁等待,而是B线程进入了锁等待<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">write_A(flag[<span class="number">1</span>] = <span class="keyword">true</span>) -&gt; write_A(lock = <span class="number">0</span>) -&gt; write_B(flag[<span class="number">0</span>] = <span class="keyword">true</span>) -&gt; write_B(lock = <span class="number">1</span>) -&gt; read_B(flag[<span class="number">1</span>] == <span class="keyword">true</span>) -&gt; read_B(lock == <span class="number">1</span>) -&gt; read_A(flag[<span class="number">1</span>] == <span class="keyword">true</span>) -&gt; read_A(lock == <span class="number">0</span>)</div></pre></td></tr></table></figure></p>
<p>我们发现这个锁算法仍然是有问题的.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/算法/">算法</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/12/算法/1_1_双线程锁/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/12/算法/1_1_双线程锁/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/08/杂记/vim/" title="GVIM" itemprop="url">GVIM</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="vimrc配置文件"><a href="#vimrc配置文件" class="headerlink" title="_vimrc配置文件"></a>_vimrc配置文件</h1><h2 id="GVIM打开即全屏"><a href="#GVIM打开即全屏" class="headerlink" title="GVIM打开即全屏"></a>GVIM打开即全屏</h2><p><code>au GUIEnter * simalt ~x</code></p>
<h2 id="设置VeraMono字体"><a href="#设置VeraMono字体" class="headerlink" title="设置VeraMono字体"></a>设置VeraMono字体</h2><p><a href="http://www.vimer.cn/wp-content/uploads/2009/11/VeraMono.ttf" target="_blank" rel="external">VeraMono</a>需要下载安装(百度字体安装就好)<br><code>set guifont=Bitstream_Vera_Sans_Mono:h10:cANSI</code></p>
<h2 id="python编译"><a href="#python编译" class="headerlink" title="python编译"></a>python编译</h2><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">autocmd BufRead *.py set makeprg=python\ -c\ \"import\ py_compile,sys;\ sys.stderr=sys.stdout;\ py_compile.compile(r'%')\"  </div><div class="line">autocmd BufRead *.py set efm=%C\ %.%#,%A\ \ File\ \"%f\"\\,\ line\ %l%.%#,%Z%[%^\ ]%\\@=%m  </div><div class="line">autocmd BufRead *.py nmap &lt;F5&gt; :!python %&lt;CR&gt;  </div><div class="line">autocmd BufRead *.py nmap &lt;F6&gt; :make&lt;CR&gt;  </div><div class="line">autocmd BufRead *.py copen "如果是py文件，则同时打开编译信息窗口</div></pre></td></tr></table></figure>
<h1 id="快捷键"><a href="#快捷键" class="headerlink" title="快捷键"></a>快捷键</h1><ul>
<li>搜索：<code>/</code>向下搜索. <code>?</code>向上搜索</li>
<li>替换： <code>:%s/abc/123/g</code>, 将abc都替换为123</li>
<li>删除行：<code>dd</code>删除整行. <code>5dd</code>从当前行开始向后删除5整行. <code>D</code>从光标删除到行尾</li>
<li>删除字符：<code>x</code>向后删除一个字符. <code>X</code>向前删除一个字符</li>
<li>撤销: <code>u</code></li>
<li>复制:<code>yy</code>复制一行. <code>5yy</code>从当前行开始向下复制5行</li>
<li>粘贴: <code>p</code>光标向下移动. <code>P</code>光标不动</li>
<li>块选择: <code>V</code>多行整行选择. <code>v</code>多行字符选择. <code>ctrl v</code>矩阵方式选择.</li>
<li>光标移动：<code>$</code>移动到行尾. <code>0</code>移动到行首. <code>G</code>移动到最后一行. <code>gg</code>移动到最一行.</li>
<li>窗口编辑: <code>：split</code>水平新建窗口. <code>：vsplit</code>垂直分割.</li>
<li>在窗口间游走: <code>Ctrl W</code> 加 <code>h, j, k, l</code>一起使用</li>
<li>分页编辑： <code>：tabnew</code>新建分页。 <code>：tabclose</code>关闭当前分页. <code>：tabonly</code>关闭其他所有的分页</li>
<li>顶部底部跳转： 顶部<code>`, 底部</code>shift + g`</li>
</ul>
<h1 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h1><h2 id="Pydiction"><a href="#Pydiction" class="headerlink" title="Pydiction "></a><a href="http://www.vim.org/scripts/script.php?script_id=850" target="_blank" rel="external">Pydiction </a></h2><p>python自动补全插件</p>
<p>配置,<code>_vimrc</code>文件追加<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">filetype plugin on</div><div class="line">let g:pydiction_location = <span class="string">'D:/Program Files/Vim/pydiction/complete-dict'</span></div></pre></td></tr></table></figure></p>
<p>然后将<code>pydiction/after/ftplugin/python_pydiction.vim</code>复制到<code>Vim\vimfiles\ftplugin\python_pydiction.vim</code></p>
<h2 id="The-NERD-tree"><a href="#The-NERD-tree" class="headerlink" title="The NERD tree"></a><a href="http://www.vim.org/scripts/script.php?script_id=1658" target="_blank" rel="external">The NERD tree</a></h2><p>文件树. 将下载下来的压缩包解压到<code>Vim\vimfiles</code></p>
<ul>
<li><code>:NERDTree</code> 打开当前文件所在目录树. 该命令后可跟需要打开的目录路径</li>
<li><code>:NERDTreeClose</code> 关闭目录树</li>
</ul>
<p>修改_vimrc配置文件,添加映射<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nmap &lt;F2&gt; :NERDTreeToggle&lt;CR&gt;</div></pre></td></tr></table></figure></p>
<h2 id="bsh-vim"><a href="#bsh-vim" class="headerlink" title="bsh.vim"></a><a href="http://www.vim.org/scripts/script.php?script_id=1202" target="_blank" rel="external">bsh.vim</a></h2><p>Shell语法高亮</p>
<p>只需将<code>bsh.vim</code>文件拷贝到<code>Vim\vimfiles\syntax</code>就可以了</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/08/杂记/vim/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/08/杂记/vim/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/08/数据库/Mysql 数据类型/" title="Mysql 数据类型" itemprop="url">Mysql 数据类型</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="varchar"><a href="#varchar" class="headerlink" title="varchar"></a>varchar</h2><p>varchar 字段是将实际内容单独存储在聚簇索引之外，内容开头用1到2个字节表示实际长度（长度超过255时需要2个字节），因此最大长度不能超过65535(2^16)。</p>
<ul>
<li>字符类型若为gbk，每个字符最多占2个字节，最大长度不能超过32766; </li>
<li>字符类型若为utf8，每个字符最多占3个字节，最大长度不能超过21845。 </li>
<li>对于英文比较多的论坛 ，使用GBK则每个字符占用2个字节，而使用UTF－8英文却只占一个字节。 </li>
<li>若定义的时候超过上述限制，则varchar字段会被强行转为text类型，并产生warning。 </li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/数据库/">数据库</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/08/数据库/Mysql 数据类型/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/08/数据库/Mysql 数据类型/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/08/数据库/Mysql 索引/" title="Mysql 索引" itemprop="url">Mysql 索引</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>一般我们在创建索引的时候都要指定它的索引名字. 当然这个不是必须的.</p>
<h3 id="普通索引"><a href="#普通索引" class="headerlink" title="普通索引"></a>普通索引</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">INDEX</span> idxName <span class="keyword">ON</span> db1.idtable(<span class="keyword">id</span>);</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (</div><div class="line">  <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="keyword">INDEX</span> (<span class="keyword">id</span>)</div><div class="line">)</div></pre></td></tr></table></figure>
<h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p>与普通索引相比值唯一, 可以有空值<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">UNIQUE</span> <span class="keyword">INDEX</span> <span class="keyword">id</span> <span class="keyword">ON</span> db1.idtable(<span class="keyword">id</span>);</div><div class="line"></div><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (</div><div class="line">  <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="keyword">UNIQUE</span> (<span class="keyword">id</span>)</div><div class="line">)</div></pre></td></tr></table></figure></p>
<h3 id="主键索引"><a href="#主键索引" class="headerlink" title="主键索引"></a>主键索引</h3><p>与普通索引相比值唯一, 不可以有空值<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> t1 (</div><div class="line">  <span class="keyword">id</span> <span class="built_in">int</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="keyword">id</span>)</div><div class="line">)</div></pre></td></tr></table></figure></p>
<h3 id="组合索引"><a href="#组合索引" class="headerlink" title="组合索引"></a>组合索引</h3><p>下面我们创建了一个唯一组合索引.<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t1`</span> (</div><div class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="string">`name`</span> <span class="built_in">varchar</span>(<span class="number">16</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</div><div class="line">  <span class="keyword">UNIQUE</span> <span class="keyword">KEY</span> <span class="string">`idx`</span> (<span class="string">`id`</span>,<span class="string">`name`</span>)</div><div class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8</div></pre></td></tr></table></figure></p>
<h3 id="索引注意事项"><a href="#索引注意事项" class="headerlink" title="索引注意事项"></a>索引注意事项</h3><ul>
<li>如果索引上出现<code>NULL</code>值(包含组合索引),那么这一行就不会被索引</li>
<li>我们要尽可能的使用短索引(指定一个前缀长度),例如对varchar类型进行索引,它的长度是16个字符,但是前6个字符是固定的,那么我们指定前缀长度为6就好了</li>
<li>尽量不要对索引进行<code>like</code>操作</li>
<li>不要在索引列上使用<code>NOT IN</code>和<code>&lt;&gt;</code>操作</li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/数据库/">数据库</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/08/数据库/Mysql 索引/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/08/数据库/Mysql 索引/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/08/编程语言/AWK/" title="AWK" itemprop="url">AWK</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="AWK"><a href="#AWK" class="headerlink" title="AWK"></a>AWK</h1><p>awk就是把文件逐行的读入，以空格为默认分隔符将每行切片，切开的部分再进行各种分析处理。</p>
<p>语法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk [-F  field-separator]  &apos;commands&apos;  input-file(s)</div></pre></td></tr></table></figure></p>
<ul>
<li>-F: 域分隔符,由域分隔符分开的每一项称为一个域。通常，在不指名-F域分隔符的情况下，默认的域分隔符是空格。(我们指定:为分隔符<code>-F &#39;:&#39;</code>)</li>
<li>commands: ‘PATTERN{COMMAND}’. PATTERN为模式(正在表达式),COMMAND为要执行的命令.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk  -F &apos;:&apos;  &apos;BEGIN &#123;print &quot;start&quot;&#125;  &#123;print $1&quot;&#125; END &#123;print &quot;end&quot;&#125;&apos; ./txt</div></pre></td></tr></table></figure>
<p>上面的例子是读取<code>txt</code>文件,然后使用<code>:</code>分割每一行数据,在开始处理的时候输出start，在处理过程中第一列数据，最后输出end。</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><h3 id="内置变量"><a href="#内置变量" class="headerlink" title="内置变量"></a>内置变量</h3><p>我们可以在AWK命令中直接使用以下内置变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">ARGC               命令行参数个数</div><div class="line">ARGV               命令行参数排列</div><div class="line">ENVIRON            支持队列中系统环境变量的使用</div><div class="line">FILENAME           awk浏览的文件名</div><div class="line">FNR                浏览文件的记录数</div><div class="line">FS                 设置输入域分隔符，等价于命令行 -F选项</div><div class="line">NF                 浏览记录的域的个数</div><div class="line">NR                 已读的记录数</div><div class="line">OFS                输出域分隔符</div><div class="line">ORS                输出记录分隔符</div><div class="line">RS                 控制记录分隔符</div></pre></td></tr></table></figure></p>
<p>例如<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;&#123;print ARGC&#125;&apos;</div></pre></td></tr></table></figure></p>
<h3 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h3><p>我们通过赋值的方式直接定义一个变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;BEGIN&#123;size=0;&#125; &#123;size=1+size&#125; &#123;print $1&#125; END&#123;print size&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>上面我们定义了一个数值型的size变量.</p>
<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><ul>
<li><code>= += -= *= /= %= ^= **=</code>    赋值</li>
<li><code>?:</code>    C条件表达式</li>
<li><code>||</code>    逻辑或</li>
<li><code>&amp;&amp;</code>    逻辑与</li>
<li><code>~ ~!</code>    匹配正则表达式和不匹配正则表达式</li>
<li><code>&lt; &lt;= &gt; &gt;= != ==</code>    关系运算符</li>
<li><code>空格</code>    连接</li>
<li><code>+ -</code>    加，减</li>
<li><code>* / &amp;</code>    乘，除与求余</li>
<li><code>+ - !</code>    一元加，减和逻辑非</li>
<li><code>^ ***</code>    求幂</li>
<li><code>++ --</code>    增加或减少，作为前缀或后缀</li>
<li><code>$</code>    字段引用</li>
<li><code>in</code>    数组成员</li>
</ul>
<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><h2 id="条件语句"><a href="#条件语句" class="headerlink" title="条件语句"></a>条件语句</h2><p>下面输出了大于10000的java进程号<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;BEGIN&#123;size=0&#125; &#123;if($1&gt;10000) &#123;size++;print $1&#125;&#125; END&#123;print size&#125;&apos;</div></pre></td></tr></table></figure></p>
<h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><p>awk中的循环语句借鉴于C语言，支持while、do/while、for、break、continue，这些关键字的语义和C语言中的语义完全相同。</p>
<h1 id="字符串处理"><a href="#字符串处理" class="headerlink" title="字符串处理"></a>字符串处理</h1><h2 id="sub函数"><a href="#sub函数" class="headerlink" title="sub函数"></a>sub函数</h2><p>匹配从左侧开始找到的第一个符合规则的字符串，然后使用替换字符串替换这些字符串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;&#123;sub(/moon/, &quot;sun&quot;)&#125; &#123;print $2&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>上面这个例子就使用sun这个字符串替换了$2中的moon字符串。</p>
<p>我们还可以指定在哪列执行查找替换<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;&#123;sub(/moon/, &quot;sun&quot;, $1)&#125; &#123;print $2&#125;&apos;</div></pre></td></tr></table></figure></p>
<p>上面的例子中我们只在第一列进行查找替换</p>
<h2 id="gsub函数"><a href="#gsub函数" class="headerlink" title="gsub函数"></a>gsub函数</h2><p>与sub函数不同的是，这个执行的是全局替换<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;&#123;gsub(/moon/, &quot;sun&quot;)&#125; &#123;print $2&#125;&apos;</div></pre></td></tr></table></figure></p>
<h2 id="index函数"><a href="#index函数" class="headerlink" title="index函数"></a>index函数</h2><p>返回子字符串第一次被匹配的位置，偏移量从位置1开始<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;&#123;print$2; $2=index($2, &quot;moon&quot;)&#125; &#123;print $2&#125;&apos;</div></pre></td></tr></table></figure></p>
<h2 id="length函数"><a href="#length函数" class="headerlink" title="length函数"></a>length函数</h2><p>返回记录的字符数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;&#123;print$2; $2=length($2)&#125; &#123;print $2&#125;&apos;</div></pre></td></tr></table></figure></p>
<h2 id="substr函数"><a href="#substr函数" class="headerlink" title="substr函数"></a>substr函数</h2><p>返回从位置1开始的子字符串，如果指定长度超过实际长度，就返回整个字符串<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;&#123;print substr($2, 2, 10)&#125; &apos;</div></pre></td></tr></table></figure></p>
<p>上面的例子将$2字符串从第二个字符还是截取，截取10个长度的字符串出来</p>
<h2 id="toupper和tolower函数"><a href="#toupper和tolower函数" class="headerlink" title="toupper和tolower函数"></a>toupper和tolower函数</h2><p>可用于字符串大小间的转换<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;&#123;print toupper($2)&#125; &apos;</div></pre></td></tr></table></figure></p>
<h2 id="split函数"><a href="#split函数" class="headerlink" title="split函数"></a>split函数</h2><p>可按给定的分隔符把字符串分割为一个数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">jps -l | awk &apos;&#123; split($2, array, &quot;/&quot;); print array[3]&#125; &apos;</div></pre></td></tr></table></figure></p>
<p>上面的例子我们将$2这一列按照<code>/</code>进行分割,然后将分割出的数据存储到array数组里. 注意这里首先不需要转义</p>
<h1 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h1><h2 id=""><a href="#" class="headerlink" title="\"></a>\</h2><p>将下一字符标记为特殊字符、文本、反向引用或八进制转义符。例如，“n”匹配字符“n”。“\n”匹配换行符。序列“\”匹配“\”，“(”匹配“(”。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/\\/&#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<p>过滤出带有<code>\</code>的行</p>
<h2 id="-1"><a href="#-1" class="headerlink" title="^"></a>^</h2><p>匹配输入字符串与最左侧开始的位置的字符串。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/^\\n/&#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<p>找到所有以<code>\n</code>字符串开始的数据</p>
<h2 id="-2"><a href="#-2" class="headerlink" title="$"></a>$</h2><p>匹配输入字符串结尾的位置。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/)。$/&#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<p>过滤以<code>)。</code>结尾的行</p>
<h2 id="-3"><a href="#-3" class="headerlink" title="*"></a>*</h2><p>零次或多次匹配前面的字符或子表达式。例如，zo<em> 匹配“z”和“zoo”。</em> 等效于 {0,}。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/反向引用*/&#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="-4"><a href="#-4" class="headerlink" title="+"></a>+</h2><p>一次或多次匹配前面的字符或子表达式。例如，“zo+”与“zo”和“zoo”匹配，但与“z”不匹配。+ 等效于 {1,}。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/反向引用+/&#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="-5"><a href="#-5" class="headerlink" title="?"></a>?</h2><p>零次或一次匹配前面的字符或子表达式。例如，“do(es)?”匹配“do”或“does”中的“do”。? 等效于 {0,1}。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/反向引用?/&#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="n"><a href="#n" class="headerlink" title="{n}"></a>{n}</h2><p>n 是非负整数。正好匹配 n 次。例如，“o{2}”与“Bob”中的“o”不匹配，但与“food”中的两个“o”匹配。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="n-1"><a href="#n-1" class="headerlink" title="{n,}"></a>{n,}</h2><p>n 是非负整数。至少匹配 n 次。例如，“o{2,}”不匹配“Bob”中的“o”，而匹配“foooood”中的所有 o。“o{1,}”等效于“o+”。“o{0,}”等效于“o*”。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="n-m"><a href="#n-m" class="headerlink" title="{n,m}"></a>{n,m}</h2><p>M 和 n 是非负整数，其中 n &lt;= m。匹配至少 n 次，至多 m 次。例如，“o{1,3}”匹配“fooooood”中的头三个 o。’o{0,1}’ 等效于 ‘o?’。注意：您不能将空格插入逗号和数字之间。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="-6"><a href="#-6" class="headerlink" title="."></a>.</h2><p>匹配除“\n”之外的任何单个字符。若要匹配包括“\n”在内的任意字符，请使用诸如“[\s\S]”之类的模式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="pattern"><a href="#pattern" class="headerlink" title="(pattern)"></a>(pattern)</h2><p>匹配 pattern 并捕获该匹配的子表达式。可以使用 $0…$9 属性从结果“匹配”集合中检索捕获的匹配。若要匹配括号字符 ( )，请使用“(”或者“)”。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="pattern-1"><a href="#pattern-1" class="headerlink" title="(?:pattern)"></a>(?:pattern)</h2><p>匹配 pattern 但不捕获该匹配的子表达式，即它是一个非捕获匹配，不存储供以后使用的匹配。这对于用“or”字符 (|) 组合模式部件的情况很有用。例如，’industr(?:y|ies) 是比 ‘industry|industries’ 更经济的表达式。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="pattern-2"><a href="#pattern-2" class="headerlink" title="(?=pattern)"></a>(?=pattern)</h2><p>执行正向预测先行搜索的子表达式，该表达式匹配处于匹配 pattern 的字符串的起始点的字符串。它是一个非捕获匹配，即不能捕获供以后使用的匹配。例如，’Windows (?=95|98|NT|2000)’ 匹配“Windows 2000”中的“Windows”，但不匹配“Windows 3.1”中的“Windows”。预测先行不占用字符，即发生匹配后，下一匹配的搜索紧随上一匹配之后，而不是在组成预测先行的字符后。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="pattern-3"><a href="#pattern-3" class="headerlink" title="(?!pattern)"></a>(?!pattern)</h2><p>执行反向预测先行搜索的子表达式，该表达式匹配不处于匹配 pattern 的字符串的起始点的搜索字符串。它是一个非捕获匹配，即不能捕获供以后使用的匹配。例如，’Windows (?!95|98|NT|2000)’ 匹配“Windows 3.1”中的 “Windows”，但不匹配“Windows 2000”中的“Windows”。预测先行不占用字符，即发生匹配后，下一匹配的搜索紧随上一匹配之后，而不是在组成预测先行的字符后。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="x-y"><a href="#x-y" class="headerlink" title="x|y"></a>x|y</h2><p>匹配 x 或 y。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/换页符等|十六进制转义码必须正好是两位数长/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="xyz"><a href="#xyz" class="headerlink" title="[xyz]"></a>[xyz]</h2><p>匹配是否包含xyz中任意一个字符<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/[前面至少有]/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="xyz-1"><a href="#xyz-1" class="headerlink" title="[^xyz]"></a>[^xyz]</h2><p>匹配不能包含xyz任意一个字符<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/[^前面至少有]/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="a-z"><a href="#a-z" class="headerlink" title="[a-z]"></a>[a-z]</h2><p>与<code>[xyz]</code>规则相同,只不过这个模式提供了一个范围模式.例如[a-c]实际为匹配[abc]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/[a-b]/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="a-z-1"><a href="#a-z-1" class="headerlink" title="[^a-z]"></a>[^a-z]</h2><p>反向范围字符。匹配不在指定的范围内的任何字符。例如，“[^a-z]”匹配任何不在“a”到“z”范围内的任何字符。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/[^a-z]/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<p>需要注意的是’\t’会被匹配出来</p>
<h2 id="d"><a href="#d" class="headerlink" title="\d"></a>\d</h2><p>数字字符匹配。等效于 [0-9]。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/\d/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="D"><a href="#D" class="headerlink" title="\D"></a>\D</h2><p>非数字字符匹配。等效于 [^0-9]。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/\D/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="n-2"><a href="#n-2" class="headerlink" title="\n"></a>\n</h2><p>换行符匹配。等效于 \x0a 和 \cJ。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/\n/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="r"><a href="#r" class="headerlink" title="\r"></a>\r</h2><p>匹配一个回车符。等效于 \x0d 和 \cM。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/\t/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="s"><a href="#s" class="headerlink" title="\s"></a>\s</h2><p>匹配任何空白字符，包括空格、制表符、换页符等。与 [ \f\n\r\t\v] 等效。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/\s/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="S"><a href="#S" class="headerlink" title="\S"></a>\S</h2><p>匹配任何非空白字符。与 [^ \f\n\r\t\v] 等效。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/\S/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="w"><a href="#w" class="headerlink" title="\w"></a>\w</h2><p>匹配任何字类字符，包括下划线。与“[A-Za-z0-9_]”等效。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/\w/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>
<h2 id="W"><a href="#W" class="headerlink" title="\W"></a>\W</h2><p>与任何非单词字符匹配。与“[^A-Za-z0-9_]”等效。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">awk &apos;/\W/ &#123;print $0&#125;&apos; ./txt</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程语言/">编程语言</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/08/编程语言/AWK/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/08/编程语言/AWK/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/08/数据库/Mysql 增删改查/" title="Mysql 增删改查" itemprop="url">Mysql 增删改查</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">mysql -h 主机地址 -u 用户名 －<span class="selector-tag">p</span> 用户密码 （注:u与root可以不用加空格，其它也一样）</div></pre></td></tr></table></figure>
<h2 id="用户操作"><a href="#用户操作" class="headerlink" title="用户操作"></a>用户操作</h2><p>创建用户<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'host'</span> <span class="keyword">IDENTIFIED</span> <span class="keyword">BY</span> <span class="string">'password'</span>;</div></pre></td></tr></table></figure></p>
<p>授权:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'host'</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>privileges - 用户的操作权限,如SELECT,INSERT,UPDATE等.如果要授予所的权限则使用ALL;如果要授予该用户对所有数据库和表的相应操作权限则可用<em>表示, 如</em>.*. </p>
</blockquote>
<p>用以上命令授权的用户不能给其它用户授权,如果想让该用户可以授权,用以下命令:<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">GRANT</span> <span class="keyword">privileges</span> <span class="keyword">ON</span> databasename.tablename <span class="keyword">TO</span> <span class="string">'username'</span>@<span class="string">'host'</span> <span class="keyword">WITH</span> <span class="keyword">GRANT</span> <span class="keyword">OPTION</span>;</div></pre></td></tr></table></figure></p>
<p>设置与更改用户密码<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SET</span> <span class="keyword">PASSWORD</span> <span class="keyword">FOR</span> <span class="string">'username'</span>@<span class="string">'host'</span> = <span class="keyword">PASSWORD</span>(<span class="string">'newpassword'</span>);</div></pre></td></tr></table></figure></p>
<p>撤销用户权限<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">REVOKE</span> privilege <span class="keyword">ON</span> databasename.tablename <span class="keyword">FROM</span> <span class="string">'username'</span>@<span class="string">'host'</span>;</div></pre></td></tr></table></figure></p>
<p>删除用户<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">DROP</span> <span class="keyword">USER</span> <span class="string">'username'</span>@<span class="string">'host'</span>;</div></pre></td></tr></table></figure></p>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><ul>
<li>显示数据库：<code>SHOW databases</code>; </li>
<li>创建库：<code>CREATE DATABASE 库名</code>; </li>
<li>删除库：<code>DROP DATABASE 库名</code>; </li>
<li>使用库(选中库)：<code>USE 库名</code>; </li>
</ul>
<h2 id="表操作"><a href="#表操作" class="headerlink" title="表操作"></a>表操作</h2><ul>
<li>显示数据表：<code>SHOW tables</code></li>
<li>显示表结构：<code>DESC 表名</code></li>
<li>删除表：<code>DROP TABLE 表名</code>; </li>
<li>输入创建表的DDL语句 <code>SHOW CREATE TABLE 表名;</code></li>
<li>创建表：<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span>  </div><div class="line">    <span class="keyword">USER</span>  </div><div class="line">    (  </div><div class="line">        <span class="keyword">name</span> <span class="built_in">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </div><div class="line">        <span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="string">'0'</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </div><div class="line">        stu_id <span class="built_in">INT</span>,  </div><div class="line">        phone <span class="built_in">VARCHAR</span>(<span class="number">20</span>),  </div><div class="line">        address <span class="built_in">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </div><div class="line">        age <span class="built_in">INT</span>(<span class="number">4</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,  </div><div class="line">        PRIMARY <span class="keyword">KEY</span> (<span class="keyword">name</span>),  </div><div class="line">        <span class="keyword">CONSTRAINT</span> stu_id <span class="keyword">UNIQUE</span> (stu_id)  </div><div class="line">    )  </div><div class="line">    <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</div></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="表数据操作"><a href="#表数据操作" class="headerlink" title="表数据操作"></a>表数据操作</h3><ul>
<li>清空表数据<code>truncate table 表名;</code>. truncate删除后不记录mysql日志，不可以恢复数据。相当于保留mysql表的结构，重新创建了这个表，所有的状态都相当于新表。</li>
<li>清空表数据<code>delete from 表名</code>. delete的效果有点像将mysql表中所有记录一条一条删除到删完</li>
</ul>
<h3 id="修改表结构"><a href="#修改表结构" class="headerlink" title="修改表结构"></a>修改表结构</h3><ul>
<li>修改列名<code>alter table 表名称 change 字段名称 字段名称</code></li>
<li>修改表名<code>alter table 表名称 rename 表名称</code></li>
<li>修改某个表的字段类型及指定为空或非空<code>alter table 表名称 change 字段名称字段名称 字段类型 [null/not null];</code></li>
<li>修改某个表的字段名称及指定为空或非空<code>alter table 表名称 change 字段原名称字段新名称 字段类型 [null/not null];</code></li>
<li>增加一个字段(一列)<code>alter table table_name add column column_name type default value;</code> type指该字段的类型,value指该字段的默认值</li>
<li>更改一个字段名字(也可以改变类型和默认值)<code>alter table table_name change sorce_col_name dest_col_name type defaultvalue;</code> source_col_name指原来的字段名称,dest_col_name指改后的字段名称</li>
<li>改变一个字段的默认值<code>alter table table_name alter column_name set default value;</code></li>
<li>改变一个字段的数据类型<code>alter table table_name change column column_name column_name type;</code></li>
<li>向一个表中增加一个列做为主键<code>alter table table_name add column column_name type auto_increment PRIMARYKEY;</code></li>
<li>向一个表中增加一个列做为主键<code>alter table table_name add column column_name type auto_increment PRIMARYKEY;</code></li>
<li>删除字段<code>alter table form1 drop column 列名;</code></li>
</ul>
<h3 id="复制表"><a href="#复制表" class="headerlink" title="复制表"></a>复制表</h3><ul>
<li>含有主键等信息的完整表结构 <code>CREATE table 新表名 LIKE book;</code></li>
<li>只有表结构，没有主键等信息 `create table 新表名 select * from books;</li>
<li>将旧表中的数据灌入新表 <code>INSERT INTO 新表 SELECT * FROM 旧表；</code> 注：新表必须已经存在</li>
</ul>
<h3 id="导入导出数据库"><a href="#导入导出数据库" class="headerlink" title="导入导出数据库"></a>导入导出数据库</h3><ul>
<li>数据库某表的备份,在命令行中输入:<code>mysqldump -u root -p database_name table_name &gt; bak_file_name</code></li>
<li>导出数据<code>select_statment into outfile”dest_file”;</code></li>
<li>导入数据<code>load data infile”file_name” into table table_name;</code></li>
<li>将两个表里的数据拼接后插入到另一个表里<code>insert into tx select t1.com1,concat(t1.com2,t2.com1) from t1,t2;</code></li>
</ul>
<h3 id="查询表"><a href="#查询表" class="headerlink" title="查询表"></a>查询表</h3><p>mysql查询的五种子句 </p>
<h4 id="where-条件查询"><a href="#where-条件查询" class="headerlink" title="where(条件查询)"></a>where(条件查询)</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> t1 <span class="keyword">WHERE</span> <span class="keyword">id</span> &gt; <span class="number">100</span>;</div></pre></td></tr></table></figure>
<ul>
<li>数值谓词:<code>&gt;,=,&lt;,&lt;&gt;,!=,!&gt;,!&lt;,=&gt;,=&lt;</code></li>
<li>字符串谓词：<code>=，like</code></li>
<li>日期谓词：<code>=</code> (<code>SELECT * from t1 WHERE create_time = &#39;2011-04-08&#39;</code>)</li>
</ul>
<h4 id="having（筛选）"><a href="#having（筛选）" class="headerlink" title="having（筛选）"></a>having（筛选）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure>
<h4 id="group-by（分组）"><a href="#group-by（分组）" class="headerlink" title="group by（分组）"></a>group by（分组）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> player <span class="keyword">GROUP</span> <span class="keyword">BY</span> vip;</div></pre></td></tr></table></figure>
<h4 id="order-by（排序）"><a href="#order-by（排序）" class="headerlink" title="order by（排序）"></a>order by（排序）</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> player <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">id</span>;</div></pre></td></tr></table></figure>
<h4 id="limit（限制结果数）"><a href="#limit（限制结果数）" class="headerlink" title="limit（限制结果数）"></a>limit（限制结果数）</h4><p>查询前n条记录(默认从第0个开始)<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> player <span class="keyword">LIMIT</span> <span class="number">10</span>;</div></pre></td></tr></table></figure></p>
<p>从结果集中第1个开始查询, 查询10个<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SELECT</span> <span class="keyword">id</span> <span class="keyword">FROM</span> player <span class="keyword">LIMIT</span> <span class="number">1</span>, <span class="number">10</span>;</div></pre></td></tr></table></figure></p>
<h2 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h2><p>sql语句的执行顺序<br><figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">(7)     <span class="keyword">SELECT</span> </div><div class="line">(<span class="number">8</span>)     <span class="keyword">DISTINCT</span> &lt;select_list&gt;</div><div class="line">(<span class="number">1</span>)     <span class="keyword">FROM</span> &lt;left_table&gt;</div><div class="line">(<span class="number">3</span>)     &lt;join_type&gt; <span class="keyword">JOIN</span> &lt;right_table&gt;</div><div class="line">(<span class="number">2</span>)     <span class="keyword">ON</span> &lt;join_condition&gt;</div><div class="line">(<span class="number">4</span>)     <span class="keyword">WHERE</span> &lt;where_condition&gt;</div><div class="line">(<span class="number">5</span>)     <span class="keyword">GROUP</span> <span class="keyword">BY</span> &lt;group_by_list&gt;</div><div class="line">(<span class="number">6</span>)     <span class="keyword">HAVING</span> &lt;having_condition&gt;</div><div class="line">(<span class="number">9</span>)     <span class="keyword">ORDER</span> <span class="keyword">BY</span> &lt;order_by_condition&gt;</div><div class="line">(<span class="number">10</span>)    <span class="keyword">LIMIT</span> &lt;limit_number&gt;</div></pre></td></tr></table></figure></p>
<p>也就是<br><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">FROM</span>-&gt;<span class="keyword">ON</span>-&gt;<span class="keyword">JOIN</span>-&gt;<span class="keyword">WHERE</span>-&gt;<span class="keyword">GROUP</span> <span class="keyword">BY</span>-&gt;HAVING-&gt;<span class="keyword">SELECT</span>-&gt;<span class="keyword">DISTINCT</span>-&gt;<span class="keyword">ORDER</span> <span class="keyword">BY</span>-&gt;LIMIT</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/数据库/">数据库</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/08/数据库/Mysql 增删改查/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/08/数据库/Mysql 增删改查/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/08/数据库/数据库事务/" title="MySQL事务" itemprop="url">MySQL事务</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h2><p>事务（Transaction）是一个操作序列，它构成了并发执行的基本单元。事务的提出主要是为了解决并发情况下保持数据一致性。</p>
<p>数据库事务具有ACID特性,即</p>
<ul>
<li>原子性： 原子性体现在对事务的修改,要么全部执行要么都不执行</li>
<li>一致性： 保持数据的一致性,例如整数类型的数据大小不能溢出,字符型数据长度不能超过规定范围，保证数据的完整性.</li>
<li>隔离性： 如果数据库并发执行A,B俩个事务,那么在A事务执行完之前对B事务是不可见的,也就是说,B事务是看不见A事务的中间状态的.</li>
<li>持久性： 事务完成后,它对数据库的影响是永久的,即使数据库出现异常也是如此.</li>
</ul>
<p>隔离级别</p>
<ul>
<li><code>Read Uncommitted</code>: 读取未提交的数据,即其他事务已经提交修改但还未提交的数据(这是最低的隔离级别)</li>
<li><code>Read Committed</code>: 读取已经提交的数据,但是在一个事务中,对同一个项,前后俩次读取的结果可能不同.</li>
<li><code>Repetable Read</code>: 可重复读取,在一个事务中,对同一个项,确保前后俩次读取的结果一样</li>
<li><code>Serializable</code>: 可序列话,即数据库的事务是可串行执行的,就像一个事务执行的时候没有别的事务同时在执行<br>我们使用下面的语句来改变数据库的隔离级别<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">SET</span> [<span class="keyword">SESSION</span>|<span class="keyword">GLOBAL</span>] <span class="keyword">TRANSACTION</span> <span class="keyword">ISOLATION</span> <span class="keyword">LEVEL</span> <span class="keyword">READ</span> UNCOMMITTED | <span class="keyword">READ</span> COMMITTED | REPEATABLE <span class="keyword">READ</span> | <span class="keyword">SERIALIZABLE</span></div></pre></td></tr></table></figure>
</li>
</ul>
<ol>
<li>不带<code>SESSION、GLOBAL</code>的SET命令,只对下一个事务有效</li>
<li><code>SET SESSION</code> 为当前会话设置隔离模式</li>
<li><code>SET GLOBAL</code>为以后新建的所有MYSQL连接设置隔离模式（当前连接不包括在内）</li>
</ol>
<p>读写异常</p>
<ul>
<li><code>Lost Update</code>: 俩个事务并发修改同一个数据,A事务提交成功,B事务提交失败回滚后,A事务的修改都可能会丢失</li>
<li><code>Dirty Reads</code>: A事务读取了B事务更新却没有提交的数据</li>
<li><code>Non-Repeatable Reads</code>: 一个事务对同一个数据项的多次读取可能得到不同的结果</li>
<li><code>Second Lost Updates</code>:俩个事务并发修改同一个数据, B事务可能会覆盖掉A事务的修改</li>
<li><code>Phantom Reads</code>: A事务进行前后俩次查询,但是在查询过程中出现了B事务向其中插入数据,那么A事务可能读取到未出现的数据</li>
</ul>
<p>隔离级别与读写异常的关系<br><figure class="highlight excel"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    LU  DR  NRR  SLU  PR</div><div class="line">RU  <span class="built_in">N</span>   Y   Y    Y    Y</div><div class="line">RC  <span class="built_in">N</span>   <span class="built_in">N</span>   Y    Y    Y</div><div class="line">RR  <span class="built_in">N</span>   <span class="built_in">N</span>   <span class="built_in">N</span>   <span class="built_in">N</span>     Y</div><div class="line">S   <span class="built_in">N</span>   <span class="built_in">N</span>   <span class="built_in">N</span>   <span class="built_in">N</span>     <span class="built_in">N</span></div></pre></td></tr></table></figure></p>
<h3 id="事务语句"><a href="#事务语句" class="headerlink" title="事务语句"></a>事务语句</h3><ul>
<li>开始事物：<code>BEGIN TRANSACTION</code></li>
<li>提交事物：<code>COMMIT TRANSACTION</code></li>
<li>回滚事务：<code>ROLLBACK TRANSACTION</code></li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># 开启一个事务</div><div class="line">START TRANSACTION;</div><div class="line">INSERT INTO db1.`t1`(id) VALUES(1);</div><div class="line"># 提交事务</div><div class="line">COMMIT;</div><div class="line"></div><div class="line"># 开启事务</div><div class="line">START TRANSACTION;</div><div class="line">INSERT INTO db1.`t1`(id) VALUES(2);</div><div class="line"># 回滚刚才的事务</div><div class="line">ROLLBACK;</div></pre></td></tr></table></figure>
<h3 id="并发控制"><a href="#并发控制" class="headerlink" title="并发控制"></a>并发控制</h3><h4 id="锁"><a href="#锁" class="headerlink" title="锁"></a>锁</h4><h4 id="写时复制"><a href="#写时复制" class="headerlink" title="写时复制"></a>写时复制</h4><h4 id="多版本并发控制"><a href="#多版本并发控制" class="headerlink" title="多版本并发控制"></a>多版本并发控制</h4><p>Mysql InnoDB存储引擎,InnoDB对每一行维护了俩个隐含的列,一列用于存储行被修改的时间,另一列存储每一行被删除的时间.</p>
<blockquote>
<p>这里的时间并不是绝对时间,而是与时间对应的数据库系统的版本号,每当一个事务开始时,InnoDB都会给这个事务分配一个递增的版本号,所以版本号也可以被任务是事务好.对于每一行的查询语句,InnoDB都会把这个查询语句的版本号同这个查询雨具遇到的行的版本号进行对比,然后结合不同的事务隔离级别来决定是否返回改行.</p>
</blockquote>
<p>下面以SELECT,DELETE,INSERT,UPDATE为例:</p>
<h5 id="SELECT"><a href="#SELECT" class="headerlink" title="SELECT"></a>SELECT</h5><p>只有同时满足下面俩个条件的行才能被返回:</p>
<ol>
<li>行的版本号小于等于该事务的版本号</li>
<li>行的删除版本号要么没有定义,要么大于等于事务的版本号<br>如果行的修改或者删除版本号大于事务号,说明行是被该食物后面启动的事务修改或者删除的 </li>
</ol>
<h5 id="DELETE"><a href="#DELETE" class="headerlink" title="DELETE"></a>DELETE</h5><p>InnoDB直接把该行的删除版本号设置为当前的事务号,相当于标记为删除而不是物理删除</p>
<h5 id="INSERT"><a href="#INSERT" class="headerlink" title="INSERT"></a>INSERT</h5><p>对于新插入的行,行的修改版本号更新为该事务的事务号</p>
<h5 id="UPDATE"><a href="#UPDATE" class="headerlink" title="UPDATE"></a>UPDATE</h5><p>更新行的时候,InnoDB会把原来的行复制一份,并把当前的事务号作为改行的修改版本号</p>
<h3 id="事务异常"><a href="#事务异常" class="headerlink" title="事务异常"></a>事务异常</h3>
        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/数据库/">数据库</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/08/数据库/数据库事务/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/08/数据库/数据库事务/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/10/08/编程语言/shell/" title="Shell 编程" itemprop="url">Shell 编程</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-10-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-10-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>每个shell脚本文件第一行都要指定使用哪个shell,我们默认使用<code>#!/bin/bash</code></p>
<h1 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h1><h2 id="变量类型"><a href="#变量类型" class="headerlink" title="变量类型"></a>变量类型</h2><p>运行shell时，会同时存在三种变量：</p>
<ul>
<li>局部变量： 局部变量在脚本或命令中定义，仅在当前shell实例中有效，其他shell启动的程序不能访问局部变量。</li>
<li>环境变量：所有的程序，包括shell启动的程序，都能访问环境变量，有些程序需要环境变量来保证其正常运行。必要的时候shell脚本也可以定义环境变量。</li>
<li>shell变量：shell变量是由shell程序设置的特殊变量。shell变量中有一部分是环境变量，有一部分是局部变量，这些变量保证了shell的正常运行</li>
</ul>
<h2 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">v1=123</div></pre></td></tr></table></figure>
<p>在上面的声明语法中我们需要注意以下几点</p>
<ul>
<li><code>=</code>左右不能用空格</li>
<li>变量的默认类型是字符串</li>
<li>该变量对当前以及子shell都有效</li>
</ul>
<h3 id="命令结果赋值"><a href="#命令结果赋值" class="headerlink" title="命令结果赋值"></a>命令结果赋值</h3><p>将命令执行的结果作为值传送给一个变量可以使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">dirName=`date +%Y_%m_%d_%H_%M_%S`</div><div class="line">#或者</div><div class="line">dirName=$(date +%Y_%m_%d_%H_%M_%S)</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Group_port=18080</div><div class="line"></div><div class="line">port_name=Group</div><div class="line">port=\$$&#123;port_name&#125;&quot;_port&quot;</div><div class="line"></div><div class="line">port1=`eval echo $port`</div><div class="line">echo $&#123;port&#125;</div><div class="line">echo $&#123;port1&#125;</div><div class="line"></div><div class="line">echo $&#123;Group_port&#125;</div></pre></td></tr></table></figure>
<h2 id="变量引用"><a href="#变量引用" class="headerlink" title="变量引用"></a>变量引用</h2><p>我们通过使用<code>$</code>或者<code>${}</code>符号可以引用一个变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">v=1</div><div class="line">echo $v</div><div class="line">echo $&#123;v&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>需要注意的是, <code>$()</code>是用来做命令替换的(<code>\</code>`<code>也是用来做命令替换的), 而</code>${}<code>是用来做变量替换的(</code>$var<code>与</code>${var}`并没有啥不一样)</p>
</blockquote>
<h2 id="只读变量"><a href="#只读变量" class="headerlink" title="只读变量"></a>只读变量</h2><p><code>readonly</code> 命令可以将变量定义为只读变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">readonly myUrl</div></pre></td></tr></table></figure></p>
<h2 id="删除变量"><a href="#删除变量" class="headerlink" title="删除变量"></a>删除变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unset  myUrl</div></pre></td></tr></table></figure>
<h2 id="特殊变量"><a href="#特殊变量" class="headerlink" title="特殊变量"></a>特殊变量</h2><ul>
<li><code>$0</code>:    当前脚本的文件名</li>
<li><code>$n</code>:    传递给脚本或函数的参数。(第一个参数是$1，第二个参数是$2)</li>
<li><code>$#</code>:    传递给脚本或函数的参数个数。</li>
<li><code>$*</code>:    传递给脚本或函数的所有参数。</li>
<li><code>$@</code>:    传递给脚本或函数的所有参数。被双引号(“ “)包含时，与 $* 稍有不同</li>
<li><code>$?</code>:    上个命令的退出状态，或函数的返回值。</li>
<li><code>$$</code>:    当前Shell进程ID。对于 Shell 脚本，就是这些脚本所在的进程ID。</li>
</ul>
<h2 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h2><h3 id="数组定义"><a href="#数组定义" class="headerlink" title="数组定义"></a>数组定义</h3><p>一对括号表示是数组，数组元素用“空格”符号分割开。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">array=(1 2 3 4 5)</div></pre></td></tr></table></figure></p>
<h3 id="数组长度"><a href="#数组长度" class="headerlink" title="数组长度"></a>数组长度</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$&#123;#数组名[@或*]&#125; : 可以得到数组长度</div><div class="line">$&#123;#array[@]&#125;</div></pre></td></tr></table></figure>
<h3 id="索引数组成员"><a href="#索引数组成员" class="headerlink" title="索引数组成员"></a>索引数组成员</h3><p><code>${数组名[下标]}</code> : 下标是从0开始 (下标是：*或者@ 得到整个数组内容)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$&#123;array[2]&#125;</div></pre></td></tr></table></figure></p>
<h3 id="数组成员赋值"><a href="#数组成员赋值" class="headerlink" title="数组成员赋值"></a>数组成员赋值</h3><p><code>数组名[下标]</code>: 进行数组元素引用，如果下标不存在，自动添加新一个数组元素<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">array[1]=100</div></pre></td></tr></table></figure></p>
<h3 id="删除数组"><a href="#删除数组" class="headerlink" title="删除数组"></a>删除数组</h3><p><code>unset 数组[下标]</code>：删除下标相应的元素，不带下标，则删掉整个数组。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unset array[1]</div></pre></td></tr></table></figure></p>
<h3 id="数组分片"><a href="#数组分片" class="headerlink" title="数组分片"></a>数组分片</h3><p><code>${数组名[@或*]:起始位置:长度}</code>： 切片数组，返回一个用“空格”分割元素的字符串</p>
<blockquote>
<p>如果加上<code>()</code>，将得到切片数组</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">c=($&#123;array[@]:1:4&#125;)</div></pre></td></tr></table></figure>
<h3 id="数组替换"><a href="#数组替换" class="headerlink" title="数组替换"></a>数组替换</h3><p><code>${数组名[@或*]/查找字符/替换字符}</code>: 该操作不会改变原先数组内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$&#123;array[@]/old/new&#125;</div></pre></td></tr></table></figure></p>
<h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="算术运算符"><a href="#算术运算符" class="headerlink" title="算术运算符"></a>算术运算符</h2><p>我们可以使用<code>expr</code>, <code>let</code>, <code>(())</code>, <code>[]</code>等四种方式进行算术运算</p>
<ul>
<li><code>+</code>:    加法    <code>(($a + $b))</code></li>
<li><code>-</code>:    减法<code>(($a - $b))</code></li>
<li><code>*</code>:    乘法    <code>(($a \* $b))</code></li>
<li><code>/</code>:    除法    <code>(($b / $a))</code></li>
<li><code>%</code>:    取余    <code>(($b % $a))</code></li>
<li><code>=</code>:    赋值    <code>a=$b</code></li>
<li><code>==</code>:    相等。用于比较两个数字，相同则返回 true。    <code>[ $a == $b ]</code> 返回 false。</li>
<li><code>!=</code>:    不相等。用于比较两个数字，不相同则返回 true。    <code>[ $a != $b ]</code> 返回 true。</li>
</ul>
<h2 id="关系运算符"><a href="#关系运算符" class="headerlink" title="关系运算符"></a>关系运算符</h2><p>关系运算符只支持数字，不支持字符串，除非字符串的值是数字。</p>
<ul>
<li><code>-eq</code>    检测两个数是否相等，相等返回 true。    <code>[ $a -eq $b ]</code> 返回 true。</li>
<li><code>-ne</code>    检测两个数是否相等，不相等返回 true。    <code>[ $a -ne $b ]</code> 返回 true。</li>
<li><code>-gt</code>    检测左边的数是否大于右边的，如果是，则返回 true。    <code>[ $a -gt $b ]</code> 返回 false。</li>
<li><code>-lt</code>    检测左边的数是否小于右边的，如果是，则返回 true。    <code>[ $a -lt $b ]</code> 返回 true。</li>
<li><code>-ge</code>    检测左边的数是否大等于右边的，如果是，则返回 true。    <code>[ $a -ge $b ]</code> 返回 false。</li>
<li><code>-le</code>    检测左边的数是否小于等于右边的，如果是，则返回 true。    <code>[ $a -le $b ]</code> 返回 true。</li>
</ul>
<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><ul>
<li><code>!</code>    非运算，表达式为 true 则返回 false，否则返回 true。    <code>[ ! false ]</code> 返回 true。</li>
<li><code>-o</code>    或运算，有一个表达式为 true 则返回 true。    <code>[ $a -lt 20 -o $b -gt 100 ]</code> 返回 true。</li>
<li><code>-a</code>    与运算，两个表达式都为 true 才返回 true。    <code>[ $a -lt 20 -a $b -gt 100 ]</code> 返回 false。</li>
</ul>
<h2 id="字符串运算符"><a href="#字符串运算符" class="headerlink" title="字符串运算符"></a>字符串运算符</h2><ul>
<li><code>=</code>    检测两个字符串是否相等，相等返回 true。    <code>[ $a = $b ]</code> 返回 false。</li>
<li><code>!=</code>    检测两个字符串是否相等，不相等返回 true。    <code>[ $a != $b ]</code> 返回 true。</li>
<li><code>-z</code>    检测字符串长度是否为0，为0返回 true。    <code>[ -z $a</code>] 返回 false。</li>
<li><code>-n</code>    检测字符串长度是否为0，不为0返回 true。    <code>[ -z $a</code>] 返回 true。</li>
<li><code>str</code>    检测字符串是否为空，不为空返回 true。    <code>[ $a</code>] 返回 true。</li>
</ul>
<h2 id="文件测试运算符"><a href="#文件测试运算符" class="headerlink" title="文件测试运算符"></a>文件测试运算符</h2><ul>
<li><code>-b</code> 文件是否是块设备文件，如果是，则返回 true。    <code>[ -b $file</code>] 返回 false。</li>
<li><code>-c</code> 文件是否是字符设备文件，如果是，则返回 true。    <code>[ -b $file</code>] 返回 false。</li>
<li><code>-d</code> 文件是否是目录，如果是，则返回 true。    <code>[ -d $file</code>] 返回 false。</li>
<li><code>-f</code> 文件是否是普通文件（既不是目录，也不是设备文件），如果是，则返回 true。    <code>[ -f $file</code>] 返回 true。</li>
<li><code>-g</code> 文件是否设置了 SGID 位，如果是，则返回 true。    <code>[ -g $file</code>] 返回 false。</li>
<li><code>-k</code> 文件是否设置了粘着位(Sticky Bit)，如果是，则返回 true。    <code>[ -k $file</code>] 返回 false。</li>
<li><code>-p</code> 文件是否是具名管道，如果是，则返回 true。    <code>[ -p $file</code>] 返回 false。</li>
<li><code>-u</code> 文件是否设置了 SUID 位，如果是，则返回 true。    <code>[ -u $file</code>] 返回 false。</li>
<li><code>-r</code> 文件是否可读，如果是，则返回 true。    <code>[ -r $file</code>] 返回 true。</li>
<li><code>-w</code> 文件是否可写，如果是，则返回 true。    <code>[ -w $file</code>] 返回 true。</li>
<li><code>-x</code> 文件是否可执行，如果是，则返回 true。    <code>[ -x $file</code>] 返回 true。</li>
<li><code>-s</code> 文件是否为空（文件大小是否大于0），不为空返回 true。    <code>[ -s $file</code>] 返回 true。</li>
<li><code>-e</code> 文件（包括目录）是否存在，如果是，则返回 true。    <code>[ -e $file</code>] 返回 true。</li>
</ul>
<h1 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h1><p>shell流程控制包含：</p>
<ul>
<li>if</li>
<li>while</li>
<li>until</li>
<li>case</li>
<li>for</li>
</ul>
<p>同样的shell也支持<code>break</code>和<code>continue</code></p>
<h2 id="if"><a href="#if" class="headerlink" title="if"></a>if</h2><p>condition 可以使用 文件测试运算符 或者 关系运算符 进行条件判断</p>
<p>语法格式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">if condition</div><div class="line">then</div><div class="line">    command1</div><div class="line">    command2</div><div class="line">    ...</div><div class="line">    commandN</div><div class="line">fi</div></pre></td></tr></table></figure></p>
<p>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line">v=123</div><div class="line">if [ -b $txt ];   </div><div class="line">then</div><div class="line">        echo &quot;ok&quot;;</div><div class="line">fi</div></pre></td></tr></table></figure></p>
<p>我们一定要注意if前后的空格</p>
<p><code>if else</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">if condition</div><div class="line">then</div><div class="line">    command1</div><div class="line">    command2</div><div class="line">    ...</div><div class="line">    commandN</div><div class="line">else</div><div class="line">    command</div><div class="line">fi</div></pre></td></tr></table></figure></p>
<p><code>if else-if else</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">if condition1</div><div class="line">then</div><div class="line">    command1</div><div class="line">elif condition2</div><div class="line">    command2</div><div class="line">else</div><div class="line">    commandN</div><div class="line">fi</div></pre></td></tr></table></figure></p>
<h2 id="case"><a href="#case" class="headerlink" title="case"></a>case</h2><p> case语句为多选择语句<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">case 值 in</div><div class="line">模式1)</div><div class="line">    command1</div><div class="line">    command2</div><div class="line">    ...</div><div class="line">    commandN</div><div class="line">    ;;</div><div class="line">模式2）</div><div class="line">    command1</div><div class="line">    command2</div><div class="line">    ...</div><div class="line">    commandN</div><div class="line">    ;;</div><div class="line">esac</div></pre></td></tr></table></figure></p>
<p>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">for i in 1 2 3 4 5;</div><div class="line">do</div><div class="line">        case $i in</div><div class="line">                1)  echo &apos;你选择了 1&apos;</div><div class="line">                ;;</div><div class="line">                2)  echo &apos;你选择了 2&apos;</div><div class="line">                ;;</div><div class="line">                3)  echo &apos;你选择了 3&apos;</div><div class="line">                ;;</div><div class="line">                4)  echo &apos;你选择了 4&apos;</div><div class="line">                ;;</div><div class="line">                *)  echo &apos;你没有输入 1 到 4 之间的数字&apos;</div><div class="line">                ;;</div><div class="line">                esac</div><div class="line">done</div></pre></td></tr></table></figure></p>
<h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">for var in item1 item2 ... itemN</div><div class="line">do</div><div class="line">    command1</div><div class="line">    command2</div><div class="line">    ...</div><div class="line">    commandN</div><div class="line">done</div></pre></td></tr></table></figure>
<p>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">for i in 1 2 3 4;</div><div class="line">do</div><div class="line">        echo $i</div><div class="line">done</div></pre></td></tr></table></figure></p>
<h2 id="while"><a href="#while" class="headerlink" title="while"></a>while</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">while condition</div><div class="line">do</div><div class="line">    command</div><div class="line">done</div></pre></td></tr></table></figure>
<p>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">i=1</div><div class="line">while(( $i&lt;=5 ))</div><div class="line">do</div><div class="line">        echo $i</div><div class="line">        ((i++))</div><div class="line">done</div></pre></td></tr></table></figure></p>
<h2 id="until"><a href="#until" class="headerlink" title="until"></a>until</h2><p>until循环执行一系列命令直至条件为真时停止。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">until condition</div><div class="line">do</div><div class="line">    command</div><div class="line">done</div></pre></td></tr></table></figure></p>
<p>示例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">#!/bin/bash</div><div class="line"></div><div class="line">i=1</div><div class="line">until(( $i&gt;3 ))</div><div class="line">do</div><div class="line">        echo $i</div><div class="line">        ((i++))</div><div class="line">done</div></pre></td></tr></table></figure></p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>调用函数不需要加<code>()</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">vi=123546789</div><div class="line">f() &#123;</div><div class="line">	echo $vi</div><div class="line">&#125;</div><div class="line">f</div></pre></td></tr></table></figure></p>
<h2 id="带参数的函数"><a href="#带参数的函数" class="headerlink" title="带参数的函数"></a>带参数的函数</h2><p>参数名是固定的<code>$n</code>, 如果参数大于10的话就需要<code>${10}</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">f() &#123;</div><div class="line">echo $1</div><div class="line">&#125;</div><div class="line">f 789</div></pre></td></tr></table></figure></p>
<h2 id="函数的返回值"><a href="#函数的返回值" class="headerlink" title="函数的返回值"></a>函数的返回值</h2><p>函数返回值在调用该函数后通过 <code>$?</code> 来获得<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">f() &#123;</div><div class="line">echo $1</div><div class="line">&#125;</div><div class="line">f 789</div><div class="line">echo $?</div></pre></td></tr></table></figure></p>
<p>如果不写<code>return</code>, 则直接返回0<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">f() &#123;</div><div class="line">echo $1</div><div class="line">return 569</div><div class="line">&#125;</div><div class="line">f 789</div><div class="line">echo $?</div></pre></td></tr></table></figure></p>
<h2 id="在当前shell里执行一个文件里的命令："><a href="#在当前shell里执行一个文件里的命令：" class="headerlink" title="在当前shell里执行一个文件里的命令："></a>在当前shell里执行一个文件里的命令：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">source /home/user/file.name</div></pre></td></tr></table></figure>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程语言/">编程语言</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/10/08/编程语言/shell/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/10/08/编程语言/shell/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/09/08/编程语言/JavaScript/" title="JavaScript变量和流程控制" itemprop="url">JavaScript变量和流程控制</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-09-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-09-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <p>JavaScript是一门基于原型继承的函数式的面向对象的编程语言,对象可以直接从其他对象继承属性,且JavaScript是无类型的.</p>
<h2 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h2><h3 id="数字"><a href="#数字" class="headerlink" title="数字"></a>数字</h3><p>JavaScript只有一个数字类型,它在内部被表示为64位的浮点数. 它没有分离出整数类型,因此1和1.0的值是相同的</p>
<p>NaN是一个数值，它表示一个不能产生正常结果的运算结果。<code>NaN</code>不等于任何值，包括它自己。可以使用函数<code>isNaN</code>来检测<code>NaN</code>。</p>
<h3 id="字符串"><a href="#字符串" class="headerlink" title="字符串"></a>字符串</h3><p>字符串可以由一对单引号或者一对双引号构成，可以包含0到多个字符。<code>\</code>是转义字符。JavaScript采用Unicode16作为字符集，因此所有的字符都是16位的。</p>
<p>字符串有一个length属性，可以获得字符串长度。</p>
<p>字符串同样也是不可变的。一旦字符串被创建出来就无法改变它。我们同+链接其他字符串创建一个新的字符串。俩个包含着相同字符且字符顺序也相同的字符被认为是同一个字符串。<code>===</code>进行字符串判断。</p>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>我们通过 <code>var</code>关键字来声明一个变量</p>
<h3 id="函数私有变量"><a href="#函数私有变量" class="headerlink" title="函数私有变量"></a>函数私有变量</h3><p>JavaScript通过函数管理作用域。在函数内部声明的变量只在这个函数内部可用，而在函数外面不可用。</p>
<h3 id="全局变量"><a href="#全局变量" class="headerlink" title="全局变量"></a>全局变量</h3><p>每个JavaScript环境有一个全局对象，当你在任意的函数外面使用this的时候可以访问到。你创建的每一个全局变量都成了这个全局对象的属性。</p>
<h2 id="控制流程"><a href="#控制流程" class="headerlink" title="控制流程"></a>控制流程</h2><p>我们可以通过条件语句(if和switch),循环语句（while，for和do）强制跳转语句（break,return，throw）和函数调用来改变执行序列。</p>
<h3 id="if"><a href="#if" class="headerlink" title="if"></a>if</h3><p>进行if判断时，下列值被作为假：</p>
<ul>
<li>false</li>
<li>null</li>
<li>空字符串 <code>&#39;&#39;</code></li>
<li>数字0</li>
<li>数字NaN</li>
</ul>
<h3 id="switch"><a href="#switch" class="headerlink" title="switch"></a>switch</h3><p>其表达式的值和case条件进行匹配。表达式可以是字符串或者数字。case表达式不一定必须是常量<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">switch</span> (num)</div><div class="line">&#123;</div><div class="line">	<span class="keyword">case</span> <span class="number">1</span>:</div><div class="line">	  x=<span class="string">"输入正确"</span>;</div><div class="line">	  <span class="keyword">break</span>;</div><div class="line">	<span class="keyword">default</span>:</div><div class="line">	  x=<span class="string">"输入错误"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="while"><a href="#while" class="headerlink" title="while"></a>while</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> (i&lt;<span class="number">5</span>)</div><div class="line">&#123;</div><div class="line">	sum += i;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="for"><a href="#for" class="headerlink" title="for"></a>for</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;<span class="number">5</span>; i++)</div><div class="line">&#123;</div><div class="line">	sum += i;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>for…in<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> array = [<span class="number">1</span>, <span class="number">2</span>]</div><div class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> array)</div><div class="line">&#123;</div><div class="line">	sum += i;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/编程语言/">编程语言</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/09/08/编程语言/JavaScript/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/09/08/编程语言/JavaScript/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/09/08/JavaLibrary/Archiva/" title="Archiva 初探" itemprop="url">Archiva 初探</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-09-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-09-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><ol>
<li>从<a href="">Archiva官网</a>下载Archiva后解压到<code>D:\archiva</code>里</li>
<li>运行<code>bin\archiva.bat install</code>, archiva就启动成功了</li>
<li>在浏览器运行<code>http://localhost:8080/</code>就可以进入archiva本地主页了</li>
<li>当进入之后我们需要创建一个账号：<img src="https://raw.githubusercontent.com/wanggnim/website/images/Archiva/0.jpg" alt=""></li>
<li>接着我们创建一个私有的仓库<img src="https://raw.githubusercontent.com/wanggnim/website/images/Archiva/1.jpg" alt=""></li>
<li>我们创建一个最简单的私有仓库：<img src="https://raw.githubusercontent.com/wanggnim/website/images/Archiva/2.jpg" alt=""></li>
<li>创建一个连接器<img src="https://raw.githubusercontent.com/wanggnim/website/images/Archiva/3.jpg" alt=""></li>
<li>同样我们只选用必须的<img src="https://raw.githubusercontent.com/wanggnim/website/images/Archiva/4.jpg" alt=""></li>
<li>接着如图操作<img src="https://raw.githubusercontent.com/wanggnim/website/images/Archiva/5.jpg" alt=""></li>
<li><p>然后我们修改项目中的<code>pom.xml</code>文件!</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?</span>xml version=<span class="string">"1.0"</span> encoding=<span class="string">"UTF-8"</span><span class="meta">?&gt;</span></span></div><div class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/POM/4.0.0"</span></span></div><div class="line">         <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">         <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>testMaven<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>testDeply<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">repositories</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>ID2015_09_17<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>NAME2015_09_17<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8080/repository/ID2015_09_17<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">repositories</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">pluginRepositories</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">pluginRepository</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>ID2015_09_17<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>NAME2015_09_17<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8080/repository/ID2015_09_17<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">pluginRepository</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">pluginRepositories</span>&gt;</span></div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">repository</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>ID2015_09_17<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">name</span>&gt;</span>NAME2015_09_17<span class="tag">&lt;/<span class="name">name</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8080/repository/ID2015_09_17<span class="tag">&lt;/<span class="name">url</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>修改本地仓库中的<code>setting.xml</code>文件(我的目录<code>C:\Users\Administrator\.m2</code>),我们添加私有仓库的用户名和密码!</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">settings</span> <span class="attr">xmlns</span>=<span class="string">"http://maven.apache.org/settings/1.0.0"</span></span></div><div class="line">          <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">          <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://maven.apache.org/SETTINGS/1.0.0 http://maven.apache.org/xsd/settings-1.0.0.xsd"</span>&gt;</div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">servers</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">server</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">id</span>&gt;</span>ID2015_09_17<span class="tag">&lt;/<span class="name">id</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">username</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">username</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">password</span>&gt;</span>admin1<span class="tag">&lt;/<span class="name">password</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">server</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">servers</span>&gt;</span></div><div class="line"></div><div class="line"> <span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java-Library/">Java Library</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/09/08/JavaLibrary/Archiva/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/09/08/JavaLibrary/Archiva/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/09/08/杂记/io/" title="IO" itemprop="url">IO</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-09-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-09-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="IO概念"><a href="#IO概念" class="headerlink" title="IO概念"></a>IO概念</h2><p>linux内核将内分分成内核区和用户区俩个区域：</p>
<ol>
<li>用户区进程A向内核发起一个读文件的系统调用(进程A阻塞)</li>
<li>linux在内核区生成一个文件句柄fd(该文件句柄指向了一个内核缓冲区)</li>
<li>linux通过驱动程序向磁盘读取指定文件</li>
<li>驱动程序将读取到的数据存储在内核区的缓冲区内</li>
<li>当内核缓冲区的大小大于进程A设置的读取文件的大小时发生读就绪,内核缓冲区的数据刷新到用户区内</li>
</ol>
<h2 id="IO类型"><a href="#IO类型" class="headerlink" title="IO类型"></a>IO类型</h2><h3 id="阻塞IO"><a href="#阻塞IO" class="headerlink" title="阻塞IO"></a>阻塞IO</h3><p>在进程空间中调用recvfrom,其系统调用直到数据报到达且被拷贝到应用进程的缓冲区中或者发生错误才返回,期间一直在等待.我们就说进程在从调用recvfrom开始到它返回的整段时间内是被阻塞的.<br><img src="https://raw.githubusercontent.com/wanggnim/website/images/net/阻塞IO.jpg" alt="阻塞IO.jpg"></p>
<h3 id="非阻塞IO"><a href="#非阻塞IO" class="headerlink" title="非阻塞IO"></a>非阻塞IO</h3><p>这种情况下用户空间的进程不断地向内核空间轮询是否有数据到达,如果没有达到不进入阻塞(睡眠)而是直接返回一个错误.<br><img src="https://raw.githubusercontent.com/wanggnim/website/images/net/非阻塞IO.jpg" alt="非阻塞IO.jpg"><br>这种操作效率是及其低下的,因为它把密集型IO操作变成了IO密集和计算密集的操作.</p>
<h3 id="SIGIO"><a href="#SIGIO" class="headerlink" title="SIGIO"></a>SIGIO</h3><p>首先开启套接口信号驱动I/O功能,并通过系统调用sigaction安装一个信号处理函数(此系统调用立即返回,进程继续工作,它是非阻塞的).当数据报准备好被读时,就为该进程生成一个SIGIO信号.随即可以在信号处理程序中调用recvfrom来读数据报,井通知主循环数据已准备好被处理中.也可以通知主循环,让它来读数据报.<br><img src="https://raw.githubusercontent.com/wanggnim/website/images/net/信号驱动IO.jpg" alt="信号驱动IO.jpg"></p>
<h3 id="IO复用"><a href="#IO复用" class="headerlink" title="IO复用"></a>IO复用</h3><p>在<code>select/poll</code>上注册多个<code>fd</code>, 然后<code>select/poll</code>顺序轮询所有的<code>fd</code>,如果轮询到某个<code>fd</code>读就绪或者写就绪就取出该<code>fd</code>进行读写数据,但是由于<code>select/poll</code>支持的<code>fd</code>数量有限而且是顺序扫描的,因此它的性能仍然会达不到要求. 于是<code>epoll</code>出现了,它是基于事件驱动方式,而不是顺序扫描,当有fd就绪时,立即回调函数rollback；<br><img src="https://raw.githubusercontent.com/wanggnim/website/images/net/IO复用.jpg" alt="IO复用.jpg"></p>
<h3 id="windows的IOCP"><a href="#windows的IOCP" class="headerlink" title="windows的IOCP"></a>windows的IOCP</h3><p>告知内核启动某个操作,并让内核在整个操作完成后(包括将数据从内核拷贝到用户自己的缓冲区)通知我们.这种模型与信号驱动模型的主要区别是：</p>
<ul>
<li>信号驱动I/O：由内核通知我们何时可以启动一个I/O操作；</li>
<li>异步I/O模型：由内核通知我们I/O操作何时完成.<br><img src="https://raw.githubusercontent.com/wanggnim/website/images/net/异步IO.jpg" alt="异步IO.jpg"></li>
</ul>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/杂记/">杂记</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/09/08/杂记/io/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/09/08/杂记/io/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/09/08/JavaSE/Java8 流/" title="java8 流" itemprop="url">java8 流</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-09-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-09-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h1 id="流"><a href="#流" class="headerlink" title="流"></a>流</h1><p>java8中新添加的流又称为<code>Streams API</code>. 它是对集合（Collection）对象功能的增强，它专注于对集合对象进行各种非常便利、高效的聚合操作（aggregate operation），或者大批量数据操作 (bulk data operation).</p>
<p>接下来我们构建一个流:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">      .filter(ele -&gt; ele.equals(<span class="string">"123"</span>))</div><div class="line">      .count();</div></pre></td></tr></table></figure></p>
<p>我们通过上述代码构建流一个流,这里有俩个概念要说:</p>
<ul>
<li>惰性求值方法:像<code>filter</code>方法,它只是在刻画Stream,它并不会被调用.(在Stream方法中凡事返回Stream对象的都是这种方法)</li>
<li>及早求值方法:像<code>count</code>方法,它会从Stream中最终产生值.(在Stream方法中凡事返回空或者另一个值都是这种方法)</li>
</ul>
<h2 id="常用的流操作"><a href="#常用的流操作" class="headerlink" title="常用的流操作"></a>常用的流操作</h2><h3 id="collect"><a href="#collect" class="headerlink" title="collect()"></a>collect()</h3><p>该方法会产生一个列表,是一个及早求值方法.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">      .filter(ele -&gt; ele.equals(<span class="string">"123"</span>))</div><div class="line">      .collect(Collectors.toList());</div></pre></td></tr></table></figure></p>
<p>当然我们还可以调用<code>Collectors.toSet()</code>等其他方法,构建其他集合</p>
<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/java8/map.jpg" alt=""><br>该操作会将一个流中的值转换为一个新的流<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">      .map(num -&gt; &#123;</div><div class="line">          <span class="keyword">if</span> (num &gt; <span class="number">1</span>) &#123;</div><div class="line">             <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">             <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">          &#125;</div><div class="line">       &#125;)</div><div class="line">       .collect(Collectors.toSet())</div><div class="line">       .forEach(ele -&gt; System.out.println(ele));</div></pre></td></tr></table></figure></p>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/java8/filter.jpg" alt=""><br>遍历数据并检查其中的元素是否符合某种条件</p>
<p>这个操作看起来和<code>map</code>很像, 但是<code>map</code>是根据操作的结果产生新的流,而<code>filter</code>是判断流中的数据是否符合条件保留下来<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">               .filter(ele -&gt; &#123;</div><div class="line">                   <span class="keyword">if</span> (ele &gt; <span class="number">1</span>) &#123;</div><div class="line">                       <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">                   &#125; <span class="keyword">else</span> &#123;</div><div class="line">                       <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">                   &#125;</div><div class="line">               &#125;)</div><div class="line">               .collect(Collectors.toSet())</div><div class="line">               .forEach(ele -&gt; System.out.println(ele));</div></pre></td></tr></table></figure></p>
<h3 id="flatMap"><a href="#flatMap" class="headerlink" title="flatMap"></a>flatMap</h3><p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/java8/flatMap.jpg" alt=""><br>用于Stream替换值然后将多个流连接到一起</p>
<p>首先我们看一种情况,流里有俩个列表<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"> Stream.of(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>),Arrays.asList(<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>))</div><div class="line">                .collect(Collectors.toSet())</div><div class="line">                .forEach(ele -&gt; System.out.println(ele));</div><div class="line"></div><div class="line">输出的结果是:</div><div class="line">[<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</div><div class="line">[<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>]</div></pre></td></tr></table></figure></p>
<p>如果我们想将这俩个列表组合到一起呢?<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Stream.of(Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>),Arrays.asList(<span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>))</div><div class="line">                    .flatMap(list -&gt; &#123;</div><div class="line">                        <span class="keyword">return</span> list.stream();</div><div class="line">                    &#125;)</div><div class="line">                .collect(Collectors.toSet())</div><div class="line">                .forEach(ele -&gt; System.out.println(ele));</div></pre></td></tr></table></figure></p>
<p>看到了吧,我们首先讲列表转换成流,然后由<code>flatMap</code>操作将流组合到一起</p>
<h3 id="max"><a href="#max" class="headerlink" title="max"></a>max</h3><p>查找流中的最大值<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Integer max = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">                .max(Comparator.comparing(ele -&gt; ele))</div><div class="line">                .get();</div><div class="line">        System.out.println(max);</div></pre></td></tr></table></figure></p>
<p>我们需要向<code>max</code>操作中传递一个排序的动作. <code>Comparator.comparing()</code>这个静态方法是java8新添加的方法,它实现流一个方便的比较器.以前我们需要比较俩个对象的某项属性的值,现在只需要提供一个取值方法就好了.</p>
<h3 id="min"><a href="#min" class="headerlink" title="min"></a>min</h3><p>查找流中的最小值<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Integer min = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">                .min(Comparator.comparing(ele -&gt; ele))</div><div class="line">                .get();</div><div class="line">        System.out.println(min);</div></pre></td></tr></table></figure></p>
<p>和<code>max</code>相似</p>
<h3 id="reduce"><a href="#reduce" class="headerlink" title="reduce"></a>reduce</h3><p>从一组值生成一个值.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Integer sum = Stream.of(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</div><div class="line">                .reduce((inSum, element) -&gt; &#123;</div><div class="line">                    <span class="keyword">return</span> inSum + element;</div><div class="line">                &#125;).get();</div><div class="line">        System.out.println(sum);</div></pre></td></tr></table></figure></p>
<p><code>reduce</code>中的<code>BinaryOperator</code>类型的lambda表达式第一个参数是上个元素执行<code>reduce</code>操作的结果, 第二个参数是流中的每个元素.</p>
<p>另外Stream中还有其他的<code>reduce</code>操作,可以指定开始结束的的位置</p>
<h1 id="元素顺序"><a href="#元素顺序" class="headerlink" title="元素顺序"></a>元素顺序</h1><p>在一个有序集合中创建一个流时，流中元素就按照出现的顺序进行排列:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Arrays.asList(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>).stream().forEach(ele -&gt; System.out.println(ele));</div></pre></td></tr></table></figure></p>
<p>上面这个输出顺序总是<code>1, 2, 3</code>.</p>
<p>而如果一个集合本身是无序的话，那么生成的流也是无序的，最后由流生成的集合也是无序的</p>
<h1 id="使用收集器"><a href="#使用收集器" class="headerlink" title="使用收集器"></a>使用收集器</h1><p><code>java.util.stream.Collectors</code>这是java提供的一种通用的，从流生成复杂值结构的收集器.</p>
<h2 id="转换成其他集合"><a href="#转换成其他集合" class="headerlink" title="转换成其他集合"></a>转换成其他集合</h2><p>Collectors提供了转换成其他集合的方式</p>
<ul>
<li><code>Collectors.toCollection()</code>： 接受一个函数作为参数，来创建集合</li>
<li><code>Collectors.toConcurrentMap()</code></li>
<li><code>Collectors.toList()</code>： 不需要指定具体的类型，Stream会自动挑选出合适的类型</li>
<li><code>Collectors.toMap()</code></li>
<li><code>Collectors.toSet()</code>： 不需要指定具体的类型，Stream会自动挑选出合适的类型</li>
</ul>
<h2 id="groupingBy"><a href="#groupingBy" class="headerlink" title="groupingBy"></a>groupingBy</h2><p>数据分组</p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</div><div class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">		Map&lt;Integer, List&lt;Integer&gt;&gt; group = list.stream().collect(Collectors.groupingBy(ele -&gt; &#123;</div><div class="line">			<span class="keyword">if</span> (ele &gt; <span class="number">5</span>) &#123;</div><div class="line">				<span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				<span class="keyword">return</span> <span class="number">2</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;));</div><div class="line"></div><div class="line"><span class="comment">// 最后结果为</span></div><div class="line">&#123;<span class="number">1</span>:[</div><div class="line">		<span class="number">10</span>,</div><div class="line">		<span class="number">9</span>,</div><div class="line">		<span class="number">11</span>,</div><div class="line">		<span class="number">6</span>,</div><div class="line">		<span class="number">7</span>,</div><div class="line">		<span class="number">8</span></div><div class="line">	],</div><div class="line"> <span class="number">2</span>:[</div><div class="line">		<span class="number">1</span>,</div><div class="line">		<span class="number">2</span>,</div><div class="line">		<span class="number">3</span>,</div><div class="line">		<span class="number">2</span>,</div><div class="line">		<span class="number">4</span>,</div><div class="line">		<span class="number">5</span></div><div class="line">	]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然分组的key,我们还可以取其他的类型,这完全取决于我们的返回值<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Map&lt;String, List&lt;Integer&gt;&gt; group = list.stream().collect(Collectors.groupingBy(ele -&gt; &#123;</div><div class="line">			<span class="keyword">if</span> (ele &gt; <span class="number">5</span>) &#123;</div><div class="line">				<span class="keyword">return</span> <span class="string">"1"</span>;</div><div class="line">			&#125; <span class="keyword">else</span> &#123;</div><div class="line">				<span class="keyword">return</span> <span class="string">"2"</span>;</div><div class="line">			&#125;</div><div class="line">		&#125;));</div></pre></td></tr></table></figure></p>
<h2 id="groupingByConcurrent"><a href="#groupingByConcurrent" class="headerlink" title="groupingByConcurrent"></a>groupingByConcurrent</h2><p>并发版本的<code>group by</code>实现</p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</div><div class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</div><div class="line">｝</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>);</div><div class="line">ConcurrentMap&lt;Integer, List&lt;Integer&gt;&gt; result = list.stream().collect(Collectors.groupingByConcurrent(ele -&gt; ele - <span class="number">3</span>));</div><div class="line"></div><div class="line"><span class="comment">// 结果</span></div><div class="line">&#123;-<span class="number">2</span>:[<span class="number">1</span>],</div><div class="line"> -<span class="number">1</span>:[</div><div class="line">		<span class="number">2</span>,</div><div class="line">		<span class="number">2</span></div><div class="line">	],</div><div class="line">  <span class="number">0</span>:[<span class="number">3</span>],</div><div class="line">  <span class="number">7</span>:[<span class="number">10</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="partitioningBy"><a href="#partitioningBy" class="headerlink" title="partitioningBy"></a>partitioningBy</h2><p>数据分组,key为<code>True</code>和<code>False</code></p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Predicate</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">test</span><span class="params">(T t)</span></span>;</div><div class="line">｝</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">Map&lt;Boolean, List&lt;Integer&gt;&gt; result = list.stream().collect(Collectors.partitioningBy(ele -&gt; ele == <span class="number">1</span>));</div><div class="line">System.out.println(JSON.toJSONString(result, <span class="keyword">true</span>));</div><div class="line"></div><div class="line"><span class="comment">// 结果为</span></div><div class="line">&#123;<span class="keyword">false</span>:[</div><div class="line">		<span class="number">10</span>,</div><div class="line">		<span class="number">2</span>,</div><div class="line">		<span class="number">3</span>,</div><div class="line">		<span class="number">2</span>,</div><div class="line">		<span class="number">9</span>,</div><div class="line">		<span class="number">4</span>,</div><div class="line">		<span class="number">5</span>,</div><div class="line">		<span class="number">11</span>,</div><div class="line">		<span class="number">6</span>,</div><div class="line">		<span class="number">7</span>,</div><div class="line">		<span class="number">8</span></div><div class="line">	],</div><div class="line"><span class="keyword">true</span>:[<span class="number">1</span>]</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="averagingDouble"><a href="#averagingDouble" class="headerlink" title="averagingDouble"></a>averagingDouble</h2><p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToDoubleFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">applyAsDouble</span><span class="params">(T value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>);</div><div class="line">Double result = list.stream().collect(Collectors.averagingDouble(ele -&gt; ele - <span class="number">3</span>));</div><div class="line"></div><div class="line"><span class="comment">// 结果</span></div><div class="line"><span class="number">0.6</span></div></pre></td></tr></table></figure></p>
<h2 id="averagingInt"><a href="#averagingInt" class="headerlink" title="averagingInt"></a>averagingInt</h2><p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToIntFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">applyAsInt</span><span class="params">(T value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>);</div><div class="line">Double result = list.stream().collect(Collectors.averagingInt(ele -&gt; ele - <span class="number">3</span>));</div><div class="line"><span class="comment">// 结果</span></div><div class="line"><span class="number">0.6</span></div></pre></td></tr></table></figure></p>
<h2 id="averagingLong"><a href="#averagingLong" class="headerlink" title="averagingLong"></a>averagingLong</h2><p>对流中数据进行进行平均数操作</p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToLongFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">long</span> <span class="title">applyAsLong</span><span class="params">(T value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">Double result = list.stream().collect(Collectors.averagingLong(ele -&gt; ele));</div></pre></td></tr></table></figure></p>
<h2 id="summarizingInt"><a href="#summarizingInt" class="headerlink" title="summarizingInt"></a>summarizingInt</h2><p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToIntFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">applyAsInt</span><span class="params">(T value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">IntSummaryStatistics result = list.stream().collect(Collectors.summarizingInt(ele -&gt; ele));</div><div class="line"></div><div class="line"><span class="comment">// 结果为</span></div><div class="line">&#123;</div><div class="line">	<span class="string">"average"</span>:<span class="number">5.666666666666667</span>,</div><div class="line">	<span class="string">"count"</span>:<span class="number">12</span>,</div><div class="line">	<span class="string">"max"</span>:<span class="number">11</span>,</div><div class="line">	<span class="string">"min"</span>:<span class="number">1</span>,</div><div class="line">	<span class="string">"sum"</span>:<span class="number">68</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="summarizingLong"><a href="#summarizingLong" class="headerlink" title="summarizingLong"></a>summarizingLong</h2><p>统计流中数据分布</p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToLongFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">long</span> <span class="title">applyAsLong</span><span class="params">(T value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">LongSummaryStatistics result = list.stream().collect(Collectors.summarizingLong(ele -&gt; ele));</div><div class="line"></div><div class="line"><span class="comment">// 结果为</span></div><div class="line">&#123;</div><div class="line">	<span class="string">"average"</span>:<span class="number">5.666666666666667</span>,</div><div class="line">	<span class="string">"count"</span>:<span class="number">12</span>,</div><div class="line">	<span class="string">"max"</span>:<span class="number">11</span>,</div><div class="line">	<span class="string">"min"</span>:<span class="number">1</span>,</div><div class="line">	<span class="string">"sum"</span>:<span class="number">68</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="summarizingDouble"><a href="#summarizingDouble" class="headerlink" title="summarizingDouble"></a>summarizingDouble</h2><p>统计流中数据分布</p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToDoubleFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">applyAsDouble</span><span class="params">(T value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">DoubleSummaryStatistics result = list.stream().collect(Collectors.summarizingDouble(ele -&gt; ele));</div><div class="line"></div><div class="line"><span class="comment">// 结果</span></div><div class="line">&#123;</div><div class="line">	<span class="string">"average"</span>:<span class="number">5.666666666666667</span>,</div><div class="line">	<span class="string">"count"</span>:<span class="number">12</span>,</div><div class="line">	<span class="string">"max"</span>:<span class="number">11</span>,</div><div class="line">	<span class="string">"min"</span>:<span class="number">1</span>,</div><div class="line">	<span class="string">"sum"</span>:<span class="number">68</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="counting"><a href="#counting" class="headerlink" title="counting"></a>counting</h2><p>统计流中数据数量</p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">Long result = list.stream().collect(Collectors.counting());</div></pre></td></tr></table></figure></p>
<h2 id="maxBy"><a href="#maxBy" class="headerlink" title="maxBy"></a>maxBy</h2><p>取出一个列表中的最大值,不过我们要自己定义一个对比规则</p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(T o1, T o2)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">Optional&lt;Integer&gt; result = list.stream().collect(Collectors.maxBy((ele1, ele2) -&gt; ele1 - ele2));</div></pre></td></tr></table></figure></p>
<h2 id="minBy"><a href="#minBy" class="headerlink" title="minBy"></a>minBy</h2><p>取出一个列表中的最大值,不过我们要自己定义一个对比规则</p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Comparator</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">compare</span><span class="params">(T o1, T o2)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">Optional&lt;Integer&gt; result = list.stream().collect(Collectors.minBy((ele1, ele2) -&gt; ele1 - ele2));</div></pre></td></tr></table></figure></p>
<h2 id="summingDouble"><a href="#summingDouble" class="headerlink" title="summingDouble"></a>summingDouble</h2><p>对列表数据取和操作,结果为<code>Double</code></p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToDoubleFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">double</span> <span class="title">applyAsDouble</span><span class="params">(T value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">Double result = list.stream().collect(Collectors.summingDouble(ele -&gt; ele));</div><div class="line"><span class="comment">// 结果为68</span></div></pre></td></tr></table></figure></p>
<h2 id="summingInt"><a href="#summingInt" class="headerlink" title="summingInt"></a>summingInt</h2><p>对列表数据取和操作,结果为<code>Int</code></p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToIntFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">int</span> <span class="title">applyAsInt</span><span class="params">(T value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">Integer result = list.stream().collect(Collectors.summingInt(ele -&gt; ele));</div></pre></td></tr></table></figure></p>
<h2 id="summingLong"><a href="#summingLong" class="headerlink" title="summingLong"></a>summingLong</h2><p>对列表数据取和操作,结果为<code>Long</code></p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ToLongFunction</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="function"><span class="keyword">long</span> <span class="title">applyAsLong</span><span class="params">(T value)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">List&lt;Integer&gt; list = Arrays.asList(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>);</div><div class="line">Long result = list.stream().collect(Collectors.summingLong(ele -&gt; ele));</div></pre></td></tr></table></figure></p>
<h2 id="joining"><a href="#joining" class="headerlink" title="joining"></a>joining</h2><p>将流中的数据拼接成一个字符串. 需要注意的是如果流中的数据不是<code>String</code>类型的数据,可以通过<code>map</code>操作将流中数据转换成<code>String</code>类型</p>
<p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</div><div class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">"1"</span>, <span class="string">"10"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"2"</span>);</div><div class="line">String result = list.stream().collect(Collectors.joining(<span class="string">","</span>, <span class="string">"("</span>, <span class="string">")"</span>));</div><div class="line"><span class="comment">// 结果</span></div><div class="line"><span class="string">"(1,10,2,3,2)"</span></div></pre></td></tr></table></figure></p>
<h2 id="reducing"><a href="#reducing" class="headerlink" title="reducing"></a>reducing</h2><p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="function">R <span class="title">apply</span><span class="params">(T t, U u)</span></span>;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></p>
<h2 id="mapping"><a href="#mapping" class="headerlink" title="mapping"></a>mapping</h2><p>lambda表达式类型<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Function</span>&lt;<span class="title">T</span>, <span class="title">R</span>&gt; </span>&#123;</div><div class="line">    <span class="function">R <span class="title">apply</span><span class="params">(T t)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>示例：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">"1"</span>, <span class="string">"10"</span>, <span class="string">"2"</span>, <span class="string">"3"</span>, <span class="string">"2"</span>);</div><div class="line">List&lt;String&gt; result = list.stream().collect(Collectors.mapping(ele -&gt; ele + <span class="number">1</span>, Collectors.toList()));</div><div class="line"><span class="comment">// 结果</span></div><div class="line">[</div><div class="line">	<span class="string">"11"</span>,</div><div class="line">	<span class="string">"101"</span>,</div><div class="line">	<span class="string">"21"</span>,</div><div class="line">	<span class="string">"31"</span>,</div><div class="line">	<span class="string">"21"</span></div><div class="line">]</div></pre></td></tr></table></figure></p>
<h2 id="distinct"><a href="#distinct" class="headerlink" title="distinct"></a>distinct</h2><p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/java8/distinct.jpg" alt=""></p>
<h2 id="limit"><a href="#limit" class="headerlink" title="limit"></a>limit</h2><p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/java8/limit.jpg" alt=""></p>
<h2 id="peek"><a href="#peek" class="headerlink" title="peek"></a>peek</h2><p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/java8/peek.jpg" alt=""></p>
<h2 id="skip"><a href="#skip" class="headerlink" title="skip"></a>skip</h2><p><img src="https://raw.githubusercontent.com/ming15/blog-website/images/java8/skip.jpg" alt=""></p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java/">Java</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/09/08/JavaSE/Java8 流/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/09/08/JavaSE/Java8 流/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>






   
    
    <article class="post-expand post" itemprop="articleBody"> 
        <header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/09/08/JavaSE/Java8 lambda/" title="java lambda" itemprop="url">java lambda</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="王玉" target="_blank" itemprop="author">王玉</a>
		
  <p class="article-time">
    <time datetime="2015-09-08T07:00:00.000Z" itemprop="datePublished"> Published 2015-09-08</time>
    
  </p>
</header>
    <div class="article-content">
        
        <h2 id="函数接口"><a href="#函数接口" class="headerlink" title="函数接口"></a>函数接口</h2><h3 id="函数接口定义"><a href="#函数接口定义" class="headerlink" title="函数接口定义"></a>函数接口定义</h3><p>函数接口只是一个抽象方法的接口,用作lambda表达式类型.</p>
<p>注意, 上面这个定义有三个需要注意的地方</p>
<ol>
<li>函数接口是一个接口</li>
<li>函数接口有且只有一个抽象方法(只有一个表示数量上是唯一的,重载也是不可以)</li>
<li>函数接口用作lambda表达式类型</li>
</ol>
<h3 id="函数接口示例"><a href="#函数接口示例" class="headerlink" title="函数接口示例:"></a>函数接口示例:</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义一个非泛型没有返回值没有参数的函数接口</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run1</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runFast</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 定义一个非泛型没有返回值有参数的函数接口</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run2</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runFast</span><span class="params">(<span class="keyword">int</span> seconds)</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 定义一个非泛型有返回值有参数的函数接口</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run3</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">runFast</span><span class="params">(<span class="keyword">int</span> seconds)</span></span>;</div><div class="line">&#125;</div><div class="line"><span class="comment">// 定义一个泛型有返回值有参数的函数接口</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run4</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">runFast</span><span class="params">(T t, <span class="keyword">int</span> seconds)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="默认方法"><a href="#默认方法" class="headerlink" title="默认方法"></a>默认方法</h3><p>我们知道java8对核心集合类进行了大幅度修改,例如<code>Collection</code>接口添加了<code>stream()</code>方法. 那么所有的<code>Collection</code>实现类都必须来实现该方法. 为了保持二进制接口的兼容性,java8提供了默认方法,来保证这一兼容性(例如来源在java1到jav7平台写出的代码仍然可以在java8平台上编译运行)<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run10</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runFast</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">default</span> <span class="keyword">void</span> <span class="title">runAt9Clock</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"run10 runAt9Clock"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run11</span>  <span class="keyword">extends</span> <span class="title">Run10</span> </span>&#123;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// 调用</span></div><div class="line">Run11 run11 = () -&gt; &#123;</div><div class="line">	System.out.println();</div><div class="line">&#125;;</div><div class="line">run11.runAt9Clock();</div></pre></td></tr></table></figure></p>
<p>那么所有的子类都可以来调用这个默认方法, 而不必实现它。</p>
<blockquote>
<p>如果接口中只有一个默认方法,那么这个接口就不是接口函数.</p>
</blockquote>
<h4 id="继承默认方法"><a href="#继承默认方法" class="headerlink" title="继承默认方法"></a>继承默认方法</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run11</span> <span class="keyword">extends</span> <span class="title">Run10</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">default</span> <span class="keyword">void</span> <span class="title">runAt9Clock</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"run11 runAt9Clock"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Run12</span> <span class="keyword">implements</span> <span class="title">Run10</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runFast</span><span class="params">()</span> </span>&#123;&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runAt9Clock</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"run12 runAt9Clock"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>从上面的例子中我们可以看到如果接口<code>Run11</code>继承了接口<code>Run10</code>, 同时重载了默认方法, 那么<code>Run11</code>中的默认方法也必须含有<code>default</code>关键字. 但是在类中重载的话,就可以不必存在了.<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">Run11 run11 = () -&gt; &#123;</div><div class="line">	System.out.println();</div><div class="line">&#125;;</div><div class="line">run11.runAt9Clock();</div><div class="line"></div><div class="line">Run12 run12 = <span class="keyword">new</span> Run12();</div><div class="line">run12.runAt9Clock();</div><div class="line"></div><div class="line"><span class="comment">//result</span></div><div class="line">run11 runAt9Clock</div><div class="line">run12 runAt9Clock</div></pre></td></tr></table></figure></p>
<p>接着我们都调用默认方法,我们发现当调用默认方法时都会优先调用子类中的方法.</p>
<h4 id="多重继承"><a href="#多重继承" class="headerlink" title="多重继承"></a>多重继承</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run10</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">default</span> <span class="keyword">void</span> <span class="title">runAt9Clock</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"run10 runAt9Clock"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run13</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">default</span> <span class="keyword">void</span> <span class="title">runAt9Clock</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"run13 runAt9Clock"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Run14</span> <span class="keyword">implements</span> <span class="title">Run10</span>, <span class="title">Run13</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runAt9Clock</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在上面这个情况下,我们需要手动在<code>Run14</code>这个类中指定重载哪个方法, 否则会产生编译错误：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Run14</span> <span class="keyword">implements</span> <span class="title">Run10</span>, <span class="title">Run13</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runAt9Clock</span><span class="params">()</span> </span>&#123;</div><div class="line">		Run10.<span class="keyword">super</span>.runAt9Clock();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="接口静态方法"><a href="#接口静态方法" class="headerlink" title="接口静态方法"></a>接口静态方法</h3><p>我们定义一个接口静态方法<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run1</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runFast</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">runSlowly</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"run1 run slowly"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//</span></div><div class="line">Run1.runSlowly();</div></pre></td></tr></table></figure></p>
<p>需要注意的是：</p>
<ul>
<li>接口静态方法不会被继承到子接口或者子类中</li>
</ul>
<h3 id="FunctionalInterface"><a href="#FunctionalInterface" class="headerlink" title="@FunctionalInterface"></a>@FunctionalInterface</h3><p>所有的函数接口都应该添加<code>@FunctionalInterface</code>注释. 该注释会强制检查javac检查一个接口是否符合函数接口的标准. 如果将这个注释添加给类，枚举，多个方法的接口都会产生编译错误.</p>
<h2 id="lambda表达式"><a href="#lambda表达式" class="headerlink" title="lambda表达式"></a>lambda表达式</h2><h3 id="lambda表达式定义"><a href="#lambda表达式定义" class="headerlink" title="lambda表达式定义"></a>lambda表达式定义</h3><p>接下来我们根据上面定义的函数接口来定义一下lambda表达式<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 不带参数的版本</span></div><div class="line">Run1 run1 = () -&gt; &#123;</div><div class="line">	System.out.println(<span class="string">"I am running"</span>);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 参数要指定</span></div><div class="line">Run2 run2 = seconds -&gt; &#123;</div><div class="line">	System.out.println(<span class="string">"I am running "</span> + seconds + <span class="string">" seconds"</span>);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 下面这个版本就必须要有个返回值了</span></div><div class="line">Run3 run3 = seconds -&gt; &#123;</div><div class="line">	System.out.println(<span class="string">"I am running"</span>);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">// 我们在下面的版本中指定了它的泛型信息</span></div><div class="line">Run4&lt;String&gt; run4 = (name, seconds) -&gt; &#123;</div><div class="line">	System.out.println(name + <span class="string">" is running"</span>);</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h3 id="lambda表达式使用"><a href="#lambda表达式使用" class="headerlink" title="lambda表达式使用"></a>lambda表达式使用</h3><p>接下来我们使用上面定义的lambda表达式<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">run1.runFast();</div><div class="line">-&gt; I am running</div><div class="line"></div><div class="line">run2.runFast(<span class="number">10</span>);</div><div class="line">-&gt; I am running <span class="number">10</span> seconds</div><div class="line"></div><div class="line"><span class="keyword">int</span> result = run3.runFast(<span class="number">10</span>);</div><div class="line">-&gt; I am running</div><div class="line"></div><div class="line">run4.runFast(<span class="string">"小狗"</span>, <span class="number">10</span>); 小狗 is running</div><div class="line">-&gt;</div></pre></td></tr></table></figure></p>
<h4 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h4><p>我们引用lambda表达式外部的一个变量<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">String name = <span class="string">"sam"</span>;</div><div class="line">Run1 run1 = () -&gt; &#123;</div><div class="line">	System.out.println(name + <span class="string">" am running"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>编译运行通过没有问题,但是如果我们将name在lambda表达式内部重新赋值的话</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">String name = <span class="string">"sam"</span>;</div><div class="line">Run1 run1 = () -&gt; &#123;</div><div class="line">	name = <span class="string">""</span>;</div><div class="line">	System.out.println(name + <span class="string">" am running"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>会提示<code>variable used in lambda expression shouble be final</code>, 这说明lambda其实内部引用的是值而不是变量.</p>
<p>好,接下来我们换种方式再次验证一下我们的结果：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">String name = <span class="string">"sam"</span>;</div><div class="line">name = <span class="string">"Jams"</span>;</div><div class="line">Run1 run1 = () -&gt; &#123;</div><div class="line">	System.out.println(name + <span class="string">" am running"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>同样的产生了编译错误.</p>
<h4 id="java中重要的函数接口"><a href="#java中重要的函数接口" class="headerlink" title="java中重要的函数接口"></a>java中重要的函数接口</h4><ul>
<li><code>Predicate&lt;T&gt;</code>: <code>boolean test(T t)</code> 判断输入的对象是否符合某个条件</li>
<li><code>Consumer&lt;T&gt;</code>: <code>void accept(T t);</code>  接收一个输入参数并且没有返回值</li>
<li><code>Supplier&lt;T&gt;</code>: <code>T get();</code>  可以看成一个对象的工厂，每次调用返回一个给定类型的对象</li>
<li><code>UnaryOperator&lt;T&gt;</code>: ``</li>
<li><code>BinaryOperator&lt;T&gt;</code>: ``</li>
</ul>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>在Java8中什么是函数呢？<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">Run1 run1 = () -&gt; &#123;</div><div class="line">	System.out.println(<span class="string">"I am running"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>上面<code>run1</code>这个就代表一个函数. 一般我们把属于某个类的函数称为方法, 而不依赖于类而存在的函数称之为方法.</p>
<h3 id="高阶函数"><a href="#高阶函数" class="headerlink" title="高阶函数"></a>高阶函数</h3><p>如果某个函数A作为函数B的参数或者返回值, 那么我们称函数B为高阶函数,像下面的<code>run6</code>就是一个高级函数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run6</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Run1 run1)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Run6 run6 = run1Param -&gt; &#123;</div><div class="line">			System.out.println(<span class="string">"run6"</span>);</div><div class="line">			run1Param.runFast();</div><div class="line">		&#125;;</div><div class="line"></div><div class="line">run6.run(run1);</div></pre></td></tr></table></figure></p>
<p>我们将<code>run1</code>这个函数作为方法传递给了<code>run6</code>.</p>
<h4 id="返回函数"><a href="#返回函数" class="headerlink" title="返回函数"></a>返回函数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run8</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(String name, <span class="keyword">int</span> second, <span class="keyword">int</span> mils)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run9</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> Run8 <span class="title">run</span><span class="params">(Run8 run8)</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line">Run8 run8 = (name, second, mils) -&gt; &#123;</div><div class="line">	System.out.println();</div><div class="line">&#125;;</div><div class="line"></div><div class="line">Run9 run9 = run8Param -&gt; &#123;</div><div class="line">	<span class="keyword">return</span> run8Param.run(<span class="string">"lily"</span>);</div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>在上述的例子中产生了编译错误, 在<code>Haskell</code>这种纯FP语言中可以将一个调用函数但是参数不完整的函数从某个参数中返回或者定义一个参数不完整的函数值.</p>
<h3 id="重载解析"><a href="#重载解析" class="headerlink" title="重载解析"></a>重载解析</h3><p>我们使用函数接口作为方法参数,然后进行重载<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 定义函数接口</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run1</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runFast</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run2</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runFast</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">// 定义重载代码</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Run1 run1)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"run1"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(Run2 run2)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"run2"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line"><span class="comment">// 定义运行代码</span></div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">	run(() -&gt; System.out.println());</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当我们进行如上定义时,javac提示了编译错误：不确定的方法调用,<code>run(Run1 run1)</code>和<code>run(Run2 run2)</code>都符合.</p>
<p>但是如果<code>Run2</code>继承了<code>Run1</code>这个接口之后<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run1</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runFast</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Run2</span> <span class="keyword">extends</span> <span class="title">Run1</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">runFast</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当我们运行测试代码之后,我们发现输出的<code>run2</code>.</p>
<p>当Lambda表达式作为参数时,其类型由它的目标类型推导得出,推导过程遵循如下规则：</p>
<ul>
<li>如果只有一个可能的目标类型,由相应的函数接口里的参数类型推导得出</li>
<li>如果有多个可能的目标类型，由最具体的类型推导得出</li>
<li>如果有多个可能的目标类型且最具体的类型不明确，则需要人为指定类型</li>
</ul>
<h2 id="方法引用"><a href="#方法引用" class="headerlink" title="方法引用"></a>方法引用</h2><p>方法引用是简洁的Lambda表达式，能够用于已经拥有名称的方法。</p>
<ul>
<li>静态方法 (ClassName::methName)</li>
<li>对象实例方法 (instanceRef::methName)</li>
<li>类型的实例方法 (ClassName::methName, 引用时和静态方法是一样的，但这里的 methName 是个实例方法)</li>
<li>构造方法 (ClassName::new)</li>
<li>数组的构造方法 (TypeName[]::new)</li>
</ul>
<h3 id="静态方法引用"><a href="#静态方法引用" class="headerlink" title="静态方法引用"></a>静态方法引用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Print</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		F f = Print::p;</div><div class="line">		f.m();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">p</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"Print"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@FunctionalInterface</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">F</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">void</span> <span class="title">m</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="类型实例方法引用"><a href="#类型实例方法引用" class="headerlink" title="类型实例方法引用"></a>类型实例方法引用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Print</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		F f = String::length;</div><div class="line">		<span class="keyword">int</span> len = f.m(<span class="string">"12"</span>);</div><div class="line">		System.out.println(len);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@FunctionalInterface</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">F</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">int</span> <span class="title">m</span><span class="params">(String p)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="构造方法引用"><a href="#构造方法引用" class="headerlink" title="构造方法引用"></a>构造方法引用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Print</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		F f = Print::<span class="keyword">new</span>;</div><div class="line">		Print p = f.m();</div><div class="line">		System.out.println(p == <span class="keyword">null</span>);	<span class="comment">// 结果为null</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">@FunctionalInterface</span></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">F</span> </span>&#123;</div><div class="line">	<span class="function">Print <span class="title">m</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="闭包"><a href="#闭包" class="headerlink" title="闭包"></a>闭包</h3><p>Java8还提供了闭包这个特性,虽然我不知道闭包这个特性有啥用,但是还是实验了一下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Java8</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">		I i = () -&gt; &#123;</div><div class="line">			C c = <span class="keyword">new</span> C();</div><div class="line">			c.count = <span class="number">10</span>;</div><div class="line"></div><div class="line">			J j = () -&gt; &#123;</div><div class="line">				System.out.println(<span class="string">"J print c:"</span> + c.count);</div><div class="line">				<span class="keyword">return</span> c;</div><div class="line">			&#125;;</div><div class="line"></div><div class="line">			System.out.println(<span class="string">"I print c:"</span> + c.count);</div><div class="line">			<span class="keyword">return</span> j;</div><div class="line">		&#125;;</div><div class="line"></div><div class="line">		J j = i.r();</div><div class="line">		C c = j.c();</div><div class="line">		c.count = <span class="number">20</span>;</div><div class="line">		System.out.println(<span class="string">"main print c:"</span> + c.count);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">I</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> J <span class="title">r</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">interface</span> <span class="title">J</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> C <span class="title">c</span><span class="params">()</span></span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span> </span>&#123;</div><div class="line">	<span class="keyword">public</span> <span class="keyword">int</span> count;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我们定义了俩个接口, <code>I</code>和<code>J</code>, 我们在I的lambada中调用J的lambada, 然后让J返回一个定义在I的对象C, 最后我们在main函数中成功的返回了这个对象.</p>

        
        
        <p class="article-more-link">
          
       </p>
    </div>
    <footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/Java/">Java</a>
</div>


</div>




<div class="comments-count">
	
	  	<span></span>
		<a href="/2015/09/08/JavaSE/Java8 lambda/#comments" class="ds-thread-count comments-count-link" data-thread-key="2015/09/08/JavaSE/Java8 lambda/" data-count-type="comments">&nbsp;</a>
	
</div>

</footer>


    </article>







  <nav id="page-nav" class="clearfix">
    <a class="extend prev" rel="prev" href="/page/5/"><span></span>Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><a class="page-number" href="/page/8/">8</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/7/">Next<span></span></a>
  </nav>

</div>
      <div class="openaside"><a class="navbutton" href="#" title="Show Sidebar"></a></div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="Hide Sidebar"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github Card</p>
<div class="github-card" data-github="yu66" data-width="220" data-height="119" data-theme="medium">
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>
  </div>



  
<div class="categorieslist">
	<p class="asidetitle">Categories</p>
		<ul>
		
		  
			<li><a href="/categories/JVM/" title="JVM">JVM<sup>38</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java/" title="Java">Java<sup>36</sup></a></li>
		  
		
		  
			<li><a href="/categories/Java-Library/" title="Java Library">Java Library<sup>40</sup></a></li>
		  
		
		  
			<li><a href="/categories/Nginx/" title="Nginx">Nginx<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/NoSql/" title="NoSql">NoSql<sup>9</sup></a></li>
		  
		
		  
			<li><a href="/categories/ZooKeeper/" title="ZooKeeper">ZooKeeper<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/数据库/" title="数据库">数据库<sup>10</sup></a></li>
		  
		
		  
			<li><a href="/categories/杂记/" title="杂记">杂记<sup>23</sup></a></li>
		  
		
		  
			<li><a href="/categories/算法/" title="算法">算法<sup>11</sup></a></li>
		  
		
		  
			<li><a href="/categories/编程语言/" title="编程语言">编程语言<sup>20</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">Tags</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Netty/" title="Netty">Netty<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/asm/" title="asm">asm<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Spring/" title="Spring">Spring<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Guice/" title="Guice">Guice<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">Links</p>
    <ul>
        
          <li>
            
            	<a href="http://vertx.yu66.wang/" target="_blank" title="vertx3">vertx3</a>
            
          </li>
        
    </ul>
</div>

  

<div class="doubanshow">
<p class="asidetitle">Douban Show</p>
<div>
<script type="text/javascript" src="http://www.douban.com/service/badge/xxxyy/?show=collection&amp;n=12&amp;columns=3&amp;hidelogo=yes&amp;hideself=yes&amp;cat=book|movie" ></script>
</div>
</div>


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS</a>
</div>

  <div class="weiboshow">
  <p class="asidetitle">Weibo</p>
    <iframe width="100%" height="119" class="share_self"  frameborder="0" scrolling="no" src="http://widget.weibo.com/weiboshow/index.php?language=&width=0&height=119&fansRow=2&ptype=1&speed=0&skin=9&isTitle=1&noborder=1&isWeibo=0&isFans=0&uid=3253370782&verifier=e9ca895b&dpc=1"></iframe>
</div>


  

<div class="lofter">
<p class="asidetitle">Lofter</p>

 <iframe width="100%" height="39" class="share_self"  frameborder="0" scrolling="no" src="http://ming15.lofter.com/"></iframe>
</div>




</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 博客,我选择重构 <br/>
			重构使事情变得更美,更加正确</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		<a href="http://weibo.com/3253370782" target="_blank" class="icon-weibo" title="微博"></a>
		
		
		<a href="https://github.com/yu66" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		<a href="https://www.douban.com/people/xxxyy" target="_blank" class="icon-douban" title="豆瓣"></a>
		
		
		<a href="http://www.zhihu.com/people/ming15" target="_blank" class="icon-zhihu" title="知乎"></a>
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="王玉">王玉</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
        
    }
  });
});
</script>




<script type="text/javascript">
  var duoshuoQuery = {short_name:"wanggnim"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
    || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
</script> 







<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F9e8fca440159a2125668804e46682db4' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="Back to Top"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
 </html>
